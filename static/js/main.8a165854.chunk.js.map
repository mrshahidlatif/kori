{"version":3,"sources":["components/ChartConfigPanel/index.module.css","components/Link/index.module.css","components/ChartGallery/index.module.css","components/Editor/index.module.css","components/ManualLinkControls/index.module.css","components/SuggestionPanel/index.module.css","components/PotentialLinkControls/index.module.css","components/HighlightTextSelection/index.module.css","components/Chart/index.module.css","utils/uniqueId.js","ducks/charts.js","ducks/docs.js","components/Navbar/index.jsx","components/Home/index.jsx","ducks/ui.js","components/Doc/index.jsx","components/Docs/index.jsx","utils/addSignalToChartSpec.js","utils/addBrushToVegaLiteSpec.js","utils/throttle.js","components/ChartConfigPanel/index.jsx","ducks/links.js","components/ManualLinkControls/index.jsx","components/ChartBlock/index.jsx","components/EditorToolbar/index.jsx","utils/createChartBlockPlugin.js","components/SuggestionPanel/index.jsx","components/PotentialLinkControls/index.jsx","utils/editorDecorators.js","components/HighlightTextSelection/index.jsx","components/Link/index.jsx","utils/findSuggestions.js","utils/parseWitResponse.js","utils/findLinks.js","utils/splitTextIntoNWordsList.js","utils/insertLinks.js","utils/getLastTypedWord.js","utils/getLastTypedSentence.js","utils/getTextSelection.js","utils/deHighlightTextSelection.js","components/Editor/index.jsx","utils/highlightTextSelection.js","components/View/index.jsx","components/Chart/index.jsx","utils/extractChartFeatures.js","utils/createThumbnail.js","components/ChartGallery/index.jsx","components/Edit/index.jsx","App.js","serviceWorker.js","ducks/index.js","index.js"],"names":["module","exports","nanoid","customAlphabet","prefix","createChart","docId","spec","liteSpec","attrs","chartId","uniqueId","type","timestamp","Date","now","highlight","channel","active","inactive","id","updateChart","getCharts","createSelector","state","docs","charts","_","map","cid","getChartsInEditor","chartsInEditor","initialState","testchart","thumbnail","properties","axes","name","field","data","title","features","value","barChartSpec","barChartLiteSpec","updateDoc","updateChartsInEditor","testdoc","sentences","editorRawState","blocks","key","text","depth","inlineStyleRanges","offset","length","style","entityRanges","entityMap","useStyles","makeStyles","theme","root","flexGrow","marginBottom","spacing","classes","dispatch","useDispatch","useSelector","ui","currentDocId","doc","AppBar","className","position","color","Toolbar","variant","Link","underline","component","RouterLink","to","TextField","onChange","e","target","size","fullWidth","margin","marginLeft","marginRight","label","Button","Home","Grid","container","justify","item","xs","Typography","gutterBottom","Box","Fab","aria-label","display","setSelectedLink","link","setTextSelection","textSelection","setManualLinkId","linkId","exitManualLinkMode","exit","button","width","padding","paper","justifyContent","alignItems","palette","secondary","height","Doc","props","onClick","Paper","elevation","Docs","Object","values","action","createDoc","console","log","isMap","mark","selections","paintbrush","toggle","brush","encoding","condition","selection","addBrushToVegaLiteSpec","compile","forEach","d","url","startsWith","process","signals","start","end","enabled","marks","addSignalToMark","includes","activePredicate","inactivePredicate","oldProp","encode","update","highlightProp","test","concat","isArray","func","last","deferTimer","wait","throttled","args","clearTimeout","setTimeout","ChartConfigPanel","channelOptions","opacity","fill","colors","chart","useState","setActive","setInactive","handleActiveChangeCommitted","event","newValue","handleInactiveChangeCommitted","zIndex","css","panel","top","left","onMouseDown","stopPropagation","p","direction","Select","option","keys","MenuItem","Slider","aria-labelledby","valueLabelDisplay","min","max","step","onChangeCommitted","picker","bgcolor","border","onMouseUp","createLinks","links","deactivateLink","ManualLinkControls","window","getSelection","pos","rangeCount","getRangeAt","getBoundingClientRect","options","chartProperties","selectedChart","cp","featureFields","f","Set","React","open","setOpen","anchorRef","useRef","selectedIndex","setSelectedIndex","handleClose","current","contains","right","ButtonGroup","ref","aria-controls","undefined","aria-expanded","aria-haspopup","prevOpen","endIcon","preventDefault","multiPoint","viewData","points","i","j","_vgsid_","push","feature","startIndex","endIndex","sentence","isConfirmed","fieldX","fieldY","rangeX","rangeY","fields","brushFieldIndex","findIndex","currentDoc","makeManualLink","selectedMarks","Popper","anchorEl","role","transition","disablePortal","TransitionProps","placement","Grow","transformOrigin","ClickAwayListener","onClickAway","MenuList","index","selected","handleMenuItemClick","memo","block","blockProps","customStyleMap","customStyleFn","decorator","forceSelection","offsetKey","tree","contentState","blockStyleFn","preventScroll","elementProps","view","setView","containerEl","chartEl","ratio","setRatio","useParams","setSelectedMarks","setViewData","setBrush","toggleSettings","setToggleSettings","filter","shallowEqual","useMemo","addSignalToChartSpec","JSON","parse","stringify","resize","runAsync","useEffect","a","runtime","View","tempView","toCanvas","canvas","vegaEmbed","actions","result","addDataListener","error","asyncExec","throttle","some","signal","rangeMin","rangeMax","showConfig","getAnchorKey","getKey","highlightStyle","indexOf","borderStyle","borderColor","Fragment","IconButton","toolbarPlugin","createToolbarPlugin","focusPlugin","createFocusPlugin","alignmentPlugin","createAlignmentPlugin","resizeablePlugin","createResizeablePlugin","AlignmentTool","EditorPlugins","config","ChartBlock","blockRendererFn","getEditorState","getType","entity","getCurrentContent","getEntity","getEntityAt","getData","editable","createChartBlockPlugin","composeDecorators","EditorToolbar","externalProps","SuggestionPanel","handleClick","suggestion","onSelected","x","y","suggestionPanel","List","ListItem","onCreateLinkSelect","ListItemIcon","suggestions","slice","dense","bind","ListItemAvatar","Avatar","alt","src","ListItemText","primary","PotentialLinkControls","selectedLink","potentialLinkControls","onDiscard","strategy","contentBlock","callback","findEntityRanges","character","entityKey","data-offset-key","children","potentialLink","onMouseOver","onMouseLeave","partialText","toLowerCase","toString","response","intent","parsedResponse","entities","hasOwnProperty","confidence","Infinity","object_in_group","group","obj","group_one","group_two","group1","group2","client","Wit","accessToken","findWordLink","findPhraseLink","matches","fsResult","fuzzyMatch","userTyped","matchedFeature","m","linkStartIndex","linkEndIndex","word","list","split","n","words","splitTextIntoNWordsList","fs","FuzzySet","get","shift","match","message","parseWitResponse","linkPhrase","substring","group1Matches","group2Matches","findMatchesInChartFeatures","group1Data","group2Data","terms","editorState","currentSelection","insertLink","currentContent","blockEndIndex","getAnchorOffset","blockKey","newContent","createEntity","getLastCreatedEntityKey","insertTextSelection","merge","anchorOffset","focusOffset","Modifier","replaceText","caretNewIndex","newEditorState","EditorState","newSelection","moveSelectionToEnd","currentBlock","getBlockForKey","caretOffset","blockTextBeforeCaret","getText","substr","lastWord","pop","charAt","lastSentence","nlp","blockDelimiter","startKey","getStartKey","endKey","getEndKey","getBlockMap","lastWasEnd","skipUntil","takeUntil","getStartOffset","getEndOffset","join","sIndex","eIndex","isBackward","currentSelectionState","currentContentState","newContentState","applyEntity","Editor","storedEditorState","allLinks","exitManualLink","manualLinkId","textSelectionInStore","tempTextSelection","setTempTextSelection","editorEl","setSuggestions","createEmpty","convertFromRaw","createWithContent","setEditorState","setSentences","setCurrentSelectionState","viewMode","convertToRaw","lastTypedWord","getLastTypedWord","getLastTypedSentence","findLinks","insertLinks","findSuggestions","ids","reduce","acc","caretPosition","activeBlockKey","getTextSelection","trim","deHighlightTextSelection","focus","editor","onDragOver","onDrop","dataTransfer","find","exists","AtomicBlockUtils","insertAtomicBlock","insertChart","clearData","plugins","onBlur","handleKeyCommand","command","RichUtils","decorators","editorDecorators","readOnly","s","createLink","highlightTextSelection","ContentState","createFromText","Edit","then","hover","setHover","draggable","onDragStart","setData","onMouseEnter","featureMap","getState","truthy","falsy","recurse","datum","entries","isString","axesMap","extractChartAxes","scales","scale","row","domain","isDate","searchFieldName","scaleName","enter","relatedAxis","axis","toImageURL","img","resized","orgImg","Promise","resolve","reject","Image","onload","document","createElement","ctx","getContext","drawImage","this","toDataURL","ChartGallery","dragging","setDragging","errorMsg","setErrorMsg","onDragEnter","onDragLeave","file","files","reader","FileReader","createThumbnail","extractChartFeatures","readAsText","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","onClose","draggingArea","App","Navbar","Container","maxWidth","mt","path","Boolean","location","hostname","combineReducers","newState","createMuiTheme","main","info","warning","success","textSecondary","localforage","getItem","catch","err","middleware","reduxFreeze","createLogger","store","createStore","rootReducer","applyMiddleware","subscribe","setItem","ReactDOM","render","ThemeProvider","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.8a165854.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"panel\":\"ChartConfigPanel_panel__1OEWt\",\"picker\":\"ChartConfigPanel_picker__2cC4T\",\"color\":\"ChartConfigPanel_color__2Pmzu\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"link\":\"Link_link__jXHvo\",\"potentialLink\":\"Link_potentialLink__3JiCy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ChartGallery_container__pQIvT\",\"draggingArea\":\"ChartGallery_draggingArea__Wft5P\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"editor\":\"Editor_editor__2c4G6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"potentialLinkControls\":\"ManualLinkControls_potentialLinkControls__3YAy9\",\"panel\":\"ManualLinkControls_panel__Ke1GF\",\"message\":\"ManualLinkControls_message__3Av28\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"suggestionPanel\":\"SuggestionPanel_suggestionPanel__2eTnI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"potentialLinkControls\":\"PotentialLinkControls_potentialLinkControls__7i3RY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"textSelection\":\"HighlightTextSelection_textSelection__2uV3y\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Chart_container__-PcK5\"};","import { customAlphabet } from 'nanoid'\r\nconst nanoid = customAlphabet('1234567890abcdefghijklmnopqrstuvwxyz', 10)\r\nexport default (prefix) => { \r\n\treturn (prefix ? prefix + nanoid() : nanoid());\r\n};","import uniqueId from \"utils/uniqueId\";\r\nimport barChartSpec from \"./specs/barchart.json\";\r\nimport barChartLiteSpec from \"./specs/barChartLite.json\";\r\nimport { createSelector } from \"reselect\";\r\n\r\n// action types\r\nexport const CREATE_CHART = \"CREATE_CHART\";\r\nexport const UPDATE_CHART = \"UPDATE_CHART\";\r\nexport const DELETE_CHART = \"DELETE_CHART\";\r\n\r\n// actions\r\nexport const createChart = (docId, spec, liteSpec, attrs = {}) => {\r\n    let chartId = uniqueId(\"chart-\");\r\n    attrs = {\r\n        docId,\r\n        spec,\r\n        liteSpec,\r\n        timestamp: Date.now(),\r\n        highlight: { channel: \"opacity\", active: 1.0, inactive: 0.1 },\r\n        ...attrs,\r\n        id: chartId,\r\n    };\r\n    return { type: CREATE_CHART, chartId, attrs };\r\n};\r\n\r\nexport const updateChart = (chartId, attrs) => {\r\n    return { type: UPDATE_CHART, chartId, attrs };\r\n};\r\n\r\nexport const deleteChart = (chartId) => {\r\n    return {\r\n        type: DELETE_CHART,\r\n        chartId,\r\n    };\r\n};\r\n// selectors\r\nexport const getCharts = createSelector(\r\n    (state) => state.docs,\r\n    (state) => state.charts,\r\n    (_, docId) => docId,\r\n    (docs, charts, docId) => docs[docId].charts.map((cid) => charts[cid])\r\n);\r\n\r\nexport const getChartsInEditor = createSelector(\r\n    (state) => state.docs,\r\n    (state) => state.charts,\r\n    (_, docId) => docId,\r\n    (docs, charts, docId) => docs[docId].chartsInEditor.map((cid) => charts[cid])\r\n);\r\n// reducers\r\nconst initialState = {\r\n    testchart: {\r\n        id: \"testchart\",\r\n        docId: \"testdoc\",\r\n        timestamp: Date.now(),\r\n        thumbnail:\r\n            \"data:image/png;base64,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\",\r\n        highlight: { channel: \"opacity\", active: 1.0, inactive: 0.1 },\r\n        properties: {\r\n            axes: [\r\n                {\r\n                    name: \"x\",\r\n                    field: \"category\",\r\n                    data: \"data_0\",\r\n                    type: \"ordinal\",\r\n                    title: \"category\",\r\n                },\r\n                { name: \"y\", field: \"amount\", data: \"data_0\", type: \"linear\", title: \"amount\" },\r\n            ],\r\n            features: [\r\n                { value: \"Apple\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Amazon\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Facebook\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Netflix\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Microsoft\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Samsung\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Twitter\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Linkedin\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n            ],\r\n        },\r\n        spec: barChartSpec,\r\n        liteSpec: barChartLiteSpec,\r\n    },\r\n};\r\n\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case CREATE_CHART:\r\n        case UPDATE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.chartId]: {\r\n                    ...(state[action.chartId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case DELETE_CHART: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.chartId];\r\n            return newState;\r\n        }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import uniqueId from \"utils/uniqueId\";\r\nimport { CREATE_CHART, DELETE_CHART } from \"ducks/charts\";\r\n// action types\r\nexport const CREATE_DOC = \"CREATE_DOC\";\r\nexport const UPDATE_DOC = \"UPDATE_DOC\";\r\nexport const DELETE_DOC = \"DELETE_DOC\";\r\n\r\nexport const UPDATE_EDITOR_STATE = \"UPDATE_EDITOR_STATE\";\r\nexport const UPDATE_CHARTS_IN_EDITOR = \"UPDATE_CHARTS_IN_EDITOR\";\r\n\r\n// actions\r\nexport const createDoc = (attrs = {}) => {\r\n    let docId = uniqueId();\r\n    attrs = {\r\n        title: \"Untitled\",\r\n        editorRawState: null,\r\n        timestamp: Date.now(),\r\n        sentences: [],\r\n        charts: [],\r\n        chartsInEditor: [],\r\n        ...attrs,\r\n        id: docId,\r\n    };\r\n    return { type: CREATE_DOC, docId, attrs };\r\n};\r\n\r\nexport const updateDoc = (docId, attrs) => {\r\n    return { type: UPDATE_DOC, docId, attrs };\r\n};\r\n\r\nexport const deleteDoc = (docId) => {\r\n    return {\r\n        type: DELETE_DOC,\r\n        docId,\r\n    };\r\n};\r\n\r\nexport const updateChartsInEditor = (docId, charts) => {\r\n    return { type: UPDATE_CHARTS_IN_EDITOR, docId, charts };\r\n};\r\n\r\n// selectors\r\n\r\n// reducers\r\n\r\nconst initialState = {\r\n    testdoc: {\r\n        id: \"testdoc\",\r\n        title: \"Testing...\",\r\n        timestamp: Date.now(),\r\n        charts: [\"testchart\"],\r\n        chartsInEditor: [],\r\n        sentences: [],\r\n        editorRawState: {\r\n            blocks: [\r\n                {\r\n                    key: \"8i090\",\r\n                    text: \"Welcome to Vis-Text Editor\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 26,\r\n                            style: \"BOLD\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n                {\r\n                    key: \"42ncd\",\r\n                    text: \"Here you can compose interactive articles\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 42,\r\n                            style: \"UNDERLINE\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n                {\r\n                    key: \"327r6\",\r\n                    text:\r\n                        \"Start dragging the chart from Chart Gallery to the editor and start creating! ;)\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 81,\r\n                            style: \"ITALIC\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n            ],\r\n            entityMap: {},\r\n        },\r\n    },\r\n};\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case CREATE_DOC:\r\n        case UPDATE_DOC:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...(state[action.docId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case DELETE_DOC: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.docId];\r\n            return newState;\r\n        }\r\n        case CREATE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.attrs.docId]: {\r\n                    ...state[action.attrs.docId],\r\n                    charts: state[action.attrs.docId].charts.concat(action.chartId),\r\n                },\r\n            };\r\n        case DELETE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.attrs.docId]: {\r\n                    ...state[action.attrs.docId],\r\n                    charts: state[action.attrs.docId].charts.filter(\r\n                        (cid) => cid !== action.chartId\r\n                    ),\r\n                },\r\n            };\r\n\r\n        case UPDATE_CHARTS_IN_EDITOR:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...state[action.docId],\r\n                    chartsInEditor: action.charts,\r\n                },\r\n            };\r\n        case UPDATE_EDITOR_STATE:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...state[action.docId],\r\n                    editorRawState: action.editorRawState,\r\n                },\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React, { Fragment } from \"react\";\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport AppBar from \"@material-ui/core/AppBar\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Link from \"@material-ui/core/Link\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { updateDoc } from \"ducks/docs\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    root: {\r\n        flexGrow: 1,\r\n        marginBottom: theme.spacing(3),\r\n    },\r\n    // menuButton: {\r\n    //   marginRight: theme.spacing(2),\r\n    // },\r\n    title: {\r\n        flexGrow: 1,\r\n    },\r\n}));\r\n\r\nexport default function () {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n    const docId = useSelector((state) => state.ui.currentDocId);\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n\r\n    function handleChange(e) {\r\n        dispatch(updateDoc(docId, { title: e.target.value }));\r\n    }\r\n    return (\r\n        <AppBar className={classes.root} position=\"static\" color=\"inherit\">\r\n            <Toolbar variant=\"dense\">\r\n                {/* <Button  color=\"inherit\" component={RouterLink} to=\"/docs\">\r\n        <Typography variant=\"h6\" className={classes.title}>\r\n        GORI\r\n          </Typography>\r\n        </Button> */}\r\n                <Link\r\n                    variant=\"h6\"\r\n                    className={classes.title}\r\n                    underline=\"none\"\r\n                    color=\"inherit\"\r\n                    component={RouterLink}\r\n                    to=\"/\"\r\n                >\r\n                    GORI\r\n                </Link>\r\n                {/* <Typography variant=\"h6\" className={classes.title} >\r\n\r\n          \r\n          </Typography> */}\r\n                {docId && (\r\n                    <TextField\r\n                        value={doc.title}\r\n                        onChange={handleChange}\r\n                        size=\"small\"\r\n                        fullWidth\r\n                        margin=\"dense\"\r\n                        variant=\"filled\"\r\n                        style={{ marginLeft: \"100px\", marginRight: \"20px\" }}\r\n                        label=\"Document Title\"\r\n                    />\r\n                )}\r\n                <Button color=\"inherit\" component={RouterLink} to=\"/docs\">\r\n                    Docs\r\n                </Button>\r\n\r\n                {docId && (\r\n                    <Fragment>\r\n                        <span style={{ marginLeft: \"10px\", marginRight: \"10px\" }}> | </span>\r\n                        <Button color=\"inherit\" component={RouterLink} to={`/docs/${docId}`}>\r\n                            Edit\r\n                        </Button>\r\n                        <Button color=\"inherit\" component={RouterLink} to={`/docs/${docId}/view`}>\r\n                            View\r\n                        </Button>\r\n                    </Fragment>\r\n                )}\r\n            </Toolbar>\r\n        </AppBar>\r\n    );\r\n}\r\n","import React from 'react'\r\nimport Fab from '@material-ui/core/Fab';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Box from '@material-ui/core/Box';\r\nimport NavigationIcon from '@material-ui/icons/Navigation';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport { Link } from 'react-router-dom';\r\nfunction Home() {\r\n    return (\r\n        <Grid container spacing={3} justify=\"center\">\r\n            <Grid item xs={6}>\r\n                <Typography variant=\"h2\" gutterBottom>\r\n                    Title\r\n                </Typography>\r\n                <Box marginBottom={2}>\r\n                    <Typography variant=\"body1\" gutterBottom>\r\n                        Abstract\r\n                    </Typography>\r\n                </Box>                \r\n                <Fab variant=\"extended\" color=\"primary\" aria-label=\"add\" component={Link} to=\"/docs\">\r\n                    <NavigationIcon />\r\n                    Get Started\r\n                </Fab>\r\n            </Grid>\r\n            <Grid item xs={6}>\r\n                <Typography variant=\"overline\" display=\"block\" gutterBottom>\r\n                    Teaser Image/Video\r\n                </Typography>\r\n            </Grid>\r\n        </Grid>\r\n\r\n    )\r\n}\r\n\r\nexport default Home\r\n","export const SET_SELECTED_LINK = \"SET_SELECTED_LINK\";\r\nexport const SET_TEXT_SELECTION = \"SET_TEXT_SELECTION\";\r\nexport const SET_MANUAL_LINK_ID = \"SET_MANUAL_LINK_ID\";\r\nexport const EXIT_MANUAL_LINK_MODE = \"EXIT_MANUAL_LINK_MODE\";\r\nexport const SET_CURRENT_DOC_ID = \"SET_CURRENT_DOC_ID\";\r\n\r\nexport const setSelectedLink = (link) => {\r\n    return { type: SET_SELECTED_LINK, link };\r\n};\r\nexport const setTextSelection = (textSelection) => {\r\n    return { type: SET_TEXT_SELECTION, textSelection };\r\n};\r\nexport const setManualLinkId = (linkId) => {\r\n    return { type: SET_MANUAL_LINK_ID, linkId };\r\n};\r\nexport const exitManualLinkMode = (exit) => {\r\n    return { type: EXIT_MANUAL_LINK_MODE, exit };\r\n};\r\n\r\nexport const SetCurrentDocId = (docId) => {\r\n    return { type: SET_CURRENT_DOC_ID, docId };\r\n};\r\n\r\n//reducers\r\nconst initialState = {};\r\n\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case SET_SELECTED_LINK:\r\n            return {\r\n                ...state,\r\n                selectedLink: action.link,\r\n            };\r\n        case SET_TEXT_SELECTION:\r\n            return {\r\n                ...state,\r\n                textSelection: action.textSelection,\r\n            };\r\n        case SET_MANUAL_LINK_ID:\r\n            return {\r\n                ...state,\r\n                manualLinkId: action.linkId,\r\n            };\r\n        case EXIT_MANUAL_LINK_MODE:\r\n            return {\r\n                ...state,\r\n                exitManualLink: action.exit,\r\n            };\r\n        case SET_CURRENT_DOC_ID:\r\n            return {\r\n                ...state,\r\n                currentDocId: action.docId,\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React from \"react\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\n\r\nimport { createDoc } from \"ducks/docs\";\r\nimport { SetCurrentDocId } from \"ducks/ui\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    button: {\r\n        width: \"100%\",\r\n        padding: theme.spacing(1),\r\n        margin: theme.spacing(1),\r\n    },\r\n    paper: {\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        color: theme.palette.text.secondary,\r\n        height: theme.spacing(16),\r\n        width: \"100%\",\r\n    },\r\n}));\r\n\r\nfunction Doc(props) {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n\r\n    function handleClick() {\r\n        dispatch(SetCurrentDocId(props.docId));\r\n    }\r\n\r\n    return (\r\n        <Button\r\n            className={classes.button}\r\n            component={RouterLink}\r\n            to={`/docs/${props.docId}`}\r\n            onClick={handleClick}\r\n        >\r\n            <Paper className={classes.paper} elevation={2}>\r\n                {props.doc.title}\r\n                <div></div>\r\n            </Paper>\r\n        </Button>\r\n    );\r\n}\r\n\r\nexport default Doc;\r\n","import React from \"react\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport Doc from \"components/Doc\";\r\n\r\nimport { createDoc } from \"ducks/docs\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    button: {\r\n        width: \"100%\",\r\n        padding: theme.spacing(1),\r\n        margin: theme.spacing(1),\r\n    },\r\n    paper: {\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        color: theme.palette.text.secondary,\r\n        height: theme.spacing(16),\r\n        width: \"100%\",\r\n    },\r\n}));\r\n\r\nfunction Docs() {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n    const docs = useSelector((state) => Object.values(state.docs));\r\n\r\n    function handleClick() {\r\n        const action = createDoc();\r\n        dispatch(action);\r\n    }\r\n\r\n    return (\r\n        <Grid container spacing={1}>\r\n            <Grid item xs={2}>\r\n                <Button className={classes.button} onClick={handleClick}>\r\n                    <Paper className={classes.paper} variant=\"outlined\">\r\n                        <AddIcon />\r\n                    </Paper>\r\n                </Button>\r\n            </Grid>\r\n            {docs.map((doc) => (\r\n                <Grid key={doc.id} item xs={2}>\r\n                    <Doc doc={doc} docId={doc.id} />\r\n                </Grid>\r\n            ))}\r\n        </Grid>\r\n    );\r\n}\r\n\r\nexport default Docs;\r\n","// TODO: support different encodings?\r\nimport { isArray, isObject } from \"vega-util\";\r\nimport addBrushToVegaLiteSpec from \"utils/addBrushToVegaLiteSpec\";\r\nimport { compile } from \"vega-lite/build/vega-lite\";\r\n\r\nexport default (highlight, liteSpec) => {\r\n    addBrushToVegaLiteSpec(liteSpec);\r\n    console.log(\"VegaLite Spec After adding brush\", liteSpec);\r\n\r\n    const spec = compile(liteSpec).spec; // vega spec\r\n    // support vega-lite sample datasets\r\n\r\n    spec.data.forEach((d) => {\r\n        if (d.url && d.url.startsWith(\"data\")) {\r\n            d.url = process.env.PUBLIC_URL + \"/\" + d.url;\r\n        }\r\n    });\r\n\r\n    // highlight\r\n    spec.signals = [\r\n        ...(spec.signals || []),\r\n        {\r\n            name: \"highlight\", // should we add a prefix to avoid conflict with existing signals\r\n            value: { data: [], start: 0, end: 100, enabled: false },\r\n        },\r\n    ];\r\n\r\n    spec.marks.forEach((mark) => {\r\n        addSignalToMark(mark, highlight);\r\n    });\r\n    return spec;\r\n};\r\n\r\nexport function addSignalToMark(mark, highlight) {\r\n    if (mark.type === \"group\") {\r\n        // recursive\r\n        if (mark.marks) {\r\n            mark.marks.forEach((mark) => addSignalToMark(mark, highlight)); // will this generalize to all charts?\r\n        }\r\n        return;\r\n    }\r\n    const isMap = mark.type === \"shape\" && mark.style.includes(\"geoshape\");\r\n    const activePredicate = `highlight.enabled===true && (\r\n        (indexof(highlight.data, ${isMap ? \"datum.properties\" : \"datum\"}[highlight.field])!=-1) ||\r\n        (datum[highlight.field] > highlight.rangeMin && datum[highlight.field]<highlight.rangeMax) ||\r\n        (datum[highlight.fieldX] > highlight.rangeX[0] && datum[highlight.fieldX] < highlight.rangeX[1] &&\r\n            datum[highlight.fieldY] < highlight.rangeY[0] && datum[highlight.fieldY] > highlight.rangeY[1] )\r\n    )`;\r\n    //TODO: reduce redundant checking\r\n    const inactivePredicate = `highlight.enabled===true && !(\r\n        (indexof(highlight.data, ${isMap ? \"datum.properties\" : \"datum\"}[highlight.field])!=-1) ||\r\n        (datum[highlight.field] > highlight.rangeMin && datum[highlight.field]<highlight.rangeMax)\r\n    )`;\r\n    const oldProp = mark.encode.update[highlight.channel];\r\n    const highlightProp = [\r\n        {\r\n            test: activePredicate,\r\n            value: highlight.active,\r\n        },\r\n        {\r\n            test: inactivePredicate,\r\n            value: highlight.inactive,\r\n        },\r\n        // put existing property if exists either in array or object form\r\n        //TODO: see if we need the Object Check?\r\n        // ...(isObject(oldProp) ? [oldProp] : isArray(oldProp) ? oldProp : []),\r\n    ];\r\n    mark.encode.update = {\r\n        ...mark.encode.update,\r\n        [highlight.channel]: highlightProp.concat(isArray(oldProp) ? oldProp : []),\r\n    };\r\n}\r\n","const CLEAR_SELECTION_TIMER = 10000; //time in ms\r\nexport default (liteSpec) => {\r\n    console.log(\"VegaLite Spec\", liteSpec);\r\n\r\n    const selectionClearCondition = {\r\n        type: \"timer\",\r\n        throttle: CLEAR_SELECTION_TIMER,\r\n    };\r\n\r\n    //TODO: Brush doesn't make sense for maps or pie chart. If we do add, it throws an error\r\n    const isMap = liteSpec.mark === \"geoshape\" || liteSpec.mark.type === \"arc\";\r\n    const selections = isMap\r\n        ? {\r\n              paintbrush: { type: \"multi\", toggle: true },\r\n          }\r\n        : {\r\n              brush: {\r\n                  type: \"interval\",\r\n                  //   clear: selectionClearCondition,\r\n              },\r\n              paintbrush: {\r\n                  type: \"multi\",\r\n                  toggle: true,\r\n                  //   clear: selectionClearCondition,\r\n              },\r\n          };\r\n\r\n    liteSpec[\"selection\"] = selections;\r\n    //TODO: Check what's wrong with multiple conditions https://github.com/vega/vega-lite/issues/3040\r\n    if (!isMap)\r\n        liteSpec.encoding[\"opacity\"] = {\r\n            condition: [\r\n                // {\r\n                //     selection: \"brush\",\r\n                //     value: 1,\r\n                // },\r\n                {\r\n                    selection: \"paintbrush\",\r\n                    value: 1,\r\n                },\r\n            ],\r\n            value: 0.1,\r\n        };\r\n    return liteSpec;\r\n};\r\n","export default (func, wait = 50) => {\r\n  let last;\r\n  let deferTimer;\r\n\r\n  const throttled = (...args) => {\r\n    const now = Date.now();\r\n\r\n    if (last && now < last + wait) {\r\n      clearTimeout(deferTimer);\r\n\r\n      deferTimer = setTimeout(() => {\r\n        last = now;\r\n        func(...args);\r\n      }, wait);\r\n    } else {\r\n      last = now;\r\n      func(...args);\r\n    }\r\n  };\r\n\r\n  return throttled;\r\n};\r\n","import React, { useState } from \"react\";\r\nimport css from \"./index.module.css\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Slider from \"@material-ui/core/Slider\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Select from \"@material-ui/core/Select\";\r\nimport PropTypes from \"prop-types\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { updateChart } from \"ducks/charts\";\r\n\r\nexport default function ChartConfigPanel(props) {\r\n    const dispatch = useDispatch();\r\n    const channelOptions = {\r\n        opacity: { active: 1.0, inactive: 0.1 },\r\n        fill: { active: \"#1f77b4\", inactive: \"#c7c7c7\" },\r\n    };\r\n    const colors = [\r\n        \"#1f77b4\",\r\n        \"#aec7e8\",\r\n        \"#ff7f0e\",\r\n        \"#ffbb78\",\r\n        \"#2ca02c\",\r\n        \"#98df8a\",\r\n        \"#d62728\",\r\n        \"#ff9896\",\r\n        \"#9467bd\",\r\n        \"#c5b0d5\",\r\n        \"#8c564b\",\r\n        \"#c49c94\",\r\n        \"#e377c2\",\r\n        \"#f7b6d2\",\r\n        \"#7f7f7f\",\r\n        \"#c7c7c7\",\r\n        \"#bcbd22\",\r\n        \"#dbdb8d\",\r\n        \"#17becf\",\r\n        \"#9edae5\",\r\n    ];\r\n    const highlight = props.chart.highlight;\r\n    const [active, setActive] = useState(highlight.active); // necessary for handling intermediate changes\r\n    const [inactive, setInactive] = useState(highlight.inactive); // to prevent constant flickering chart updates\r\n    function handleChannelChange(event) {\r\n        // setChannel(event.target.value);\r\n        const channel = event.target.value;\r\n\r\n        if (channel !== highlight.channel) {\r\n            const option = channelOptions[channel];\r\n            setActive(option.active);\r\n            setInactive(option.inactive);\r\n            dispatch(\r\n                updateChart(props.chart.id, { highlight: { channel, ...channelOptions[channel] } })\r\n            );\r\n        }\r\n    }\r\n    function handleActiveChange(event, newValue) {\r\n        setActive(newValue);\r\n    }\r\n    function handleInactiveChange(event, newValue) {\r\n        setInactive(newValue);\r\n    }\r\n    function handleActiveChangeCommitted(event, newValue) {\r\n        setActive(newValue);\r\n        dispatch(updateChart(props.chart.id, { highlight: { ...highlight, active: newValue } }));\r\n    }\r\n    function handleInactiveChangeCommitted(event, newValue) {\r\n        setInactive(newValue);\r\n        dispatch(updateChart(props.chart.id, { highlight: { ...highlight, inactive: newValue } }));\r\n    }\r\n    return (\r\n        <div>\r\n            <Box\r\n                zIndex=\"modal\"\r\n                className={css.panel}\r\n                top={40}\r\n                left={\"45%\"}\r\n                onMouseDown={(e) => e.stopPropagation()}\r\n            >\r\n                <Box component={Paper} p={2}>\r\n                    <Grid container direction=\"column\" spacing={2}>\r\n                        <Grid item>\r\n                            <Typography gutterBottom>Highlight Option</Typography>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <Typography variant=\"caption\">Channel</Typography>\r\n                            <Box>\r\n                                <Select value={highlight.channel} onChange={handleChannelChange}>\r\n                                    {Object.keys(channelOptions).map((option) => (\r\n                                        <MenuItem key={option} value={option}>\r\n                                            {option}\r\n                                        </MenuItem>\r\n                                    ))}\r\n                                </Select>\r\n                            </Box>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <Typography variant=\"caption\">Active</Typography>\r\n                            {highlight.channel === \"opacity\" ? (\r\n                                <Slider\r\n                                    value={active}\r\n                                    aria-labelledby=\"discrete-slider\"\r\n                                    valueLabelDisplay=\"auto\"\r\n                                    min={0.0}\r\n                                    max={1.0}\r\n                                    step={0.05}\r\n                                    onChange={handleActiveChange}\r\n                                    onChangeCommitted={handleActiveChangeCommitted}\r\n                                />\r\n                            ) : (\r\n                                <Box className={css.picker}>\r\n                                    {colors.map((color) => (\r\n                                        <Box\r\n                                            className={css.color}\r\n                                            bgcolor={color}\r\n                                            border={color === active ? 1 : 0}\r\n                                            onMouseUp={(e) => handleActiveChangeCommitted(e, color)}\r\n                                        />\r\n                                    ))}\r\n                                </Box>\r\n                            )}\r\n                            <Typography variant=\"caption\">Inactive</Typography>\r\n                            {highlight.channel === \"opacity\" ? (\r\n                                <Slider\r\n                                    value={inactive}\r\n                                    aria-labelledby=\"discrete-slider\"\r\n                                    valueLabelDisplay=\"auto\"\r\n                                    min={0.0}\r\n                                    max={1.0}\r\n                                    step={0.05}\r\n                                    onChange={handleInactiveChange}\r\n                                    onChangeCommitted={handleInactiveChangeCommitted}\r\n                                />\r\n                            ) : (\r\n                                <Box className={css.picker}>\r\n                                    {colors.map((color) => (\r\n                                        <Box\r\n                                            className={css.color}\r\n                                            bgcolor={color}\r\n                                            border={color === inactive ? 1 : 0}\r\n                                            onMouseUp={(e) =>\r\n                                                handleInactiveChangeCommitted(e, color)\r\n                                            }\r\n                                        />\r\n                                    ))}\r\n                                </Box>\r\n                            )}\r\n                        </Grid>\r\n                    </Grid>\r\n                </Box>\r\n            </Box>\r\n        </div>\r\n    );\r\n}\r\n\r\nChartConfigPanel.propTypes = {\r\n    chart: PropTypes.object,\r\n    onUpdated: PropTypes.func,\r\n};\r\n","import uniqueId from \"utils/uniqueId\";\r\n\r\n// action types\r\nexport const CREATE_LINK = \"CREATE_LINK\";\r\nexport const UPDATE_LINK = \"UPDATE_LINK\";\r\nexport const DELETE_LINK = \"DELETE_LINK\";\r\nexport const ACTIVATE_LINK = \"ACTIVATE_LINK\";\r\nexport const DEACTIVATE_LINK = \"DEACTIVATE_LINK\";\r\nexport const CREATE_LINKS = \"CREATE_LINKS\";\r\nexport const CONFIRM_LINK = \"CONFIRM_LINK\";\r\n\r\nexport const createLink = (docId, link, attrs = {}) => {\r\n    let linkId = uniqueId(\"link-\");\r\n    attrs = {\r\n        docId,\r\n        timestamp: Date.now(),\r\n        ...link, // chartId, text, etc\r\n        ...attrs, // will override the above properties if any attr is set in attrs\r\n        id: linkId,\r\n    };\r\n    return { type: CREATE_LINK, linkId, attrs };\r\n};\r\n\r\nexport const createLinks = (docId, links) => {\r\n    return {\r\n        type: CREATE_LINKS,\r\n        links: links.map((link) => ({\r\n            ...link,\r\n            timestamp: Date.now(),\r\n            docId,\r\n            id: uniqueId(\"link-\"),\r\n        })),\r\n    };\r\n};\r\n\r\nexport const updateLink = (linkId, attrs) => {\r\n    return { type: UPDATE_LINK, linkId, attrs };\r\n};\r\n\r\nexport const deleteLink = (linkId) => {\r\n    return {\r\n        type: DELETE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const activateLink = (linkId) => {\r\n    return {\r\n        type: ACTIVATE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const deactivateLink = (linkId) => {\r\n    return {\r\n        type: DEACTIVATE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const confirmLink = (linkId) => {\r\n    return {\r\n        type: CONFIRM_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\n// selectors\r\n\r\n// reducers\r\nexport default (state = {}, action) => {\r\n    switch (action.type) {\r\n        case CREATE_LINK:\r\n        case UPDATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...(state[action.linkId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case CREATE_LINKS:\r\n            return action.links.reduce((state, link) => {\r\n                return {\r\n                    ...state,\r\n                    [link.id]: link,\r\n                };\r\n            }, state);\r\n        case DELETE_LINK: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.linkId];\r\n            return newState;\r\n        }\r\n        case ACTIVATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    active: true,\r\n                },\r\n            };\r\n        case DEACTIVATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    active: false,\r\n                },\r\n            };\r\n        case CONFIRM_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    isConfirmed: true,\r\n                },\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\n\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\n\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\r\nimport ArrowDropDownIcon from \"@material-ui/icons/ArrowDropDown\";\r\nimport ClickAwayListener from \"@material-ui/core/ClickAwayListener\";\r\nimport Grow from \"@material-ui/core/Grow\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Popper from \"@material-ui/core/Popper\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport MenuList from \"@material-ui/core/MenuList\";\r\n\r\nimport { setTextSelection } from \"ducks/ui\";\r\nimport { createLinks } from \"ducks/links\";\r\nimport { setManualLinkId, exitManualLinkMode } from \"ducks/ui\";\r\n\r\nexport default function ManualLinkControls(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n    const padding = 10;\r\n    let options = [];\r\n\r\n    const chartProperties = props.selectedChart.properties;\r\n    options = chartProperties.axes.map((cp) => cp.field);\r\n    let featureFields = chartProperties.features.map((f) => f.field);\r\n\r\n    options = options.concat(featureFields);\r\n    options = [...new Set(options)];\r\n\r\n    function handleResetClick(event) {\r\n        dispatch(exitManualLinkMode(true));\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        dispatch(setTextSelection(null));\r\n    }\r\n    function handleAcceptClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        makeManualLink(props.textSelection, props.selectedMarks, props.brush, props.viewData);\r\n        dispatch(setTextSelection(null));\r\n        dispatch(exitManualLinkMode(true));\r\n    }\r\n\r\n    const [open, setOpen] = React.useState(false);\r\n    const anchorRef = React.useRef(null);\r\n    const [selectedIndex, setSelectedIndex] = React.useState(1);\r\n\r\n    const handleClick = () => {\r\n        console.info(`You clicked ${options[selectedIndex]}`);\r\n    };\r\n\r\n    const handleMenuItemClick = (event, index) => {\r\n        setSelectedIndex(index);\r\n        setOpen(false);\r\n    };\r\n\r\n    const handleToggle = () => {\r\n        setOpen((prevOpen) => !prevOpen);\r\n    };\r\n\r\n    const handleClose = (event) => {\r\n        if (anchorRef.current && anchorRef.current.contains(event.target)) {\r\n            return;\r\n        }\r\n\r\n        setOpen(false);\r\n    };\r\n\r\n    function makeManualLink(textSelection, multiPoint, brush, viewData) {\r\n        console.log(\"Selected Points\", multiPoint);\r\n        console.log(\"Selected Brush\", brush);\r\n        console.log(\"View Data\", viewData);\r\n\r\n        let link = null;\r\n        if (multiPoint.length > 0) {\r\n            //TODO: _vegasid_ doesn't exist for charts that have built-in data (e.g., canada.json) Strange!\r\n            //TODO: handle multi selection on maps; data is inside viewData.properties: We don't have an example for it.\r\n            console.log(\"Handle MultiPoint Selection\");\r\n            var points = [];\r\n            for (let i = 0; i < multiPoint.length; i++) {\r\n                for (let j = 0; j < viewData.length; j++) {\r\n                    if (multiPoint[i].values[0] === viewData[j]._vgsid_) points.push(viewData[j]);\r\n                }\r\n            }\r\n\r\n            link = {\r\n                text: textSelection.text,\r\n                feature: { field: options[selectedIndex] },\r\n                chartId: props.selectedChart.id,\r\n                active: false,\r\n                type: \"multipoint\",\r\n                data: points.map((d) => d[options[selectedIndex]]),\r\n                startIndex: props.textSelection.startIndex,\r\n                endIndex: props.textSelection.endIndex,\r\n                sentence: \"\",\r\n                isConfirmed: true,\r\n            };\r\n        }\r\n        if (brush.length > 0) {\r\n            console.log(\"Handle Brush Selection\");\r\n            let points;\r\n            let fieldX;\r\n            let fieldY;\r\n            let rangeX;\r\n            let rangeY;\r\n\r\n            //Rectangular Brush\r\n            if (\r\n                brush[0].fields.length === 2 &&\r\n                brush[0].fields[0].type === \"R\" &&\r\n                brush[0].fields[1].type === \"R\"\r\n            ) {\r\n                fieldX = brush[0].fields[0].field;\r\n                fieldY = brush[0].fields[1].field;\r\n                rangeX = brush[0].values[0];\r\n                rangeY = brush[0].values[1];\r\n                points = [];\r\n            } else {\r\n                //Single Axis Brush\r\n                const brushFieldIndex = brush[0].fields.findIndex(\r\n                    (f) => f.field === options[selectedIndex] && f.type === \"E\"\r\n                );\r\n                //TODO: handle single axis brush of type \"R\" too\r\n\r\n                if (brushFieldIndex > -1) {\r\n                    points = brush[0].values[brushFieldIndex];\r\n                }\r\n            }\r\n\r\n            link = {\r\n                text: textSelection.text,\r\n                feature: { field: options[selectedIndex] },\r\n                chartId: props.selectedChart.id,\r\n                active: false,\r\n                type: \"brush\",\r\n                data: points,\r\n                startIndex: props.textSelection.startIndex,\r\n                endIndex: props.textSelection.endIndex,\r\n                sentence: \"\",\r\n                isConfirmed: true,\r\n                fieldX: fieldX,\r\n                rangeX: rangeX,\r\n                fieldY: fieldY,\r\n                rangeY: rangeY,\r\n            };\r\n        }\r\n        if (link !== null) {\r\n            const action = createLinks(props.currentDoc.id, [link]);\r\n            dispatch(action);\r\n            dispatch(setManualLinkId(action.links[0].id));\r\n        } else dispatch(setManualLinkId(null));\r\n    }\r\n\r\n    return pos && props.textSelection ? (\r\n        <Box\r\n            // zIndex=\"modal\"\r\n            // left={pos.x + padding}\r\n            // top={pos.y + padding}\r\n            right={0}\r\n            top={0}\r\n            className={css.panel}\r\n        >\r\n            <Paper elevation={1}>\r\n                <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\r\n                    <Button\r\n                        ref={anchorRef}\r\n                        aria-controls={open ? \"split-button-menu\" : undefined}\r\n                        aria-expanded={open ? \"true\" : undefined}\r\n                        aria-label=\"Select an axis\"\r\n                        aria-haspopup=\"menu\"\r\n                        onClick={handleToggle}\r\n                        endIcon={<ArrowDropDownIcon />}\r\n                    >\r\n                        {options[selectedIndex]}\r\n                    </Button>\r\n                </ButtonGroup>\r\n                <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\r\n                    <Button onMouseDown={handleAcceptClick}>Accept</Button>\r\n                    <Button onMouseDown={handleResetClick}>Cancel</Button>\r\n                </ButtonGroup>\r\n                <Popper\r\n                    open={open}\r\n                    anchorEl={anchorRef.current}\r\n                    role={undefined}\r\n                    transition\r\n                    disablePortal\r\n                >\r\n                    {({ TransitionProps, placement }) => (\r\n                        <Grow\r\n                            {...TransitionProps}\r\n                            style={{\r\n                                transformOrigin:\r\n                                    placement === \"bottom\" ? \"center top\" : \"center bottom\",\r\n                            }}\r\n                        >\r\n                            <Paper>\r\n                                <ClickAwayListener onClickAway={handleClose}>\r\n                                    <MenuList id=\"split-button-menu\">\r\n                                        {options.map((option, index) => (\r\n                                            <MenuItem\r\n                                                key={option}\r\n                                                // disabled={index === 2}\r\n                                                selected={index === selectedIndex}\r\n                                                onClick={(event) =>\r\n                                                    handleMenuItemClick(event, index)\r\n                                                }\r\n                                            >\r\n                                                {option}\r\n                                            </MenuItem>\r\n                                        ))}\r\n                                    </MenuList>\r\n                                </ClickAwayListener>\r\n                            </Paper>\r\n                        </Grow>\r\n                    )}\r\n                </Popper>\r\n            </Paper>\r\n\r\n            {/* <Grid container direction=\"column\" alignItems=\"center\">\r\n                <Grid item xs={12}>\r\n                    \r\n                </Grid>\r\n            </Grid> */}\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n","import React, { useEffect, useMemo, memo, useState, useRef } from \"react\";\r\nimport { useDispatch, useSelector, shallowEqual, connect } from \"react-redux\";\r\nimport addSignalToChartSpec from \"utils/addSignalToChartSpec\";\r\nimport vegaEmbed from \"vega-embed\";\r\nimport throttle from \"utils/throttle\";\r\nimport { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\nimport ChartConfigPanel from \"components/ChartConfigPanel\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport ManualLinkControls from \"components/ManualLinkControls\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport SettingsIcon from \"@material-ui/icons/Settings\";\r\n\r\nexport default memo(function ChartBlock({\r\n    block,\r\n    blockProps,\r\n    customStyleMap,\r\n    customStyleFn,\r\n    decorator,\r\n    forceSelection,\r\n    offsetKey,\r\n    selection,\r\n    tree,\r\n    contentState,\r\n    blockStyleFn, //weird props passed from editor\r\n    preventScroll, //weird props passed from editor\r\n    style,\r\n    ...elementProps\r\n}) {\r\n    // const data = props.contentState.getEntity(props.block.getEntityAt(0)).getData();\r\n    // let view = null;\r\n    const dispatch = useDispatch();\r\n    const [view, setView] = useState(null);\r\n    const containerEl = useRef(null);\r\n    const chartEl = useRef(null);\r\n    const [ratio, setRatio] = useState(1);\r\n    const chart = useSelector((state) => state.charts[blockProps.id]);\r\n    const textSelection = useSelector((state) => state.ui.textSelection);\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n    const chartsInEditor = useSelector((state) => state.docs[docId].chartsInEditor);\r\n    const [selectedMarks, setSelectedMarks] = useState([]);\r\n    const [viewData, setViewData] = useState([]);\r\n    const [brush, setBrush] = useState([]);\r\n    const [toggleSettings, setToggleSettings] = useState(false);\r\n\r\n    // TODO: use a memoized selector for performance\r\n    const links = useSelector(\r\n        (state) => Object.values(state.links).filter((link) => link.chartId === blockProps.id),\r\n        shallowEqual\r\n    );\r\n    const spec = useMemo(\r\n        () =>\r\n            addSignalToChartSpec(\r\n                // JSON.parse(JSON.stringify(chart.spec)),\r\n                chart.highlight,\r\n                JSON.parse(JSON.stringify(chart.liteSpec))\r\n            ),\r\n        [chart.spec, chart.highlight]\r\n    );\r\n\r\n    useEffect(() => {\r\n        const asyncExec = async () => {\r\n            // compute canvas aspect ratio to maintain it while resizing\r\n\r\n            const runtime = parse(spec);\r\n            const tempView = await new View(runtime).runAsync();\r\n\r\n            const canvas = await tempView.toCanvas();\r\n            const ratio = canvas.height / canvas.width;\r\n            setRatio(ratio);\r\n\r\n            // add autosize: has limitations: https://vega.github.io/vega-lite/docs/size.html#limitations\r\n            //TODO: brush interfere with autosize\r\n\r\n            // spec.autosize = {\r\n            //     type: \"fit\",\r\n            //     contains: \"padding\",\r\n            //     resize: false,\r\n            // };\r\n\r\n            const result = await vegaEmbed(chartEl.current, spec, { actions: false });\r\n            const view = result.view;\r\n\r\n            const viewData = view.data(\"source_0\");\r\n            setViewData(viewData);\r\n\r\n            view.addDataListener(\"paintbrush_store\", function (name, value) {\r\n                console.log(name, value);\r\n                setSelectedMarks(selectedMarks.concat(value));\r\n            });\r\n            try {\r\n                view.addDataListener(\"brush_store\", function (name, value) {\r\n                    console.log(name, value);\r\n                    setBrush(brush.concat(value));\r\n                });\r\n            } catch (error) {\r\n                //No brush_store if no brush added\r\n            }\r\n            setView(view);\r\n        };\r\n        asyncExec();\r\n    }, [spec]);\r\n\r\n    useEffect(\r\n        throttle(async () => {\r\n            resize(view, ratio);\r\n        }, 500)\r\n    );\r\n\r\n    function resize(view, ratio) {\r\n        if (view) {\r\n            const { width } = containerEl.current.getBoundingClientRect();\r\n            const height = ratio * width;\r\n            view.resize().height(height).width(width).runAsync();\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!view) {\r\n            return;\r\n        }\r\n        if (links.some((link) => link.active)) {\r\n            // Should we send all signals at once? would it improve performance?\r\n            links\r\n                .filter((link) => link.active)\r\n                .forEach((link) => {\r\n                    view.signal(\"highlight\", {\r\n                        type: link.type,\r\n                        data: link.data,\r\n                        field: link.feature.field,\r\n                        enabled: true,\r\n                        //Next 2 fields refer to range selection links\r\n                        rangeMin: link.rangeMin || 0,\r\n                        rangeMax: link.rangeMax || 0,\r\n                        //Rectangular Brushes\r\n                        fieldX: link.fieldX || \"\",\r\n                        fieldY: link.fieldY || \"\",\r\n                        rangeX: link.rangeX || [0, 0],\r\n                        rangeY: link.rangeY || [0, 0],\r\n                    }).runAsync();\r\n                });\r\n        } else {\r\n            view.signal(\"highlight\", { enabled: false }).runAsync();\r\n        }\r\n    }, [view, links]);\r\n\r\n    function handleSettingClick() {\r\n        setToggleSettings(!toggleSettings);\r\n    }\r\n    const showConfig = selection.getAnchorKey() === block.getKey(); // show only clicking this block\r\n    const highlightStyle =\r\n        chartsInEditor.indexOf(chart.id) > -1 && !showConfig && textSelection\r\n            ? {\r\n                  ...style,\r\n                  position: \"relative\",\r\n                  borderStyle: \"solid\",\r\n                  borderColor: \"gray\",\r\n                  //   width: \"fit-content\",\r\n              }\r\n            : {\r\n                  ...style,\r\n                  position: \"relative\",\r\n                  //   width: \"fit-content\",\r\n              };\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <div ref={containerEl} {...elementProps} style={highlightStyle}>\r\n                <div>\r\n                    {showConfig && (\r\n                        <IconButton\r\n                            onMouseDown={handleSettingClick}\r\n                            aria-label=\"settings\"\r\n                            // color=\"primary\"\r\n                        >\r\n                            <SettingsIcon />\r\n                        </IconButton>\r\n                    )}\r\n                </div>\r\n                <div ref={chartEl} />\r\n                {/* {showConfig && !textSelection && <ChartConfigPanel chart={chart} />} */}\r\n                {showConfig && toggleSettings && <ChartConfigPanel chart={chart} />}\r\n                {/* {resizing && <AspectRatioIcon style={{color: grey[500], zIndex:2, marginLeft:\"-30px\"}}/>} */}\r\n                {showConfig && textSelection && (\r\n                    <ManualLinkControls\r\n                        currentDoc={doc}\r\n                        selectedChart={chart}\r\n                        textSelection={textSelection}\r\n                        selectedMarks={selectedMarks}\r\n                        brush={brush}\r\n                        viewData={viewData}\r\n                    />\r\n                )}\r\n            </div>\r\n        </React.Fragment>\r\n    );\r\n});\r\n","\r\nimport React, { Fragment } from 'react';\r\nimport createToolbarPlugin, { Separator } from \"draft-js-static-toolbar-plugin\";\r\nimport createAlignmentPlugin from \"draft-js-alignment-plugin\";\r\nimport createFocusPlugin from \"draft-js-focus-plugin\";\r\nimport createResizeablePlugin from 'draft-js-resizeable-plugin';\r\n\r\nimport \"draft-js-static-toolbar-plugin/lib/plugin.css\";\r\nimport \"draft-js-alignment-plugin/lib/plugin.css\";\r\nimport \"draft-js-focus-plugin/lib/plugin.css\";\r\n// import \"draft-js-resizeable-plugin/lib/plugin.css\";\r\n\r\nimport createChartBlockPlugin from 'utils/createChartBlockPlugin';\r\n\r\nimport {\r\n  ItalicButton,\r\n  BoldButton,\r\n  UnderlineButton,\r\n  CodeButton,\r\n  HeadlineOneButton,\r\n  HeadlineTwoButton,\r\n  HeadlineThreeButton,\r\n  UnorderedListButton,\r\n  OrderedListButton,\r\n  BlockquoteButton,\r\n  CodeBlockButton\r\n} from \"draft-js-buttons\";\r\nimport { composeDecorators } from \"draft-js-plugins-editor\";\r\n\r\n\r\nconst toolbarPlugin = createToolbarPlugin();\r\nconst focusPlugin = createFocusPlugin();\r\nconst alignmentPlugin = createAlignmentPlugin();\r\nconst resizeablePlugin = createResizeablePlugin();\r\n\r\nconst { AlignmentTool } = alignmentPlugin;\r\nconst { Toolbar } = toolbarPlugin;\r\nconst decorator = composeDecorators(\r\n  focusPlugin.decorator,\r\n  resizeablePlugin.decorator,\r\n  alignmentPlugin.decorator\r\n);\r\n\r\nconst chartBlockPlugin = createChartBlockPlugin({ decorator });\r\nexport const EditorPlugins = [focusPlugin, resizeablePlugin, alignmentPlugin, toolbarPlugin, chartBlockPlugin];\r\n\r\nexport default function EditorToolbar() {\r\n  return (\r\n    <Fragment>\r\n      <Toolbar>\r\n        {// may be use React.Fragment instead of div to improve perfomance after React 16\r\n          externalProps => (\r\n            <div>\r\n              <BoldButton {...externalProps} />\r\n              <ItalicButton {...externalProps} />\r\n              <UnderlineButton {...externalProps} />\r\n              <CodeButton {...externalProps} />\r\n              <Separator {...externalProps} />\r\n              <HeadlineOneButton {...externalProps} />\r\n              <HeadlineTwoButton {...externalProps} />\r\n              <HeadlineThreeButton {...externalProps} />\r\n              <UnorderedListButton {...externalProps} />\r\n              <OrderedListButton {...externalProps} />\r\n              <BlockquoteButton {...externalProps} />\r\n              <CodeBlockButton {...externalProps} />\r\n            </div>\r\n          )}\r\n      </Toolbar>\r\n      <AlignmentTool />\r\n    </Fragment>\r\n\r\n  )\r\n}","\r\nimport ChartBlock from 'components/ChartBlock';\r\n\r\nexport default (config = {}) => {\r\n    const component = config.decorator\r\n        ? config.decorator(ChartBlock)\r\n        : ChartBlock;\r\n\r\n    return {\r\n        blockRendererFn: (block, { getEditorState }) => {\r\n            if (block.getType() === \"atomic\") {\r\n                const contentState = getEditorState().getCurrentContent();\r\n                const entity = contentState.getEntity(block.getEntityAt(0));\r\n                const data = entity.getData();\r\n                const type = entity.getType();\r\n                if (type === \"CHART\") {\r\n                    return {\r\n                        component,\r\n                        editable: false,\r\n                        props:{\r\n                            ...data\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n            return null;\r\n        },\r\n        ChartBlock\r\n    };\r\n};","import React from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport css from \"./index.module.css\";\r\n// import { addTextLink, deactivateSuggestions } from \"../ducks/ui\";\r\n// import insertSuggestion from \"utils/insertSuggestion\";\r\n// import createTextLink from \"utils/createTextLink\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport ListItemAvatar from \"@material-ui/core/ListItemAvatar\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport LinkIcon from '@material-ui/icons/Link';\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport { setTextSelection } from \"ducks/ui\";\r\n\r\nconst SUGGESTION_LIMIT = 5;\r\nexport default function SuggestionPanel(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n\r\n    const padding = 20;\r\n\r\n    function handleClick(suggestion, event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        props.onSelected(suggestion);\r\n    }\r\n\r\n    function handleCreateLink() {\r\n        props.onCreateLinkSelect();\r\n        dispatch(setTextSelection(props.textSelection));\r\n    }\r\n    return pos ? (\r\n        <Box\r\n            zIndex=\"modal\"\r\n            left={pos.x + padding}\r\n            top={pos.y + padding}\r\n            className={css.suggestionPanel}\r\n        >\r\n            <Paper>\r\n\r\n                <List>\r\n                    <ListItem button onMouseDown={handleCreateLink}>\r\n                        {/* <ListItemAvatar>\r\n                            <Avatar>\r\n                            <LinkIcon />\r\n                            </Avatar>\r\n                        </ListItemAvatar> */}\r\n                        <ListItemIcon>\r\n                            <LinkIcon />\r\n                        </ListItemIcon>\r\n                        Create Link\r\n                    </ListItem>\r\n                    {\r\n                        // should we rank suggestions\r\n\r\n                        props.suggestions.slice(0, SUGGESTION_LIMIT).map((suggestion, i) => (\r\n                            <ListItem\r\n                                key={i}\r\n                                button\r\n                                dense\r\n                                onMouseDown={handleClick.bind(null, suggestion)}\r\n                            >\r\n                                <ListItemAvatar>\r\n                                    <Avatar alt=\"chart\" src={suggestion.thumbnail} />\r\n                                </ListItemAvatar>\r\n                                <ListItemText\r\n                                    primary={suggestion.text}\r\n                                    secondary={\r\n                                        <Typography component=\"span\" variant=\"caption\" color='textSecondary'>\r\n                                            {suggestion.chartId}\r\n                                        </Typography>\r\n                                    }\r\n                                />\r\n                            </ListItem>\r\n                        ))\r\n                    }\r\n                </List>\r\n            </Paper>\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n\r\nSuggestionPanel.propTypes = {\r\n    suggestions: PropTypes.array,\r\n    onSelected: PropTypes.func,\r\n};\r\n","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\n\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\r\nimport PropTypes from \"prop-types\";\r\nimport { setSelectedLink } from \"ducks/ui\";\r\nimport { confirmLink, deleteLink } from \"ducks/links\";\r\nimport Paper from '@material-ui/core/Paper';\r\n\r\nexport default function PotentialLinkControls(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n\r\n    const padding = 10;\r\n\r\n    function handleDiscardClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        props.onDiscard(props.selectedLink);\r\n\r\n        dispatch(setSelectedLink(null));\r\n    }\r\n    function handleAcceptClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        dispatch(confirmLink(props.selectedLink.id));\r\n        dispatch(setSelectedLink(null));\r\n    }\r\n    return pos && props.selectedLink ? (\r\n        <Box\r\n            zIndex=\"modal\"\r\n            left={pos.x + padding}\r\n            top={pos.y + padding}\r\n            className={css.potentialLinkControls}\r\n        >\r\n            <Paper elevation={1}>\r\n                <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\r\n                    <Button onMouseDown={handleAcceptClick}>Accept</Button>\r\n                    <Button onMouseDown={handleDiscardClick}>Discard</Button>\r\n                </ButtonGroup>\r\n            </Paper>\r\n\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n","/**\r\n * Super simple decorators for handles and hashtags, for demonstration\r\n * purposes only. Don't reuse these regexes.\r\n */\r\n//TODO: REGEX needs to be improved and crafted to our use case!\r\n// import LinkText from 'components/LinkText';\r\n// import AutoLink from 'components/AutoLink';\r\nimport Link from \"components/Link\";\r\nimport HighlightTextSelection from \"components/HighlightTextSelection\";\r\n// const HANDLE_REGEX = /\\@[\\w]+/g;\r\n\r\n// export function handleStrategy(contentBlock, callback, contentState) {\r\n//   findWithRegex(HANDLE_REGEX, contentBlock, callback);\r\n// }\r\n\r\n// export function findWithRegex(regex, contentBlock, callback) {\r\n//   const text = contentBlock.getText();\r\n//   let matchArr, start;\r\n//   while ((matchArr = regex.exec(text)) !== null) {\r\n//     start = matchArr.index;\r\n//     callback(start, start + matchArr[0].length);\r\n//   }\r\n// }\r\n\r\nexport function findLinkEntities(contentBlock, callback, contentState) {\r\n    contentBlock.findEntityRanges((character) => {\r\n        const entityKey = character.getEntity();\r\n        return entityKey !== null && contentState.getEntity(entityKey).getType() === \"LINK\";\r\n    }, callback);\r\n}\r\nexport function findTextSelectionEntity(contentBlock, callback, contentState) {\r\n    contentBlock.findEntityRanges((character) => {\r\n        const entityKey = character.getEntity();\r\n        return (\r\n            entityKey !== null && contentState.getEntity(entityKey).getType() === \"TEXT_SELECTION\"\r\n        );\r\n    }, callback);\r\n}\r\n\r\nexport default [\r\n    {\r\n        strategy: findTextSelectionEntity,\r\n        component: HighlightTextSelection, // decorateComponentWithProps(LinkText, EditorState)\r\n    },\r\n    {\r\n        strategy: findLinkEntities,\r\n        component: Link,\r\n    },\r\n    // {\r\n    //     strategy: findAutoLinkEntities,\r\n    //     component: AutoLink\r\n    // }\r\n];\r\n","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\n\r\nexport default function Link(props) {\r\n    return (\r\n        <span className={css.textSelection} data-offset-key={props.offsetKey}>\r\n            {props.children}\r\n        </span>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport css from \"./index.module.css\";\r\nimport { activateLink, deactivateLink } from \"ducks/links\";\r\nimport { setSelectedLink } from \"ducks/ui\";\r\n\r\nexport default function Link(props) {\r\n    const dispatch = useDispatch();\r\n    const links = useSelector((state) => state.links);\r\n\r\n    let style = css.potentialLink;\r\n    const link = props.contentState.getEntity(props.entityKey).getData();\r\n    if (links[link.id]) {\r\n        if (links[link.id].isConfirmed) style = css.link;\r\n    }\r\n\r\n    function handleMouseOver() {\r\n        // if (links[link.id].isConfirmed)\r\n        dispatch(activateLink(link.id));\r\n    }\r\n    function handleMouseLeave() {\r\n        deactivateLink(link.id);\r\n        dispatch(deactivateLink(link.id));\r\n    }\r\n    function handleClick() {\r\n        dispatch(setSelectedLink(link));\r\n    }\r\n\r\n    return (\r\n        <span\r\n            className={style}\r\n            onMouseOver={handleMouseOver}\r\n            onMouseLeave={handleMouseLeave}\r\n            onClick={handleClick}\r\n            data-offset-key={props.offsetKey}\r\n        >\r\n            {props.children}\r\n        </span>\r\n    );\r\n}\r\n","export default (charts, partialText, startIndex) => {\r\n    return partialText.length === 0\r\n        ? []\r\n        : [].concat(\r\n              ...charts.map((chart) =>\r\n                  chart.properties.features\r\n                      .filter((d) => {\r\n                          if (d.type === \"string\" && d.value) {\r\n                              return d.value.toLowerCase().startsWith(partialText.toLowerCase());\r\n                          } else if (d.type === \"date\") {\r\n                              //temporary\r\n                              return d.value\r\n                                  .toString()\r\n                                  .toLowerCase()\r\n                                  .includes(partialText.toLowerCase());\r\n                          }\r\n                          return false;\r\n                      })\r\n                      .map((d) => ({\r\n                          chartId: chart.id,\r\n                          thumbnail: chart.thumbnail,\r\n                          feature: d,\r\n                          text: d.value.toString(),\r\n                          startIndex,\r\n                      }))\r\n              )\r\n          );\r\n};\r\n","const MIN_INTENT_COFIDENCE = 0.8;\r\nexport default (response) => {\r\n    //TODO: This function will be modified depending on the training on Wit.ai service!\r\n    //TODO: Updated Version of Wit.ai will store *Intents* and *Entities* separately in the response!\r\n    let parsedResponse = null;\r\n    let intent;\r\n    if (response.entities.hasOwnProperty(\"intent\")) {\r\n        if (response.entities.intent[0].confidence > MIN_INTENT_COFIDENCE) {\r\n            intent = response.entities.intent[0].value;\r\n        }\r\n    }\r\n    switch (intent) {\r\n        case \"range_selection\":\r\n            const min = response.entities.hasOwnProperty(\"min\")\r\n                ? response.entities.min[0].value\r\n                : -Infinity;\r\n            const max = response.entities.hasOwnProperty(\"max\")\r\n                ? response.entities.max[0].value\r\n                : Infinity;\r\n            parsedResponse = { intent: intent, min: min, max: max };\r\n            break;\r\n        case \"group_selection\":\r\n            if (response.entities.object_in_group) {\r\n                const group = response.entities.object_in_group.map((obj) => obj.value);\r\n                parsedResponse = { intent: intent, group: group };\r\n            }\r\n            break;\r\n        case \"comparison\":\r\n            if (response.entities.group_one && response.entities.group_two) {\r\n                const group1 = response.entities.group_one.map((obj) => obj.value);\r\n                const group2 = response.entities.group_two.map((obj) => obj.value);\r\n                parsedResponse = { intent: intent, group1: group1, group2: group2 };\r\n            }\r\n            break;\r\n    }\r\n    return parsedResponse;\r\n};\r\n","import FuzzySet from \"fuzzyset.js\";\r\nimport splitTextIntoNWordsList from \"./splitTextIntoNWordsList\";\r\nimport { Wit } from \"node-wit\";\r\nimport { isArray } from \"vega\";\r\nimport parseWitResponse from \"./parseWitResponse\";\r\n\r\nconst MIN_MATCH_THRESHOLD = 0.8;\r\nconst client = new Wit({\r\n    accessToken: \"FFJCMCE6JAQ3CT52WH5YBFED5TKENKTI\",\r\n    // logger: new log.Logger(log.DEBUG), // optional\r\n});\r\n\r\nexport default async (charts, sentence) => {\r\n    let links = [];\r\n    //forEach loop doesn't work with async-await!\r\n    for (const chart of charts) {\r\n        links = links.concat(findWordLink(chart, sentence).filter((link) => link !== null));\r\n        const link = await findPhraseLink(chart, sentence);\r\n        if (link !== null) links.push(link);\r\n    }\r\n    return links;\r\n};\r\n\r\nexport const findWordLink = (chart, sentence) => {\r\n    let matches = [];\r\n    chart.properties.features.forEach(function (f) {\r\n        const fsResult = fuzzyMatch(sentence.text, f.value); //returns a [score, word] pair!\r\n        // console.log(\"FUZZY MATCH\", fs_res);\r\n        // if (f.type === \"string\" && sentence.text.includes(f.value)) {\r\n        if (f.type === \"string\" && fsResult[0] > MIN_MATCH_THRESHOLD) {\r\n            matches.push({ userTyped: fsResult[1], matchedFeature: f });\r\n        }\r\n    });\r\n    let links = [];\r\n    if (matches.length > 0)\r\n        matches.forEach(function (m) {\r\n            const linkStartIndex = sentence.startIndex + sentence.text.indexOf(m.userTyped);\r\n            const linkEndIndex = linkStartIndex + m.userTyped.length;\r\n            const link = {\r\n                text: m.userTyped,\r\n                feature: m.matchedFeature, //information about how the link was found\r\n                chartId: chart.id,\r\n                active: false,\r\n                type: \"point\",\r\n                data: [m.matchedFeature.value],\r\n                startIndex: linkStartIndex,\r\n                endIndex: linkEndIndex,\r\n                sentence: sentence.text,\r\n                isConfirmed: false,\r\n            };\r\n            links.push(link);\r\n        });\r\n    return links;\r\n};\r\nfunction fuzzyMatch(sentence, word) {\r\n    if (typeof word === \"string\") {\r\n        let list =\r\n            word.split(\" \").length === 1\r\n                ? sentence.split(\" \")\r\n                : splitTextIntoNWordsList(sentence, word.split(\" \").length);\r\n        let fs = FuzzySet(list);\r\n        return fs.get(word) !== null ? fs.get(word).shift() : [0, \"\"];\r\n    } else return [0, \"\"];\r\n}\r\n\r\nexport async function findPhraseLink(chart, sentence) {\r\n    let match = null;\r\n    let link = null;\r\n    chart.properties.axes.forEach(function (a) {\r\n        const fsResult = fuzzyMatch(sentence.text, a.title); //returns a [score, word] pair!\r\n        // TODO: Later check only if the f.type is a number!\r\n        if (fsResult[0] > MIN_MATCH_THRESHOLD) {\r\n            match = { userTyped: fsResult[1], matchedFeature: a };\r\n        }\r\n    });\r\n    //only send request to Wit.ai when we have a potential match!\r\n    if (match !== null) {\r\n        const response = await client.message(sentence.text, {});\r\n        const parsedResponse = parseWitResponse(response);\r\n        console.log(\"Parsed Response\", parsedResponse);\r\n        if (parsedResponse !== null) {\r\n            //TODO: Also see if we can check if Wit.ai can also give us numbers described\r\n            // as words (e.g., fifty, thirty four, etc.)\r\n            switch (parsedResponse.intent) {\r\n                case \"range_selection\":\r\n                    const linkStartIndex = sentence.text.indexOf(match.userTyped);\r\n                    const linkEndIndex =\r\n                        parsedResponse.max !== Infinity\r\n                            ? sentence.text.indexOf(parsedResponse.max) !== -1\r\n                                ? sentence.text.indexOf(parsedResponse.max) +\r\n                                  parsedResponse.max.toString().length\r\n                                : sentence.text.length - 1\r\n                            : parsedResponse.min !== -Infinity\r\n                            ? sentence.text.indexOf(parsedResponse.min) !== -1\r\n                                ? sentence.text.indexOf(parsedResponse.min) +\r\n                                  parsedResponse.min.toString().length\r\n                                : sentence.text.length - 1\r\n                            : sentence.text.length - 1;\r\n                    const linkPhrase = sentence.text.substring(linkStartIndex, linkEndIndex);\r\n                    link = {\r\n                        text: linkPhrase,\r\n                        feature: match.matchedFeature, //information about how the link was found\r\n                        chartId: chart.id,\r\n                        active: false,\r\n                        type: parsedResponse.intent,\r\n                        data: isArray(match.matchedFeature.field)\r\n                            ? match.matchedFeature.field\r\n                            : [match.matchedFeature.field],\r\n                        startIndex: sentence.startIndex + linkStartIndex,\r\n                        endIndex: sentence.startIndex + linkEndIndex,\r\n\r\n                        sentence: sentence.text,\r\n                        rangeMin: parsedResponse.min,\r\n                        rangeMax: parsedResponse.max,\r\n                        isConfirmed: false,\r\n                    };\r\n                    break;\r\n                case \"comparison\":\r\n                    let group1Matches = [];\r\n                    let group2Matches = [];\r\n                    if (parsedResponse.group1 && parsedResponse.group2) {\r\n                        // only if group has more than 2 values otherwise it is point link\r\n                        group1Matches = findMatchesInChartFeatures(parsedResponse.group1, chart);\r\n                        group2Matches = findMatchesInChartFeatures(parsedResponse.group2, chart);\r\n                    }\r\n                    if (group1Matches && group2Matches) {\r\n                        let group1Data = group1Matches.map((m) => m.matchedFeature.value);\r\n                        let group2Data = group2Matches.map((m) => m.matchedFeature.value);\r\n                        const data = [...group1Data, ...group2Data];\r\n                        link = {\r\n                            text: sentence.text,\r\n                            feature: group1Matches[0].matchedFeature, //information about how the link was found\r\n                            chartId: chart.id,\r\n                            active: false,\r\n                            type: parsedResponse.intent,\r\n                            data: data,\r\n                            startIndex: sentence.startIndex,\r\n                            endIndex: sentence.endIndex,\r\n                            sentence: sentence.text,\r\n                            isConfirmed: false,\r\n                        };\r\n                    }\r\n                    break;\r\n                case \"group_selection\":\r\n                    let matches = [];\r\n                    if (parsedResponse.group.length > 1) {\r\n                        // only if group has more than 2 values otherwise it is point link\r\n                        matches = findMatchesInChartFeatures(parsedResponse.group, chart);\r\n                    }\r\n                    if (matches.length === parsedResponse.group.length) {\r\n                        const linkStartIndex = sentence.text.indexOf(matches[0].userTyped);\r\n                        const linkEndIndex =\r\n                            sentence.text.indexOf(matches[matches.length - 1].userTyped) +\r\n                            matches[matches.length - 1].userTyped.length;\r\n                        const linkPhrase = sentence.text.substring(\r\n                            linkStartIndex,\r\n                            linkEndIndex,\r\n                            matches[matches.length - 1].userTyped\r\n                        );\r\n                        link = {\r\n                            text: linkPhrase,\r\n                            feature: matches[0].matchedFeature, //information about how the link was found\r\n                            chartId: chart.id,\r\n                            active: false,\r\n                            type: parsedResponse.intent,\r\n                            data: matches.map((m) => m.matchedFeature.value),\r\n                            startIndex: sentence.startIndex + linkStartIndex,\r\n                            endIndex: sentence.startIndex + linkEndIndex,\r\n                            sentence: sentence.text,\r\n                            isConfirmed: false,\r\n                        };\r\n                    }\r\n                    break;\r\n            }\r\n            console.log(\"Phrase Link\", link);\r\n            return link;\r\n        }\r\n    }\r\n}\r\nfunction findMatchesInChartFeatures(terms, chart) {\r\n    let matches = [];\r\n    for (let i = 0; i < terms.length; i++) {\r\n        chart.properties.features.forEach(function (f) {\r\n            const fsResult = fuzzyMatch(terms[i], f.value); //returns a [score, word] pair!\r\n            if (f.type === \"string\" && fsResult[0] > MIN_MATCH_THRESHOLD) {\r\n                matches.push({ userTyped: fsResult[1], matchedFeature: f });\r\n            }\r\n        });\r\n    }\r\n    return matches;\r\n}\r\n","//This function converts a sentence into an array of n-word combinations\r\nexport default (sentence, n) => {\r\n    let words = sentence.split(\" \");\r\n    let blocks = [];\r\n    if (words.length >= n) {\r\n        for (let i = n - 1; i < words.length; i++) {\r\n            let block = \"\";\r\n            for (let j = n - 1; j >= 0; j--) {\r\n                block += j === 0 ? words[i - j] : words[i - j] + \" \";\r\n            }\r\n            blocks.push(block);\r\n        }\r\n    } else blocks = words;\r\n    return blocks;\r\n};\r\n","import { Modifier, EditorState } from \"draft-js\";\r\nexport default (links, editorState, currentSelection) => {\r\n    links.forEach((link) => {\r\n        editorState = insertLink(link, editorState, currentSelection);\r\n    });\r\n    return editorState;\r\n};\r\nexport const insertLink = (link, editorState, currentSelection) => {\r\n    //TODO: remove duplicates\r\n    const currentContent = editorState.getCurrentContent();\r\n    console.log(\"jcurrent selection\", currentSelection);\r\n    currentSelection = currentSelection || editorState.getSelection();\r\n    const blockEndIndex = currentSelection.getAnchorOffset();\r\n    const blockKey = currentSelection.getAnchorKey();\r\n    let start = link.startIndex;\r\n    let end = link.endIndex;\r\n    if (start < 0) start = 0;\r\n\r\n    //TODO: properly fix this object not extensible problem!\r\n    link = JSON.parse(JSON.stringify(link));\r\n    link[\"blockKey\"] = blockKey;\r\n\r\n    let newContent = currentContent.createEntity(`LINK`, \"MUTABLE\", {\r\n        ...link,\r\n    });\r\n    const entityKey = newContent.getLastCreatedEntityKey();\r\n\r\n    const insertTextSelection = currentSelection.merge({\r\n        anchorOffset: start,\r\n        focusOffset: end,\r\n    });\r\n    newContent = Modifier.replaceText(\r\n        editorState.getCurrentContent(),\r\n        insertTextSelection,\r\n        link.text,\r\n        [], //inline styling\r\n        entityKey\r\n    );\r\n    const caretNewIndex = end > blockEndIndex ? end : blockEndIndex;\r\n    let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n    let newSelection = newEditorState.getSelection().merge({\r\n        focusOffset: caretNewIndex,\r\n        anchorOffset: caretNewIndex,\r\n    });\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n    return newEditorState;\r\n};\r\n","export default (editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n    const blockKey = currentSelection.getAnchorKey();\r\n    const currentBlock = currentContent.getBlockForKey(blockKey);\r\n    const caretOffset = currentSelection.getAnchorOffset();\r\n    const blockTextBeforeCaret = currentBlock.getText().substr(0, caretOffset);\r\n    const end = currentSelection.getAnchorOffset();\r\n\r\n    const lastWord = blockTextBeforeCaret.split(\" \").slice(-1).pop();\r\n    const start = end - lastWord.length;\r\n    return {\r\n        text: lastWord,\r\n        startIndex: start,\r\n        endIndex: end,\r\n    };\r\n};\r\n","import nlp from \"compromise\";\r\n//It returns the desired text along with it's position (startOffset and endOffset) in editor\r\nexport default (editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n    const blockKey = currentSelection.getAnchorKey();\r\n    const currentBlock = currentContent.getBlockForKey(blockKey);\r\n    const caretOffset = currentSelection.getAnchorOffset();\r\n    const blockTextBeforeCaret = currentBlock.getText().substr(0, caretOffset);\r\n    const end = currentSelection.getAnchorOffset();\r\n    if (blockTextBeforeCaret.charAt(blockTextBeforeCaret.length - 1) === \".\") {\r\n        const lastSentence = nlp(blockTextBeforeCaret).sentences().slice(-1).text();\r\n        const start = end - lastSentence.length;\r\n        if (lastSentence.indexOf(\".\") > -1)\r\n            return {\r\n                text: lastSentence,\r\n                startIndex: start,\r\n                endIndex: end,\r\n            };\r\n        else return null;\r\n    }\r\n    return null;\r\n};\r\n","//https://github.com/facebook/draft-js/issues/442#issuecomment-223816158\r\n//TODO: Maybe follow the next comment (on the above) and use getContentStateFragment function!\r\n\r\nexport default (contentState, selection, blockDelimiter) => {\r\n    blockDelimiter = blockDelimiter || \"\\n\";\r\n    var startKey = selection.getStartKey();\r\n    var endKey = selection.getEndKey();\r\n    var blocks = contentState.getBlockMap();\r\n\r\n    var lastWasEnd = false;\r\n    var selectedBlock = blocks\r\n        .skipUntil(function (block) {\r\n            return block.getKey() === startKey;\r\n        })\r\n        .takeUntil(function (block) {\r\n            var result = lastWasEnd;\r\n\r\n            if (block.getKey() === endKey) {\r\n                lastWasEnd = true;\r\n            }\r\n\r\n            return result;\r\n        });\r\n\r\n    const text = selectedBlock\r\n        .map(function (block) {\r\n            var key = block.getKey();\r\n            var text = block.getText();\r\n\r\n            let start = 0;\r\n            let end = text.length;\r\n\r\n            if (key === startKey) {\r\n                start = selection.getStartOffset();\r\n            }\r\n            if (key === endKey) {\r\n                end = selection.getEndOffset();\r\n            }\r\n            text = text.slice(start, end);\r\n            return text;\r\n        })\r\n        .join(blockDelimiter);\r\n    let sIndex = selection.getStartOffset();\r\n    let eIndex = selection.getEndOffset();\r\n    if (selection.isBackward) {\r\n        sIndex = selection.getEndOffset();\r\n        eIndex = selection.getStartOffset();\r\n    }\r\n    return selection.getStartOffset() !== selection.getEndOffset()\r\n        ? { text: text, startIndex: sIndex, endIndex: eIndex }\r\n        : null;\r\n};\r\n","import { Modifier, EditorState, ContentState } from \"draft-js\";\r\n\r\nexport default (currentSelectionState, editorState) => {\r\n    var currentContentState = editorState.getCurrentContent();\r\n\r\n    var newContentState = Modifier.applyEntity(currentContentState, currentSelectionState, null);\r\n    var newEditorState = EditorState.push(editorState, newContentState, \"apply-entity\");\r\n\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    // newEditorState = EditorState.forceSelection(newEditorState, editorState.getSelection());\r\n    return newEditorState;\r\n};\r\n","import React, { Fragment, useState, useRef, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport PropTypes from \"prop-types\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport {\r\n    EditorState,\r\n    AtomicBlockUtils,\r\n    RichUtils,\r\n    convertToRaw,\r\n    convertFromRaw,\r\n    Modifier,\r\n    ContentState,\r\n} from \"draft-js\";\r\n\r\nimport DraftEditor from \"draft-js-plugins-editor\";\r\n\r\nimport css from \"./index.module.css\";\r\n\r\nimport EditorToolbar, { EditorPlugins } from \"components/EditorToolbar\";\r\n\r\nimport SuggestionPanel from \"components/SuggestionPanel\";\r\nimport PotentialLinkControls from \"components/PotentialLinkControls\";\r\n\r\nimport { updateDoc, updateChartsInEditor } from \"ducks/docs\";\r\nimport { createLinks, createLink, deleteLink } from \"ducks/links\";\r\nimport { getChartsInEditor, getCharts } from \"ducks/charts\";\r\nimport { setSelectedLink, setManualLinkId, exitManualLinkMode, setTextSelection } from \"ducks/ui\";\r\n\r\nimport editorDecorators from \"utils/editorDecorators\";\r\nimport findSuggestions from \"utils/findSuggestions\";\r\nimport findLinks from \"utils/findLinks\";\r\nimport insertLinks from \"utils/insertLinks\";\r\nimport getLastTypedWord from \"utils/getLastTypedWord\";\r\nimport getLastTypedSentence from \"utils/getLastTypedSentence\";\r\nimport getTextSelection from \"utils/getTextSelection\";\r\nimport highlightTextSelection from \"utils/highlightTextSelection\";\r\nimport deHighlightTextSelection from \"utils/deHighlightTextSelection\";\r\n\r\nexport default function Editor(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n    const charts = useSelector((state) => getCharts(state, docId));\r\n    const storedEditorState = useSelector((state) => state.docs[docId].editorRawState);\r\n    const chartsInEditor = useSelector((state) => getChartsInEditor(state, docId));\r\n    const selectedLink = useSelector((state) => state.ui.selectedLink);\r\n    const allLinks = useSelector((state) => state.links);\r\n    const exitManualLink = useSelector((state) => state.ui.exitManualLink);\r\n    const manualLinkId = useSelector((state) => state.ui.manualLinkId);\r\n\r\n    const textSelectionInStore = useSelector((state) => state.ui.textSelection);\r\n    const [tempTextSelection, setTempTextSelection] = useState(textSelectionInStore);\r\n\r\n    const editorEl = useRef(null); //https://reactjs.org/docs/hooks-reference.html#useref\r\n    const [suggestions, setSuggestions] = useState([]);\r\n\r\n    const contentState =\r\n        storedEditorState === null\r\n            ? EditorState.createEmpty().getCurrentContent()\r\n            : convertFromRaw(storedEditorState);\r\n    const [editorState, setEditorState] = useState(EditorState.createWithContent(contentState));\r\n\r\n    //To keep track what sentences have already been searched for links!\r\n    const [sentences, setSentences] = useState(doc.sentences);\r\n    const [currentSelectionState, setCurrentSelectionState] = useState(null);\r\n\r\n    //Disabling edit functions in view mode!\r\n    const viewMode = props.viewMode;\r\n\r\n    useEffect(() => {\r\n        if (exitManualLink) {\r\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\r\n            editorEl.current.focus();\r\n            dispatch(exitManualLinkMode(false));\r\n            setCurrentSelectionState(null);\r\n        }\r\n    }, [exitManualLink]);\r\n\r\n    useEffect(() => {\r\n        if (exitManualLink && allLinks[manualLinkId] === undefined) {\r\n            //clear selection in case no brushing and pressing 'Accept'\r\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\r\n            setCurrentSelectionState(null);\r\n        }\r\n        if (allLinks[manualLinkId]) {\r\n            setEditorState(\r\n                insertLinks([allLinks[manualLinkId]], editorState, currentSelectionState)\r\n            );\r\n            dispatch(setManualLinkId(null));\r\n            setCurrentSelectionState(null);\r\n        }\r\n    }, [manualLinkId, exitManualLink]);\r\n\r\n    useEffect(() => {\r\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\r\n        dispatch(updateDoc(doc.id, { editorRawState, sentences }));\r\n    }, [editorState]);\r\n\r\n    async function handleEditorChange(editorState) {\r\n        setEditorState(editorState);\r\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\r\n\r\n        const lastTypedWord = getLastTypedWord(editorState);\r\n        const lastSentence = getLastTypedSentence(editorState);\r\n\r\n        if (lastSentence && sentences.indexOf(lastSentence.text) === -1)\r\n            setSentences(sentences.concat(lastSentence.text));\r\n\r\n        if (lastSentence) {\r\n            const alreadySearched = sentences.indexOf(lastSentence.text) > -1 ? true : false;\r\n            if (!alreadySearched) {\r\n                const links = await findLinks(chartsInEditor, lastSentence);\r\n\r\n                if (links.length > 0) {\r\n                    const action = createLinks(doc.id, links); // need ids\r\n                    editorState = insertLinks(action.links, editorState);\r\n                    setEditorState(editorState);\r\n                    dispatch(action);\r\n                }\r\n            }\r\n        }\r\n\r\n        //Enable SuggestionMenu on @\r\n        if (lastTypedWord.text.startsWith(\"@\")) {\r\n            const suggestions = findSuggestions(\r\n                chartsInEditor,\r\n                lastTypedWord.text.slice(1),\r\n                lastTypedWord.startIndex\r\n            );\r\n\r\n            setSuggestions(suggestions);\r\n        } else {\r\n            setSuggestions([]);\r\n        }\r\n\r\n        // TODO: see if we can catch an event for adding or removing a chart.\r\n        // Updating charts in store when a chart is added to or removed from document\r\n        const entityMap = editorRawState.entityMap;\r\n        const numCharts = Object.keys(entityMap).length;\r\n        if (numCharts !== chartsInEditor.length) {\r\n            const ids = Object.values(entityMap).reduce((acc, entity) => {\r\n                if (entity.type === \"CHART\") {\r\n                    acc.push(entity.data.id);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            dispatch(updateChartsInEditor(doc.id, ids));\r\n        }\r\n\r\n        const currentSelection = editorState.getSelection();\r\n        const caretPosition = currentSelection.getAnchorOffset();\r\n        const activeBlockKey = currentSelection.getAnchorKey();\r\n        //Hide the link accept/delete button when cursor not in link range\r\n        //TODO: what if selection spans more than one block?\r\n        if (selectedLink && activeBlockKey) {\r\n            if (\r\n                activeBlockKey !== selectedLink.blockKey ||\r\n                caretPosition < selectedLink.startIndex ||\r\n                caretPosition > selectedLink.endIndex\r\n            ) {\r\n                dispatch(setSelectedLink(null));\r\n            }\r\n        }\r\n\r\n        console.log(\"editorRawState\", editorRawState);\r\n\r\n        let textSelection = getTextSelection(\r\n            editorState.getCurrentContent(),\r\n            currentSelection,\r\n            \" \" //delimiter\r\n        );\r\n        //Hide the floating controls when no text is selected\r\n        setTempTextSelection(textSelection);\r\n\r\n        //search for suggestions on text selection\r\n        if (textSelection) {\r\n            const suggestions = findSuggestions(\r\n                chartsInEditor,\r\n                textSelection.text.trim(),\r\n                textSelection.startIndex\r\n            );\r\n            suggestions.length !== 0\r\n                ? setSuggestions(suggestions)\r\n                : setSuggestions([{ text: \"NoLinkFound!\" }]);\r\n        }\r\n    }\r\n\r\n    function handleKeyCommand(command) {\r\n        // handle common key bindings (e.g., bold, italic, etc.)\r\n        const newEditorState = RichUtils.handleKeyCommand(editorState, command);\r\n        if (newEditorState) {\r\n            setEditorState(newEditorState);\r\n            return \"handled\";\r\n        }\r\n        return \"not-handled\";\r\n    }\r\n\r\n    function handleDragOver(e) {\r\n        // may need to throttle for performance\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        editorEl.current.focus();\r\n        // e.persist(); //conflict with asynchronous setTimeout in throuttle:\r\n        //https://stackoverflow.com/questions/38142880/react-js-throttle-mousemove-event-keep-throwing-event-persist-error\r\n    }\r\n\r\n    function handleDrop(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const chartId = e.dataTransfer.getData(\"chartId\");\r\n        const chart = charts.find((d) => d.id === chartId);\r\n        const exists = chartsInEditor.find((d) => d.id === chartId);\r\n        // console.log(chartsInEditor, chartId, editorState.getCurrentContent().getEntityMap().mapEntries());\r\n        if (chart && !exists) {\r\n            insertChart(chart);\r\n            e.dataTransfer.clearData();\r\n        }\r\n    }\r\n\r\n    function blockRendererFn(block) {\r\n        //TODO: is this necessary given the plugin is there\r\n        // ChartBlock Removed\r\n    }\r\n    function insertChart(chart) {\r\n        // console.log(chartId, charts[chart.id])\r\n        let contentState = editorState.getCurrentContent();\r\n\r\n        contentState = contentState.createEntity(\"CHART\", \"IMMUTABLE\", {\r\n            id: chart.id, // wil get chart info from store\r\n        });\r\n        const entityKey = contentState.getLastCreatedEntityKey();\r\n        const newEditorState = AtomicBlockUtils.insertAtomicBlock(editorState, entityKey, \" \");\r\n        setEditorState(newEditorState);\r\n    }\r\n    function handleBlur() {\r\n        setSuggestions([]);\r\n    }\r\n    function handleSuggestionSelected(suggestion) {\r\n        //TODO: there should be a single place generating a link (see find links)\r\n        const action = createLink(doc.id, {\r\n            text: suggestion.text,\r\n            feature: suggestion.feature,\r\n            chartId: suggestion.chartId,\r\n            active: false,\r\n            type: \"point\", //TODO: range selection\r\n            sentence: suggestion.text,\r\n            data: [suggestion.text],\r\n            startIndex: suggestion.startIndex,\r\n            endIndex: suggestion.startIndex + suggestion.text.length,\r\n            isConfirmed: true,\r\n        }); // need ids\r\n        const newEditorState = insertLinks([action.attrs], editorState);\r\n        dispatch(action);\r\n\r\n        setSuggestions([]);\r\n        setEditorState(newEditorState);\r\n    }\r\n    function handleCreateLinkSelect() {\r\n        dispatch(exitManualLinkMode(false));\r\n        setCurrentSelectionState(editorState.getSelection());\r\n        setEditorState(highlightTextSelection(tempTextSelection, editorState));\r\n    }\r\n\r\n    function handleLinkDiscard(link) {\r\n        //TODO: Some code is similar to insertLinks.js. Consider refactoring!\r\n        const currentSelection = editorState.getSelection();\r\n        let newContent = ContentState.createFromText(\"\");\r\n        const insertTextSelection = currentSelection.merge({\r\n            anchorOffset: link.startIndex,\r\n            focusOffset: link.endIndex,\r\n        });\r\n        newContent = Modifier.replaceText(\r\n            editorState.getCurrentContent(),\r\n            insertTextSelection,\r\n            link.text,\r\n            [] //inline styling\r\n        );\r\n        let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n        let newSelection = newEditorState.getSelection().merge({\r\n            focusOffset: link.endIndex,\r\n            anchorOffset: link.endIndex,\r\n        });\r\n        newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n        newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n        setEditorState(newEditorState);\r\n\r\n        dispatch(deleteLink(link.id));\r\n    }\r\n\r\n    return (\r\n        <Fragment>\r\n            {!viewMode && <EditorToolbar />}\r\n            <div className={css.editor} onDragOver={handleDragOver} onDrop={handleDrop}>\r\n                <DraftEditor\r\n                    editorState={editorState}\r\n                    plugins={EditorPlugins}\r\n                    onChange={handleEditorChange}\r\n                    onBlur={handleBlur}\r\n                    handleKeyCommand={handleKeyCommand}\r\n                    blockRendererFn={blockRendererFn}\r\n                    decorators={editorDecorators}\r\n                    ref={editorEl}\r\n                    readOnly={viewMode}\r\n                />\r\n            </div>\r\n            {suggestions.length >= 1 && chartsInEditor.length > 0 && (\r\n                <SuggestionPanel\r\n                    suggestions={suggestions.filter((s) => s.text !== \"NoLinkFound!\")}\r\n                    textSelection={tempTextSelection}\r\n                    onSelected={handleSuggestionSelected}\r\n                    onCreateLinkSelect={handleCreateLinkSelect}\r\n                />\r\n            )}\r\n            <PotentialLinkControls selectedLink={selectedLink} onDiscard={handleLinkDiscard} />\r\n        </Fragment>\r\n    );\r\n}\r\n\r\n//Define the public proptypes of this componenet\r\nEditor.propTypes = {\r\n    editor: PropTypes.object,\r\n    updateEditorState: PropTypes.func,\r\n    addSelectedChart: PropTypes.func,\r\n};\r\n","import { Modifier, EditorState, ContentState } from \"draft-js\";\r\n\r\nexport default (textSelection, editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n\r\n    let newContent = currentContent.createEntity(`TEXT_SELECTION`, \"MUTABLE\", {\r\n        ...textSelection,\r\n    });\r\n\r\n    const entityKey = newContent.getLastCreatedEntityKey();\r\n\r\n    const insertTextSelection = currentSelection.merge({\r\n        anchorOffset: textSelection.startIndex,\r\n        focusOffset: textSelection.endIndex,\r\n    });\r\n    newContent = Modifier.replaceText(\r\n        editorState.getCurrentContent(),\r\n        insertTextSelection,\r\n        textSelection.text,\r\n        [], //inline styling\r\n        entityKey\r\n    );\r\n    let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n    let newSelection = newEditorState.getSelection().merge({\r\n        focusOffset: textSelection.endIndex,\r\n        anchorOffset: textSelection.endIndex,\r\n    });\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n    return newEditorState;\r\n};\r\n","import React from \"react\";\r\nimport Editor from \"components/Editor\";\r\n\r\nimport Grid from \"@material-ui/core/Grid\";\r\n\r\nexport default function Edit(props) {\r\n    return (\r\n        <Grid container spacing={2}>\r\n            <Grid item xs={8}>\r\n                <Editor viewMode={true} />\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n","import React, { useMemo, memo, useRef, useState, useEffect } from \"react\";\r\nimport vegaEmbed from 'vega-embed';\r\nimport PropTypes from \"prop-types\";\r\nimport css from './index.module.css';\r\nimport Paper from '@material-ui/core/Paper';\r\n// See ChartBlock for a chart in the editor\r\nexport function Chart(props) {\r\n  const chartEl = useRef(null);\r\n  // why we need to stringify and parse it back? needs further investigation\r\n  const spec = useMemo(() => JSON.parse(JSON.stringify(props.spec)), [props.spec]);\r\n  // const [view, setView] = useState(null);\r\n  \r\n  useEffect( ()=>{\r\n    vegaEmbed(chartEl.current, spec).then(result=>{\r\n      // setView(result.view);\r\n    });\r\n  },[spec]);// will run only once\r\n\r\n\r\n  function handleDragStart(e) {\r\n    e.dataTransfer.setData('chartId', props.id);\r\n  }\r\n\r\n  const [hover, setHover] = useState(false);\r\n  function handleEnter(){\r\n    setHover(true);\r\n  }\r\n  function handleLeave(){\r\n    setHover(false);\r\n  }\r\n  return (\r\n    <Paper className={css.container}\r\n      elevation={hover?2:0}>\r\n      <div\r\n        draggable={true}\r\n        onDragStart={handleDragStart}\r\n        onMouseEnter={handleEnter}\r\n        onMouseLeave={handleLeave}\r\n      >\r\n        <div ref={chartEl} />\r\n      </div>\r\n    </Paper>\r\n  )\r\n}\r\n\r\n\r\nChart.propTypes = {\r\n  id: PropTypes.any,\r\n  spec: PropTypes.object,\r\n  width: PropTypes.number,\r\n  height: PropTypes.number\r\n}\r\n\r\nexport default memo(Chart);\r\n","//Parsing ChartInEditor for extracting chart features from vegalite spec\r\n\r\nimport { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\nimport { truthy, falsy } from \"vega-util\";\r\nimport { toString, isDate, isString, isArray } from \"vega-util\";\r\n\r\n// potential features?\r\n// data categories (discrete)\r\n// data values (continuous)\r\n// axis titles\r\n// legends\r\n// scales etc\r\nexport default async function (spec) {\r\n    if (!spec.data) {\r\n        return [];\r\n    }\r\n    const featureMap = {};\r\n    const runtime = parse(spec);\r\n    const view = await new View(runtime).runAsync();\r\n    const state = view.getState({\r\n        data: truthy,\r\n        signals: falsy,\r\n        recurse: true,\r\n    });\r\n\r\n    // sometimes, individual data points are not explicitely encoded using scales\r\n    for (const mark of spec.marks) {\r\n        // mu\r\n        const data = state.data[mark.name].map((d) => d.datum);\r\n\r\n        for (const datum of data) {\r\n            const isMap = mark.type === \"shape\" && mark.style.includes(\"geoshape\");\r\n            const entries = Object.entries(isMap ? datum.properties : datum);\r\n            for (const [field, value] of entries) {\r\n                if (!isString(value)) {\r\n                    // only categorical data\r\n                    continue;\r\n                }\r\n                featureMap[value] = {\r\n                    value,\r\n                    type: \"string\",\r\n                    field,\r\n                    data: datum.name,\r\n                };\r\n            }\r\n        }\r\n    }\r\n    // Note: The following logic addressses two missing cases\r\n    // 1. Nested marks\r\n    // 2. Categorical scale with numeric data domain\r\n    // TODO: Can we combine the two logics elegantly?\r\n    spec.data.forEach((datum) => {\r\n        // for each data table\r\n        const viewdata = view.data(datum.name);\r\n        // console.log(\"viewdata\", viewdata);\r\n    });\r\n    //Extracting Axes of the charts\r\n    const axesMap = extractChartAxes(spec);\r\n    spec.scales\r\n        .filter((scale) => [\"ordinal\", \"band\", \"point\"].includes(scale.type))\r\n        .forEach((scale) => {\r\n            // each discrete scale\r\n            spec.data.forEach((datum) => {\r\n                // for each data table\r\n                const viewdata = view.data(datum.name);\r\n                viewdata.forEach((row) => {\r\n                    // for each row in the table\r\n                    // a single field\r\n                    if (scale.domain.field) {\r\n                        const field = scale.domain.field;\r\n                        const value = isDate(row[field]) ? row[field] : toString(row[field]);\r\n                        const type = isDate(value) ? \"date\" : \"string\";\r\n                        featureMap[value] = {\r\n                            value,\r\n                            type,\r\n                            field,\r\n                            data: datum.name,\r\n                        };\r\n                    } else if (scale.domain.fields) {\r\n                        //multiple fields from the same data\r\n                        scale.domain.fields.forEach((d) => {\r\n                            const field = isString(d) ? d : d.field;\r\n                            const value = isDate(row[field]) ? row[field] : toString(row[field]);\r\n                            const type = isDate(value) ? \"date\" : \"string\";\r\n                            featureMap[value] = {\r\n                                value,\r\n                                type,\r\n                                field,\r\n                                data: datum.name,\r\n                            };\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n            if (isArray(scale.domain)) {\r\n                // literal array\r\n                scale.domain.forEach((value) => {\r\n                    value = isDate(value) ? value : toString(value);\r\n                    const type = isDate(value) ? \"date\" : \"string\";\r\n                    const field = searchFieldName(spec, scale.name);\r\n                    featureMap[value] = {\r\n                        value,\r\n                        type,\r\n                        field,\r\n                        data: null,\r\n                    };\r\n                });\r\n            }\r\n        });\r\n    const properties = { axes: Object.values(axesMap), features: Object.values(featureMap) };\r\n    console.log(\"properties\", properties);\r\n    return properties;\r\n}\r\n\r\nexport const searchFieldName = (spec, scaleName) => {\r\n    console.log(scaleName);\r\n    for (const mark of spec.marks) {\r\n        console.log(\"mark\");\r\n        if (mark.encode.enter) {\r\n            for (const [, props] of Object.entries(mark.encode.enter)) {\r\n                if (props.scale === scaleName && props.field) {\r\n                    return props.field;\r\n                }\r\n            }\r\n        }\r\n        if (mark.encode.update) {\r\n            for (const [, props] of Object.entries(mark.encode.update)) {\r\n                if (props.scale === scaleName && props.field) {\r\n                    return props.field;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return null;\r\n};\r\n\r\nexport const extractChartAxes = (spec) => {\r\n    let axesMap = {};\r\n    spec.scales.forEach((scale) => {\r\n        console.log(\"Scales in Chart:\", scale);\r\n        //TODO: handle cases where data is aggregated e.g., stack bar chart, stack area chart, pie chart,\r\n        const name = scale.name;\r\n        const field =\r\n            //field is array of objects\r\n            isArray(scale.domain.fields) && scale.domain.fields[0].hasOwnProperty(\"field\")\r\n                ? scale.domain.fields[0].field\r\n                : //field is simple array\r\n                isArray(scale.domain.fields)\r\n                ? scale.domain.fields\r\n                : scale.domain.field;\r\n        const data = scale.domain.data;\r\n        const type = scale.type;\r\n\r\n        const relatedAxis = spec.axes\r\n            ? spec.axes.filter((axis) => {\r\n                  return (axis.scale === name && axis.title !== undefined) || null;\r\n              })\r\n            : undefined;\r\n        const title =\r\n            isArray(relatedAxis) && relatedAxis.length > 0 && relatedAxis[0].hasOwnProperty(\"title\")\r\n                ? relatedAxis[0].title\r\n                : field //if title is not found, saving field as title (needed for maps!)\r\n                ? field\r\n                : undefined;\r\n\r\n        const axis = { name: name, field: field, data: data, type: type, title: title };\r\n        axesMap[name] = axis;\r\n    });\r\n    return axesMap;\r\n};\r\n","\r\nimport { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\n\r\nconst THUMBNAIL_HEIGHT = 50;\r\nexport default async (spec)=>{\r\n    // parse the spec and get the view\r\n    const runtime = parse(spec);     \r\n    const view = await new View(runtime).runAsync();\r\n    // conver the view to an image\r\n    const img = await view.toImageURL('png');// base64\r\n    // resize the image to a thumbnail size\r\n    const resized =  await resize(img);\r\n    return resized;\r\n\r\n    \r\n}\r\n\r\nfunction resize(orgImg){\r\n    return new Promise((resolve, reject)=>{\r\n        const img = new Image();\r\n        img.src = orgImg;\r\n        img.onload = function (){\r\n            // draw the image into a thumbnail scale\r\n            const height = THUMBNAIL_HEIGHT; \r\n            const width = (height/img.height)*img.width;\r\n            const canvas = document.createElement('canvas'),\r\n            ctx = canvas.getContext('2d');\r\n\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n\r\n            ctx.drawImage(this, 0, 0, width, height);\r\n\r\n            // return rescaled base64 image url\r\n            resolve(canvas.toDataURL());\r\n        }\r\n    })\r\n}","import React, { useState } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport css from \"./index.module.css\";\r\nimport Chart from \"components/Chart\";\r\nimport { createChart, getCharts } from \"ducks/charts\";\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport { compile } from \"vega-lite/build/vega-lite\";\r\nimport extractChartFeatures from \"utils/extractChartFeatures\";\r\nimport createThumbnail from \"utils/createThumbnail\";\r\n\r\nexport default function ChartGallery(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const [dragging, setDragging] = useState(false);\r\n    const [errorMsg, setErrorMsg] = useState(null);\r\n\r\n    const charts = useSelector((state) => getCharts(state, docId));\r\n\r\n    function handleDragEnter() {\r\n        setDragging(true);\r\n    }\r\n    function handleDragLeave() {\r\n        setDragging(false);\r\n    }\r\n    function handleDragOver(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    }\r\n\r\n    function handleDrop(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // console.log('VegaLite', VegaLite);\r\n        let file = e.dataTransfer.files[0];\r\n        if (!file) {\r\n            return;\r\n        }\r\n        if (file.size > 1000000) {\r\n            // larger than 1 MB\r\n            setErrorMsg(\"Size too big (>1MB)!\");\r\n            return;\r\n        }\r\n        if (file.type.match(\"application/json\")) {\r\n            const reader = new FileReader();\r\n\r\n            // Closure to capture the file information.\r\n            reader.onload = async (e) => {\r\n                const liteSpec = JSON.parse(e.target.result);\r\n                const spec = compile(liteSpec).spec; // vega spec\r\n                // support vega-lite sample datasets\r\n\r\n                spec.data.forEach((d) => {\r\n                    if (d.url && d.url.startsWith(\"data\")) {\r\n                        d.url = process.env.PUBLIC_URL + \"/\" + d.url;\r\n                    }\r\n                });\r\n                const thumbnail = await createThumbnail(spec);\r\n\r\n                const properties = await extractChartFeatures(spec);\r\n                dispatch(createChart(docId, spec, liteSpec, { properties, thumbnail }));\r\n            };\r\n\r\n            reader.readAsText(file);\r\n        } else {\r\n            setErrorMsg(\"Wrong format!\");\r\n        }\r\n        setDragging(false);\r\n    }\r\n    return (\r\n        <div\r\n            className={css.container}\r\n            onDragEnter={handleDragEnter}\r\n            onDragLeave={handleDragLeave}\r\n            onDragOver={handleDragOver}\r\n            onDrop={handleDrop}\r\n        >\r\n            <Snackbar\r\n                open={errorMsg !== null}\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                autoHideDuration={5000}\r\n                onClose={() => {\r\n                    setErrorMsg(null);\r\n                }}\r\n                message={errorMsg}\r\n            />\r\n\r\n            <div className={css.draggingArea} style={{ opacity: dragging ? 0.5 : 0.0 }}>\r\n                Drop Vega-lite Spec\r\n            </div>\r\n            {charts.map((chart) => (\r\n                <Chart key={chart.id} id={chart.id} spec={chart.spec} />\r\n            ))}\r\n        </div>\r\n    );\r\n}\r\n","import React from 'react';\r\n// import TextField from '@material-ui/core/TextField';\r\nimport ChartGallery from 'components/ChartGallery';\r\nimport Editor from 'components/Editor';\r\n\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\n\r\nexport default function Edit(props){\r\n\r\n    return (\r\n    <Grid container spacing={2} >\r\n        <Grid item xs={4}>\r\n            <Typography variant=\"overline\" display=\"block\" gutterBottom>\r\n                Chart Gallery\r\n            </Typography>\r\n            <ChartGallery/>\r\n        </Grid>\r\n        <Grid item xs={8}>\r\n           <Editor/>\r\n        </Grid>\r\n    </Grid>\r\n    )\r\n}","import React from \"react\";\r\nimport Navbar from \"components/Navbar\";\r\nimport Home from 'components/Home';\r\nimport Docs from 'components/Docs';\r\nimport View from 'components/View';\r\nimport Edit from 'components/Edit';\r\nimport { BrowserRouter as Router, Switch, Route } from \"react-router-dom\";\r\nimport Container from '@material-ui/core/Container';\r\n\r\nfunction App() {\r\n  return (\r\n    <Router>\r\n      <Navbar />\r\n      <Container maxWidth=\"lg\" mt={2}>\r\n        <Switch>\r\n          <Route path=\"/docs/:docId/view\">\r\n            <View />\r\n          </Route>\r\n          <Route path=\"/docs/:docId\">\r\n            <Edit />\r\n          </Route>\r\n          <Route path=\"/docs\">\r\n            <Docs />\r\n          </Route>\r\n          <Route path=\"/\">\r\n            <Home />\r\n          </Route>\r\n          \r\n        </Switch>\r\n      </Container>\r\n    </Router>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { combineReducers } from \"redux\";\r\n// import editor from \"./editor\";\r\nimport charts from \"./charts\";\r\nimport docs from \"./docs\";\r\nimport links from \"./links\";\r\nimport ui from \"./ui\";\r\n\r\nexport default combineReducers({\r\n  docs,\r\n  charts,\r\n  links,\r\n  ui\r\n});\r\n\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\nimport { createLogger } from \"redux-logger\";\r\nimport reduxFreeze from \"redux-freeze\";\r\nimport { Provider } from \"react-redux\";\r\nimport { applyMiddleware, createStore } from \"redux\";\r\nimport rootReducer from \"./ducks\";\r\nimport localforage from \"localforage\";\r\nimport throttle from \"./utils/throttle\";\r\n\r\nimport { createMuiTheme, ThemeProvider } from \"@material-ui/core/styles\";\r\nconst theme = createMuiTheme({\r\n    //https://material-ui.com/customization/palette/\r\n    palette: {\r\n        primary: {\r\n            main: \"#2196f3\",\r\n        },\r\n        secondary: {\r\n            main: \"#e91e63\",\r\n        },\r\n        info: {\r\n            main: \"#1976d2\",\r\n        },\r\n        error: {\r\n            main: \"#f44336\",\r\n        },\r\n        warning: {\r\n            main: \"#ff9800\",\r\n        },\r\n        success: {\r\n            main: \"#4caf50\",\r\n        },\r\n    },\r\n    secondary: {\r\n        main: \"#e91e63\",\r\n    },\r\n    info: {\r\n        main: \"#1976d2\",\r\n    },\r\n    error: {\r\n        main: \"#f44336\",\r\n    },\r\n    warning: {\r\n        main: \"#ff9800\",\r\n    },\r\n    success: {\r\n        main: \"#4caf50\",\r\n    },\r\n    textSecondary: {\r\n        main: \"#bdbdbd\",\r\n    },\r\n});\r\n// console.log(logger);\r\n\r\nlet loadData = new Promise((resolve, reject) => {\r\n    localforage\r\n        .getItem(\"state\")\r\n        .then((data) => {\r\n            resolve(data);\r\n        })\r\n        .catch((err) => {\r\n            reject(err);\r\n        });\r\n});\r\n\r\nloadData\r\n    .then((data) => {\r\n        let middleware = [reduxFreeze, createLogger()];\r\n        let store = createStore(\r\n            rootReducer,\r\n            // {},\r\n            data ? data : {},\r\n            applyMiddleware(...middleware)\r\n        );\r\n        // initialize if ne\r\n        if (!data) {\r\n        }\r\n        store.subscribe(\r\n            throttle(() => {\r\n                let state = { ...store.getState() };\r\n                delete state[\"ui\"]; // don't persist ui sate\r\n                localforage.setItem(\"state\", state);\r\n            }, 1000)\r\n        );\r\n        // localforage.clear(function(err) {\r\n        //   // Run this code once the database has been entirely deleted.\r\n        //   console.log(\"Database is now empty.\");\r\n        // });\r\n        ReactDOM.render(\r\n            <Provider store={store}>\r\n                <ThemeProvider theme={theme}>\r\n                    <App />\r\n                </ThemeProvider>\r\n            </Provider>,\r\n            document.getElementById(\"root\")\r\n        );\r\n    })\r\n    .catch((err) => {\r\n        console.log(err);\r\n        ReactDOM.render(<div>Failed to initialize data!</div>, document.getElementById(\"root\"));\r\n    });\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}