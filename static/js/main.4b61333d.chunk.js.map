{"version":3,"sources":["components/ChartConfigPanel/index.module.css","components/Link/index.module.css","components/ChartGallery/index.module.css","components/Viewer/index.module.css","components/ManualLinkControls/index.module.css","components/HighlightTextSelection/index.module.css","components/Chart/index.module.css","components/Editor/index.module.css","components/SuggestionPanel/index.module.css","components/PotentialLinkControls/index.module.css","utils/uniqueId.js","ducks/charts.js","ducks/docs.js","components/Navbar/index.jsx","components/Home/index.jsx","ducks/ui.js","components/Doc/index.jsx","components/Docs/index.jsx","utils/addSignalToChartSpec.js","utils/addBrushToVegaLiteSpec.js","utils/throttle.js","components/ChartConfigPanel/index.jsx","ducks/links.js","components/ManualLinkControls/index.jsx","components/ChartBlock/index.jsx","components/EditorToolbar/index.jsx","utils/createChartBlockPlugin.js","utils/editorDecorators.js","components/HighlightTextSelection/index.jsx","components/Link/index.jsx","components/Viewer/index.jsx","utils/removePotentialLinks.js","components/View/index.jsx","components/Chart/index.jsx","utils/extractChartFeatures.js","utils/createThumbnail.js","components/ChartGallery/index.jsx","components/SuggestionPanel/index.jsx","components/PotentialLinkControls/index.jsx","utils/findSuggestions.js","utils/parseWitResponse.js","utils/findLinks.js","utils/splitTextIntoNWordsList.js","utils/insertLinks.js","utils/getLastTypedWord.js","utils/getTextSelection.js","utils/deHighlightTextSelection.js","utils/getBlockText.js","utils/filterAlreadyConfirmedLinksInEditor.js","components/Editor/index.jsx","utils/highlightTextSelection.js","components/Edit/index.jsx","App.js","serviceWorker.js","ducks/index.js","index.js"],"names":["module","exports","nanoid","customAlphabet","prefix","createChart","docId","spec","liteSpec","attrs","chartId","uniqueId","type","timestamp","Date","now","highlight","channel","active","inactive","id","updateChart","getCharts","createSelector","state","docs","charts","_","map","cid","getChartsInEditor","chartsInEditor","initialState","testchart","thumbnail","properties","axes","name","field","data","title","features","value","barChartSpec","barChartLiteSpec","updateDoc","updateChartsInEditor","testdoc","sentences","editorRawState","blocks","key","text","depth","inlineStyleRanges","offset","length","style","entityRanges","entityMap","useStyles","makeStyles","theme","root","flexGrow","marginBottom","spacing","classes","dispatch","useDispatch","useSelector","ui","currentDocId","doc","AppBar","className","position","color","Toolbar","variant","Link","underline","component","RouterLink","to","TextField","onChange","e","target","size","fullWidth","margin","marginLeft","marginRight","label","Button","Home","Grid","container","justify","item","xs","Typography","gutterBottom","Box","Fab","aria-label","display","setSelectedLink","link","setTextSelection","textSelection","setManualLinkId","linkId","exitManualLinkMode","exit","setViewMode","val","button","width","padding","paper","justifyContent","alignItems","palette","secondary","height","Doc","props","onClick","Paper","elevation","Docs","Object","values","action","createDoc","isMap","mark","selections","paintbrush","toggle","brush","clear","encoding","condition","selection","addBrushToVegaLiteSpec","compile","forEach","d","url","startsWith","process","signals","start","end","enabled","marks","addSignalToMark","includes","activePredicate","inactivePredicate","oldProp","encode","update","highlightProp","test","concat","isArray","func","last","deferTimer","wait","throttled","args","clearTimeout","setTimeout","ChartConfigPanel","channelOptions","opacity","fill","colors","chart","useState","setActive","setInactive","handleActiveChangeCommitted","event","newValue","handleInactiveChangeCommitted","zIndex","css","panel","top","left","onMouseDown","stopPropagation","p","direction","Select","option","keys","MenuItem","Slider","aria-labelledby","valueLabelDisplay","min","max","step","onChangeCommitted","picker","bgcolor","border","onMouseUp","createLinks","links","deactivateLink","ManualLinkControls","window","getSelection","pos","rangeCount","getRangeAt","getBoundingClientRect","fields","selectedChart","f","options","Set","React","open","setOpen","anchorRef","useRef","selectedIndex","setSelectedIndex","handleClose","current","contains","right","ButtonGroup","ref","aria-controls","undefined","aria-expanded","aria-haspopup","prevOpen","endIcon","preventDefault","multiPoint","viewData","console","log","points","i","j","_vgsid_","push","hasOwnProperty","feature","startIndex","endIndex","sentence","isConfirmed","fieldX","fieldY","rangeX","rangeY","brushFieldIndex","findIndex","currentDoc","makeManualLink","selectedMarks","Popper","anchorEl","role","transition","disablePortal","TransitionProps","placement","Grow","transformOrigin","ClickAwayListener","onClickAway","MenuList","index","selected","handleMenuItemClick","memo","block","blockProps","customStyleMap","customStyleFn","decorator","forceSelection","offsetKey","tree","contentState","blockStyleFn","preventScroll","elementProps","view","setView","containerEl","chartEl","ratio","setRatio","useParams","setSelectedMarks","setViewData","setBrush","toggleSettings","setToggleSettings","viewMode","filter","shallowEqual","useMemo","addSignalToChartSpec","JSON","parse","stringify","resize","runAsync","useEffect","a","runtime","View","tempView","toCanvas","canvas","vegaEmbed","actions","result","addDataListener","error","asyncExec","throttle","some","signal","rangeField","rangeMin","rangeMax","showConfig","getAnchorKey","getKey","highlightStyle","indexOf","borderStyle","borderColor","Fragment","IconButton","toolbarPlugin","createToolbarPlugin","focusPlugin","createFocusPlugin","alignmentPlugin","createAlignmentPlugin","resizeablePlugin","createResizeablePlugin","AlignmentTool","EditorPlugins","config","ChartBlock","blockRendererFn","getEditorState","getType","entity","getCurrentContent","getEntity","getEntityAt","getData","editable","createChartBlockPlugin","composeDecorators","EditorToolbar","externalProps","strategy","contentBlock","callback","findEntityRanges","character","entityKey","data-offset-key","children","potentialLink","onMouseOver","onMouseLeave","Viewer","rawEditorState","editorEl","EditorState","createEmpty","convertFromRaw","removePotentialLinks","createWithContent","editorState","setEditorState","viewer","plugins","handleKeyCommand","command","newEditorState","RichUtils","decorators","editorDecorators","readOnly","then","hover","setHover","draggable","onDragStart","dataTransfer","setData","onMouseEnter","featureMap","getState","truthy","falsy","recurse","datum","entries","isString","axesMap","extractChartAxes","scales","scale","row","domain","isDate","toString","searchFieldName","scaleName","enter","relatedAxis","axis","toImageURL","img","resized","orgImg","Promise","resolve","reject","Image","src","onload","document","createElement","ctx","getContext","drawImage","this","toDataURL","ChartGallery","dragging","setDragging","errorMsg","setErrorMsg","onDragEnter","onDragLeave","onDragOver","onDrop","file","files","match","reader","FileReader","createThumbnail","extractChartFeatures","readAsText","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","onClose","message","draggingArea","SuggestionPanel","handleClick","suggestion","onSelected","x","y","suggestionPanel","List","ListItem","onCreateLinkSelect","ListItemIcon","suggestions","slice","dense","bind","ListItemAvatar","Avatar","alt","ListItemText","primary","PotentialLinkControls","selectedLink","potentialLinkControls","onAccept","onDiscard","partialText","toLowerCase","response","intent","parsedResponse","entities","confidence","Infinity","request","require","client","Wit","accessToken","findWordOrPhraseLinks","findRangeLinks","rangeLink","findGroupableLinks","groupableLinks","groupLink","createGroupLink","matches","fsResult","fuzzyMatch","userTyped","matchedFeature","pointLinks","m","linkStartIndex","linkEndIndex","isNaN","Number","word","wordLength","split","list","n","words","splitTextIntoNWordsList","fs","FuzzySet","get","shift","parseWitResponse","Math","abs","linkPhrase","substring","l","sentenceObject","uri","method","headers","Accept","json","body","requestPromise","util","promisify","shouldKeep","glink","firstIndividualLink","reduce","prev","curr","lastIndividualLink","pointLink","currentSelection","insertLink","currentContent","blockEndIndex","getAnchorOffset","blockKey","newContent","createEntity","getLastCreatedEntityKey","insertTextSelection","merge","anchorOffset","focusOffset","Modifier","replaceText","caretNewIndex","newSelection","moveSelectionToEnd","currentBlock","getBlockForKey","caretOffset","blockTextBeforeCaret","getText","substr","lastWord","pop","blockDelimiter","startKey","getStartKey","endKey","getEndKey","getBlockMap","lastWasEnd","skipUntil","takeUntil","getStartOffset","getEndOffset","join","sIndex","eIndex","isBackward","currentSelectionState","currentContentState","newContentState","applyEntity","allLinksInCurrentBlockText","linkInCurrentBlockText","Editor","storedEditorState","allLinks","exitManualLink","manualLinkId","textSelectionInStore","tempTextSelection","setTempTextSelection","setSuggestions","setCurrentSelectionState","blockText","setBlockText","pastedText","setPastedText","interval","convertToRaw","lastTypedWord","getLastTypedWord","findSuggestions","ids","acc","caretPosition","activeBlockKey","getTextSelection","trim","findLinks","insertLinks","setInterval","getBlockText","clearInterval","deHighlightTextSelection","focus","nlp","sentenceOffset","filterAlreadyConfirmedLinksInEditor","editor","find","exists","AtomicBlockUtils","insertAtomicBlock","insertChart","clearData","onBlur","onTab","handlePastedText","s","createLink","highlightTextSelection","ContentState","createFromText","Edit","App","Navbar","Container","maxWidth","mt","path","Boolean","location","hostname","combineReducers","newState","createMuiTheme","main","info","warning","success","textSecondary","localforage","getItem","catch","err","middleware","reduxFreeze","createLogger","store","createStore","rootReducer","applyMiddleware","subscribe","setItem","ReactDOM","render","ThemeProvider","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"+EACAA,EAAOC,QAAU,CAAC,MAAQ,gCAAgC,OAAS,iCAAiC,MAAQ,kC,oBCA5GD,EAAOC,QAAU,CAAC,KAAO,mBAAmB,cAAgB,8B,oBCA5DD,EAAOC,QAAU,CAAC,UAAY,gCAAgC,aAAe,qC,g0ECA7ED,EAAOC,QAAU,CAAC,OAAS,yB,oBCA3BD,EAAOC,QAAU,CAAC,sBAAwB,kDAAkD,MAAQ,kCAAkC,QAAU,sC,oBCAhJD,EAAOC,QAAU,CAAC,cAAgB,gD,oBCAlCD,EAAOC,QAAU,CAAC,UAAY,2B,oBCA9BD,EAAOC,QAAU,CAAC,OAAS,yB,oBCA3BD,EAAOC,QAAU,CAAC,gBAAkB,2C,oBCApCD,EAAOC,QAAU,CAAC,sBAAwB,uD,4XCApCC,EAASC,YAAe,uCAAwC,IACvD,WAACC,GACf,OAAQA,EAASA,EAASF,IAAWA,K,2BCQzBG,EAAc,SAACC,EAAOC,EAAMC,GAA0B,IAAhBC,EAAe,uDAAP,GACnDC,EAAUC,EAAS,UAUvB,MAAO,CAAEC,KAhBe,eAgBKF,UAASD,MATtCA,EAAK,aACDH,QACAC,OACAC,WACAK,UAAWC,KAAKC,MAChBC,UAAW,CAAEC,QAAS,UAAWC,OAAQ,EAAKC,SAAU,KACrDV,EANF,CAODW,GAAIV,MAKCW,EAAc,SAACX,EAASD,GACjC,MAAO,CAAEG,KAnBe,eAmBKF,UAASD,UAU7Ba,EAAYC,aACrB,SAACC,GAAD,OAAWA,EAAMC,QACjB,SAACD,GAAD,OAAWA,EAAME,UACjB,SAACC,EAAGrB,GAAJ,OAAcA,KACd,SAACmB,EAAMC,EAAQpB,GAAf,OAAyBmB,EAAKnB,GAAOoB,OAAOE,KAAI,SAACC,GAAD,OAASH,EAAOG,SAGvDC,EAAoBP,aAC7B,SAACC,GAAD,OAAWA,EAAMC,QACjB,SAACD,GAAD,OAAWA,EAAME,UACjB,SAACC,EAAGrB,GAAJ,OAAcA,KACd,SAACmB,EAAMC,EAAQpB,GAAf,OAAyBmB,EAAKnB,GAAOyB,eAAeH,KAAI,SAACC,GAAD,OAASH,EAAOG,SAGtEG,EAAe,CACjBC,UAAW,CACPb,GAAI,YACJd,MAAO,UACPO,UAAWC,KAAKC,MAChBmB,UACI,6oLACJlB,UAAW,CAAEC,QAAS,UAAWC,OAAQ,EAAKC,SAAU,IACxDgB,WAAY,CACRC,KAAM,CACF,CACIC,KAAM,IACNC,MAAO,WACPC,KAAM,SACN3B,KAAM,UACN4B,MAAO,YAEX,CAAEH,KAAM,IAAKC,MAAO,SAAUC,KAAM,SAAU3B,KAAM,SAAU4B,MAAO,WAEzEC,SAAU,CACN,CAAEC,MAAO,QAAS9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC3D,CAAEG,MAAO,SAAU9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC5D,CAAEG,MAAO,WAAY9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC9D,CAAEG,MAAO,UAAW9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC7D,CAAEG,MAAO,YAAa9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC/D,CAAEG,MAAO,UAAW9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC7D,CAAEG,MAAO,UAAW9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC7D,CAAEG,MAAO,WAAY9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,YAGtEhC,KAAMoC,EACNnC,SAAUoC,ICvDLC,EAAY,SAACvC,EAAOG,GAC7B,MAAO,CAAEG,KAvBa,aAuBKN,QAAOG,UAUzBqC,EAAuB,SAACxC,EAAOoB,GACxC,MAAO,CAAEd,KA9B0B,0BA8BKN,QAAOoB,WAO7CM,EAAe,CACjBe,QAAS,CACL3B,GAAI,UACJoB,MAAO,aACP3B,UAAWC,KAAKC,MAChBW,OAAQ,CAAC,aACTK,eAAgB,GAChBiB,UAAW,GACXC,eAAgB,CACZC,OAAQ,CACJ,CACIC,IAAK,QACLC,KAAM,6BACNxC,KAAM,WACNyC,MAAO,EACPC,kBAAmB,CACf,CACIC,OAAQ,EACRC,OAAQ,GACRC,MAAO,SAGfC,aAAc,GACdnB,KAAM,IAEV,CACIY,IAAK,QACLC,KAAM,4CACNxC,KAAM,WACNyC,MAAO,EACPC,kBAAmB,CACf,CACIC,OAAQ,EACRC,OAAQ,GACRC,MAAO,cAGfC,aAAc,GACdnB,KAAM,IAEV,CACIY,IAAK,QACLC,KACI,mFACJxC,KAAM,WACNyC,MAAO,EACPC,kBAAmB,CACf,CACIC,OAAQ,EACRC,OAAQ,GACRC,MAAO,WAGfC,aAAc,GACdnB,KAAM,KAGdoB,UAAW,MC3FjBC,EAAYC,aAAW,SAACC,GAAD,MAAY,CACrCC,KAAM,CACFC,SAAU,EACVC,aAAcH,EAAMI,QAAQ,IAKhC1B,MAAO,CACHwB,SAAU,OAIH,aACX,IAAMG,EAAUP,IACVQ,EAAWC,cACX/D,EAAQgE,aAAY,SAAC9C,GAAD,OAAWA,EAAM+C,GAAGC,gBACxCC,EAAMH,aAAY,SAAC9C,GAAD,OAAWA,EAAMC,KAAKnB,MAK9C,OACI,kBAACoE,EAAA,EAAD,CAAQC,UAAWR,EAAQJ,KAAMa,SAAS,SAASC,MAAM,WACrD,kBAACC,EAAA,EAAD,CAASC,QAAQ,SAMb,kBAACC,EAAA,EAAD,CACID,QAAQ,KACRJ,UAAWR,EAAQ3B,MACnByC,UAAU,OACVJ,MAAM,UACNK,UAAWC,IACXC,GAAG,KANP,QAcC9E,GACG,kBAAC+E,EAAA,EAAD,CACI3C,MAAO+B,EAAIjC,MACX8C,SA5BpB,SAAsBC,GAClBnB,EAASvB,EAAUvC,EAAO,CAAEkC,MAAO+C,EAAEC,OAAO9C,UA4B5B+C,KAAK,QACLC,WAAS,EACTC,OAAO,QACPZ,QAAQ,SACRtB,MAAO,CAAEmC,WAAY,QAASC,YAAa,QAC3CC,MAAM,mBAGd,kBAACC,EAAA,EAAD,CAAQlB,MAAM,UAAUK,UAAWC,IAAYC,GAAG,SAAlD,QAIC9E,GACG,kBAAC,WAAD,KACI,0BAAMmD,MAAO,CAAEmC,WAAY,OAAQC,YAAa,SAAhD,OACA,kBAACE,EAAA,EAAD,CAAQlB,MAAM,UAAUK,UAAWC,IAAYC,GAAE,gBAAW9E,IAA5D,QAGA,kBAACyF,EAAA,EAAD,CAAQlB,MAAM,UAAUK,UAAWC,IAAYC,GAAE,gBAAW9E,EAAX,UAAjD,Y,sDC3CT0F,MA3Bf,WACI,OACI,kBAACC,EAAA,EAAD,CAAMC,WAAS,EAAChC,QAAS,EAAGiC,QAAQ,UAChC,kBAACF,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAACC,EAAA,EAAD,CAAYvB,QAAQ,KAAKwB,cAAY,GAArC,SAGA,kBAACC,EAAA,EAAD,CAAKvC,aAAc,GACf,kBAACqC,EAAA,EAAD,CAAYvB,QAAQ,QAAQwB,cAAY,GAAxC,aAIJ,kBAACE,EAAA,EAAD,CAAK1B,QAAQ,WAAWF,MAAM,UAAU6B,aAAW,MAAMxB,UAAWF,IAAMI,GAAG,SACzE,kBAAC,IAAD,MADJ,gBAKJ,kBAACa,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAACC,EAAA,EAAD,CAAYvB,QAAQ,WAAW4B,QAAQ,QAAQJ,cAAY,GAA3D,yB,2BClBHK,EAAkB,SAACC,GAC5B,MAAO,CAAEjG,KARoB,oBAQKiG,SAEzBC,EAAmB,SAACC,GAC7B,MAAO,CAAEnG,KAVqB,qBAUKmG,kBAE1BC,EAAkB,SAACC,GAC5B,MAAO,CAAErG,KAZqB,qBAYKqG,WAE1BC,EAAqB,SAACC,GAC/B,MAAO,CAAEvG,KAdwB,wBAcKuG,SAM7BC,EAAc,SAACC,GACxB,MAAO,CAAEzG,KAnBgB,gBAmBKyG,QAI5BrF,EAAe,GChBf4B,EAAYC,aAAW,SAACC,GAAD,MAAY,CACrCwD,OAAQ,CACJC,MAAO,OACPC,QAAS1D,EAAMI,QAAQ,GACvByB,OAAQ7B,EAAMI,QAAQ,IAE1BuD,MAAO,CACHd,QAAS,OACTe,eAAgB,SAChBC,WAAY,SACZ9C,MAAOf,EAAM8D,QAAQxE,KAAKyE,UAC1BC,OAAQhE,EAAMI,QAAQ,IACtBqD,MAAO,YA2BAQ,MAvBf,SAAaC,GACT,IAAM7D,EAAUP,IACVQ,EAAWC,cAMjB,OACI,kBAAC0B,EAAA,EAAD,CACIpB,UAAWR,EAAQmD,OACnBpC,UAAWC,IACXC,GAAE,gBAAW4C,EAAM1H,OACnB2H,QATR,WACI7D,EDZG,CAAExD,KAjBqB,qBAiBKN,MCYN0H,EAAM1H,UAU3B,kBAAC4H,EAAA,EAAD,CAAOvD,UAAWR,EAAQsD,MAAOU,UAAW,GACvCH,EAAMvD,IAAIjC,MACX,iCClCVoB,EAAYC,aAAW,SAACC,GAAD,MAAY,CACrCwD,OAAQ,CACJC,MAAO,OACPC,QAAS1D,EAAMI,QAAQ,GACvByB,OAAQ7B,EAAMI,QAAQ,IAE1BuD,MAAO,CACHd,QAAS,OACTe,eAAgB,SAChBC,WAAY,SACZ9C,MAAOf,EAAM8D,QAAQxE,KAAKyE,UAC1BC,OAAQhE,EAAMI,QAAQ,IACtBqD,MAAO,YAgCAa,MA5Bf,WACI,IAAMjE,EAAUP,IACVQ,EAAWC,cACX5C,EAAO6C,aAAY,SAAC9C,GAAD,OAAW6G,OAAOC,OAAO9G,EAAMC,SAOxD,OACI,kBAACwE,EAAA,EAAD,CAAMC,WAAS,EAAChC,QAAS,GACrB,kBAAC+B,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAACN,EAAA,EAAD,CAAQpB,UAAWR,EAAQmD,OAAQW,QAR/C,WACI,IAAMM,ELtBW,WAAiB,IAAhB9H,EAAe,uDAAP,GAC1BH,EAAQK,IAWZ,MAAO,CAAEC,KApBa,aAoBKN,QAAOG,MAVlCA,EAAK,aACD+B,MAAO,WACPS,eAAgB,KAChBpC,UAAWC,KAAKC,MAChBiC,UAAW,GACXtB,OAAQ,GACRK,eAAgB,IACbtB,EAPF,CAQDW,GAAId,KKYWkI,GACfpE,EAASmE,KAOG,kBAACL,EAAA,EAAD,CAAOvD,UAAWR,EAAQsD,MAAO1C,QAAQ,YACrC,kBAAC,IAAD,SAIXtD,EAAKG,KAAI,SAAC6C,GAAD,OACN,kBAACwB,EAAA,EAAD,CAAM9C,IAAKsB,EAAIrD,GAAIgF,MAAI,EAACC,GAAI,GACxB,kBAAC,EAAD,CAAK5B,IAAKA,EAAKnE,MAAOmE,EAAIrD,W,8OC3C/B,YAACJ,EAAWR,GACvB,KCLW,SAACA,GACZ,IAMMiI,EAA0B,aAAlBjI,EAASkI,MAA8C,QAAvBlI,EAASkI,KAAK9H,KACtD+H,EAAaF,EACb,CACIG,WAAY,CAAEhI,KAAM,QAASiI,QAAQ,IAEzC,CACIC,MAAO,CACHlI,KAAM,WACNmI,MAAO,mBAGXH,WAAY,CACRhI,KAAM,QACNiI,QAAQ,EACRE,MAAO,oBAKrBvI,EAAQ,UAAgBmI,EAEnBF,IACDjI,EAASwI,SAAT,QAA+B,CAC3BC,UAAW,CAKP,CACIC,UAAW,aACXxG,MAAO,IAGfA,MAAO,KDlCXyG,CAAuB3I,GACzB,MAAO+E,IAET,IAAMhF,EAAO6I,mBAAQ5I,GAAUD,KAqB/B,OAlBAA,EAAKgC,KAAK8G,SAAQ,SAACC,GACXA,EAAEC,KAAOD,EAAEC,IAAIC,WAAW,UAC1BF,EAAEC,IAAME,oBAA+BH,EAAEC,QAKjDhJ,EAAKmJ,QAAL,uBACQnJ,EAAKmJ,SAAW,IADxB,CAEI,CACIrH,KAAM,YACNK,MAAO,CAAEH,KAAM,GAAIoH,MAAO,EAAGC,IAAK,IAAKC,SAAS,MAIxDtJ,EAAKuJ,MAAMT,SAAQ,SAACX,IAMjB,SAASqB,EAAgBrB,EAAM1H,GAClC,GAAkB,UAAd0H,EAAK9H,KAKL,YAHI8H,EAAKoB,OACLpB,EAAKoB,MAAMT,SAAQ,SAACX,GAAD,OAAUqB,EAAgBrB,EAAM1H,OAI3D,IAAMyH,EAAsB,UAAdC,EAAK9H,MAAoB8H,EAAKjF,MAAMuG,SAAS,YACrDC,EAAe,sIAEbxB,EAAQ,qEAAuE,IAFlE,6GAKbA,EAAQ,qEAAuE,IALlE,wbAYfyB,EAAiB,uIAEfzB,EAAQ,qEAAuE,IAFhE,6GAKfA,EAAQ,qEAAuE,IALhE,oHAQjB0B,EAAUzB,EAAK0B,OAAOC,OAAOrJ,EAAUC,SACvCqJ,EAAgB,CAClB,CACIC,KAAMN,EACNvH,MAAO1B,EAAUE,QAErB,CACIqJ,KAAML,EACNxH,MAAO1B,EAAUG,WAMzBuH,EAAK0B,OAAOC,OAAZ,eACO3B,EAAK0B,OAAOC,OADnB,eAEKrJ,EAAUC,QAAUqJ,EAAcE,OAAOC,aAAQN,GAAWA,EAAU,MAlDvEJ,CAAgBrB,EAAM1H,MAEnBT,G,cE/BI,YAACmK,GAAqB,IAC/BC,EACAC,EAFgBC,EAAc,uDAAP,GAIrBC,EAAY,WAAc,IAAD,uBAATC,EAAS,yBAATA,EAAS,gBAC7B,IAAMhK,EAAMD,KAAKC,MAEb4J,GAAQ5J,EAAM4J,EAAOE,GACvBG,aAAaJ,GAEbA,EAAaK,YAAW,WACtBN,EAAO5J,EACP2J,EAAI,WAAJ,EAAQK,KACPF,KAEHF,EAAO5J,EACP2J,EAAI,WAAJ,EAAQK,KAIZ,OAAOD,G,uECPM,SAASI,GAAiBlD,GACrC,IAAM5D,EAAWC,cACX8G,EAAiB,CACnBC,QAAS,CAAElK,OAAQ,EAAKC,SAAU,IAClCkK,KAAM,CAAEnK,OAAQ,UAAWC,SAAU,YAEnCmK,EAAS,CACX,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEEtK,EAAYgH,EAAMuD,MAAMvK,UA5Bc,EA6BhBwK,mBAASxK,EAAUE,QA7BH,mBA6BrCA,EA7BqC,KA6B7BuK,EA7B6B,OA8BZD,mBAASxK,EAAUG,UA9BP,mBA8BrCA,EA9BqC,KA8B3BuK,EA9B2B,KAkD5C,SAASC,EAA4BC,EAAOC,GACxCJ,EAAUI,GACVzH,EAAS/C,EAAY2G,EAAMuD,MAAMnK,GAAI,CAAEJ,UAAU,eAAMA,EAAP,CAAkBE,OAAQ2K,OAE9E,SAASC,EAA8BF,EAAOC,GAC1CH,EAAYG,GACZzH,EAAS/C,EAAY2G,EAAMuD,MAAMnK,GAAI,CAAEJ,UAAU,eAAMA,EAAP,CAAkBG,SAAU0K,OAEhF,OACI,6BACI,kBAACrF,EAAA,EAAD,CACIuF,OAAO,QACPpH,UAAWqH,KAAIC,MACfC,IAAK,GACLC,KAAM,MACNC,YAAa,SAAC7G,GAAD,OAAOA,EAAE8G,oBAEtB,kBAAC7F,EAAA,EAAD,CAAKtB,UAAWgD,IAAOoE,EAAG,GACtB,kBAACrG,EAAA,EAAD,CAAMC,WAAS,EAACqG,UAAU,SAASrI,QAAS,GACxC,kBAAC+B,EAAA,EAAD,CAAMG,MAAI,GACN,kBAACE,EAAA,EAAD,CAAYC,cAAY,GAAxB,qBAEJ,kBAACN,EAAA,EAAD,CAAMG,MAAI,GACN,kBAACE,EAAA,EAAD,CAAYvB,QAAQ,WAApB,WACA,kBAACyB,EAAA,EAAD,KACI,kBAACgG,GAAA,EAAD,CAAQ9J,MAAO1B,EAAUC,QAASqE,SA5C9D,SAA6BsG,GAEzB,IAAM3K,EAAU2K,EAAMpG,OAAO9C,MAE7B,GAAIzB,IAAYD,EAAUC,QAAS,CAC/B,IAAMwL,EAAStB,EAAelK,GAC9BwK,EAAUgB,EAAOvL,QACjBwK,EAAYe,EAAOtL,UACnBiD,EACI/C,EAAY2G,EAAMuD,MAAMnK,GAAI,CAAEJ,UAAU,aAAGC,WAAYkK,EAAelK,UAoCjDoH,OAAOqE,KAAKvB,GAAgBvJ,KAAI,SAAC6K,GAAD,OAC7B,kBAACE,GAAA,EAAD,CAAUxJ,IAAKsJ,EAAQ/J,MAAO+J,GACzBA,SAMrB,kBAACxG,EAAA,EAAD,CAAMG,MAAI,GACN,kBAACE,EAAA,EAAD,CAAYvB,QAAQ,WAApB,UACuB,YAAtB/D,EAAUC,QACP,kBAAC2L,GAAA,EAAD,CACIlK,MAAOxB,EACP2L,kBAAgB,kBAChBC,kBAAkB,OAClBC,IAAK,EACLC,IAAK,EACLC,KAAM,IACN3H,SAlDhC,SAA4BsG,EAAOC,GAC/BJ,EAAUI,IAkDkBqB,kBAAmBvB,IAGvB,kBAACnF,EAAA,EAAD,CAAK7B,UAAWqH,KAAImB,QACf7B,EAAO1J,KAAI,SAACiD,GAAD,OACR,kBAAC2B,EAAA,EAAD,CACI7B,UAAWqH,KAAInH,MACfuI,QAASvI,EACTwI,OAAQxI,IAAU3D,EAAS,EAAI,EAC/BoM,UAAW,SAAC/H,GAAD,OAAOoG,EAA4BpG,EAAGV,UAKjE,kBAACyB,EAAA,EAAD,CAAYvB,QAAQ,WAApB,YACuB,YAAtB/D,EAAUC,QACP,kBAAC2L,GAAA,EAAD,CACIlK,MAAOvB,EACP0L,kBAAgB,kBAChBC,kBAAkB,OAClBC,IAAK,EACLC,IAAK,EACLC,KAAM,IACN3H,SAvEhC,SAA8BsG,EAAOC,GACjCH,EAAYG,IAuEgBqB,kBAAmBpB,IAGvB,kBAACtF,EAAA,EAAD,CAAK7B,UAAWqH,KAAImB,QACf7B,EAAO1J,KAAI,SAACiD,GAAD,OACR,kBAAC2B,EAAA,EAAD,CACI7B,UAAWqH,KAAInH,MACfuI,QAASvI,EACTwI,OAAQxI,IAAU1D,EAAW,EAAI,EACjCmM,UAAW,SAAC/H,GAAD,OACPuG,EAA8BvG,EAAGV,e,gGCvHpE0I,GAAc,SAACjN,EAAOkN,GAC/B,MAAO,CACH5M,KAjBoB,eAkBpB4M,MAAOA,EAAM5L,KAAI,SAACiF,GAAD,sBACVA,EADU,CAEbhG,UAAWC,KAAKC,MAChBT,QACAc,GAAIT,EAAS,gBAuBZ8M,GAAiB,SAACxG,GAC3B,MAAO,CACHrG,KAhDuB,kBAiDvBqG,WCnCO,SAASyG,GAAmB1F,GACvC,IAAM5D,EAAWC,cACX6E,EAAYyE,OAAOC,eACnBC,EAAM3E,EAAU4E,WAAa,EAAI5E,EAAU6E,WAAW,GAAGC,wBAA0B,KAInFC,EADkBjG,EAAMkG,cAAc/L,WACbM,SAASb,KAAI,SAACuM,GAAD,OAAOA,EAAE7L,SAC/C8L,EAAO,aAAO,IAAIC,IAAIJ,IARkB,MAwBtBK,IAAM9C,UAAS,GAxBO,mBAwBvC+C,EAxBuC,KAwBjCC,EAxBiC,KAyBxCC,EAAYH,IAAMI,OAAO,MAzBe,EA0BJJ,IAAM9C,SAAS,GA1BX,mBA0BvCmD,EA1BuC,KA0BxBC,EA1BwB,KAyCxCC,EAAc,SAACjD,GACb6C,EAAUK,SAAWL,EAAUK,QAAQC,SAASnD,EAAMpG,SAI1DgJ,GAAQ,IA2FZ,OAAOX,GAAO7F,EAAMjB,cAChB,kBAACP,EAAA,EAAD,CAIIwI,MAAO,EACP9C,IAAK,EACLvH,UAAWqH,KAAIC,OAEf,kBAAC/D,EAAA,EAAD,CAAOC,UAAW,GACd,kBAAC8G,GAAA,EAAD,CAAaxJ,KAAK,QAAQV,QAAQ,OAAOW,WAAS,EAACgB,aAAW,sBAC1D,kBAACX,EAAA,EAAD,CACImJ,IAAKT,EACLU,gBAAeZ,EAAO,yBAAsBa,EAC5CC,gBAAed,EAAO,YAASa,EAC/B1I,aAAW,iBACX4I,gBAAc,OACdrH,QArHC,WACjBuG,GAAQ,SAACe,GAAD,OAAeA,MAqHPC,QAAS,kBAAC,KAAD,OAERpB,EAAQO,KAGjB,kBAACM,GAAA,EAAD,CAAaxJ,KAAK,QAAQV,QAAQ,OAAOW,WAAS,EAACgB,aAAW,sBAC1D,kBAACX,EAAA,EAAD,CAAQqG,YAjJxB,SAA2BR,GACvBA,EAAM6D,iBACN7D,EAAMS,kBA+BV,SAAwBtF,EAAe2I,EAAY5G,EAAO6G,GACtDC,QAAQC,IAAI,YAAaF,GACzB,IAAI9I,EAAO,KACX,GAAI6I,EAAWlM,OAAS,EAAG,CAEvB,IADA,IAAIsM,EAAS,GACJC,EAAI,EAAGA,EAAIL,EAAWlM,OAAQuM,IACnC,IAAK,IAAIC,EAAI,EAAGA,EAAIL,EAASnM,OAAQwM,IAC7BN,EAAWK,GAAGzH,OAAO,KAAOqH,EAASK,GAAGC,SAASH,EAAOI,KAAKP,EAASK,IAGlF,IAAIzN,EAAO,GACXuN,EAAOzG,SAAQ,SAAUiD,GACjBA,EAAE6D,eAAe,eAGZ7D,EAAC,WAAe8B,EAAQO,IAEtBpM,EAAK2N,KAAK5D,EAAC,WAAe8B,EAAQO,KACtCpM,EAAK2N,KAAK5D,EAAE8B,EAAQO,QAG/B9H,EAAO,CACHzD,KAAM2D,EAAc3D,KACpBgN,QAAS,CAAE9N,MAAO8L,EAAQO,IAC1BjO,QAASsH,EAAMkG,cAAc9M,GAC7BF,QAAQ,EACRN,KAAM,aACN2B,KAAMA,EACN8N,WAAYrI,EAAMjB,cAAcsJ,WAChCC,SAAUtI,EAAMjB,cAAcuJ,SAC9BC,SAAU,GACVC,aAAa,GAGrB,GAAI1H,EAAMtF,OAAS,EAAG,CAClB,IAAIsM,EACAW,EACAC,EACAC,EACAC,EAGJ,GAC+B,IAA3B9H,EAAM,GAAGmF,OAAOzK,QACY,MAA5BsF,EAAM,GAAGmF,OAAO,GAAGrN,MACS,MAA5BkI,EAAM,GAAGmF,OAAO,GAAGrN,KAEnB6P,EAAS3H,EAAM,GAAGmF,OAAO,GAAG3L,MAC5BoO,EAAS5H,EAAM,GAAGmF,OAAO,GAAG3L,MAC5BqO,EAAS7H,EAAM,GAAGR,OAAO,GACzBsI,EAAS9H,EAAM,GAAGR,OAAO,GACzBwH,EAAS,OACN,CAEH,IAAMe,EAAkB/H,EAAM,GAAGmF,OAAO6C,WACpC,SAAC3C,GAAD,OAAOA,EAAE7L,QAAU8L,EAAQO,IAA6B,MAAXR,EAAEvN,QAI/CiQ,GAAmB,IACnBf,EAAShH,EAAM,GAAGR,OAAOuI,IAIjChK,EAAO,CACHzD,KAAM2D,EAAc3D,KACpBgN,QAAS,CAAE9N,MAAO8L,EAAQO,IAC1BjO,QAASsH,EAAMkG,cAAc9M,GAC7BF,QAAQ,EACRN,KAAM,QACN2B,KAAMuN,EACNO,WAAYrI,EAAMjB,cAAcsJ,WAChCC,SAAUtI,EAAMjB,cAAcuJ,SAC9BC,SAAU,GACVC,aAAa,EACbC,OAAQA,EACRE,OAAQA,EACRD,OAAQA,EACRE,OAAQA,GAGhB,GAAa,OAAT/J,EAAe,CACf,IAAM0B,EAASgF,GAAYvF,EAAM+I,WAAW3P,GAAI,CAACyF,IACjDzC,EAASmE,GACTnE,EAAS4C,EAAgBuB,EAAOiF,MAAM,GAAGpM,UACtCgD,EAAS4C,EAAgB,OAnHhCgK,CAAehJ,EAAMjB,cAAeiB,EAAMiJ,cAAejJ,EAAMc,MAAOd,EAAM2H,UAC5EvL,EAAS0C,EAAiB,OAC1B1C,EAAS8C,GAAmB,MA4IhB,UACA,kBAACnB,EAAA,EAAD,CAAQqG,YAxJxB,SAA0BR,GACtBxH,EAAS8C,GAAmB,IAC5B0E,EAAM6D,iBACN7D,EAAMS,kBACNjI,EAAS0C,EAAiB,SAoJd,WAEJ,kBAACoK,GAAA,EAAD,CACI3C,KAAMA,EACN4C,SAAU1C,EAAUK,QACpBsC,UAAMhC,EACNiC,YAAU,EACVC,eAAa,IAEZ,gBAAGC,EAAH,EAAGA,gBAAiBC,EAApB,EAAoBA,UAApB,OACG,kBAACC,GAAA,EAAD,iBACQF,EADR,CAEI9N,MAAO,CACHiO,gBACkB,WAAdF,EAAyB,aAAe,mBAGhD,kBAACtJ,EAAA,EAAD,KACI,kBAACyJ,GAAA,EAAD,CAAmBC,YAAa/C,GAC5B,kBAACgD,GAAA,EAAD,CAAUzQ,GAAG,qBACRgN,EAAQxM,KAAI,SAAC6K,EAAQqF,GAAT,OACT,kBAACnF,GAAA,EAAD,CACIxJ,IAAKsJ,EAELsF,SAAUD,IAAUnD,EACpB1G,QAAS,SAAC2D,GAAD,OA3JzB,SAACA,EAAOkG,GAChClD,EAAiBkD,GACjBtD,GAAQ,GA0JoCwD,CAAoBpG,EAAOkG,KAG9BrF,eAkBzC,G,mCCzNOwF,mBAAK,YAehB,IAdAC,EAcD,EAdCA,MACAC,EAaD,EAbCA,WAMAjJ,GAOD,EAZCkJ,eAYD,EAXCC,cAWD,EAVCC,UAUD,EATCC,eASD,EARCC,UAQD,EAPCtJ,WAKAzF,GAED,EANCgP,KAMD,EALCC,aAKD,EAJCC,aAID,EAHCC,cAGD,EAFCnP,OACGoP,EACJ,6LAGkBxO,cACOmH,mBAAS,OAJlC,mBAIQsH,EAJR,KAIcC,EAJd,KAKOC,EAActE,iBAAO,MACrBuE,EAAUvE,iBAAO,MANxB,EAO2BlD,mBAAS,GAPpC,mBAOQ0H,EAPR,KAOeC,EAPf,KAQO5H,EAAQjH,aAAY,SAAC9C,GAAD,OAAWA,EAAME,OAAOyQ,EAAW/Q,OACvD2F,EAAgBzC,aAAY,SAAC9C,GAAD,OAAWA,EAAM+C,GAAGwC,iBAChDzG,EAAU8S,eAAV9S,MACAmE,EAAMH,aAAY,SAAC9C,GAAD,OAAWA,EAAMC,KAAKnB,MACxCyB,EAAiBuC,aAAY,SAAC9C,GAAD,OAAWA,EAAMC,KAAKnB,GAAOyB,kBAZjE,EAa2CyJ,mBAAS,IAbpD,mBAaQyF,EAbR,KAauBoC,EAbvB,OAciC7H,mBAAS,IAd1C,mBAcQmE,EAdR,KAckB2D,EAdlB,OAe2B9H,mBAAS,IAfpC,mBAeQ1C,EAfR,KAeeyK,EAff,OAgB6C/H,oBAAS,GAhBtD,mBAgBQgI,EAhBR,KAgBwBC,EAhBxB,KAiBOC,EAAWpP,aAAY,SAAC9C,GAAD,OAAWA,EAAM+C,GAAGmP,YAG3ClG,EAAQlJ,aACV,SAAC9C,GAAD,OAAW6G,OAAOC,OAAO9G,EAAMgM,OAAOmG,QAAO,SAAC9M,GAAD,OAAUA,EAAKnG,UAAYyR,EAAW/Q,QACnFwS,KAEErT,EAAOsT,mBACT,kBACIC,GAEIvI,EAAMvK,UACN+S,KAAKC,MAAMD,KAAKE,UAAU1I,EAAM/K,cAExC,CAAC+K,EAAMhL,KAAMgL,EAAMvK,YAuDvB,SAASkT,EAAOpB,EAAMI,GAClB,GAAIJ,EAAM,CAAC,IACCvL,EAAUyL,EAAYlE,QAAQd,wBAA9BzG,MACFO,EAASoL,EAAQ3L,EACvBuL,EAAKoB,SAASpM,OAAOA,GAAQP,MAAMA,GAAO4M,YAxDlDC,qBAAU,YACS,yCAAG,yCAAAC,EAAA,6DAGRC,EAAUN,aAAMzT,GAHR,SAIS,IAAIgU,KAAKD,GAASH,WAJ3B,cAIRK,EAJQ,gBAMOA,EAASC,WANhB,cAMRC,EANQ,OAORxB,EAAQwB,EAAO5M,OAAS4M,EAAOnN,MACrC4L,EAASD,GARK,UAmBOyB,mBAAU1B,EAAQnE,QAASvO,EAAM,CAAEqU,SAAS,IAnBnD,QAmBRC,EAnBQ,OAoBR/B,EAAO+B,EAAO/B,KAGdnD,EAAYpE,EAAM/K,SAAS+B,KAAK4N,eAAe,OAE/C2C,EAAKvQ,KAAK,YADVuQ,EAAKvQ,KAAK,UAEhB+Q,EAAY3D,GACZ,IACImD,EAAKgC,gBAAgB,oBAAoB,SAAUzS,EAAMK,GACrDkN,QAAQC,IAAIxN,EAAMK,GAClB2Q,EAAiBpC,EAAczG,OAAO9H,OAG1CoQ,EAAKgC,gBAAgB,eAAe,SAAUzS,EAAMK,GAChDkN,QAAQC,IAAIxN,EAAMK,GAClB6Q,EAASzK,EAAM0B,OAAO9H,OAE5B,MAAOqS,IAGThC,EAAQD,GAxCM,4CAAH,qDA0CfkC,KACD,CAACzU,IAEJ6T,oBACIa,GAAQ,wBAAC,uBAAAZ,EAAA,sDACLH,EAAOpB,EAAMI,GADR,2CAEN,MAWPkB,qBAAU,WACDtB,IAGDtF,EAAM0H,MAAK,SAACrO,GAAD,OAAUA,EAAK3F,UAE1BsM,EACKmG,QAAO,SAAC9M,GAAD,OAAUA,EAAK3F,UACtBmI,SAAQ,SAACxC,GACNiM,EAAKqC,OAAO,YAAa,CACrBvU,KAAMiG,EAAKjG,KACX2B,KAAMsE,EAAKtE,KACXD,MAAOuE,EAAKuJ,QAAQ9N,MACpBuH,SAAS,EAETuL,WAAYvO,EAAKuO,YAAc,GAC/BC,SAAUxO,EAAKwO,UAAY,EAC3BC,SAAUzO,EAAKyO,UAAY,EAE3B7E,OAAQ5J,EAAK4J,QAAU,GACvBC,OAAQ7J,EAAK6J,QAAU,GACvBC,OAAQ9J,EAAK8J,QAAU,CAAC,EAAG,GAC3BC,OAAQ/J,EAAK+J,QAAU,CAAC,EAAG,KAC5BuD,cAGXrB,EAAKqC,OAAO,YAAa,CAAEtL,SAAS,IAASsK,cAElD,CAACrB,EAAMtF,IAKV,IAAM+H,GAAa7B,GAAmBxK,EAAUsM,iBAAmBtD,EAAMuD,SAEnEC,EACF3T,EAAe4T,QAAQpK,EAAMnK,KAAO,IAAMmU,GAAcxO,EAAxD,eAEatD,EAFb,CAGUmB,SAAU,WACVgR,YAAa,QACbC,YAAa,SALvB,eASapS,EATb,CAUUmB,SAAU,aAIxB,OACI,kBAAC,IAAMkR,SAAP,KACI,uCAAK5G,IAAK8D,GAAiBH,EAA3B,CAAyCpP,MAAOiS,IAC5C,6BACKH,GACG,kBAACQ,GAAA,EAAD,CACI3J,YA1BxB,WACIqH,GAAmBD,IA0BC9M,aAAW,YAGX,kBAAC,KAAD,QAIZ,yBAAKwI,IAAK+D,IAETsC,GAAc/B,GAAkB,kBAACtI,GAAD,CAAkBK,MAAOA,IAEzDgK,GAAcxO,GACX,kBAAC2G,GAAD,CACIqD,WAAYtM,EACZyJ,cAAe3C,EACfxE,cAAeA,EACfkK,cAAeA,EACfnI,MAAOA,EACP6G,SAAUA,S,SCvK5BqG,GAAgBC,OAChBC,GAAcC,OACdC,GAAkBC,OAClBC,GAAmBC,OAEjBC,GAAkBJ,GAAlBI,cACA1R,GAAYkR,GAAZlR,QAQK2R,GAAgB,CAACP,GAAaI,GAAkBF,GAAiBJ,GCzC/D,WAAkB,IAAjBU,EAAgB,uDAAP,GACfxR,EAAYwR,EAAOpE,UACnBoE,EAAOpE,UAAUqE,IACjBA,GAEN,MAAO,CACHC,gBAAiB,SAAC1E,EAAD,GAAgC,IAAtB2E,EAAqB,EAArBA,eACvB,GAAwB,WAApB3E,EAAM4E,UAAwB,CAC9B,IACMC,EADeF,IAAiBG,oBACVC,UAAU/E,EAAMgF,YAAY,IAClD3U,EAAOwU,EAAOI,UAEpB,GAAa,UADAJ,EAAOD,UAEhB,MAAO,CACH5R,YACAkS,UAAU,EACVpP,MAAM,eACCzF,IAKnB,OAAO,MAEXoU,eDgBiBU,CAAuB,CAAE/E,UANhCgF,6BAChBpB,GAAY5D,UACZgE,GAAiBhE,UACjB8D,GAAgB9D,cAMH,SAASiF,KACtB,OACE,kBAAC,WAAD,KACE,kBAAC,GAAD,MAEI,SAAAC,GAAa,OACX,6BACE,kBAAC,cAAeA,GAChB,kBAAC,gBAAiBA,GAClB,kBAAC,mBAAoBA,GACrB,kBAAC,cAAeA,GAChB,kBAAC,aAAcA,GACf,kBAAC,qBAAsBA,GACvB,kBAAC,qBAAsBA,GACvB,kBAAC,uBAAwBA,GACzB,kBAAC,uBAAwBA,GACzB,kBAAC,qBAAsBA,GACvB,kBAAC,oBAAqBA,GACtB,kBAAC,mBAAoBA,OAI7B,kBAAChB,GAAD,O,kDE7BS,QACX,CACIiB,SAXD,SAAiCC,EAAcC,EAAUjF,GAC5DgF,EAAaE,kBAAiB,SAACC,GAC3B,IAAMC,EAAYD,EAAUZ,YAC5B,OACkB,OAAda,GAAsE,mBAAhDpF,EAAauE,UAAUa,GAAWhB,YAE7Da,IAMCzS,UCvCO,SAAc8C,GACzB,OACI,0BAAMrD,UAAWqH,KAAIjF,cAAegR,kBAAiB/P,EAAMwK,WACtDxK,EAAMgQ,YDsCf,CACIP,SArBD,SAA0BC,EAAcC,EAAUjF,GACrDgF,EAAaE,kBAAiB,SAACC,GAC3B,IAAMC,EAAYD,EAAUZ,YAC5B,OAAqB,OAAda,GAAsE,SAAhDpF,EAAauE,UAAUa,GAAWhB,YAChEa,IAkBCzS,UExCO,SAAc8C,GACzB,IAAM5D,EAAWC,cACXmJ,EAAQlJ,aAAY,SAAC9C,GAAD,OAAWA,EAAMgM,SAEvC/J,EAAQuI,KAAIiM,cACVpR,EAAOmB,EAAM0K,aAAauE,UAAUjP,EAAM8P,WAAWX,UAiB3D,OAhBI3J,EAAM3G,EAAKzF,KACPoM,EAAM3G,EAAKzF,IAAIoP,cAAa/M,EAAQuI,KAAInF,MAgB5C,0BACIlC,UAAWlB,EACXyU,YAfR,WAEI9T,EP6BG,CACHxD,KA1CqB,gBA2CrBqG,OO/BsBJ,EAAKzF,MAcvB+W,aAZR,WACI1K,GAAe5G,EAAKzF,IACpBgD,EAASqJ,GAAe5G,EAAKzF,MAWzB6G,QATR,WACI7D,EAASwC,EAAgBC,KASrBkR,kBAAiB/P,EAAMwK,WAEtBxK,EAAMgQ,aCvBJ,SAASI,GAAOpQ,GACV3D,cAAjB,IACM/D,EAAU8S,eAAV9S,MAGA+X,GAFM/T,aAAY,SAAC9C,GAAD,OAAWA,EAAMC,KAAKnB,MAEvBgE,aAAY,SAAC9C,GAAD,OAAWA,EAAMC,KAAKnB,GAAO2C,mBAC1DqV,EAAW5J,iBAAO,MAElBgE,EACiB,OAAnB2F,EACME,eAAYC,cAAcxB,oBAC1ByB,0BCxBC,SAACJ,GACZ,IAAI1U,EAAS,eAAQ0U,EAAe1U,WAOpC,OANA0E,OAAOqE,KAAK/I,GAAW0F,SAAQ,SAAUlG,GACT,SAAxBQ,EAAUR,GAAKvC,OACV+C,EAAUR,GAAKZ,KAAKiO,oBAAoB7M,EAAUR,OAGrC,CAAED,OAAQmV,EAAenV,OAAQS,UAAWA,GDiB7C+U,CAAqBL,IAXZ,EAYI7M,mBAAS+M,eAAYI,kBAAkBjG,IAZ3C,mBAY3BkG,EAZ2B,KAYdC,EAZc,KAe5BnF,EAAW1L,EAAM0L,SAgBvB,OACI,kBAAC,WAAD,KACI,yBAAK/O,UAAWqH,KAAI8M,QAChB,kBAAC,KAAD,CACIF,YAAaA,EACbG,QAAStC,GACTnR,SApBhB,SAA4BsT,GACxBC,EAAeD,IAoBHI,iBAjBhB,SAA0BC,GAEtB,IAAMC,EAAiBC,aAAUH,iBAAiBJ,EAAaK,GAC/D,OAAIC,GACAL,EAAeK,GACR,WAEJ,eAWKE,WAAYC,GACZnK,IAAKoJ,EACLgB,SAAU5F,ME/Cf,SAASa,GAAKvM,GAMzB,OALA4H,QAAQC,IAAI,yBAEKxL,aACjBD,CAASgD,GAAY,IAGjB,kBAACnB,EAAA,EAAD,CAAMC,WAAS,EAAChC,QAAS,GACrB,kBAAC+B,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAAC+R,GAAD,CAAQ1E,UAAU,M,8CCqCnBzB,uBA/CR,SAAejK,GACpB,IAAMiL,EAAUvE,iBAAO,MAEjBnO,EAAOsT,mBAAQ,kBAAME,KAAKC,MAAMD,KAAKE,UAAUjM,EAAMzH,SAAQ,CAACyH,EAAMzH,OAG1E6T,qBAAW,WACTO,mBAAU1B,EAAQnE,QAASvO,GAAMgZ,MAAK,SAAA1E,SAGtC,CAACtU,IAVwB,MAiBDiL,oBAAS,GAjBR,mBAiBpBgO,EAjBoB,KAiBbC,EAjBa,KAwB3B,OACE,kBAACvR,EAAA,EAAD,CAAOvD,UAAWqH,KAAI9F,UACpBiC,UAAWqR,EAAM,EAAE,GACnB,yBACEE,WAAW,EACXC,YAhBN,SAAyBpU,GACvBA,EAAEqU,aAAaC,QAAQ,UAAW7R,EAAM5G,KAgBpC0Y,aAZN,WACEL,GAAS,IAYLtB,aAVN,WACEsB,GAAS,KAWL,yBAAKvK,IAAK+D,S,UC1BH,gD,gDAAA,WAAgB1S,GAAhB,wEAAA8T,EAAA,yDACN9T,EAAKgC,KADC,yCAEA,IAFA,cAILwX,EAAa,GACbzF,EAAUN,aAAMzT,GALX,SAMQ,IAAIgU,KAAKD,GAASH,WAN1B,OAMLrB,EANK,OAOLtR,EAAQsR,EAAKkH,SAAS,CACxBzX,KAAM0X,MACNvQ,QAASwQ,KACTC,SAAS,IAVF,+BAcQ5Z,EAAKuJ,MAdb,mEAcApB,EAdA,QAgBDnG,EAAOf,EAAMe,KAAKmG,EAAKrG,MAAMT,KAAI,SAAC0H,GAAD,OAAOA,EAAE8Q,SAhBzC,+BAkBa7X,EAlBb,mEAkBI6X,EAlBJ,QAmBG3R,EAAsB,UAAdC,EAAK9H,MAAoB8H,EAAKjF,MAAMuG,SAAS,YACvDqQ,EAAUhS,OAAOgS,QAAQD,GACzB3R,IAEA4R,EAAUA,EAAQ7P,OAAOnC,OAAOgS,QAAQD,EAAMjY,cAvB/C,+BAyB0BkY,EAzB1B,+FAyBS/X,EAzBT,KAyBgBI,EAzBhB,KA0BM4X,aAAS5X,GA1Bf,wDA8BCqX,EAAWrX,GAAS,CAChBA,QACA9B,KAAM,SACN0B,QACAC,KAAM6X,EAAM/X,MAlCjB,oyBA2CX9B,EAAKgC,KAAK8G,SAAQ,SAAC+Q,GAEEtH,EAAKvQ,KAAK6X,EAAM/X,SAI/BkY,EAAUC,GAAiBja,GACjCA,EAAKka,OACA9G,QAAO,SAAC+G,GAAD,MAAW,CAAC,UAAW,OAAQ,SAAS1Q,SAAS0Q,EAAM9Z,SAC9DyI,SAAQ,SAACqR,GAENna,EAAKgC,KAAK8G,SAAQ,SAAC+Q,GAEEtH,EAAKvQ,KAAK6X,EAAM/X,MACxBgH,SAAQ,SAACsR,GAGd,GAAID,EAAME,OAAOtY,MAAO,CACpB,IAAMA,EAAQoY,EAAME,OAAOtY,MACrBI,EAAQmY,aAAOF,EAAIrY,IAAUqY,EAAIrY,GAASwY,cAASH,EAAIrY,IACvD1B,EAAOia,aAAOnY,GAAS,OAAS,SACtCqX,EAAWrX,GAAS,CAChBA,QACA9B,OACA0B,QACAC,KAAM6X,EAAM/X,WAETqY,EAAME,OAAO3M,QAEpByM,EAAME,OAAO3M,OAAO5E,SAAQ,SAACC,GACzB,IAAMhH,EAAQgY,aAAShR,GAAKA,EAAIA,EAAEhH,MAC5BI,EAAQmY,aAAOF,EAAIrY,IAAUqY,EAAIrY,GAASwY,cAASH,EAAIrY,IACvD1B,EAAOia,aAAOnY,GAAS,OAAS,SACtCqX,EAAWrX,GAAS,CAChBA,QACA9B,OACA0B,QACAC,KAAM6X,EAAM/X,eAM5BoI,aAAQiQ,EAAME,SAEdF,EAAME,OAAOvR,SAAQ,SAAC3G,GAClBA,EAAQmY,aAAOnY,GAASA,EAAQoY,cAASpY,GACzC,IAAM9B,EAAOia,aAAOnY,GAAS,OAAS,SAChCJ,EAAQyY,GAAgBxa,EAAMma,EAAMrY,MAC1C0X,EAAWrX,GAAS,CAChBA,QACA9B,OACA0B,QACAC,KAAM,YAKpBJ,EAAa,CAAEC,KAAMiG,OAAOC,OAAOiS,GAAU9X,SAAU4F,OAAOC,OAAOyR,IArGhE,kBAsGJ5X,GAtGI,kI,sBAyGR,IAAM4Y,GAAkB,SAACxa,EAAMya,GAAe,IAAD,uBAChD,YAAmBza,EAAKuJ,MAAxB,+CAA+B,CAAC,IAArBpB,EAAoB,QAC3B,GAAIA,EAAK0B,OAAO6Q,MACZ,cAAwB5S,OAAOgS,QAAQ3R,EAAK0B,OAAO6Q,OAAnD,eAA2D,CAAC,IAA9CjT,EAA6C,uBACvD,GAAIA,EAAM0S,QAAUM,GAAahT,EAAM1F,MACnC,OAAO0F,EAAM1F,MAIzB,GAAIoG,EAAK0B,OAAOC,OACZ,cAAwBhC,OAAOgS,QAAQ3R,EAAK0B,OAAOC,QAAnD,eAA4D,CAAC,IAA/CrC,EAA8C,uBACxD,GAAIA,EAAM0S,QAAUM,GAAahT,EAAM1F,MACnC,OAAO0F,EAAM1F,QAZmB,kFAiBhD,OAAO,MAGEkY,GAAmB,SAACja,GAC7B,IAAIga,EAAU,GA8Bd,OA7BAha,EAAKka,OAAOpR,SAAQ,SAACqR,GAEjB,IAAMrY,EAAOqY,EAAMrY,KACbC,EAEFmI,aAAQiQ,EAAME,OAAO3M,SAAWyM,EAAME,OAAO3M,OAAO,GAAGkC,eAAe,SAChEuK,EAAME,OAAO3M,OAAO,GAAG3L,MAEzBmI,aAAQiQ,EAAME,OAAO3M,QACnByM,EAAME,OAAO3M,OACbyM,EAAME,OAAOtY,MACjBC,EAAOmY,EAAME,OAAOrY,KACpB3B,EAAO8Z,EAAM9Z,KAEbsa,EAAc3a,EAAK6B,KACnB7B,EAAK6B,KAAKuR,QAAO,SAACwH,GACd,OAAQA,EAAKT,QAAUrY,QAAuB+M,IAAf+L,EAAK3Y,OAAwB,aAEhE4M,EACA5M,EACFiI,aAAQyQ,IAAgBA,EAAY1X,OAAS,GAAK0X,EAAY,GAAG/K,eAAe,SAC1E+K,EAAY,GAAG1Y,MACfF,QAEA8M,EAEJ+L,EAAO,CAAE9Y,KAAMA,EAAMC,MAAOA,EAAOC,KAAMA,EAAM3B,KAAMA,EAAM4B,MAAOA,GACxE+X,EAAQlY,GAAQ8Y,KAEbZ,GCrKX,4CAAe,WAAOha,GAAP,sBAAA8T,EAAA,6DAELC,EAAUN,aAAMzT,GAFX,SAGQ,IAAIgU,KAAKD,GAASH,WAH1B,cAGLrB,EAHK,gBAKOA,EAAKsI,WAAW,OALvB,cAKLC,EALK,gBAOWnH,GAAOmH,GAPlB,cAOLC,EAPK,yBAQJA,GARI,4CAAf,sDAWA,SAASpH,GAAOqH,GACZ,OAAO,IAAIC,SAAQ,SAACC,EAASC,GACzB,IAAML,EAAM,IAAIM,MAChBN,EAAIO,IAAML,EACVF,EAAIQ,OAAS,WAET,IACMtU,EAnBO,GAmBW8T,EAAIvT,OAAUuT,EAAI9T,MACpCmN,EAASoH,SAASC,cAAc,UAClCC,EAAMtH,EAAOuH,WAAW,MAE5BvH,EAAOnN,MAAQA,EACfmN,EAAO5M,OAxBM,GA0BbkU,EAAIE,UAAUC,KAAM,EAAG,EAAG5U,EA1Bb,IA6BbkU,EAAQ/G,EAAO0H,iBCrBZ,SAASC,GAAarU,GACjC,IAAM5D,EAAWC,cACX/D,EAAU8S,eAAV9S,MAFkC,EAGRkL,oBAAS,GAHD,mBAGjC8Q,EAHiC,KAGvBC,EAHuB,OAIR/Q,mBAAS,MAJD,mBAIjCgR,EAJiC,KAIvBC,EAJuB,KAMlC/a,EAAS4C,aAAY,SAAC9C,GAAD,OAAWF,EAAUE,EAAOlB,MAoDvD,OACI,yBACIqE,UAAWqH,KAAI9F,UACfwW,YArDR,WACIH,GAAY,IAqDRI,YAnDR,WACIJ,GAAY,IAmDRK,WAjDR,SAAwBrX,GACpBA,EAAEkK,iBACFlK,EAAE8G,mBAgDEwQ,OA7CR,SAAoBtX,GAChBA,EAAEkK,iBACFlK,EAAE8G,kBAEF,IAAIyQ,EAAOvX,EAAEqU,aAAamD,MAAM,GAChC,GAAKD,EAAL,CAQA,GAAIA,EAAKlc,KAAKoc,MAAM,oBAAqB,CACrC,IAAMC,EAAS,IAAIC,WAGnBD,EAAOpB,OAAP,yCAAgB,WAAOtW,GAAP,sBAAA8O,EAAA,6DACN7T,EAAWuT,KAAKC,MAAMzO,EAAEC,OAAOqP,SAC/BtU,EAAO6I,mBAAQ5I,GAAUD,MAG1BgC,KAAK8G,SAAQ,SAACC,GACXA,EAAEC,KAAOD,EAAEC,IAAIC,WAAW,UAC1BF,EAAEC,IAAME,oBAA+BH,EAAEC,QAPrC,SAUY4T,GAAgB5c,GAV5B,cAUN2B,EAVM,gBAYakb,GAAqB7c,GAZlC,OAYN4B,EAZM,OAaZiC,EAAS/D,EAAYC,EAAOC,EAAMC,EAAU,CAAE2B,aAAYD,eAb9C,4CAAhB,sDAgBA+a,EAAOI,WAAWP,QAElBL,EAAY,iBAEhBF,GAAY,MAUR,kBAACe,GAAA,EAAD,CACI/O,KAAmB,OAAbiO,EACNe,aAAc,CACVC,SAAU,SACVC,WAAY,QAEhBC,iBAAkB,IAClBC,QAAS,WACLlB,EAAY,OAEhBmB,QAASpB,IAGb,yBAAK7X,UAAWqH,KAAI6R,aAAcpa,MAAO,CAAE2H,QAASkR,EAAW,GAAM,IAArE,uBAGC5a,EAAOE,KAAI,SAAC2J,GAAD,OACR,kBAAC,GAAD,CAAOpI,IAAKoI,EAAMnK,GAAIA,GAAImK,EAAMnK,GAAIb,KAAMgL,EAAMhL,W,+HCzEjD,SAASud,GAAgB9V,GACpC,IAAM5D,EAAWC,cACX6E,EAAYyE,OAAOC,eACnBC,EAAM3E,EAAU4E,WAAa,EAAI5E,EAAU6E,WAAW,GAAGC,wBAA0B,KAIzF,SAAS+P,EAAYC,EAAYpS,GAC7BA,EAAM6D,iBACN7D,EAAMS,kBACNrE,EAAMiW,WAAWD,GAOrB,OAAOnQ,EACH,kBAACrH,EAAA,EAAD,CACIuF,OAAO,QACPI,KAAM0B,EAAIqQ,EAfF,GAgBRhS,IAAK2B,EAAIsQ,EAhBD,GAiBRxZ,UAAWqH,KAAIoS,iBAEf,kBAAClW,EAAA,EAAD,KAEI,kBAACmW,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAUhX,QAAM,EAAC8E,YAdjC,WACIpE,EAAMuW,qBACNna,EAAS0C,EAAiBkB,EAAMjB,kBAkBhB,kBAACyX,GAAA,EAAD,KACI,kBAAC,KAAD,OAPR,eAcIxW,EAAMyW,YAAYC,MAAM,EA1CvB,GA0C4C9c,KAAI,SAACoc,EAAYjO,GAAb,OAC7C,kBAACuO,GAAA,EAAD,CACInb,IAAK4M,EACLzI,QAAM,EACNqX,OAAK,EACLvS,YAAa2R,EAAYa,KAAK,KAAMZ,IAEpC,kBAACa,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAQC,IAAI,QAAQnD,IAAKoC,EAAW9b,aAExC,kBAAC8c,GAAA,EAAD,CACIC,QAASjB,EAAW5a,KACpByE,UACI,kBAACvB,EAAA,EAAD,CAAYpB,UAAU,OAAOH,QAAQ,UAAUF,MAAM,iBAChDmZ,EAAWtd,kBAWhD,G,yBC3EO,SAASwe,GAAsBlX,GAC1C,IAAM5D,EAAWC,cACX6E,EAAYyE,OAAOC,eACnBC,EAAM3E,EAAU4E,WAAa,EAAI5E,EAAU6E,WAAW,GAAGC,wBAA0B,KAmBzF,OAAOH,GAAO7F,EAAMmX,eAAiBnX,EAAMmX,aAAa3O,YACpD,kBAAChK,EAAA,EAAD,CACIuF,OAAO,QACPI,KAAM0B,EAAIqQ,EApBF,GAqBRhS,IAAK2B,EAAIsQ,EArBD,GAsBRxZ,UAAWqH,KAAIoT,uBAEf,kBAAClX,EAAA,EAAD,CAAOC,UAAW,GACd,kBAAC8G,GAAA,EAAD,CAAaxJ,KAAK,QAAQV,QAAQ,OAAOW,WAAS,EAACgB,aAAW,sBAC1D,kBAACX,EAAA,EAAD,CAAQqG,YAjBxB,SAA2BR,GACvBA,EAAM6D,iBACN7D,EAAMS,kBAENjI,EhB+BG,CACHxD,KArDoB,eAsDpBqG,OgBjCqBe,EAAMmX,aAAa/d,KACxC4G,EAAMqX,SAASrX,EAAMmX,aAAa/d,IAClCgD,EAASwC,EAAgB,SAWb,UACA,kBAACb,EAAA,EAAD,CAAQqG,YAzBxB,SAA4BR,GACxBA,EAAM6D,iBACN7D,EAAMS,kBACNrE,EAAMsX,UAAUtX,EAAMmX,cAEtB/a,EAASwC,EAAgB,SAoBb,cAKZ,GCjDO,gBAAClF,EAAQ6d,EAAalP,GAAgB,IAAD,EAChD,OAA8B,IAAvBkP,EAAY/b,OACb,IACA,MAAGgH,OAAH,qBACO9I,EAAOE,KAAI,SAAC2J,GAAD,OACVA,EAAMpJ,WAAWM,SACZkR,QAAO,SAACrK,GACL,MAAe,WAAXA,EAAE1I,MAAqB0I,EAAE5G,MAClB4G,EAAE5G,MAAM8c,cAAchW,WAAW+V,EAAYC,eAClC,SAAXlW,EAAE1I,MAEF0I,EAAE5G,MACJoY,WACA0E,cACAxV,SAASuV,EAAYC,kBAIjC5d,KAAI,SAAC0H,GAAD,MAAQ,CACT5I,QAAS6K,EAAMnK,GACfc,UAAWqJ,EAAMrJ,UACjBkO,QAAS9G,EACTlG,KAAMkG,EAAE5G,MAAMoY,WACdzK,uB,yCCtBX,YAACoP,GACZ,IACIC,EADAC,EAAiB,KAOrB,OALIF,EAASG,SAASzP,eAAe,WAC7BsP,EAASG,SAASF,OAAO,GAAGG,WALX,KAMjBH,EAASD,EAASG,SAASF,OAAO,GAAGhd,OAGrCgd,GACJ,IAAK,kBASDC,EAAiB,CACbD,OAAQA,EACR3S,IAVQ0S,EAASG,SAASzP,eAAe,OACvCsP,EAASG,SAAS7S,IAAI,GAAGrK,OACxBod,IASH9S,IAPQyS,EAASG,SAASzP,eAAe,OACvCsP,EAASG,SAAS5S,IAAI,GAAGtK,MACzBod,KASd,OAAOH,G,oBCnBLI,I,OAAUC,EAAQ,MAIlBC,GAAS,IAAIC,OAAI,CACnBC,YAAa,qCAIjB,4CAAe,WAAOze,EAAQ6O,GAAf,kCAAA8D,EAAA,sDACP7G,EAAQ,GADD,8BAGS9L,EAHT,yEAGA6J,EAHA,QAIPiC,EAAQA,EAAMhD,OACV4V,GAAsB7U,EAAOgF,GAAUoD,QAAO,SAAC9M,GAAD,OAAmB,OAATA,MALrD,UAOiBwZ,GAAe9U,EAAOgF,GAPvC,WAQW,QADZ+P,EAPC,SAQiB9S,EAAM0C,KAAKoQ,GACnC9S,EAAQA,EAAMmG,QAAO,SAAC9M,GAAD,YAAmBuI,IAATvI,OAEb,OAAdyZ,QAAoClR,IAAdkR,GAA2B9S,EAAMhK,OAAS,GAX7D,kCAY0B+c,GAAmBhQ,EAAU/C,GAZvD,SAYGgT,EAZH,QAagBhd,OAAS,IAClBid,EAAYC,GAAgBnQ,EAAUiQ,EAAgBhT,GAC5DA,EAAM0C,KAAKuQ,IAfZ,sSAoBJjT,GApBI,4EAAf,wDAuBa4S,GAAwB,SAAC7U,EAAOgF,GACzC,IAAIoQ,EAAU,GACdpV,EAAMpJ,WAAWM,SAAS4G,SAAQ,SAAU8E,GACxC,IAAMyS,EAAWC,GAAWtQ,EAASnN,KAAM+K,EAAEzL,OAE9B,WAAXyL,EAAEvN,MAAqBggB,EAAS,GAnChB,KAoChBD,EAAQzQ,KAAK,CAAE4Q,UAAWF,EAAS,GAAIG,eAAgB5S,OAG/D,IAAI6S,EAAa,GAuBjB,OAtBIL,EAAQnd,OAAS,GACjBmd,EAAQtX,SAAQ,SAAU4X,GACtB,IAAMC,EAAiB3Q,EAASF,WAAaE,EAASnN,KAAKuS,QAAQsL,EAAEH,WAC/DK,EAAeD,EAAiBD,EAAEH,UAAUtd,OAC5CqD,EAAO,CACTzD,KAAM6d,EAAEH,UACR1Q,QAAS6Q,EAAEF,eACXrgB,QAAS6K,EAAMnK,GACfF,QAAQ,EACRN,KAAM,QACN2B,KAAM,CACF6e,MAAMC,OAAOJ,EAAEF,eAAere,QACxBue,EAAEF,eAAere,MACjB2e,OAAOJ,EAAEF,eAAere,QAElC2N,WAAY6Q,EACZ5Q,SAAU6Q,EACV5Q,SAAUA,EAASnN,KACnBoN,aAAa,GAEjBwQ,EAAW9Q,KAAKrJ,MAEjBma,GAEX,SAASH,GAAWtQ,EAAU+Q,GAC1B,GAAoB,kBAATA,EAAmB,CAC1B,IAAMC,EAAaD,EAAKE,MAAM,WAAWhe,OACrCie,EACc,GAAdF,EAAkBhR,EAASiR,MAAM,KC5E9B,SAACjR,EAAUmR,GACtB,IAAIC,EAAQpR,EAASiR,MAAM,KACvBte,EAAS,GACb,GAAIye,EAAMne,QAAUke,EAChB,IAAK,IAAI3R,EAAI2R,EAAI,EAAG3R,EAAI4R,EAAMne,OAAQuM,IAAK,CAEvC,IADA,IAAImC,EAAQ,GACHlC,EAAI0R,EAAI,EAAG1R,GAAK,EAAGA,IACxBkC,GAAe,IAANlC,EAAU2R,EAAM5R,EAAIC,GAAK2R,EAAM5R,EAAIC,GAAK,IAErD9M,EAAOgN,KAAKgC,QAEbhP,EAASye,EAChB,OAAOze,EDgEyC0e,CAAwBrR,EAAUgR,GAC1EM,EAAKC,KAASL,GAClB,OAAwB,OAAjBI,EAAGE,IAAIT,GAAiBO,EAAGE,IAAIT,GAAMU,QAAU,CAAC,EAAG,IACvD,MAAO,CAAC,EAAG,IAGf,SAAe3B,GAAtB,qC,gDAAO,WAA8B9U,EAAOgF,GAArC,4BAAA8D,EAAA,yDACC2I,EAAQ,KACRsD,EAAY,KAChB/U,EAAMpJ,WAAWC,KAAKiH,SAAQ,SAAUgL,GACpC,IAAMuM,EAAWC,GAAWtQ,EAASnN,KAAMiR,EAAE7R,OAEzCoe,EAAS,GAhFO,MAiFhB5D,EAAQ,CAAE8D,UAAWF,EAAS,GAAIG,eAAgB1M,OAI5C,OAAV2I,EAXD,sBAYKzM,EAASnN,KAAKI,OArFE,KAyErB,iEAawByc,GAAOrC,QAAQrN,EAASnN,KAAM,IAbtD,UAaOqc,EAbP,OAewB,QADjBE,EAAiBsC,GAAiBxC,IAdzC,oBAmBSyC,KAAKC,IAAIxC,EAAe5S,MAAQ+S,KAChCoC,KAAKC,IAAIxC,EAAe3S,MAAQ8S,IApBzC,wDAuBaH,EAAeD,OAvB5B,OAwBc,oBAxBd,gCAyBmBwB,EAAiB3Q,EAASnN,KAAKuS,QAAQqH,EAAM8D,WAC7CK,EACFxB,EAAe3S,MAAQ8S,KAC8B,IAA/CvP,EAASnN,KAAKuS,QAAQgK,EAAe3S,KACjCuD,EAASnN,KAAKuS,QAAQgK,EAAe3S,KACrC2S,EAAe3S,IAAI8N,WAAWtX,OAC9B+M,EAASnN,KAAKI,OAAS,EAC3Bmc,EAAe5S,OAAS+S,MACuB,IAA/CvP,EAASnN,KAAKuS,QAAQgK,EAAe5S,KACjCwD,EAASnN,KAAKuS,QAAQgK,EAAe5S,KACrC4S,EAAe5S,IAAI+N,WAAWtX,OAElC+M,EAASnN,KAAKI,OAAS,EAE3B4e,EAAa7R,EAASnN,KAAKif,UAAUnB,EAAgBC,GAC3Db,EAAY,CACRld,KAAMgf,EACNhS,QAAS4M,EAAM+D,eACfrgB,QAAS6K,EAAMnK,GACfF,QAAQ,EACRN,KAAM,QACN2B,KAAMkI,mBAAQuS,EAAM+D,eAAeze,OAC7B0a,EAAM+D,eAAeze,MACrB,CAAC0a,EAAM+D,eAAeze,OAC5B+N,WACI6Q,EAAiBC,EACX5Q,EAASF,WAAa8Q,EACtB5Q,EAASF,WAAa6Q,EAChC5Q,SACI6Q,EAAeD,EACT3Q,EAASF,WAAa6Q,EACtB3Q,EAASF,WAAa8Q,EAEhC5Q,SAAUA,EAASnN,KACnBiS,SAAUsK,EAAe5S,IACzBuI,SAAUqK,EAAe3S,IACzBwD,aAAa,GA7D9B,sDAiEY8P,GAjEZ,6C,+BAqEQC,G,qFAAf,WAAkChQ,EAAU/C,GAA5C,wBAAA6G,EAAA,6DACU2M,EAAaxT,EAAM5L,KAAI,SAAC0gB,GAAD,OAAOA,EAAElf,QAChCmf,EAAiB,CAAEnf,KAAMmN,EAAQ,KAAU/C,MAAOwT,GAElD5S,EAAU,CACZoU,IAAK,oCACLC,OAAQ,OACRC,QAAS,CACLC,OAAQ,mBACR,iBAAkB,SAEtBC,MAAM,EACNC,KAAMN,GAGJO,EAAiBC,KAAKC,UAAUjD,IAf1C,SAgB2B+C,EAAe1U,GAhB1C,cAgBUqR,EAhBV,yBAiBWA,EAASoD,KAAKtgB,MAjBzB,4C,sBAoBA,SAASme,GAAgBnQ,EAAUiQ,EAAgBhT,GAAQ,IAAD,EAEtD,GAAK+C,KAAY/C,EAAMhK,OAAS,IAAMgd,EAAtC,CASA,IAAMQ,GAPNxT,EAAQA,EAAMmG,QAAO,SAAC9M,GAClB,IAAIoc,GAAa,EAIjB,OAHAzC,EAAenX,SAAQ,SAAC6Z,GAChBrc,EAAKzD,OAAS8f,IAAOD,GAAa,MAEnCA,MAEctP,QAAO,SAAC9M,GAAD,MAAwB,UAAdA,EAAKjG,QAEzC0f,EAAY9S,EAAMmG,QAAO,SAAC9M,GAAD,MAAwB,UAAdA,EAAKjG,QAAkB,GAChE,GAAK0f,EAAL,CACA,IAAM6C,EAAsB3V,EAAM4V,QAAO,SAAUC,EAAMC,GACrD,OAAOD,EAAKhT,WAAaiT,EAAKjT,WAAagT,EAAOC,KAGhDC,EAAqB/V,EAAM4V,QAAO,SAAUC,EAAMC,GACpD,OAAOD,EAAK/S,SAAWgT,EAAKhT,SAAW+S,EAAOC,KAG5CpC,EAAiBiC,EAAoB9S,WACrC8Q,EAAeoC,EAAmBjT,SAqBxC,MAfkB,CACdlN,KALamN,EAASnN,KAAKif,UAC3Bc,EAAoB9S,WACpBkT,EAAmBjT,UAInBF,QAAS4Q,EAAW,GAAG5Q,QACvB1P,QAASsgB,EAAW,GAAGtgB,QACvBQ,QAAQ,EACRN,KAAM,QACN2B,KAAMye,EAAWpf,KAAI,SAAC4hB,GAAD,OAAeA,EAAUjhB,KAAK,MACnD8N,WAAY6Q,EACZ5Q,SAAU6Q,EACV5Q,SAAUA,EAASnN,KACnBgS,YAAqB,OAATkL,QAAS,IAATA,OAAA,YAAAA,EAAWlQ,eAAX,eAAoB9N,OAAQge,EAAUlQ,QAAQ9N,MAAQ,GAClE+S,SAAUiL,EAAUjL,SACpBC,SAAUgL,EAAUhL,SACpB9E,aAAa,KEtNN,gBAAChD,EAAOoL,EAAa6K,GAIhC,OAHAjW,EAAMnE,SAAQ,SAACxC,GACX+R,EAAc8K,GAAW7c,EAAM+R,EAAa6K,MAEzC7K,GAEE8K,GAAa,SAAC7c,EAAM+R,EAAa6K,GAE1C,IAAME,EAAiB/K,EAAY5B,oBAE7B4M,GADNH,EAAmBA,GAAoB7K,EAAYhL,gBACZiW,kBACjCC,EAAWL,EAAiBjO,eAC9B7L,EAAQ9C,EAAKwJ,WACbzG,EAAM/C,EAAKyJ,SACX3G,EAAQ,IAAGA,EAAQ,IAGvB9C,EAAOkN,KAAKC,MAAMD,KAAKE,UAAUpN,KAC7B,SAAeid,EAEnB,IAAIC,EAAaJ,EAAeK,aAAf,OAAoC,UAApC,eACVnd,IAEDiR,EAAYiM,EAAWE,0BAEvBC,EAAsBT,EAAiBU,MAAM,CAC/CC,aAAcza,EACd0a,YAAaza,IAEjBma,EAAaO,YAASC,YAClB3L,EAAY5B,oBACZkN,EACArd,EAAKzD,KACL,GACA0U,GAEJ,IAAM0M,EAAgB5a,EAAMga,EAAgBha,EAAMga,EAC9C1K,EAAiBX,eAAYrI,KAAK0I,EAAamL,EAAY,gBAC3DU,EAAevL,EAAetL,eAAeuW,MAAM,CACnDE,YAAaG,EACbJ,aAAcI,IAIlB,OAFAtL,EAAiBX,eAAYmM,mBAAmBxL,GAChDA,EAAiBX,eAAYhG,eAAe2G,EAAgBuL,IC5CjD,YAAC7L,GACZ,IAAM+K,EAAiB/K,EAAY5B,oBAC7ByM,EAAmB7K,EAAYhL,eAC/BkW,EAAWL,EAAiBjO,eAC5BmP,EAAehB,EAAeiB,eAAed,GAC7Ce,EAAcpB,EAAiBI,kBAC/BiB,EAAuBH,EAAaI,UAAUC,OAAO,EAAGH,GACxDjb,EAAM6Z,EAAiBI,kBAEvBoB,EAAWH,EAAqBtD,MAAM,KAAK9C,OAAO,GAAGwG,MAE3D,MAAO,CACH9hB,KAAM6hB,EACN5U,WAHUzG,EAAMqb,EAASzhB,OAIzB8M,SAAU1G,ICXH,YAAC8I,EAAcxJ,EAAWic,GACrCA,EAAiBA,GAAkB,KACnC,IAAIC,EAAWlc,EAAUmc,cACrBC,EAASpc,EAAUqc,YACnBriB,EAASwP,EAAa8S,cAEtBC,GAAa,EAeXriB,EAdcF,EACfwiB,WAAU,SAAUxT,GACjB,OAAOA,EAAMuD,WAAa2P,KAE7BO,WAAU,SAAUzT,GACjB,IAAI2C,EAAS4Q,EAMb,OAJIvT,EAAMuD,WAAa6P,IACnBG,GAAa,GAGV5Q,KAIVjT,KAAI,SAAUsQ,GACX,IAAI/O,EAAM+O,EAAMuD,SACZrS,EAAO8O,EAAM6S,UAEbpb,EAAQ,EACRC,EAAMxG,EAAKI,OASf,OAPIL,IAAQiiB,IACRzb,EAAQT,EAAU0c,kBAElBziB,IAAQmiB,IACR1b,EAAMV,EAAU2c,gBAEpBziB,EAAOA,EAAKsb,MAAM/U,EAAOC,MAG5Bkc,KAAKX,GACNY,EAAS7c,EAAU0c,iBACnBI,EAAS9c,EAAU2c,eAKvB,OAJI3c,EAAU+c,aACVF,EAAS7c,EAAU2c,eACnBG,EAAS9c,EAAU0c,kBAEhB1c,EAAU0c,mBAAqB1c,EAAU2c,eAC1C,CAAEziB,KAAMA,EAAMiN,WAAY0V,EAAQzV,SAAU0V,GAC5C,MChDK,YAACE,EAAuBtN,GACnC,IAAIuN,EAAsBvN,EAAY5B,oBAElCoP,EAAkB9B,YAAS+B,YAAYF,EAAqBD,EAAuB,MACnFhN,EAAiBX,eAAYrI,KAAK0I,EAAawN,EAAiB,gBAIpE,OAFAlN,EAAiBX,eAAYmM,mBAAmBxL,ICRrC,YAACN,GACZ,IAAM+K,EAAiB/K,EAAY5B,oBAE7B8M,EADmBlL,EAAYhL,eACH4H,eAIlC,OAHqBmO,EAAeiB,eAAed,GACpBiB,WCLpB,YAAC1M,EAAgBiO,GAC5B,IAAM3iB,EAAS,eAAQ0U,EAAe1U,WAetC,OAdA2iB,EAA6BA,EAA2B3S,QAAO,SAAC4S,GAC5D,IAAItD,GAAa,EAWjB,OAVA5a,OAAOqE,KAAK/I,GAAW0F,SAAQ,SAAUlG,GACT,SAAxBQ,EAAUR,GAAKvC,MAEX+C,EAAUR,GAAKZ,KAAKiO,aACpB7M,EAAUR,GAAKZ,KAAKa,OAASmjB,EAAuBnjB,OAEpD6f,GAAa,MAIlBA,M,UC4BA,SAASuD,GAAOxe,GAC3B,IAAM5D,EAAWC,cACX/D,EAAU8S,eAAV9S,MACAmE,EAAMH,aAAY,SAAC9C,GAAD,OAAWA,EAAMC,KAAKnB,MACxCoB,EAAS4C,aAAY,SAAC9C,GAAD,OAAWF,EAAUE,EAAOlB,MACjDmmB,EAAoBniB,aAAY,SAAC9C,GAAD,OAAWA,EAAMC,KAAKnB,GAAO2C,kBAC7DlB,EAAiBuC,aAAY,SAAC9C,GAAD,OAAWM,EAAkBN,EAAOlB,MACjE6e,EAAe7a,aAAY,SAAC9C,GAAD,OAAWA,EAAM+C,GAAG4a,gBAC/CuH,EAAWpiB,aAAY,SAAC9C,GAAD,OAAWA,EAAMgM,SACxCmZ,EAAiBriB,aAAY,SAAC9C,GAAD,OAAWA,EAAM+C,GAAGoiB,kBACjDC,EAAetiB,aAAY,SAAC9C,GAAD,OAAWA,EAAM+C,GAAGqiB,gBAE/CC,EAAuBviB,aAAY,SAAC9C,GAAD,OAAWA,EAAM+C,GAAGwC,iBAZ3B,EAagByE,mBAASqb,GAbzB,mBAa3BC,EAb2B,KAaRC,EAbQ,KAe5BzO,EAAW5J,iBAAO,MAfU,EAgBIlD,mBAAS,IAhBb,mBAgB3BiT,EAhB2B,KAgBduI,EAhBc,KAkB5BtU,EACoB,OAAtB+T,EACMlO,eAAYC,cAAcxB,oBAC1ByB,0BAAegO,GArBS,EAsBIjb,mBAAS+M,eAAYI,kBAAkBjG,IAtB3C,mBAsB3BkG,EAtB2B,KAsBdC,EAtBc,OAwBwBrN,mBAAS,MAxBjC,mBAwB3B0a,EAxB2B,KAwBJe,EAxBI,OAyBAzb,mBAAS,IAzBT,mBAyB3B0b,EAzB2B,KAyBhBC,EAzBgB,OA0BE3b,mBAAS,MA1BX,mBA0B3B4b,EA1B2B,KA0BfC,EA1Be,KA4B9BC,EAAW5Y,mBA5BmB,8CAiHlC,WAAkCkK,GAAlC,sCAAAvE,EAAA,yDACIwE,EAAeD,GACT3V,EAAiBskB,wBAAa3O,EAAY5B,sBAC1CwQ,EAAgBC,GAAiB7O,IAGrBxV,KAAKoG,WAAW,MACxBiV,EAAciJ,GAChB3lB,EACAylB,EAAcpkB,KAAKsb,MAAM,GACzB8I,EAAcnX,YAGlB2W,EAAevI,IAEfuI,EAAe,IAIbrjB,EAAYV,EAAeU,UACf0E,OAAOqE,KAAK/I,GAAWH,SACvBzB,EAAeyB,SACvBmkB,EAAMtf,OAAOC,OAAO3E,GAAWyf,QAAO,SAACwE,EAAK7Q,GAI9C,MAHoB,UAAhBA,EAAOnW,MACPgnB,EAAI1X,KAAK6G,EAAOxU,KAAKnB,IAElBwmB,IACR,IACHxjB,EAAStB,EAAqB2B,EAAIrD,GAAIumB,KAGpClE,EAAmB7K,EAAYhL,eAC/Bia,EAAgBpE,EAAiBI,kBACjCiE,EAAiBrE,EAAiBjO,eAGpC2J,GAAgB2I,IAEZA,IAAmB3I,EAAa2E,UAChC+D,EAAgB1I,EAAa9O,YAC7BwX,EAAgB1I,EAAa7O,WAE7BlM,EAASwC,EAAgB,OAI7BG,EAAgBghB,GAChBnP,EAAY5B,oBACZyM,EACA,KAGJsD,EAAqBhgB,GAGjBA,IAMuB,KALjB0X,EAAciJ,GAChB3lB,EACAgF,EAAc3D,KAAK4kB,OACnBjhB,EAAcsJ,aAEN7M,OACNwjB,EAAevI,GACfuI,EAAe,CAAC,CAAE5jB,KAAM,oBAM9BgkB,EArER,kCAsE4Ba,GAAUlmB,EAAgBqlB,GAtEtD,SAsEc5Z,EAtEd,QAwEkBhK,OAAS,IACT+E,EAASgF,GAAY9I,EAAIrD,GAAIoM,GACnCoL,EAAcsP,GAAY3f,EAAOiF,MAAOoL,GACxCC,EAAeD,GACfxU,EAASmE,IAEb8e,EAAc,MA9EtB,6CAjHkC,sBA4TlC,OArRAjT,qBAAU,WAEN,OAVAkT,EAAWa,aAAY,WAAO,IAAD,IACzBvY,QAAQC,IAAI,sCAlCa,MAmCzB,OAAIyI,QAAJ,IAAIA,OAAJ,YAAIA,EAAUxJ,eAAd,uBAAI,EAAmB9G,aAAvB,aAAI,EAA0B4Q,cAC1BuO,EAAaiB,GAAa9P,EAASxJ,QAAQ9G,MAAM4Q,gBApC5B,KA2CtB,kBAAMyP,cAAcf,EAASxY,YACrC,IAEHsF,qBAAU,WACFuS,IACA9N,EAAeyP,GAAyBpC,EAAuBtN,IAC/DN,EAASxJ,QAAQyZ,QACjBnkB,EAAS8C,GAAmB,IAC5B+f,EAAyB,SAE9B,CAACN,IAEJvS,qBAAU,WACFuS,QAA6CvX,IAA3BsX,EAASE,KAE3B/N,EAAeyP,GAAyBpC,EAAuBtN,IAC/DqO,EAAyB,OAEzBP,EAASE,KACT/N,EACIqP,GAAY,CAACxB,EAASE,IAAgBhO,EAAasN,IAEvD9hB,EAAS4C,EAAgB,OACzBigB,EAAyB,SAE9B,CAACL,EAAcD,IAElBvS,qBAAU,WACFuS,QAA6CvX,IAA3BsX,EAASE,KAE3B/N,EAAeyP,GAAyBpC,EAAuBtN,IAC/DqO,EAAyB,SAE9B,CAACrO,IAEJxE,qBAAU,WACN,IAAMnR,EAAiBskB,wBAAa3O,EAAY5B,qBAChD5S,EAASvB,EAAU4B,EAAIrD,GAAI,CAAE6B,sBAC9B,CAAC2V,IAEJxE,qBAAU,YACS,yCAAG,6CAAAC,EAAA,yDACI,KAAd6S,EADU,iCAEcsB,aAAItB,GAAWlkB,YAAY4f,OAFzC,OAEJ5f,EAFI,OAGNylB,EAAiB,EACjBnC,EAA6B,GACxBvW,EAAI,EALH,YAKMA,EAAI/M,EAAUQ,QALpB,wBAMEJ,EAASJ,EAAU+M,GAAnB3M,KACFmf,EAAiB,CACnBnf,KAAMA,EACNiN,WAAY6W,EAAUvR,QAAQvS,GAC9BkN,SAAUmY,EAAiBrlB,EAAKI,QAV9B,UAYcykB,GAAUlmB,EAAgBwgB,GAZxC,QAYA/U,EAZA,OAaN8Y,EAA6BA,EAA2B9b,OAAOgD,GAbzD,QAK4BuC,IAL5B,uBAeNuW,EAA2B9iB,OAAS,IAC9B6U,EAAiBkP,wBAAa3O,EAAY5B,qBAChDsP,EAA6BoC,GACzBrQ,EACAiO,GAEE/d,EAASgF,GAAY9I,EAAIrD,GAAIklB,GACnCzN,EAAeqP,GAAY3f,EAAOiF,MAAOoL,IACzCxU,EAASmE,IAEb4e,EAAa,IAzBH,4CAAH,qDA4BfnS,KACD,CAACkS,IA8MA,kBAAC,WAAD,KACK,kBAAC3P,GAAD,MACD,yBAAK5S,UAAWqH,KAAI2c,OAAQ/L,WA5GpC,SAAwBrX,GAEpBA,EAAEkK,iBACFlK,EAAE8G,kBACFiM,EAASxJ,QAAQyZ,SAwG2C1L,OAnGhE,SAAoBtX,GAChBA,EAAEkK,iBACFlK,EAAE8G,kBACF,IAAM3L,EAAU6E,EAAEqU,aAAazC,QAAQ,WACjC5L,EAAQ7J,EAAOknB,MAAK,SAACtf,GAAD,OAAOA,EAAElI,KAAOV,KACpCmoB,EAAS9mB,EAAe6mB,MAAK,SAACtf,GAAD,OAAOA,EAAElI,KAAOV,KAE/C6K,IAAUsd,KAUlB,SAAqBtd,GAEjB,IAAImH,EAAekG,EAAY5B,oBAKzBc,GAHNpF,EAAeA,EAAasR,aAAa,QAAS,YAAa,CAC3D5iB,GAAImK,EAAMnK,MAEiB6iB,0BACzB/K,EAAiB4P,oBAAiBC,kBAAkBnQ,EAAad,EAAW,KAClFe,EAAeK,GAlBX8P,CAAYzd,GACZhG,EAAEqU,aAAaqP,eA2FX,kBAAC,KAAD,CACIrQ,YAAaA,EACbG,QAAStC,GACTnR,SAnUkB,4CAoUlB4jB,OA5EhB,WACIlC,EAAe,KA4EHhO,iBAlIhB,SAA0BC,GAEtB,IAAMC,EAAiBC,aAAUH,iBAAiBJ,EAAaK,GAC/D,OAAIC,GACAL,EAAeK,GACR,WAEJ,eA4HKtC,gBA7FhB,SAAyB1E,KA8FTkH,WAAYC,GACZnK,IAAKoJ,EACL6Q,MA7HhB,SAAmB5jB,GAIf,OAHAA,EAAEkK,iBACFlK,EAAE8G,kBACF8a,EAAaiB,GAAaxP,IACnB,WA0HKwQ,iBAxBhB,SAA0BhmB,GACtB,IAAMwG,EAAMgP,EAAYhL,eAAeiW,kBAAoBzgB,EAAKI,OAC1DD,EAASqG,EAAMxG,EAAKI,OAC1B6jB,EAAc,CACVjkB,KAAMA,EACNiN,WAAY9M,EACZ+M,SAAU1G,QAqBT6U,EAAYjb,QAAU,GAAKzB,EAAeyB,OAAS,GAChD,kBAACsa,GAAD,CACIW,YAAaA,EAAY9K,QAAO,SAAC0V,GAAD,MAAkB,iBAAXA,EAAEjmB,QACzC2D,cAAe+f,EACf7I,WAtFhB,SAAkCD,GAE9B,IAAMzV,E3B5RY,SAACjI,EAAOuG,GAAsB,IAAhBpG,EAAe,uDAAP,GACxCwG,EAAStG,EAAS,SAQtB,MAAO,CAAEC,KAjBc,cAiBKqG,SAAQxG,MAPpCA,EAAK,aACDH,QACAO,UAAWC,KAAKC,OACb8F,EAHF,GAIEpG,EAJF,CAKDW,GAAI6F,K2BqRWqiB,CAAW7kB,EAAIrD,GAAI,CAC9BgC,KAAM4a,EAAW5a,KACjBgN,QAAS4N,EAAW5N,QACpB1P,QAASsd,EAAWtd,QACpBQ,QAAQ,EACRN,KAAM,QACN2P,SAAUyN,EAAW5a,KACrBb,KAAM,CAAC6e,MAAMC,OAAOrD,EAAW5a,OAAS4a,EAAW5a,KAAOie,OAAOrD,EAAW5a,OAC5EiN,WAAY2N,EAAW3N,WACvBC,SAAU0N,EAAW3N,WAAa2N,EAAW5a,KAAKI,OAClDgN,aAAa,IAEX0I,EAAiBgP,GAAY,CAAC3f,EAAO9H,OAAQmY,GACnDxU,EAASmE,GAETye,EAAe,IACfnO,EAAeK,IAqEHqF,mBAnEhB,WACIna,EAAS8C,GAAmB,IAC5B+f,EAAyBrO,EAAYhL,gBACrCiL,EC1TO,SAAC9R,EAAe6R,GAC3B,IAAM+K,EAAiB/K,EAAY5B,oBAC7ByM,EAAmB7K,EAAYhL,eAEjCmW,EAAaJ,EAAeK,aAAf,iBAA8C,UAA9C,eACVjd,IAGD+Q,EAAYiM,EAAWE,0BAEvBC,EAAsBT,EAAiBU,MAAM,CAC/CC,aAAcrd,EAAcsJ,WAC5BgU,YAAatd,EAAcuJ,WAE/ByT,EAAaO,YAASC,YAClB3L,EAAY5B,oBACZkN,EACAnd,EAAc3D,KACd,GACA0U,GAEJ,IAAIoB,EAAiBX,eAAYrI,KAAK0I,EAAamL,EAAY,gBAC3DU,EAAevL,EAAetL,eAAeuW,MAAM,CACnDE,YAAatd,EAAcuJ,SAC3B8T,aAAcrd,EAAcuJ,WAIhC,OAFA4I,EAAiBX,eAAYmM,mBAAmBxL,GAChDA,EAAiBX,eAAYhG,eAAe2G,EAAgBuL,GD+RzC8E,CAAuBzC,EAAmBlO,OAmErD,kBAACsG,GAAD,CACIC,aAAcA,EACdG,UAlEZ,SAA2BzY,GAEvB,IAAM4c,EAAmB7K,EAAYhL,eACjCmW,EAAayF,gBAAaC,eAAe,IACvCvF,EAAsBT,EAAiBU,MAAM,CAC/CC,aAAcvd,EAAKwJ,WACnBgU,YAAaxd,EAAKyJ,WAEtByT,EAAaO,YAASC,YAClB3L,EAAY5B,oBACZkN,EACArd,EAAKzD,KACL,IAEJ,IAAI8V,EAAiBX,eAAYrI,KAAK0I,EAAamL,EAAY,gBAC3DU,EAAevL,EAAetL,eAAeuW,MAAM,CACnDE,YAAaxd,EAAKyJ,SAClB8T,aAAcvd,EAAKyJ,WAEvB4I,EAAiBX,eAAYmM,mBAAmBxL,GAChDA,EAAiBX,eAAYhG,eAAe2G,EAAgBuL,GAC5D5L,EAAeK,GAEf9U,E3B9SG,CACHxD,KApCmB,cAqCnBqG,O2B4SoBJ,EAAKzF,MA4CjBie,SA1CZ,SAA0BpY,GACtB4R,EAAeqP,GAAY,CAACxB,EAASzf,IAAU2R,EAAaA,EAAYhL,qBE/UjE,SAAS8b,GAAK1hB,GAGzB,OAFiB3D,aACjBD,CAASgD,GAAY,IAEjB,kBAACnB,EAAA,EAAD,CAAMC,WAAS,EAAChC,QAAS,GACrB,kBAAC+B,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAACC,EAAA,EAAD,CAAYvB,QAAQ,WAAW4B,QAAQ,QAAQJ,cAAY,GAA3D,iBAGA,kBAAC8V,GAAD,OAEJ,kBAACpW,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAACmgB,GAAD,Q,cCYDmD,OAzBf,WACE,OACE,kBAAC,IAAD,KACE,kBAACC,EAAD,MACA,kBAACC,GAAA,EAAD,CAAWC,SAAS,KAAKC,GAAI,GAC3B,kBAAC,KAAD,KACE,kBAAC,KAAD,CAAOC,KAAK,qBACV,kBAACzV,GAAD,OAEF,kBAAC,KAAD,CAAOyV,KAAK,gBACV,kBAACN,GAAD,OAEF,kBAAC,KAAD,CAAOM,KAAK,SACV,kBAAC,EAAD,OAEF,kBAAC,KAAD,CAAOA,KAAK,KACV,kBAAC,EAAD,WCbQC,QACW,cAA7Btc,OAAOuc,SAASC,UAEe,UAA7Bxc,OAAOuc,SAASC,UAEhBxc,OAAOuc,SAASC,SAASnN,MACvB,2D,6CCXSoN,gBAAgB,CAC7B3oB,K1CkGa,WAAmC,IAAlCD,EAAiC,uDAAzBQ,EAAcuG,EAAW,uCAC7C,OAAQA,EAAO3H,MACX,IAzGkB,aA0GlB,IAzGkB,aA0Gd,OAAO,eACAY,EADP,eAEK+G,EAAOjI,MAFZ,eAGYkB,EAAM+G,EAAOjI,QAAU,GAHnC,GAIWiI,EAAO9H,SAGtB,IAhHkB,aAiHd,IAAI4pB,EAAQ,eACL7oB,GAGP,cADO6oB,EAAS9hB,EAAOjI,OAChB+pB,EAEX,IDtHoB,eCuHhB,OAAO,eACA7oB,EADP,eAEK+G,EAAO9H,MAAMH,MAFlB,eAGWkB,EAAM+G,EAAO9H,MAAMH,OAH9B,CAIQoB,OAAQF,EAAM+G,EAAO9H,MAAMH,OAAOoB,OAAO8I,OAAOjC,EAAO7H,aAGnE,ID5HoB,eC6HhB,OAAO,eACAc,EADP,eAEK+G,EAAO9H,MAAMH,MAFlB,eAGWkB,EAAM+G,EAAO9H,MAAMH,OAH9B,CAIQoB,OAAQF,EAAM+G,EAAO9H,MAAMH,OAAOoB,OAAOiS,QACrC,SAAC9R,GAAD,OAASA,IAAQ0G,EAAO7H,eAKxC,IAvI+B,0BAwI3B,OAAO,eACAc,EADP,eAEK+G,EAAOjI,MAFZ,eAGWkB,EAAM+G,EAAOjI,OAHxB,CAIQyB,eAAgBwG,EAAO7G,WAGnC,IAhJ2B,sBAiJvB,OAAO,eACAF,EADP,eAEK+G,EAAOjI,MAFZ,eAGWkB,EAAM+G,EAAOjI,OAHxB,CAIQ2C,eAAgBsF,EAAOtF,mBAGnC,QACI,OAAOzB,I0CvJjBE,O3C4Ea,WAAmC,IAAlCF,EAAiC,uDAAzBQ,EAAcuG,EAAW,uCAC7C,OAAQA,EAAO3H,MACX,IAjFoB,eAkFpB,IAjFoB,eAkFhB,OAAO,eACAY,EADP,eAEK+G,EAAO7H,QAFZ,eAGYc,EAAM+G,EAAO7H,UAAY,GAHrC,GAIW6H,EAAO9H,SAGtB,IAxFoB,eAyFhB,IAAI4pB,EAAQ,eACL7oB,GAGP,cADO6oB,EAAS9hB,EAAO7H,SAChB2pB,EAGX,QACI,OAAO7oB,I2C/FjBgM,MhC4Da,WAAyB,IAAxBhM,EAAuB,uDAAf,GAAI+G,EAAW,uCACnC,OAAQA,EAAO3H,MACX,IArEmB,cAsEnB,IArEmB,cAsEf,OAAO,eACAY,EADP,eAEK+G,EAAOtB,OAFZ,eAGYzF,EAAM+G,EAAOtB,SAAW,GAHpC,GAIWsB,EAAO9H,SAGtB,IAzEoB,eA0EhB,OAAO8H,EAAOiF,MAAM4V,QAAO,SAAC5hB,EAAOqF,GAC/B,OAAO,eACArF,EADP,eAEKqF,EAAKzF,GAAKyF,MAEhBrF,GACP,IAnFmB,cAoFf,IAAI6oB,EAAQ,eACL7oB,GAGP,cADO6oB,EAAS9hB,EAAOtB,QAChBojB,EAEX,IAzFqB,gBA0FjB,OAAO,eACA7oB,EADP,eAEK+G,EAAOtB,OAFZ,eAGWzF,EAAM+G,EAAOtB,QAHxB,CAIQ/F,QAAQ,MAGpB,IAhGuB,kBAiGnB,OAAO,eACAM,EADP,eAEK+G,EAAOtB,OAFZ,eAGWzF,EAAM+G,EAAOtB,QAHxB,CAIQ/F,QAAQ,MAGpB,IAtGoB,eAuGhB,OAAO,eACAM,EADP,eAEK+G,EAAOtB,OAFZ,eAGWzF,EAAM+G,EAAOtB,QAHxB,CAIQuJ,aAAa,MAGzB,QACI,OAAOhP,IgC7GjB+C,GvCmBa,WAAmC,IAAlC/C,EAAiC,uDAAzBQ,EAAcuG,EAAW,uCAC7C,OAAQA,EAAO3H,MACX,IAhCyB,oBAiCrB,OAAO,eACAY,EADP,CAEI2d,aAAc5W,EAAO1B,OAE7B,IApC0B,qBAqCtB,OAAO,eACArF,EADP,CAEIuF,cAAewB,EAAOxB,gBAE9B,IAxC0B,qBAyCtB,OAAO,eACAvF,EADP,CAEIolB,aAAcre,EAAOtB,SAE7B,IA5C6B,wBA6CzB,OAAO,eACAzF,EADP,CAEImlB,eAAgBpe,EAAOpB,OAE/B,IAhD0B,qBAiDtB,OAAO,eACA3F,EADP,CAEIgD,aAAc+D,EAAOjI,QAE7B,IApDqB,gBAqDjB,OAAO,eAAKkB,EAAZ,CAAmBkS,SAAUnL,EAAOlB,MACxC,QACI,OAAO7F,M,yCwC9CbsC,GAAQwmB,aAAe,CAEzB1iB,QAAS,CACLqX,QAAS,CACLsL,KAAM,WAEV1iB,UAAW,CACP0iB,KAAM,WAEVC,KAAM,CACFD,KAAM,WAEVxV,MAAO,CACHwV,KAAM,WAEVE,QAAS,CACLF,KAAM,WAEVG,QAAS,CACLH,KAAM,YAGd1iB,UAAW,CACP0iB,KAAM,WAEVC,KAAM,CACFD,KAAM,WAEVxV,MAAO,CACHwV,KAAM,WAEVE,QAAS,CACLF,KAAM,WAEVG,QAAS,CACLH,KAAM,WAEVI,cAAe,CACXJ,KAAM,aAKC,IAAI/O,SAAQ,SAACC,EAASC,GACjCkP,KACKC,QAAQ,SACRtR,MAAK,SAAChX,GACHkZ,EAAQlZ,MAEXuoB,OAAM,SAACC,GACJrP,EAAOqP,SAKdxR,MAAK,SAAChX,GACH,IAAIyoB,EAAa,CAACC,KAAaC,2BAC3BC,EAAQC,aACRC,GAEA9oB,GAAc,GACd+oB,KAAe,WAAf,EAAmBN,IAKvBG,EAAMI,UACFtW,IAAS,WACL,IAAIzT,EAAK,eAAQ2pB,EAAMnR,mBAChBxY,EAAK,GACZopB,KAAYY,QAAQ,QAAShqB,KAC9B,MAMPiqB,IAASC,OACL,kBAAC,IAAD,CAAUP,MAAOA,GACb,kBAACQ,GAAA,EAAD,CAAe7nB,MAAOA,IAClB,kBAAC,GAAD,QAGRgY,SAAS8P,eAAe,YAG/Bd,OAAM,SAACC,GACJnb,QAAQC,IAAIkb,GACZU,IAASC,OAAO,2DAAuC5P,SAAS8P,eAAe,YF6BjF,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAMxS,MAAK,SAAAyS,GACjCA,EAAaC,kB","file":"static/js/main.4b61333d.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"panel\":\"ChartConfigPanel_panel__1OEWt\",\"picker\":\"ChartConfigPanel_picker__2cC4T\",\"color\":\"ChartConfigPanel_color__2Pmzu\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"link\":\"Link_link__jXHvo\",\"potentialLink\":\"Link_potentialLink__3JiCy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ChartGallery_container__pQIvT\",\"draggingArea\":\"ChartGallery_draggingArea__Wft5P\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"viewer\":\"Viewer_viewer__2m97m\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"potentialLinkControls\":\"ManualLinkControls_potentialLinkControls__3YAy9\",\"panel\":\"ManualLinkControls_panel__Ke1GF\",\"message\":\"ManualLinkControls_message__3Av28\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"textSelection\":\"HighlightTextSelection_textSelection__2uV3y\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Chart_container__-PcK5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"editor\":\"Editor_editor__2c4G6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"suggestionPanel\":\"SuggestionPanel_suggestionPanel__2eTnI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"potentialLinkControls\":\"PotentialLinkControls_potentialLinkControls__7i3RY\"};","import { customAlphabet } from 'nanoid'\r\nconst nanoid = customAlphabet('1234567890abcdefghijklmnopqrstuvwxyz', 10)\r\nexport default (prefix) => { \r\n\treturn (prefix ? prefix + nanoid() : nanoid());\r\n};","import uniqueId from \"utils/uniqueId\";\r\nimport barChartSpec from \"./specs/barchart.json\";\r\nimport barChartLiteSpec from \"./specs/barChartLite.json\";\r\nimport { createSelector } from \"reselect\";\r\n\r\n// action types\r\nexport const CREATE_CHART = \"CREATE_CHART\";\r\nexport const UPDATE_CHART = \"UPDATE_CHART\";\r\nexport const DELETE_CHART = \"DELETE_CHART\";\r\n\r\n// actions\r\nexport const createChart = (docId, spec, liteSpec, attrs = {}) => {\r\n    let chartId = uniqueId(\"chart-\");\r\n    attrs = {\r\n        docId,\r\n        spec,\r\n        liteSpec,\r\n        timestamp: Date.now(),\r\n        highlight: { channel: \"opacity\", active: 1.0, inactive: 0.1 },\r\n        ...attrs,\r\n        id: chartId,\r\n    };\r\n    return { type: CREATE_CHART, chartId, attrs };\r\n};\r\n\r\nexport const updateChart = (chartId, attrs) => {\r\n    return { type: UPDATE_CHART, chartId, attrs };\r\n};\r\n\r\nexport const deleteChart = (chartId) => {\r\n    return {\r\n        type: DELETE_CHART,\r\n        chartId,\r\n    };\r\n};\r\n// selectors\r\nexport const getCharts = createSelector(\r\n    (state) => state.docs,\r\n    (state) => state.charts,\r\n    (_, docId) => docId,\r\n    (docs, charts, docId) => docs[docId].charts.map((cid) => charts[cid])\r\n);\r\n\r\nexport const getChartsInEditor = createSelector(\r\n    (state) => state.docs,\r\n    (state) => state.charts,\r\n    (_, docId) => docId,\r\n    (docs, charts, docId) => docs[docId].chartsInEditor.map((cid) => charts[cid])\r\n);\r\n// reducers\r\nconst initialState = {\r\n    testchart: {\r\n        id: \"testchart\",\r\n        docId: \"testdoc\",\r\n        timestamp: Date.now(),\r\n        thumbnail:\r\n            \"data:image/png;base64,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\",\r\n        highlight: { channel: \"opacity\", active: 1.0, inactive: 0.1 },\r\n        properties: {\r\n            axes: [\r\n                {\r\n                    name: \"x\",\r\n                    field: \"category\",\r\n                    data: \"data_0\",\r\n                    type: \"ordinal\",\r\n                    title: \"category\",\r\n                },\r\n                { name: \"y\", field: \"amount\", data: \"data_0\", type: \"linear\", title: \"amount\" },\r\n            ],\r\n            features: [\r\n                { value: \"Apple\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Amazon\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Facebook\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Netflix\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Microsoft\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Samsung\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Twitter\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Linkedin\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n            ],\r\n        },\r\n        spec: barChartSpec,\r\n        liteSpec: barChartLiteSpec,\r\n    },\r\n};\r\n\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case CREATE_CHART:\r\n        case UPDATE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.chartId]: {\r\n                    ...(state[action.chartId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case DELETE_CHART: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.chartId];\r\n            return newState;\r\n        }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import uniqueId from \"utils/uniqueId\";\r\nimport { CREATE_CHART, DELETE_CHART } from \"ducks/charts\";\r\n// action types\r\nexport const CREATE_DOC = \"CREATE_DOC\";\r\nexport const UPDATE_DOC = \"UPDATE_DOC\";\r\nexport const DELETE_DOC = \"DELETE_DOC\";\r\n\r\nexport const UPDATE_EDITOR_STATE = \"UPDATE_EDITOR_STATE\";\r\nexport const UPDATE_CHARTS_IN_EDITOR = \"UPDATE_CHARTS_IN_EDITOR\";\r\n\r\n// actions\r\nexport const createDoc = (attrs = {}) => {\r\n    let docId = uniqueId();\r\n    attrs = {\r\n        title: \"Untitled\",\r\n        editorRawState: null,\r\n        timestamp: Date.now(),\r\n        sentences: [],\r\n        charts: [],\r\n        chartsInEditor: [],\r\n        ...attrs,\r\n        id: docId,\r\n    };\r\n    return { type: CREATE_DOC, docId, attrs };\r\n};\r\n\r\nexport const updateDoc = (docId, attrs) => {\r\n    return { type: UPDATE_DOC, docId, attrs };\r\n};\r\n\r\nexport const deleteDoc = (docId) => {\r\n    return {\r\n        type: DELETE_DOC,\r\n        docId,\r\n    };\r\n};\r\n\r\nexport const updateChartsInEditor = (docId, charts) => {\r\n    return { type: UPDATE_CHARTS_IN_EDITOR, docId, charts };\r\n};\r\n\r\n// selectors\r\n\r\n// reducers\r\n\r\nconst initialState = {\r\n    testdoc: {\r\n        id: \"testdoc\",\r\n        title: \"Testing...\",\r\n        timestamp: Date.now(),\r\n        charts: [\"testchart\"],\r\n        chartsInEditor: [],\r\n        sentences: [],\r\n        editorRawState: {\r\n            blocks: [\r\n                {\r\n                    key: \"8i090\",\r\n                    text: \"Welcome to Vis-Text Editor\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 26,\r\n                            style: \"BOLD\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n                {\r\n                    key: \"42ncd\",\r\n                    text: \"Here you can compose interactive articles\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 42,\r\n                            style: \"UNDERLINE\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n                {\r\n                    key: \"327r6\",\r\n                    text:\r\n                        \"Start dragging the chart from Chart Gallery to the editor and start creating! ;)\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 81,\r\n                            style: \"ITALIC\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n            ],\r\n            entityMap: {},\r\n        },\r\n    },\r\n};\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case CREATE_DOC:\r\n        case UPDATE_DOC:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...(state[action.docId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case DELETE_DOC: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.docId];\r\n            return newState;\r\n        }\r\n        case CREATE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.attrs.docId]: {\r\n                    ...state[action.attrs.docId],\r\n                    charts: state[action.attrs.docId].charts.concat(action.chartId),\r\n                },\r\n            };\r\n        case DELETE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.attrs.docId]: {\r\n                    ...state[action.attrs.docId],\r\n                    charts: state[action.attrs.docId].charts.filter(\r\n                        (cid) => cid !== action.chartId\r\n                    ),\r\n                },\r\n            };\r\n\r\n        case UPDATE_CHARTS_IN_EDITOR:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...state[action.docId],\r\n                    chartsInEditor: action.charts,\r\n                },\r\n            };\r\n        case UPDATE_EDITOR_STATE:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...state[action.docId],\r\n                    editorRawState: action.editorRawState,\r\n                },\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React, { Fragment } from \"react\";\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport AppBar from \"@material-ui/core/AppBar\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Link from \"@material-ui/core/Link\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { updateDoc } from \"ducks/docs\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    root: {\r\n        flexGrow: 1,\r\n        marginBottom: theme.spacing(3),\r\n    },\r\n    // menuButton: {\r\n    //   marginRight: theme.spacing(2),\r\n    // },\r\n    title: {\r\n        flexGrow: 1,\r\n    },\r\n}));\r\n\r\nexport default function () {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n    const docId = useSelector((state) => state.ui.currentDocId);\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n\r\n    function handleChange(e) {\r\n        dispatch(updateDoc(docId, { title: e.target.value }));\r\n    }\r\n    return (\r\n        <AppBar className={classes.root} position=\"static\" color=\"inherit\">\r\n            <Toolbar variant=\"dense\">\r\n                {/* <Button  color=\"inherit\" component={RouterLink} to=\"/docs\">\r\n        <Typography variant=\"h6\" className={classes.title}>\r\n        GORI\r\n          </Typography>\r\n        </Button> */}\r\n                <Link\r\n                    variant=\"h6\"\r\n                    className={classes.title}\r\n                    underline=\"none\"\r\n                    color=\"inherit\"\r\n                    component={RouterLink}\r\n                    to=\"/\"\r\n                >\r\n                    KORI\r\n                </Link>\r\n                {/* <Typography variant=\"h6\" className={classes.title} >\r\n\r\n          \r\n          </Typography> */}\r\n                {docId && (\r\n                    <TextField\r\n                        value={doc.title}\r\n                        onChange={handleChange}\r\n                        size=\"small\"\r\n                        fullWidth\r\n                        margin=\"dense\"\r\n                        variant=\"filled\"\r\n                        style={{ marginLeft: \"100px\", marginRight: \"20px\" }}\r\n                        label=\"Document Title\"\r\n                    />\r\n                )}\r\n                <Button color=\"inherit\" component={RouterLink} to=\"/docs\">\r\n                    Docs\r\n                </Button>\r\n\r\n                {docId && (\r\n                    <Fragment>\r\n                        <span style={{ marginLeft: \"10px\", marginRight: \"10px\" }}> | </span>\r\n                        <Button color=\"inherit\" component={RouterLink} to={`/docs/${docId}`}>\r\n                            Edit\r\n                        </Button>\r\n                        <Button color=\"inherit\" component={RouterLink} to={`/docs/${docId}/view`}>\r\n                            View\r\n                        </Button>\r\n                    </Fragment>\r\n                )}\r\n            </Toolbar>\r\n        </AppBar>\r\n    );\r\n}\r\n","import React from 'react'\r\nimport Fab from '@material-ui/core/Fab';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Box from '@material-ui/core/Box';\r\nimport NavigationIcon from '@material-ui/icons/Navigation';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport { Link } from 'react-router-dom';\r\nfunction Home() {\r\n    return (\r\n        <Grid container spacing={3} justify=\"center\">\r\n            <Grid item xs={6}>\r\n                <Typography variant=\"h2\" gutterBottom>\r\n                    Title\r\n                </Typography>\r\n                <Box marginBottom={2}>\r\n                    <Typography variant=\"body1\" gutterBottom>\r\n                        Abstract\r\n                    </Typography>\r\n                </Box>                \r\n                <Fab variant=\"extended\" color=\"primary\" aria-label=\"add\" component={Link} to=\"/docs\">\r\n                    <NavigationIcon />\r\n                    Get Started\r\n                </Fab>\r\n            </Grid>\r\n            <Grid item xs={6}>\r\n                <Typography variant=\"overline\" display=\"block\" gutterBottom>\r\n                    Teaser Image/Video\r\n                </Typography>\r\n            </Grid>\r\n        </Grid>\r\n\r\n    )\r\n}\r\n\r\nexport default Home\r\n","export const SET_SELECTED_LINK = \"SET_SELECTED_LINK\";\r\nexport const SET_TEXT_SELECTION = \"SET_TEXT_SELECTION\";\r\nexport const SET_MANUAL_LINK_ID = \"SET_MANUAL_LINK_ID\";\r\nexport const EXIT_MANUAL_LINK_MODE = \"EXIT_MANUAL_LINK_MODE\";\r\nexport const SET_CURRENT_DOC_ID = \"SET_CURRENT_DOC_ID\";\r\nexport const SET_VIEW_MODE = \"SET_VIEW_MODE\";\r\n\r\nexport const setSelectedLink = (link) => {\r\n    return { type: SET_SELECTED_LINK, link };\r\n};\r\nexport const setTextSelection = (textSelection) => {\r\n    return { type: SET_TEXT_SELECTION, textSelection };\r\n};\r\nexport const setManualLinkId = (linkId) => {\r\n    return { type: SET_MANUAL_LINK_ID, linkId };\r\n};\r\nexport const exitManualLinkMode = (exit) => {\r\n    return { type: EXIT_MANUAL_LINK_MODE, exit };\r\n};\r\n\r\nexport const SetCurrentDocId = (docId) => {\r\n    return { type: SET_CURRENT_DOC_ID, docId };\r\n};\r\nexport const setViewMode = (val) => {\r\n    return { type: SET_VIEW_MODE, val };\r\n};\r\n\r\n//reducers\r\nconst initialState = {};\r\n\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case SET_SELECTED_LINK:\r\n            return {\r\n                ...state,\r\n                selectedLink: action.link,\r\n            };\r\n        case SET_TEXT_SELECTION:\r\n            return {\r\n                ...state,\r\n                textSelection: action.textSelection,\r\n            };\r\n        case SET_MANUAL_LINK_ID:\r\n            return {\r\n                ...state,\r\n                manualLinkId: action.linkId,\r\n            };\r\n        case EXIT_MANUAL_LINK_MODE:\r\n            return {\r\n                ...state,\r\n                exitManualLink: action.exit,\r\n            };\r\n        case SET_CURRENT_DOC_ID:\r\n            return {\r\n                ...state,\r\n                currentDocId: action.docId,\r\n            };\r\n        case SET_VIEW_MODE:\r\n            return { ...state, viewMode: action.val };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React from \"react\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\n\r\nimport { createDoc } from \"ducks/docs\";\r\nimport { SetCurrentDocId } from \"ducks/ui\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    button: {\r\n        width: \"100%\",\r\n        padding: theme.spacing(1),\r\n        margin: theme.spacing(1),\r\n    },\r\n    paper: {\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        color: theme.palette.text.secondary,\r\n        height: theme.spacing(16),\r\n        width: \"100%\",\r\n    },\r\n}));\r\n\r\nfunction Doc(props) {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n\r\n    function handleClick() {\r\n        dispatch(SetCurrentDocId(props.docId));\r\n    }\r\n\r\n    return (\r\n        <Button\r\n            className={classes.button}\r\n            component={RouterLink}\r\n            to={`/docs/${props.docId}`}\r\n            onClick={handleClick}\r\n        >\r\n            <Paper className={classes.paper} elevation={2}>\r\n                {props.doc.title}\r\n                <div></div>\r\n            </Paper>\r\n        </Button>\r\n    );\r\n}\r\n\r\nexport default Doc;\r\n","import React from \"react\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport Doc from \"components/Doc\";\r\n\r\nimport { createDoc } from \"ducks/docs\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    button: {\r\n        width: \"100%\",\r\n        padding: theme.spacing(1),\r\n        margin: theme.spacing(1),\r\n    },\r\n    paper: {\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        color: theme.palette.text.secondary,\r\n        height: theme.spacing(16),\r\n        width: \"100%\",\r\n    },\r\n}));\r\n\r\nfunction Docs() {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n    const docs = useSelector((state) => Object.values(state.docs));\r\n\r\n    function handleClick() {\r\n        const action = createDoc();\r\n        dispatch(action);\r\n    }\r\n\r\n    return (\r\n        <Grid container spacing={1}>\r\n            <Grid item xs={2}>\r\n                <Button className={classes.button} onClick={handleClick}>\r\n                    <Paper className={classes.paper} variant=\"outlined\">\r\n                        <AddIcon />\r\n                    </Paper>\r\n                </Button>\r\n            </Grid>\r\n            {docs.map((doc) => (\r\n                <Grid key={doc.id} item xs={2}>\r\n                    <Doc doc={doc} docId={doc.id} />\r\n                </Grid>\r\n            ))}\r\n        </Grid>\r\n    );\r\n}\r\n\r\nexport default Docs;\r\n","// TODO: support different encodings?\r\nimport { isArray, isObject } from \"vega-util\";\r\nimport addBrushToVegaLiteSpec from \"utils/addBrushToVegaLiteSpec\";\r\nimport { compile } from \"vega-lite/build/vega-lite\";\r\n\r\nexport default (highlight, liteSpec) => {\r\n    try {\r\n        addBrushToVegaLiteSpec(liteSpec);\r\n    } catch (e) {}\r\n\r\n    const spec = compile(liteSpec).spec; // vega spec\r\n    // support vega-lite sample datasets\r\n\r\n    spec.data.forEach((d) => {\r\n        if (d.url && d.url.startsWith(\"data\")) {\r\n            d.url = process.env.PUBLIC_URL + \"/\" + d.url;\r\n        }\r\n    });\r\n\r\n    // highlight\r\n    spec.signals = [\r\n        ...(spec.signals || []),\r\n        {\r\n            name: \"highlight\", // should we add a prefix to avoid conflict with existing signals\r\n            value: { data: [], start: 0, end: 100, enabled: false },\r\n        },\r\n    ];\r\n\r\n    spec.marks.forEach((mark) => {\r\n        addSignalToMark(mark, highlight);\r\n    });\r\n    return spec;\r\n};\r\n\r\nexport function addSignalToMark(mark, highlight) {\r\n    if (mark.type === \"group\") {\r\n        // recursive\r\n        if (mark.marks) {\r\n            mark.marks.forEach((mark) => addSignalToMark(mark, highlight)); // will this generalize to all charts?\r\n        }\r\n        return;\r\n    }\r\n    const isMap = mark.type === \"shape\" && mark.style.includes(\"geoshape\");\r\n    const activePredicate = `highlight.enabled===true && (\r\n        (highlight.rangeField === '' && (indexof(highlight.data, datum[highlight.field])!=-1 ${\r\n            isMap ? \"|| indexof(highlight.data, datum.properties[highlight.field])!=-1)\" : \")\"\r\n        }) ||\r\n        (highlight.rangeField != '' && (indexof(highlight.data, datum[highlight.field])!=-1 ${\r\n            isMap ? \"|| indexof(highlight.data, datum.properties[highlight.field])!=-1)\" : \")\"\r\n        } && (datum[highlight.rangeField] > highlight.rangeMin && datum[highlight.rangeField]<highlight.rangeMax)) ||\r\n        (datum[highlight.field] > highlight.rangeMin && datum[highlight.field]<highlight.rangeMax) ||\r\n        (datum[highlight.fieldX] > highlight.rangeX[0] && datum[highlight.fieldX] < highlight.rangeX[1] &&\r\n            datum[highlight.fieldY] < highlight.rangeY[0] && datum[highlight.fieldY] > highlight.rangeY[1] )\r\n    )`;\r\n    //TODO: reduce redundant checking\r\n    const inactivePredicate = `highlight.enabled===true && !(\r\n        (highlight.rangeField === '' && (indexof(highlight.data, datum[highlight.field])!=-1 ${\r\n            isMap ? \"|| indexof(highlight.data, datum.properties[highlight.field])!=-1)\" : \")\"\r\n        }) ||\r\n        (highlight.rangeField != '' && (indexof(highlight.data, datum[highlight.field])!=-1 ${\r\n            isMap ? \"|| indexof(highlight.data, datum.properties[highlight.field])!=-1)\" : \")\"\r\n        } && (datum[highlight.rangeField] > highlight.rangeMin && datum[highlight.rangeField]<highlight.rangeMax))\r\n    )`;\r\n    const oldProp = mark.encode.update[highlight.channel];\r\n    const highlightProp = [\r\n        {\r\n            test: activePredicate,\r\n            value: highlight.active,\r\n        },\r\n        {\r\n            test: inactivePredicate,\r\n            value: highlight.inactive,\r\n        },\r\n        // put existing property if exists either in array or object form\r\n        //TODO: see if we need the Object Check?\r\n        // ...(isObject(oldProp) ? [oldProp] : isArray(oldProp) ? oldProp : []),\r\n    ];\r\n    mark.encode.update = {\r\n        ...mark.encode.update,\r\n        [highlight.channel]: highlightProp.concat(isArray(oldProp) ? oldProp : []),\r\n    };\r\n}\r\n","const CLEAR_SELECTION_TIMER = 10000; //time in ms\r\nexport default (liteSpec) => {\r\n    const selectionClearCondition = {\r\n        type: \"timer\",\r\n        throttle: CLEAR_SELECTION_TIMER,\r\n    };\r\n\r\n    //TODO: Brush doesn't make sense for maps or pie chart. If we do add, it throws an error\r\n    const isMap = liteSpec.mark === \"geoshape\" || liteSpec.mark.type === \"arc\";\r\n    const selections = isMap\r\n        ? {\r\n              paintbrush: { type: \"multi\", toggle: true },\r\n          }\r\n        : {\r\n              brush: {\r\n                  type: \"interval\",\r\n                  clear: \"window:keypress\",\r\n                  //   clear: selectionClearCondition,\r\n              },\r\n              paintbrush: {\r\n                  type: \"multi\",\r\n                  toggle: true,\r\n                  clear: \"window:keypress\",\r\n                  //   clear: selectionClearCondition,\r\n              },\r\n          };\r\n\r\n    liteSpec[\"selection\"] = selections;\r\n    //TODO: Check what's wrong with multiple conditions https://github.com/vega/vega-lite/issues/3040\r\n    if (!isMap)\r\n        liteSpec.encoding[\"opacity\"] = {\r\n            condition: [\r\n                // {\r\n                //     selection: \"brush\",\r\n                //     value: 1,\r\n                // },\r\n                {\r\n                    selection: \"paintbrush\",\r\n                    value: 1,\r\n                },\r\n            ],\r\n            value: 0.1,\r\n        };\r\n    return liteSpec;\r\n};\r\n","export default (func, wait = 50) => {\r\n  let last;\r\n  let deferTimer;\r\n\r\n  const throttled = (...args) => {\r\n    const now = Date.now();\r\n\r\n    if (last && now < last + wait) {\r\n      clearTimeout(deferTimer);\r\n\r\n      deferTimer = setTimeout(() => {\r\n        last = now;\r\n        func(...args);\r\n      }, wait);\r\n    } else {\r\n      last = now;\r\n      func(...args);\r\n    }\r\n  };\r\n\r\n  return throttled;\r\n};\r\n","import React, { useState } from \"react\";\r\nimport css from \"./index.module.css\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Slider from \"@material-ui/core/Slider\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Select from \"@material-ui/core/Select\";\r\nimport PropTypes from \"prop-types\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { updateChart } from \"ducks/charts\";\r\n\r\nexport default function ChartConfigPanel(props) {\r\n    const dispatch = useDispatch();\r\n    const channelOptions = {\r\n        opacity: { active: 1.0, inactive: 0.1 },\r\n        fill: { active: \"#1f77b4\", inactive: \"#c7c7c7\" },\r\n    };\r\n    const colors = [\r\n        \"#1f77b4\",\r\n        \"#aec7e8\",\r\n        \"#ff7f0e\",\r\n        \"#ffbb78\",\r\n        \"#2ca02c\",\r\n        \"#98df8a\",\r\n        \"#d62728\",\r\n        \"#ff9896\",\r\n        \"#9467bd\",\r\n        \"#c5b0d5\",\r\n        \"#8c564b\",\r\n        \"#c49c94\",\r\n        \"#e377c2\",\r\n        \"#f7b6d2\",\r\n        \"#7f7f7f\",\r\n        \"#c7c7c7\",\r\n        \"#bcbd22\",\r\n        \"#dbdb8d\",\r\n        \"#17becf\",\r\n        \"#9edae5\",\r\n    ];\r\n    const highlight = props.chart.highlight;\r\n    const [active, setActive] = useState(highlight.active); // necessary for handling intermediate changes\r\n    const [inactive, setInactive] = useState(highlight.inactive); // to prevent constant flickering chart updates\r\n    function handleChannelChange(event) {\r\n        // setChannel(event.target.value);\r\n        const channel = event.target.value;\r\n\r\n        if (channel !== highlight.channel) {\r\n            const option = channelOptions[channel];\r\n            setActive(option.active);\r\n            setInactive(option.inactive);\r\n            dispatch(\r\n                updateChart(props.chart.id, { highlight: { channel, ...channelOptions[channel] } })\r\n            );\r\n        }\r\n    }\r\n    function handleActiveChange(event, newValue) {\r\n        setActive(newValue);\r\n    }\r\n    function handleInactiveChange(event, newValue) {\r\n        setInactive(newValue);\r\n    }\r\n    function handleActiveChangeCommitted(event, newValue) {\r\n        setActive(newValue);\r\n        dispatch(updateChart(props.chart.id, { highlight: { ...highlight, active: newValue } }));\r\n    }\r\n    function handleInactiveChangeCommitted(event, newValue) {\r\n        setInactive(newValue);\r\n        dispatch(updateChart(props.chart.id, { highlight: { ...highlight, inactive: newValue } }));\r\n    }\r\n    return (\r\n        <div>\r\n            <Box\r\n                zIndex=\"modal\"\r\n                className={css.panel}\r\n                top={40}\r\n                left={\"45%\"}\r\n                onMouseDown={(e) => e.stopPropagation()}\r\n            >\r\n                <Box component={Paper} p={2}>\r\n                    <Grid container direction=\"column\" spacing={2}>\r\n                        <Grid item>\r\n                            <Typography gutterBottom>Highlight Option</Typography>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <Typography variant=\"caption\">Channel</Typography>\r\n                            <Box>\r\n                                <Select value={highlight.channel} onChange={handleChannelChange}>\r\n                                    {Object.keys(channelOptions).map((option) => (\r\n                                        <MenuItem key={option} value={option}>\r\n                                            {option}\r\n                                        </MenuItem>\r\n                                    ))}\r\n                                </Select>\r\n                            </Box>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <Typography variant=\"caption\">Active</Typography>\r\n                            {highlight.channel === \"opacity\" ? (\r\n                                <Slider\r\n                                    value={active}\r\n                                    aria-labelledby=\"discrete-slider\"\r\n                                    valueLabelDisplay=\"auto\"\r\n                                    min={0.0}\r\n                                    max={1.0}\r\n                                    step={0.05}\r\n                                    onChange={handleActiveChange}\r\n                                    onChangeCommitted={handleActiveChangeCommitted}\r\n                                />\r\n                            ) : (\r\n                                <Box className={css.picker}>\r\n                                    {colors.map((color) => (\r\n                                        <Box\r\n                                            className={css.color}\r\n                                            bgcolor={color}\r\n                                            border={color === active ? 1 : 0}\r\n                                            onMouseUp={(e) => handleActiveChangeCommitted(e, color)}\r\n                                        />\r\n                                    ))}\r\n                                </Box>\r\n                            )}\r\n                            <Typography variant=\"caption\">Inactive</Typography>\r\n                            {highlight.channel === \"opacity\" ? (\r\n                                <Slider\r\n                                    value={inactive}\r\n                                    aria-labelledby=\"discrete-slider\"\r\n                                    valueLabelDisplay=\"auto\"\r\n                                    min={0.0}\r\n                                    max={1.0}\r\n                                    step={0.05}\r\n                                    onChange={handleInactiveChange}\r\n                                    onChangeCommitted={handleInactiveChangeCommitted}\r\n                                />\r\n                            ) : (\r\n                                <Box className={css.picker}>\r\n                                    {colors.map((color) => (\r\n                                        <Box\r\n                                            className={css.color}\r\n                                            bgcolor={color}\r\n                                            border={color === inactive ? 1 : 0}\r\n                                            onMouseUp={(e) =>\r\n                                                handleInactiveChangeCommitted(e, color)\r\n                                            }\r\n                                        />\r\n                                    ))}\r\n                                </Box>\r\n                            )}\r\n                        </Grid>\r\n                    </Grid>\r\n                </Box>\r\n            </Box>\r\n        </div>\r\n    );\r\n}\r\n\r\nChartConfigPanel.propTypes = {\r\n    chart: PropTypes.object,\r\n    onUpdated: PropTypes.func,\r\n};\r\n","import uniqueId from \"utils/uniqueId\";\r\n\r\n// action types\r\nexport const CREATE_LINK = \"CREATE_LINK\";\r\nexport const UPDATE_LINK = \"UPDATE_LINK\";\r\nexport const DELETE_LINK = \"DELETE_LINK\";\r\nexport const ACTIVATE_LINK = \"ACTIVATE_LINK\";\r\nexport const DEACTIVATE_LINK = \"DEACTIVATE_LINK\";\r\nexport const CREATE_LINKS = \"CREATE_LINKS\";\r\nexport const CONFIRM_LINK = \"CONFIRM_LINK\";\r\n\r\nexport const createLink = (docId, link, attrs = {}) => {\r\n    let linkId = uniqueId(\"link-\");\r\n    attrs = {\r\n        docId,\r\n        timestamp: Date.now(),\r\n        ...link, // chartId, text, etc\r\n        ...attrs, // will override the above properties if any attr is set in attrs\r\n        id: linkId,\r\n    };\r\n    return { type: CREATE_LINK, linkId, attrs };\r\n};\r\n\r\nexport const createLinks = (docId, links) => {\r\n    return {\r\n        type: CREATE_LINKS,\r\n        links: links.map((link) => ({\r\n            ...link,\r\n            timestamp: Date.now(),\r\n            docId,\r\n            id: uniqueId(\"link-\"),\r\n        })),\r\n    };\r\n};\r\n\r\nexport const updateLink = (linkId, attrs) => {\r\n    return { type: UPDATE_LINK, linkId, attrs };\r\n};\r\n\r\nexport const deleteLink = (linkId) => {\r\n    return {\r\n        type: DELETE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const activateLink = (linkId) => {\r\n    return {\r\n        type: ACTIVATE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const deactivateLink = (linkId) => {\r\n    return {\r\n        type: DEACTIVATE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const confirmLink = (linkId) => {\r\n    return {\r\n        type: CONFIRM_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\n// selectors\r\n\r\n// reducers\r\nexport default (state = {}, action) => {\r\n    switch (action.type) {\r\n        case CREATE_LINK:\r\n        case UPDATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...(state[action.linkId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case CREATE_LINKS:\r\n            return action.links.reduce((state, link) => {\r\n                return {\r\n                    ...state,\r\n                    [link.id]: link,\r\n                };\r\n            }, state);\r\n        case DELETE_LINK: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.linkId];\r\n            return newState;\r\n        }\r\n        case ACTIVATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    active: true,\r\n                },\r\n            };\r\n        case DEACTIVATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    active: false,\r\n                },\r\n            };\r\n        case CONFIRM_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    isConfirmed: true,\r\n                },\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\n\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\n\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\r\nimport ArrowDropDownIcon from \"@material-ui/icons/ArrowDropDown\";\r\nimport ClickAwayListener from \"@material-ui/core/ClickAwayListener\";\r\nimport Grow from \"@material-ui/core/Grow\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Popper from \"@material-ui/core/Popper\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport MenuList from \"@material-ui/core/MenuList\";\r\n\r\nimport { setTextSelection } from \"ducks/ui\";\r\nimport { createLinks } from \"ducks/links\";\r\nimport { setManualLinkId, exitManualLinkMode } from \"ducks/ui\";\r\n\r\nexport default function ManualLinkControls(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n    const padding = 10;\r\n\r\n    const chartProperties = props.selectedChart.properties;\r\n    const fields = chartProperties.features.map((f) => f.field);\r\n    const options = [...new Set(fields)];\r\n\r\n    function handleResetClick(event) {\r\n        dispatch(exitManualLinkMode(true));\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        dispatch(setTextSelection(null));\r\n    }\r\n    function handleAcceptClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        makeManualLink(props.textSelection, props.selectedMarks, props.brush, props.viewData);\r\n        dispatch(setTextSelection(null));\r\n        dispatch(exitManualLinkMode(true));\r\n    }\r\n\r\n    const [open, setOpen] = React.useState(false);\r\n    const anchorRef = React.useRef(null);\r\n    const [selectedIndex, setSelectedIndex] = React.useState(0);\r\n\r\n    const handleClick = () => {\r\n        console.info(`You clicked ${options[selectedIndex]}`);\r\n    };\r\n\r\n    const handleMenuItemClick = (event, index) => {\r\n        setSelectedIndex(index);\r\n        setOpen(false);\r\n    };\r\n\r\n    const handleToggle = () => {\r\n        setOpen((prevOpen) => !prevOpen);\r\n    };\r\n\r\n    const handleClose = (event) => {\r\n        if (anchorRef.current && anchorRef.current.contains(event.target)) {\r\n            return;\r\n        }\r\n\r\n        setOpen(false);\r\n    };\r\n\r\n    function makeManualLink(textSelection, multiPoint, brush, viewData) {\r\n        console.log(\"View Data\", viewData);\r\n        let link = null;\r\n        if (multiPoint.length > 0) {\r\n            let points = [];\r\n            for (let i = 0; i < multiPoint.length; i++) {\r\n                for (let j = 0; j < viewData.length; j++) {\r\n                    if (multiPoint[i].values[0] === viewData[j]._vgsid_) points.push(viewData[j]);\r\n                }\r\n            }\r\n            let data = [];\r\n            points.forEach(function (p) {\r\n                if (p.hasOwnProperty(\"properties\")) {\r\n                    //Special case: Maps\r\n                    //Look for data in TopoJSON Properties or in the datafile!\r\n                    if (!p[\"properties\"][options[selectedIndex]]) {\r\n                        data.push(p[options[selectedIndex]]);\r\n                    } else data.push(p[\"properties\"][options[selectedIndex]]);\r\n                } else data.push(p[options[selectedIndex]]);\r\n            });\r\n\r\n            link = {\r\n                text: textSelection.text,\r\n                feature: { field: options[selectedIndex] },\r\n                chartId: props.selectedChart.id,\r\n                active: false,\r\n                type: \"multipoint\",\r\n                data: data,\r\n                startIndex: props.textSelection.startIndex,\r\n                endIndex: props.textSelection.endIndex,\r\n                sentence: \"\",\r\n                isConfirmed: true,\r\n            };\r\n        }\r\n        if (brush.length > 0) {\r\n            let points;\r\n            let fieldX;\r\n            let fieldY;\r\n            let rangeX;\r\n            let rangeY;\r\n\r\n            //Rectangular Brush\r\n            if (\r\n                brush[0].fields.length === 2 &&\r\n                brush[0].fields[0].type === \"R\" &&\r\n                brush[0].fields[1].type === \"R\"\r\n            ) {\r\n                fieldX = brush[0].fields[0].field;\r\n                fieldY = brush[0].fields[1].field;\r\n                rangeX = brush[0].values[0];\r\n                rangeY = brush[0].values[1];\r\n                points = [];\r\n            } else {\r\n                //Single Axis Brush\r\n                const brushFieldIndex = brush[0].fields.findIndex(\r\n                    (f) => f.field === options[selectedIndex] && f.type === \"E\"\r\n                );\r\n                //TODO: handle single axis brush of type \"R\" too\r\n\r\n                if (brushFieldIndex > -1) {\r\n                    points = brush[0].values[brushFieldIndex];\r\n                }\r\n            }\r\n\r\n            link = {\r\n                text: textSelection.text,\r\n                feature: { field: options[selectedIndex] },\r\n                chartId: props.selectedChart.id,\r\n                active: false,\r\n                type: \"brush\",\r\n                data: points,\r\n                startIndex: props.textSelection.startIndex,\r\n                endIndex: props.textSelection.endIndex,\r\n                sentence: \"\",\r\n                isConfirmed: true,\r\n                fieldX: fieldX,\r\n                rangeX: rangeX,\r\n                fieldY: fieldY,\r\n                rangeY: rangeY,\r\n            };\r\n        }\r\n        if (link !== null) {\r\n            const action = createLinks(props.currentDoc.id, [link]);\r\n            dispatch(action);\r\n            dispatch(setManualLinkId(action.links[0].id));\r\n        } else dispatch(setManualLinkId(null));\r\n    }\r\n\r\n    return pos && props.textSelection ? (\r\n        <Box\r\n            // zIndex=\"modal\"\r\n            // left={pos.x + padding}\r\n            // top={pos.y + padding}\r\n            right={0}\r\n            top={0}\r\n            className={css.panel}\r\n        >\r\n            <Paper elevation={1}>\r\n                <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\r\n                    <Button\r\n                        ref={anchorRef}\r\n                        aria-controls={open ? \"split-button-menu\" : undefined}\r\n                        aria-expanded={open ? \"true\" : undefined}\r\n                        aria-label=\"Select an axis\"\r\n                        aria-haspopup=\"menu\"\r\n                        onClick={handleToggle}\r\n                        endIcon={<ArrowDropDownIcon />}\r\n                    >\r\n                        {options[selectedIndex]}\r\n                    </Button>\r\n                </ButtonGroup>\r\n                <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\r\n                    <Button onMouseDown={handleAcceptClick}>Accept</Button>\r\n                    <Button onMouseDown={handleResetClick}>Cancel</Button>\r\n                </ButtonGroup>\r\n                <Popper\r\n                    open={open}\r\n                    anchorEl={anchorRef.current}\r\n                    role={undefined}\r\n                    transition\r\n                    disablePortal\r\n                >\r\n                    {({ TransitionProps, placement }) => (\r\n                        <Grow\r\n                            {...TransitionProps}\r\n                            style={{\r\n                                transformOrigin:\r\n                                    placement === \"bottom\" ? \"center top\" : \"center bottom\",\r\n                            }}\r\n                        >\r\n                            <Paper>\r\n                                <ClickAwayListener onClickAway={handleClose}>\r\n                                    <MenuList id=\"split-button-menu\">\r\n                                        {options.map((option, index) => (\r\n                                            <MenuItem\r\n                                                key={option}\r\n                                                // disabled={index === 2}\r\n                                                selected={index === selectedIndex}\r\n                                                onClick={(event) =>\r\n                                                    handleMenuItemClick(event, index)\r\n                                                }\r\n                                            >\r\n                                                {option}\r\n                                            </MenuItem>\r\n                                        ))}\r\n                                    </MenuList>\r\n                                </ClickAwayListener>\r\n                            </Paper>\r\n                        </Grow>\r\n                    )}\r\n                </Popper>\r\n            </Paper>\r\n\r\n            {/* <Grid container direction=\"column\" alignItems=\"center\">\r\n                <Grid item xs={12}>\r\n                    \r\n                </Grid>\r\n            </Grid> */}\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n","import React, { useEffect, useMemo, memo, useState, useRef } from \"react\";\r\nimport { useDispatch, useSelector, shallowEqual, connect } from \"react-redux\";\r\nimport addSignalToChartSpec from \"utils/addSignalToChartSpec\";\r\nimport vegaEmbed from \"vega-embed\";\r\nimport throttle from \"utils/throttle\";\r\nimport { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\nimport ChartConfigPanel from \"components/ChartConfigPanel\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport ManualLinkControls from \"components/ManualLinkControls\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport SettingsIcon from \"@material-ui/icons/Settings\";\r\n\r\nexport default memo(function ChartBlock({\r\n    block,\r\n    blockProps,\r\n    customStyleMap,\r\n    customStyleFn,\r\n    decorator,\r\n    forceSelection,\r\n    offsetKey,\r\n    selection,\r\n    tree,\r\n    contentState,\r\n    blockStyleFn, //weird props passed from editor\r\n    preventScroll, //weird props passed from editor\r\n    style,\r\n    ...elementProps\r\n}) {\r\n    // const data = props.contentState.getEntity(props.block.getEntityAt(0)).getData();\r\n    // let view = null;\r\n    const dispatch = useDispatch();\r\n    const [view, setView] = useState(null);\r\n    const containerEl = useRef(null);\r\n    const chartEl = useRef(null);\r\n    const [ratio, setRatio] = useState(1);\r\n    const chart = useSelector((state) => state.charts[blockProps.id]);\r\n    const textSelection = useSelector((state) => state.ui.textSelection);\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n    const chartsInEditor = useSelector((state) => state.docs[docId].chartsInEditor);\r\n    const [selectedMarks, setSelectedMarks] = useState([]);\r\n    const [viewData, setViewData] = useState([]);\r\n    const [brush, setBrush] = useState([]);\r\n    const [toggleSettings, setToggleSettings] = useState(false);\r\n    const viewMode = useSelector((state) => state.ui.viewMode);\r\n\r\n    // TODO: use a memoized selector for performance\r\n    const links = useSelector(\r\n        (state) => Object.values(state.links).filter((link) => link.chartId === blockProps.id),\r\n        shallowEqual\r\n    );\r\n    const spec = useMemo(\r\n        () =>\r\n            addSignalToChartSpec(\r\n                // JSON.parse(JSON.stringify(chart.spec)),\r\n                chart.highlight,\r\n                JSON.parse(JSON.stringify(chart.liteSpec))\r\n            ),\r\n        [chart.spec, chart.highlight]\r\n    );\r\n\r\n    useEffect(() => {\r\n        const asyncExec = async () => {\r\n            // compute canvas aspect ratio to maintain it while resizing\r\n\r\n            const runtime = parse(spec);\r\n            const tempView = await new View(runtime).runAsync();\r\n\r\n            const canvas = await tempView.toCanvas();\r\n            const ratio = canvas.height / canvas.width;\r\n            setRatio(ratio);\r\n\r\n            // add autosize: has limitations: https://vega.github.io/vega-lite/docs/size.html#limitations\r\n            //TODO: brush interfere with autosize\r\n\r\n            // spec.autosize = {\r\n            //     type: \"fit\",\r\n            //     contains: \"padding\",\r\n            //     resize: false,\r\n            // };\r\n\r\n            const result = await vegaEmbed(chartEl.current, spec, { actions: false });\r\n            const view = result.view;\r\n\r\n            // const viewData = view.data(\"source_0\");\r\n            const viewData = !chart.liteSpec.data.hasOwnProperty(\"url\")\r\n                ? view.data(\"data_0\")\r\n                : view.data(\"source_0\");\r\n            setViewData(viewData);\r\n            try {\r\n                view.addDataListener(\"paintbrush_store\", function (name, value) {\r\n                    console.log(name, value);\r\n                    setSelectedMarks(selectedMarks.concat(value));\r\n                });\r\n\r\n                view.addDataListener(\"brush_store\", function (name, value) {\r\n                    console.log(name, value);\r\n                    setBrush(brush.concat(value));\r\n                });\r\n            } catch (error) {\r\n                //No brush_store if no brush added\r\n            }\r\n            setView(view);\r\n        };\r\n        asyncExec();\r\n    }, [spec]);\r\n\r\n    useEffect(\r\n        throttle(async () => {\r\n            resize(view, ratio);\r\n        }, 500)\r\n    );\r\n\r\n    function resize(view, ratio) {\r\n        if (view) {\r\n            const { width } = containerEl.current.getBoundingClientRect();\r\n            const height = ratio * width;\r\n            view.resize().height(height).width(width).runAsync();\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!view) {\r\n            return;\r\n        }\r\n        if (links.some((link) => link.active)) {\r\n            // Should we send all signals at once? would it improve performance?\r\n            links\r\n                .filter((link) => link.active)\r\n                .forEach((link) => {\r\n                    view.signal(\"highlight\", {\r\n                        type: link.type,\r\n                        data: link.data,\r\n                        field: link.feature.field,\r\n                        enabled: true,\r\n                        //Next 2 fields refer to range selection links\r\n                        rangeField: link.rangeField || \"\",\r\n                        rangeMin: link.rangeMin || 0,\r\n                        rangeMax: link.rangeMax || 0,\r\n                        //Rectangular Brushes\r\n                        fieldX: link.fieldX || \"\",\r\n                        fieldY: link.fieldY || \"\",\r\n                        rangeX: link.rangeX || [0, 0],\r\n                        rangeY: link.rangeY || [0, 0],\r\n                    }).runAsync();\r\n                });\r\n        } else {\r\n            view.signal(\"highlight\", { enabled: false }).runAsync();\r\n        }\r\n    }, [view, links]);\r\n\r\n    function handleSettingClick() {\r\n        setToggleSettings(!toggleSettings);\r\n    }\r\n    const showConfig = viewMode ? false : selection.getAnchorKey() === block.getKey(); // show only clicking this block\r\n\r\n    const highlightStyle =\r\n        chartsInEditor.indexOf(chart.id) > -1 && !showConfig && textSelection\r\n            ? {\r\n                  ...style,\r\n                  position: \"relative\",\r\n                  borderStyle: \"solid\",\r\n                  borderColor: \"gray\",\r\n                  //   width: \"fit-content\",\r\n              }\r\n            : {\r\n                  ...style,\r\n                  position: \"relative\",\r\n                  //   width: \"fit-content\",\r\n              };\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <div ref={containerEl} {...elementProps} style={highlightStyle}>\r\n                <div>\r\n                    {showConfig && (\r\n                        <IconButton\r\n                            onMouseDown={handleSettingClick}\r\n                            aria-label=\"settings\"\r\n                            // color=\"primary\"\r\n                        >\r\n                            <SettingsIcon />\r\n                        </IconButton>\r\n                    )}\r\n                </div>\r\n                <div ref={chartEl} />\r\n                {/* {showConfig && !textSelection && <ChartConfigPanel chart={chart} />} */}\r\n                {showConfig && toggleSettings && <ChartConfigPanel chart={chart} />}\r\n                {/* {resizing && <AspectRatioIcon style={{color: grey[500], zIndex:2, marginLeft:\"-30px\"}}/>} */}\r\n                {showConfig && textSelection && (\r\n                    <ManualLinkControls\r\n                        currentDoc={doc}\r\n                        selectedChart={chart}\r\n                        textSelection={textSelection}\r\n                        selectedMarks={selectedMarks}\r\n                        brush={brush}\r\n                        viewData={viewData}\r\n                    />\r\n                )}\r\n            </div>\r\n        </React.Fragment>\r\n    );\r\n});\r\n","\r\nimport React, { Fragment } from 'react';\r\nimport createToolbarPlugin, { Separator } from \"draft-js-static-toolbar-plugin\";\r\nimport createAlignmentPlugin from \"draft-js-alignment-plugin\";\r\nimport createFocusPlugin from \"draft-js-focus-plugin\";\r\nimport createResizeablePlugin from 'draft-js-resizeable-plugin';\r\n\r\nimport \"draft-js-static-toolbar-plugin/lib/plugin.css\";\r\nimport \"draft-js-alignment-plugin/lib/plugin.css\";\r\nimport \"draft-js-focus-plugin/lib/plugin.css\";\r\n// import \"draft-js-resizeable-plugin/lib/plugin.css\";\r\n\r\nimport createChartBlockPlugin from 'utils/createChartBlockPlugin';\r\n\r\nimport {\r\n  ItalicButton,\r\n  BoldButton,\r\n  UnderlineButton,\r\n  CodeButton,\r\n  HeadlineOneButton,\r\n  HeadlineTwoButton,\r\n  HeadlineThreeButton,\r\n  UnorderedListButton,\r\n  OrderedListButton,\r\n  BlockquoteButton,\r\n  CodeBlockButton\r\n} from \"draft-js-buttons\";\r\nimport { composeDecorators } from \"draft-js-plugins-editor\";\r\n\r\n\r\nconst toolbarPlugin = createToolbarPlugin();\r\nconst focusPlugin = createFocusPlugin();\r\nconst alignmentPlugin = createAlignmentPlugin();\r\nconst resizeablePlugin = createResizeablePlugin();\r\n\r\nconst { AlignmentTool } = alignmentPlugin;\r\nconst { Toolbar } = toolbarPlugin;\r\nconst decorator = composeDecorators(\r\n  focusPlugin.decorator,\r\n  resizeablePlugin.decorator,\r\n  alignmentPlugin.decorator\r\n);\r\n\r\nconst chartBlockPlugin = createChartBlockPlugin({ decorator });\r\nexport const EditorPlugins = [focusPlugin, resizeablePlugin, alignmentPlugin, toolbarPlugin, chartBlockPlugin];\r\n\r\nexport default function EditorToolbar() {\r\n  return (\r\n    <Fragment>\r\n      <Toolbar>\r\n        {// may be use React.Fragment instead of div to improve perfomance after React 16\r\n          externalProps => (\r\n            <div>\r\n              <BoldButton {...externalProps} />\r\n              <ItalicButton {...externalProps} />\r\n              <UnderlineButton {...externalProps} />\r\n              <CodeButton {...externalProps} />\r\n              <Separator {...externalProps} />\r\n              <HeadlineOneButton {...externalProps} />\r\n              <HeadlineTwoButton {...externalProps} />\r\n              <HeadlineThreeButton {...externalProps} />\r\n              <UnorderedListButton {...externalProps} />\r\n              <OrderedListButton {...externalProps} />\r\n              <BlockquoteButton {...externalProps} />\r\n              <CodeBlockButton {...externalProps} />\r\n            </div>\r\n          )}\r\n      </Toolbar>\r\n      <AlignmentTool />\r\n    </Fragment>\r\n\r\n  )\r\n}","\r\nimport ChartBlock from 'components/ChartBlock';\r\n\r\nexport default (config = {}) => {\r\n    const component = config.decorator\r\n        ? config.decorator(ChartBlock)\r\n        : ChartBlock;\r\n\r\n    return {\r\n        blockRendererFn: (block, { getEditorState }) => {\r\n            if (block.getType() === \"atomic\") {\r\n                const contentState = getEditorState().getCurrentContent();\r\n                const entity = contentState.getEntity(block.getEntityAt(0));\r\n                const data = entity.getData();\r\n                const type = entity.getType();\r\n                if (type === \"CHART\") {\r\n                    return {\r\n                        component,\r\n                        editable: false,\r\n                        props:{\r\n                            ...data\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n            return null;\r\n        },\r\n        ChartBlock\r\n    };\r\n};","/**\r\n * Super simple decorators for handles and hashtags, for demonstration\r\n * purposes only. Don't reuse these regexes.\r\n */\r\n//TODO: REGEX needs to be improved and crafted to our use case!\r\n// import LinkText from 'components/LinkText';\r\n// import AutoLink from 'components/AutoLink';\r\nimport Link from \"components/Link\";\r\nimport HighlightTextSelection from \"components/HighlightTextSelection\";\r\n// const HANDLE_REGEX = /\\@[\\w]+/g;\r\n\r\n// export function handleStrategy(contentBlock, callback, contentState) {\r\n//   findWithRegex(HANDLE_REGEX, contentBlock, callback);\r\n// }\r\n\r\n// export function findWithRegex(regex, contentBlock, callback) {\r\n//   const text = contentBlock.getText();\r\n//   let matchArr, start;\r\n//   while ((matchArr = regex.exec(text)) !== null) {\r\n//     start = matchArr.index;\r\n//     callback(start, start + matchArr[0].length);\r\n//   }\r\n// }\r\n\r\nexport function findLinkEntities(contentBlock, callback, contentState) {\r\n    contentBlock.findEntityRanges((character) => {\r\n        const entityKey = character.getEntity();\r\n        return entityKey !== null && contentState.getEntity(entityKey).getType() === \"LINK\";\r\n    }, callback);\r\n}\r\nexport function findTextSelectionEntity(contentBlock, callback, contentState) {\r\n    contentBlock.findEntityRanges((character) => {\r\n        const entityKey = character.getEntity();\r\n        return (\r\n            entityKey !== null && contentState.getEntity(entityKey).getType() === \"TEXT_SELECTION\"\r\n        );\r\n    }, callback);\r\n}\r\n\r\nexport default [\r\n    {\r\n        strategy: findTextSelectionEntity,\r\n        component: HighlightTextSelection, // decorateComponentWithProps(LinkText, EditorState)\r\n    },\r\n    {\r\n        strategy: findLinkEntities,\r\n        component: Link,\r\n    },\r\n    // {\r\n    //     strategy: findAutoLinkEntities,\r\n    //     component: AutoLink\r\n    // }\r\n];\r\n","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\n\r\nexport default function Link(props) {\r\n    return (\r\n        <span className={css.textSelection} data-offset-key={props.offsetKey}>\r\n            {props.children}\r\n        </span>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport css from \"./index.module.css\";\r\nimport { activateLink, deactivateLink } from \"ducks/links\";\r\nimport { setSelectedLink } from \"ducks/ui\";\r\n\r\nexport default function Link(props) {\r\n    const dispatch = useDispatch();\r\n    const links = useSelector((state) => state.links);\r\n\r\n    let style = css.potentialLink;\r\n    const link = props.contentState.getEntity(props.entityKey).getData();\r\n    if (links[link.id]) {\r\n        if (links[link.id].isConfirmed) style = css.link;\r\n    }\r\n\r\n    function handleMouseOver() {\r\n        // if (links[link.id].isConfirmed)\r\n        dispatch(activateLink(link.id));\r\n    }\r\n    function handleMouseLeave() {\r\n        deactivateLink(link.id);\r\n        dispatch(deactivateLink(link.id));\r\n    }\r\n    function handleClick() {\r\n        dispatch(setSelectedLink(link));\r\n    }\r\n\r\n    return (\r\n        <span\r\n            className={style}\r\n            onMouseOver={handleMouseOver}\r\n            onMouseLeave={handleMouseLeave}\r\n            onClick={handleClick}\r\n            data-offset-key={props.offsetKey}\r\n        >\r\n            {props.children}\r\n        </span>\r\n    );\r\n}\r\n","import React, { Fragment, useState, useRef, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { EditorState, RichUtils, convertFromRaw } from \"draft-js\";\r\n\r\nimport DraftEditor from \"draft-js-plugins-editor\";\r\n\r\nimport css from \"./index.module.css\";\r\n\r\nimport { EditorPlugins } from \"components/EditorToolbar\";\r\nimport editorDecorators from \"utils/editorDecorators\";\r\nimport removePotentialLinks from \"utils/removePotentialLinks\";\r\n\r\nexport default function Viewer(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n\r\n    const rawEditorState = useSelector((state) => state.docs[docId].editorRawState);\r\n    const editorEl = useRef(null); //https://reactjs.org/docs/hooks-reference.html#useref\r\n\r\n    const contentState =\r\n        rawEditorState === null\r\n            ? EditorState.createEmpty().getCurrentContent()\r\n            : convertFromRaw(removePotentialLinks(rawEditorState));\r\n    const [editorState, setEditorState] = useState(EditorState.createWithContent(contentState));\r\n\r\n    //Disabling edit functions in view mode!\r\n    const viewMode = props.viewMode;\r\n\r\n    function handleEditorChange(editorState) {\r\n        setEditorState(editorState);\r\n    }\r\n\r\n    function handleKeyCommand(command) {\r\n        // handle common key bindings (e.g., bold, italic, etc.)\r\n        const newEditorState = RichUtils.handleKeyCommand(editorState, command);\r\n        if (newEditorState) {\r\n            setEditorState(newEditorState);\r\n            return \"handled\";\r\n        }\r\n        return \"not-handled\";\r\n    }\r\n\r\n    return (\r\n        <Fragment>\r\n            <div className={css.viewer}>\r\n                <DraftEditor\r\n                    editorState={editorState}\r\n                    plugins={EditorPlugins}\r\n                    onChange={handleEditorChange}\r\n                    handleKeyCommand={handleKeyCommand}\r\n                    decorators={editorDecorators}\r\n                    ref={editorEl}\r\n                    readOnly={viewMode}\r\n                />\r\n            </div>\r\n        </Fragment>\r\n    );\r\n}\r\n","export default (rawEditorState) => {\r\n    let entityMap = { ...rawEditorState.entityMap };\r\n    Object.keys(entityMap).forEach(function (key) {\r\n        if (entityMap[key].type === \"LINK\") {\r\n            if (!entityMap[key].data.isConfirmed) delete entityMap[key];\r\n        }\r\n    });\r\n    const newRawEditorState = { blocks: rawEditorState.blocks, entityMap: entityMap };\r\n    return newRawEditorState;\r\n};\r\n","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport Viewer from \"components/Viewer\";\r\n\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport { setViewMode } from \"ducks/ui\";\r\n\r\nexport default function View(props) {\r\n    console.log(\"Viewer Mode Active!!!\");\r\n\r\n    const dispatch = useDispatch();\r\n    dispatch(setViewMode(true));\r\n\r\n    return (\r\n        <Grid container spacing={2}>\r\n            <Grid item xs={8}>\r\n                <Viewer viewMode={true} />\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n","import React, { useMemo, memo, useRef, useState, useEffect } from \"react\";\r\nimport vegaEmbed from 'vega-embed';\r\nimport PropTypes from \"prop-types\";\r\nimport css from './index.module.css';\r\nimport Paper from '@material-ui/core/Paper';\r\n// See ChartBlock for a chart in the editor\r\nexport function Chart(props) {\r\n  const chartEl = useRef(null);\r\n  // why we need to stringify and parse it back? needs further investigation\r\n  const spec = useMemo(() => JSON.parse(JSON.stringify(props.spec)), [props.spec]);\r\n  // const [view, setView] = useState(null);\r\n  \r\n  useEffect( ()=>{\r\n    vegaEmbed(chartEl.current, spec).then(result=>{\r\n      // setView(result.view);\r\n    });\r\n  },[spec]);// will run only once\r\n\r\n\r\n  function handleDragStart(e) {\r\n    e.dataTransfer.setData('chartId', props.id);\r\n  }\r\n\r\n  const [hover, setHover] = useState(false);\r\n  function handleEnter(){\r\n    setHover(true);\r\n  }\r\n  function handleLeave(){\r\n    setHover(false);\r\n  }\r\n  return (\r\n    <Paper className={css.container}\r\n      elevation={hover?2:0}>\r\n      <div\r\n        draggable={true}\r\n        onDragStart={handleDragStart}\r\n        onMouseEnter={handleEnter}\r\n        onMouseLeave={handleLeave}\r\n      >\r\n        <div ref={chartEl} />\r\n      </div>\r\n    </Paper>\r\n  )\r\n}\r\n\r\n\r\nChart.propTypes = {\r\n  id: PropTypes.any,\r\n  spec: PropTypes.object,\r\n  width: PropTypes.number,\r\n  height: PropTypes.number\r\n}\r\n\r\nexport default memo(Chart);\r\n","//Parsing ChartInEditor for extracting chart features from vegalite spec\r\n\r\nimport { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\nimport { truthy, falsy } from \"vega-util\";\r\nimport { toString, isDate, isString, isArray } from \"vega-util\";\r\n\r\n// potential features?\r\n// data categories (discrete)\r\n// data values (continuous)\r\n// axis titles\r\n// legends\r\n// scales etc\r\nexport default async function (spec) {\r\n    if (!spec.data) {\r\n        return [];\r\n    }\r\n    const featureMap = {};\r\n    const runtime = parse(spec);\r\n    const view = await new View(runtime).runAsync();\r\n    const state = view.getState({\r\n        data: truthy,\r\n        signals: falsy,\r\n        recurse: true,\r\n    });\r\n\r\n    // sometimes, individual data points are not explicitely encoded using scales\r\n    for (const mark of spec.marks) {\r\n        // mu\r\n        const data = state.data[mark.name].map((d) => d.datum);\r\n\r\n        for (const datum of data) {\r\n            const isMap = mark.type === \"shape\" && mark.style.includes(\"geoshape\");\r\n            let entries = Object.entries(datum); //Object.entries(isMap ? datum : datum);\r\n            if (isMap) {\r\n                // combine with map properties\r\n                entries = entries.concat(Object.entries(datum.properties));\r\n            }\r\n            for (const [field, value] of entries) {\r\n                if (!isString(value)) {\r\n                    // only categorical data\r\n                    continue;\r\n                }\r\n                featureMap[value] = {\r\n                    value,\r\n                    type: \"string\",\r\n                    field,\r\n                    data: datum.name,\r\n                };\r\n            }\r\n        }\r\n    }\r\n    // Note: The following logic addressses two missing cases\r\n    // 1. Nested marks\r\n    // 2. Categorical scale with numeric data domain\r\n    // TODO: Can we combine the two logics elegantly?\r\n    spec.data.forEach((datum) => {\r\n        // for each data table\r\n        const viewdata = view.data(datum.name);\r\n        // console.log(\"viewdata\", viewdata);\r\n    });\r\n    //Extracting Axes of the charts\r\n    const axesMap = extractChartAxes(spec);\r\n    spec.scales\r\n        .filter((scale) => [\"ordinal\", \"band\", \"point\"].includes(scale.type))\r\n        .forEach((scale) => {\r\n            // each discrete scale\r\n            spec.data.forEach((datum) => {\r\n                // for each data table\r\n                const viewdata = view.data(datum.name);\r\n                viewdata.forEach((row) => {\r\n                    // for each row in the table\r\n                    // a single field\r\n                    if (scale.domain.field) {\r\n                        const field = scale.domain.field;\r\n                        const value = isDate(row[field]) ? row[field] : toString(row[field]);\r\n                        const type = isDate(value) ? \"date\" : \"string\";\r\n                        featureMap[value] = {\r\n                            value,\r\n                            type,\r\n                            field,\r\n                            data: datum.name,\r\n                        };\r\n                    } else if (scale.domain.fields) {\r\n                        //multiple fields from the same data\r\n                        scale.domain.fields.forEach((d) => {\r\n                            const field = isString(d) ? d : d.field;\r\n                            const value = isDate(row[field]) ? row[field] : toString(row[field]);\r\n                            const type = isDate(value) ? \"date\" : \"string\";\r\n                            featureMap[value] = {\r\n                                value,\r\n                                type,\r\n                                field,\r\n                                data: datum.name,\r\n                            };\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n            if (isArray(scale.domain)) {\r\n                // literal array\r\n                scale.domain.forEach((value) => {\r\n                    value = isDate(value) ? value : toString(value);\r\n                    const type = isDate(value) ? \"date\" : \"string\";\r\n                    const field = searchFieldName(spec, scale.name);\r\n                    featureMap[value] = {\r\n                        value,\r\n                        type,\r\n                        field,\r\n                        data: null,\r\n                    };\r\n                });\r\n            }\r\n        });\r\n    const properties = { axes: Object.values(axesMap), features: Object.values(featureMap) };\r\n    return properties;\r\n}\r\n\r\nexport const searchFieldName = (spec, scaleName) => {\r\n    for (const mark of spec.marks) {\r\n        if (mark.encode.enter) {\r\n            for (const [, props] of Object.entries(mark.encode.enter)) {\r\n                if (props.scale === scaleName && props.field) {\r\n                    return props.field;\r\n                }\r\n            }\r\n        }\r\n        if (mark.encode.update) {\r\n            for (const [, props] of Object.entries(mark.encode.update)) {\r\n                if (props.scale === scaleName && props.field) {\r\n                    return props.field;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return null;\r\n};\r\n\r\nexport const extractChartAxes = (spec) => {\r\n    let axesMap = {};\r\n    spec.scales.forEach((scale) => {\r\n        //TODO: handle cases where data is aggregated e.g., stack bar chart, stack area chart, pie chart,\r\n        const name = scale.name;\r\n        const field =\r\n            //field is array of objects\r\n            isArray(scale.domain.fields) && scale.domain.fields[0].hasOwnProperty(\"field\")\r\n                ? scale.domain.fields[0].field\r\n                : //field is simple array\r\n                isArray(scale.domain.fields)\r\n                ? scale.domain.fields\r\n                : scale.domain.field;\r\n        const data = scale.domain.data;\r\n        const type = scale.type;\r\n\r\n        const relatedAxis = spec.axes\r\n            ? spec.axes.filter((axis) => {\r\n                  return (axis.scale === name && axis.title !== undefined) || null;\r\n              })\r\n            : undefined;\r\n        const title =\r\n            isArray(relatedAxis) && relatedAxis.length > 0 && relatedAxis[0].hasOwnProperty(\"title\")\r\n                ? relatedAxis[0].title\r\n                : field //if title is not found, saving field as title (needed for maps!)\r\n                ? field\r\n                : undefined;\r\n\r\n        const axis = { name: name, field: field, data: data, type: type, title: title };\r\n        axesMap[name] = axis;\r\n    });\r\n    return axesMap;\r\n};\r\n","import { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\n\r\nconst THUMBNAIL_HEIGHT = 50;\r\nexport default async (spec) => {\r\n    // parse the spec and get the view\r\n    const runtime = parse(spec);\r\n    const view = await new View(runtime).runAsync();\r\n    // conver the view to an image\r\n    const img = await view.toImageURL(\"png\"); // base64\r\n    // resize the image to a thumbnail size\r\n    const resized = await resize(img);\r\n    return resized;\r\n};\r\n\r\nfunction resize(orgImg) {\r\n    return new Promise((resolve, reject) => {\r\n        const img = new Image();\r\n        img.src = orgImg;\r\n        img.onload = function () {\r\n            // draw the image into a thumbnail scale\r\n            const height = THUMBNAIL_HEIGHT;\r\n            const width = (height / img.height) * img.width;\r\n            const canvas = document.createElement(\"canvas\"),\r\n                ctx = canvas.getContext(\"2d\");\r\n\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n\r\n            ctx.drawImage(this, 0, 0, width, height);\r\n\r\n            // return rescaled base64 image url\r\n            resolve(canvas.toDataURL());\r\n        };\r\n    });\r\n}\r\n","import React, { useState } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport css from \"./index.module.css\";\r\nimport Chart from \"components/Chart\";\r\nimport { createChart, getCharts } from \"ducks/charts\";\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport { compile } from \"vega-lite/build/vega-lite\";\r\nimport extractChartFeatures from \"utils/extractChartFeatures\";\r\nimport createThumbnail from \"utils/createThumbnail\";\r\n\r\nexport default function ChartGallery(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const [dragging, setDragging] = useState(false);\r\n    const [errorMsg, setErrorMsg] = useState(null);\r\n\r\n    const charts = useSelector((state) => getCharts(state, docId));\r\n\r\n    function handleDragEnter() {\r\n        setDragging(true);\r\n    }\r\n    function handleDragLeave() {\r\n        setDragging(false);\r\n    }\r\n    function handleDragOver(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    }\r\n\r\n    function handleDrop(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // console.log('VegaLite', VegaLite);\r\n        let file = e.dataTransfer.files[0];\r\n        if (!file) {\r\n            return;\r\n        }\r\n        // if (file.size > 1000000) {\r\n        //     // larger than 1 MB\r\n        //     setErrorMsg(\"Size too big (>1MB)!\");\r\n        //     return;\r\n        // }\r\n        if (file.type.match(\"application/json\")) {\r\n            const reader = new FileReader();\r\n\r\n            // Closure to capture the file information.\r\n            reader.onload = async (e) => {\r\n                const liteSpec = JSON.parse(e.target.result);\r\n                const spec = compile(liteSpec).spec; // vega spec\r\n                // support vega-lite sample datasets\r\n\r\n                spec.data.forEach((d) => {\r\n                    if (d.url && d.url.startsWith(\"data\")) {\r\n                        d.url = process.env.PUBLIC_URL + \"/\" + d.url;\r\n                    }\r\n                });\r\n                const thumbnail = await createThumbnail(spec);\r\n\r\n                const properties = await extractChartFeatures(spec);\r\n                dispatch(createChart(docId, spec, liteSpec, { properties, thumbnail }));\r\n            };\r\n\r\n            reader.readAsText(file);\r\n        } else {\r\n            setErrorMsg(\"Wrong format!\");\r\n        }\r\n        setDragging(false);\r\n    }\r\n    return (\r\n        <div\r\n            className={css.container}\r\n            onDragEnter={handleDragEnter}\r\n            onDragLeave={handleDragLeave}\r\n            onDragOver={handleDragOver}\r\n            onDrop={handleDrop}\r\n        >\r\n            <Snackbar\r\n                open={errorMsg !== null}\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                autoHideDuration={5000}\r\n                onClose={() => {\r\n                    setErrorMsg(null);\r\n                }}\r\n                message={errorMsg}\r\n            />\r\n\r\n            <div className={css.draggingArea} style={{ opacity: dragging ? 0.5 : 0.0 }}>\r\n                Drop Vega-lite Spec\r\n            </div>\r\n            {charts.map((chart) => (\r\n                <Chart key={chart.id} id={chart.id} spec={chart.spec} />\r\n            ))}\r\n        </div>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport css from \"./index.module.css\";\r\n// import { addTextLink, deactivateSuggestions } from \"../ducks/ui\";\r\n// import insertSuggestion from \"utils/insertSuggestion\";\r\n// import createTextLink from \"utils/createTextLink\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport ListItemAvatar from \"@material-ui/core/ListItemAvatar\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport LinkIcon from '@material-ui/icons/Link';\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport { setTextSelection } from \"ducks/ui\";\r\n\r\nconst SUGGESTION_LIMIT = 5;\r\nexport default function SuggestionPanel(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n\r\n    const padding = 20;\r\n\r\n    function handleClick(suggestion, event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        props.onSelected(suggestion);\r\n    }\r\n\r\n    function handleCreateLink() {\r\n        props.onCreateLinkSelect();\r\n        dispatch(setTextSelection(props.textSelection));\r\n    }\r\n    return pos ? (\r\n        <Box\r\n            zIndex=\"modal\"\r\n            left={pos.x + padding}\r\n            top={pos.y + padding}\r\n            className={css.suggestionPanel}\r\n        >\r\n            <Paper>\r\n\r\n                <List>\r\n                    <ListItem button onMouseDown={handleCreateLink}>\r\n                        {/* <ListItemAvatar>\r\n                            <Avatar>\r\n                            <LinkIcon />\r\n                            </Avatar>\r\n                        </ListItemAvatar> */}\r\n                        <ListItemIcon>\r\n                            <LinkIcon />\r\n                        </ListItemIcon>\r\n                        Create Link\r\n                    </ListItem>\r\n                    {\r\n                        // should we rank suggestions\r\n\r\n                        props.suggestions.slice(0, SUGGESTION_LIMIT).map((suggestion, i) => (\r\n                            <ListItem\r\n                                key={i}\r\n                                button\r\n                                dense\r\n                                onMouseDown={handleClick.bind(null, suggestion)}\r\n                            >\r\n                                <ListItemAvatar>\r\n                                    <Avatar alt=\"chart\" src={suggestion.thumbnail} />\r\n                                </ListItemAvatar>\r\n                                <ListItemText\r\n                                    primary={suggestion.text}\r\n                                    secondary={\r\n                                        <Typography component=\"span\" variant=\"caption\" color='textSecondary'>\r\n                                            {suggestion.chartId}\r\n                                        </Typography>\r\n                                    }\r\n                                />\r\n                            </ListItem>\r\n                        ))\r\n                    }\r\n                </List>\r\n            </Paper>\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n\r\nSuggestionPanel.propTypes = {\r\n    suggestions: PropTypes.array,\r\n    onSelected: PropTypes.func,\r\n};\r\n","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\n\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\r\nimport PropTypes from \"prop-types\";\r\nimport { setSelectedLink } from \"ducks/ui\";\r\nimport { confirmLink, deleteLink } from \"ducks/links\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\n\r\nexport default function PotentialLinkControls(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n\r\n    const padding = 10;\r\n\r\n    function handleDiscardClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        props.onDiscard(props.selectedLink);\r\n\r\n        dispatch(setSelectedLink(null));\r\n    }\r\n    function handleAcceptClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        dispatch(confirmLink(props.selectedLink.id));\r\n        props.onAccept(props.selectedLink.id);\r\n        dispatch(setSelectedLink(null));\r\n    }\r\n    return pos && props.selectedLink && !props.selectedLink.isConfirmed ? (\r\n        <Box\r\n            zIndex=\"modal\"\r\n            left={pos.x + padding}\r\n            top={pos.y + padding}\r\n            className={css.potentialLinkControls}\r\n        >\r\n            <Paper elevation={1}>\r\n                <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\r\n                    <Button onMouseDown={handleAcceptClick}>Accept</Button>\r\n                    <Button onMouseDown={handleDiscardClick}>Discard</Button>\r\n                </ButtonGroup>\r\n            </Paper>\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n","export default (charts, partialText, startIndex) => {\r\n    return partialText.length === 0\r\n        ? []\r\n        : [].concat(\r\n              ...charts.map((chart) =>\r\n                  chart.properties.features\r\n                      .filter((d) => {\r\n                          if (d.type === \"string\" && d.value) {\r\n                              return d.value.toLowerCase().startsWith(partialText.toLowerCase());\r\n                          } else if (d.type === \"date\") {\r\n                              //temporary\r\n                              return d.value\r\n                                  .toString()\r\n                                  .toLowerCase()\r\n                                  .includes(partialText.toLowerCase());\r\n                          }\r\n                          return false;\r\n                      })\r\n                      .map((d) => ({\r\n                          chartId: chart.id,\r\n                          thumbnail: chart.thumbnail,\r\n                          feature: d,\r\n                          text: d.value.toString(),\r\n                          startIndex,\r\n                      }))\r\n              )\r\n          );\r\n};\r\n","const MIN_INTENT_COFIDENCE = 0.8;\r\nexport default (response) => {\r\n    let parsedResponse = null;\r\n    let intent;\r\n    if (response.entities.hasOwnProperty(\"intent\")) {\r\n        if (response.entities.intent[0].confidence > MIN_INTENT_COFIDENCE) {\r\n            intent = response.entities.intent[0].value;\r\n        }\r\n    }\r\n    switch (intent) {\r\n        case \"range_selection\":\r\n            const min = response.entities.hasOwnProperty(\"min\")\r\n                ? response.entities.min[0].value\r\n                : -Infinity;\r\n\r\n            const max = response.entities.hasOwnProperty(\"max\")\r\n                ? response.entities.max[0].value\r\n                : Infinity;\r\n\r\n            parsedResponse = {\r\n                intent: intent,\r\n                min: min,\r\n                max: max,\r\n            };\r\n            break;\r\n    }\r\n    return parsedResponse;\r\n};\r\n","import FuzzySet from \"fuzzyset.js\";\r\nimport splitTextIntoNWordsList from \"./splitTextIntoNWordsList\";\r\nimport { Wit } from \"node-wit\";\r\nimport { isArray } from \"vega\";\r\nimport parseWitResponse from \"./parseWitResponse\";\r\nimport util from \"util\";\r\nimport { link } from \"fs\";\r\nconst request = require(\"request\");\r\n\r\nconst MIN_MATCH_THRESHOLD = 0.75;\r\nconst WIT_CHARACTER_LIMIT = 280;\r\nconst client = new Wit({\r\n    accessToken: \"LKKJIM2L7TQ6JJJCUBGDUSQGAI5SZB7N\",\r\n    // logger: new log.Logger(log.DEBUG), // optional\r\n});\r\n\r\nexport default async (charts, sentence) => {\r\n    let links = [];\r\n    //forEach loop doesn't work with async-await!\r\n    for (const chart of charts) {\r\n        links = links.concat(\r\n            findWordOrPhraseLinks(chart, sentence).filter((link) => link !== null)\r\n        );\r\n        const rangeLink = await findRangeLinks(chart, sentence);\r\n        if (rangeLink !== null) links.push(rangeLink);\r\n        links = links.filter((link) => link !== undefined);\r\n        //only call when there is one phrase link!\r\n        if (rangeLink !== null && rangeLink !== undefined && links.length > 1) {\r\n            const groupableLinks = await findGroupableLinks(sentence, links);\r\n            if (groupableLinks.length > 1) {\r\n                const groupLink = createGroupLink(sentence, groupableLinks, links);\r\n                links.push(groupLink);\r\n            }\r\n        }\r\n    }\r\n\r\n    return links;\r\n};\r\n\r\nexport const findWordOrPhraseLinks = (chart, sentence) => {\r\n    let matches = [];\r\n    chart.properties.features.forEach(function (f) {\r\n        const fsResult = fuzzyMatch(sentence.text, f.value); //returns a [score, word] pair!\r\n        // if (f.type === \"string\" && sentence.text.includes(f.value)) {\r\n        if (f.type === \"string\" && fsResult[0] > MIN_MATCH_THRESHOLD) {\r\n            matches.push({ userTyped: fsResult[1], matchedFeature: f });\r\n        }\r\n    });\r\n    let pointLinks = [];\r\n    if (matches.length > 0)\r\n        matches.forEach(function (m) {\r\n            const linkStartIndex = sentence.startIndex + sentence.text.indexOf(m.userTyped);\r\n            const linkEndIndex = linkStartIndex + m.userTyped.length;\r\n            const link = {\r\n                text: m.userTyped,\r\n                feature: m.matchedFeature, //information about how the link was found\r\n                chartId: chart.id,\r\n                active: false,\r\n                type: \"point\",\r\n                data: [\r\n                    isNaN(Number(m.matchedFeature.value))\r\n                        ? m.matchedFeature.value\r\n                        : Number(m.matchedFeature.value),\r\n                ],\r\n                startIndex: linkStartIndex,\r\n                endIndex: linkEndIndex,\r\n                sentence: sentence.text,\r\n                isConfirmed: false,\r\n            };\r\n            pointLinks.push(link);\r\n        });\r\n    return pointLinks;\r\n};\r\nfunction fuzzyMatch(sentence, word) {\r\n    if (typeof word === \"string\") {\r\n        const wordLength = word.split(/[_-\\s]+/).length;\r\n        let list =\r\n            wordLength == 1 ? sentence.split(\" \") : splitTextIntoNWordsList(sentence, wordLength);\r\n        let fs = FuzzySet(list);\r\n        return fs.get(word) !== null ? fs.get(word).shift() : [0, \"\"];\r\n    } else return [0, \"\"];\r\n}\r\n\r\nexport async function findRangeLinks(chart, sentence) {\r\n    let match = null;\r\n    let rangeLink = null;\r\n    chart.properties.axes.forEach(function (a) {\r\n        const fsResult = fuzzyMatch(sentence.text, a.title); //returns a [score, word] pair!\r\n        // TODO: Later check only if the f.type is a number!\r\n        if (fsResult[0] > MIN_MATCH_THRESHOLD) {\r\n            match = { userTyped: fsResult[1], matchedFeature: a };\r\n        }\r\n    });\r\n    //only send request to Wit.ai when we have a potential match!\r\n    if (match !== null) {\r\n        if (sentence.text.length > WIT_CHARACTER_LIMIT) return;\r\n        const response = await client.message(sentence.text, {});\r\n        const parsedResponse = parseWitResponse(response);\r\n        if (parsedResponse !== null) {\r\n            //TODO: Also see if we can check if Wit.ai can also give us numbers described\r\n            // as words (e.g., fifty, thirty four, etc.)\r\n            if (\r\n                Math.abs(parsedResponse.min) == Infinity &&\r\n                Math.abs(parsedResponse.max) == Infinity\r\n            )\r\n                return;\r\n            switch (parsedResponse.intent) {\r\n                case \"range_selection\":\r\n                    const linkStartIndex = sentence.text.indexOf(match.userTyped);\r\n                    const linkEndIndex =\r\n                        parsedResponse.max !== Infinity\r\n                            ? sentence.text.indexOf(parsedResponse.max) !== -1\r\n                                ? sentence.text.indexOf(parsedResponse.max) +\r\n                                  parsedResponse.max.toString().length\r\n                                : sentence.text.length - 1\r\n                            : parsedResponse.min !== -Infinity\r\n                            ? sentence.text.indexOf(parsedResponse.min) !== -1\r\n                                ? sentence.text.indexOf(parsedResponse.min) +\r\n                                  parsedResponse.min.toString().length\r\n                                : sentence.text.length - 1\r\n                            : sentence.text.length - 1;\r\n\r\n                    const linkPhrase = sentence.text.substring(linkStartIndex, linkEndIndex);\r\n                    rangeLink = {\r\n                        text: linkPhrase,\r\n                        feature: match.matchedFeature, //information about how the rangeLink was found\r\n                        chartId: chart.id,\r\n                        active: false,\r\n                        type: \"range\",\r\n                        data: isArray(match.matchedFeature.field)\r\n                            ? match.matchedFeature.field\r\n                            : [match.matchedFeature.field],\r\n                        startIndex:\r\n                            linkStartIndex > linkEndIndex\r\n                                ? sentence.startIndex + linkEndIndex\r\n                                : sentence.startIndex + linkStartIndex,\r\n                        endIndex:\r\n                            linkEndIndex < linkStartIndex\r\n                                ? sentence.startIndex + linkStartIndex\r\n                                : sentence.startIndex + linkEndIndex,\r\n\r\n                        sentence: sentence.text,\r\n                        rangeMin: parsedResponse.min,\r\n                        rangeMax: parsedResponse.max,\r\n                        isConfirmed: false,\r\n                    };\r\n                    break;\r\n            }\r\n            return rangeLink;\r\n        }\r\n    }\r\n}\r\nasync function findGroupableLinks(sentence, links) {\r\n    const pointLinks = links.map((l) => l.text);\r\n    const sentenceObject = { text: sentence[\"text\"], links: pointLinks };\r\n\r\n    const options = {\r\n        uri: \"http://localhost:8885/processjson\",\r\n        method: \"POST\",\r\n        headers: {\r\n            Accept: \"application/json\",\r\n            \"Accept-Charset\": \"utf-8\",\r\n        },\r\n        json: true,\r\n        body: sentenceObject,\r\n    };\r\n\r\n    const requestPromise = util.promisify(request);\r\n    const response = await requestPromise(options);\r\n    return response.body.data;\r\n}\r\n\r\nfunction createGroupLink(sentence, groupableLinks, links) {\r\n    //Limited to ONE range link with multiple individual links of same chart FIELD!\r\n    if (!sentence || links.length < 2 || !groupableLinks) return;\r\n\r\n    links = links.filter((link) => {\r\n        let shouldKeep = false;\r\n        groupableLinks.forEach((glink) => {\r\n            if (link.text === glink) shouldKeep = true;\r\n        });\r\n        return shouldKeep;\r\n    });\r\n    const pointLinks = links.filter((link) => link.type === \"point\");\r\n\r\n    const rangeLink = links.filter((link) => link.type === \"range\")[0];\r\n    if (!rangeLink) return;\r\n    const firstIndividualLink = links.reduce(function (prev, curr) {\r\n        return prev.startIndex < curr.startIndex ? prev : curr;\r\n    });\r\n\r\n    const lastIndividualLink = links.reduce(function (prev, curr) {\r\n        return prev.endIndex > curr.endIndex ? prev : curr;\r\n    });\r\n\r\n    const linkStartIndex = firstIndividualLink.startIndex;\r\n    const linkEndIndex = lastIndividualLink.endIndex;\r\n\r\n    const linkText = sentence.text.substring(\r\n        firstIndividualLink.startIndex,\r\n        lastIndividualLink.endIndex\r\n    );\r\n    const groupLink = {\r\n        text: linkText,\r\n        feature: pointLinks[0].feature, //information about how the link was found\r\n        chartId: pointLinks[0].chartId,\r\n        active: false,\r\n        type: \"group\",\r\n        data: pointLinks.map((pointLink) => pointLink.data[0]),\r\n        startIndex: linkStartIndex,\r\n        endIndex: linkEndIndex,\r\n        sentence: sentence.text,\r\n        rangeField: rangeLink?.feature?.field ? rangeLink.feature.field : \"\",\r\n        rangeMin: rangeLink.rangeMin,\r\n        rangeMax: rangeLink.rangeMax,\r\n        isConfirmed: false,\r\n    };\r\n    return groupLink;\r\n}\r\n","//This function converts a sentence into an array of n-word combinations\r\nexport default (sentence, n) => {\r\n    let words = sentence.split(\" \");\r\n    let blocks = [];\r\n    if (words.length >= n) {\r\n        for (let i = n - 1; i < words.length; i++) {\r\n            let block = \"\";\r\n            for (let j = n - 1; j >= 0; j--) {\r\n                block += j === 0 ? words[i - j] : words[i - j] + \" \";\r\n            }\r\n            blocks.push(block);\r\n        }\r\n    } else blocks = words;\r\n    return blocks;\r\n};\r\n","import { Modifier, EditorState } from \"draft-js\";\r\nexport default (links, editorState, currentSelection) => {\r\n    links.forEach((link) => {\r\n        editorState = insertLink(link, editorState, currentSelection);\r\n    });\r\n    return editorState;\r\n};\r\nexport const insertLink = (link, editorState, currentSelection) => {\r\n    //TODO: remove duplicates\r\n    const currentContent = editorState.getCurrentContent();\r\n    currentSelection = currentSelection || editorState.getSelection();\r\n    const blockEndIndex = currentSelection.getAnchorOffset();\r\n    const blockKey = currentSelection.getAnchorKey();\r\n    let start = link.startIndex;\r\n    let end = link.endIndex;\r\n    if (start < 0) start = 0;\r\n\r\n    //TODO: properly fix this object not extensible problem!\r\n    link = JSON.parse(JSON.stringify(link));\r\n    link[\"blockKey\"] = blockKey;\r\n\r\n    let newContent = currentContent.createEntity(`LINK`, \"MUTABLE\", {\r\n        ...link,\r\n    });\r\n    const entityKey = newContent.getLastCreatedEntityKey();\r\n\r\n    const insertTextSelection = currentSelection.merge({\r\n        anchorOffset: start,\r\n        focusOffset: end,\r\n    });\r\n    newContent = Modifier.replaceText(\r\n        editorState.getCurrentContent(),\r\n        insertTextSelection,\r\n        link.text,\r\n        [], //inline styling\r\n        entityKey\r\n    );\r\n    const caretNewIndex = end > blockEndIndex ? end : blockEndIndex;\r\n    let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n    let newSelection = newEditorState.getSelection().merge({\r\n        focusOffset: caretNewIndex,\r\n        anchorOffset: caretNewIndex,\r\n    });\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n    return newEditorState;\r\n};\r\n","export default (editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n    const blockKey = currentSelection.getAnchorKey();\r\n    const currentBlock = currentContent.getBlockForKey(blockKey);\r\n    const caretOffset = currentSelection.getAnchorOffset();\r\n    const blockTextBeforeCaret = currentBlock.getText().substr(0, caretOffset);\r\n    const end = currentSelection.getAnchorOffset();\r\n\r\n    const lastWord = blockTextBeforeCaret.split(\" \").slice(-1).pop();\r\n    const start = end - lastWord.length;\r\n    return {\r\n        text: lastWord,\r\n        startIndex: start,\r\n        endIndex: end,\r\n    };\r\n};\r\n","//https://github.com/facebook/draft-js/issues/442#issuecomment-223816158\r\n//TODO: Maybe follow the next comment (on the above) and use getContentStateFragment function!\r\n\r\nexport default (contentState, selection, blockDelimiter) => {\r\n    blockDelimiter = blockDelimiter || \"\\n\";\r\n    var startKey = selection.getStartKey();\r\n    var endKey = selection.getEndKey();\r\n    var blocks = contentState.getBlockMap();\r\n\r\n    var lastWasEnd = false;\r\n    var selectedBlock = blocks\r\n        .skipUntil(function (block) {\r\n            return block.getKey() === startKey;\r\n        })\r\n        .takeUntil(function (block) {\r\n            var result = lastWasEnd;\r\n\r\n            if (block.getKey() === endKey) {\r\n                lastWasEnd = true;\r\n            }\r\n\r\n            return result;\r\n        });\r\n\r\n    const text = selectedBlock\r\n        .map(function (block) {\r\n            var key = block.getKey();\r\n            var text = block.getText();\r\n\r\n            let start = 0;\r\n            let end = text.length;\r\n\r\n            if (key === startKey) {\r\n                start = selection.getStartOffset();\r\n            }\r\n            if (key === endKey) {\r\n                end = selection.getEndOffset();\r\n            }\r\n            text = text.slice(start, end);\r\n            return text;\r\n        })\r\n        .join(blockDelimiter);\r\n    let sIndex = selection.getStartOffset();\r\n    let eIndex = selection.getEndOffset();\r\n    if (selection.isBackward) {\r\n        sIndex = selection.getEndOffset();\r\n        eIndex = selection.getStartOffset();\r\n    }\r\n    return selection.getStartOffset() !== selection.getEndOffset()\r\n        ? { text: text, startIndex: sIndex, endIndex: eIndex }\r\n        : null;\r\n};\r\n","import { Modifier, EditorState, ContentState } from \"draft-js\";\r\n\r\nexport default (currentSelectionState, editorState) => {\r\n    var currentContentState = editorState.getCurrentContent();\r\n\r\n    var newContentState = Modifier.applyEntity(currentContentState, currentSelectionState, null);\r\n    var newEditorState = EditorState.push(editorState, newContentState, \"apply-entity\");\r\n\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    // newEditorState = EditorState.forceSelection(newEditorState, editorState.getSelection());\r\n    return newEditorState;\r\n};\r\n","export default (editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n    const blockKey = currentSelection.getAnchorKey();\r\n    const currentBlock = currentContent.getBlockForKey(blockKey);\r\n    const blockText = currentBlock.getText();\r\n\r\n    return blockText;\r\n};\r\n","export default (rawEditorState, allLinksInCurrentBlockText) => {\r\n    const entityMap = { ...rawEditorState.entityMap };\r\n    allLinksInCurrentBlockText = allLinksInCurrentBlockText.filter((linkInCurrentBlockText) => {\r\n        let shouldKeep = true;\r\n        Object.keys(entityMap).forEach(function (key) {\r\n            if (entityMap[key].type === \"LINK\") {\r\n                if (\r\n                    entityMap[key].data.isConfirmed &&\r\n                    entityMap[key].data.text === linkInCurrentBlockText.text\r\n                ) {\r\n                    shouldKeep = false;\r\n                }\r\n            }\r\n        });\r\n        return shouldKeep;\r\n    });\r\n    return allLinksInCurrentBlockText;\r\n};\r\n","import React, { Fragment, useState, useRef, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport PropTypes from \"prop-types\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport {\r\n    EditorState,\r\n    AtomicBlockUtils,\r\n    RichUtils,\r\n    convertToRaw,\r\n    convertFromRaw,\r\n    Modifier,\r\n    ContentState,\r\n} from \"draft-js\";\r\n\r\nimport DraftEditor from \"draft-js-plugins-editor\";\r\n\r\nimport css from \"./index.module.css\";\r\n\r\nimport EditorToolbar, { EditorPlugins } from \"components/EditorToolbar\";\r\n\r\nimport SuggestionPanel from \"components/SuggestionPanel\";\r\nimport PotentialLinkControls from \"components/PotentialLinkControls\";\r\n\r\nimport { updateDoc, updateChartsInEditor } from \"ducks/docs\";\r\nimport { createLinks, createLink, deleteLink } from \"ducks/links\";\r\nimport { getChartsInEditor, getCharts } from \"ducks/charts\";\r\nimport { setSelectedLink, setManualLinkId, exitManualLinkMode, setTextSelection } from \"ducks/ui\";\r\n\r\nimport editorDecorators from \"utils/editorDecorators\";\r\nimport findSuggestions from \"utils/findSuggestions\";\r\nimport findLinks from \"utils/findLinks\";\r\nimport insertLinks from \"utils/insertLinks\";\r\nimport getLastTypedWord from \"utils/getLastTypedWord\";\r\nimport getTextSelection from \"utils/getTextSelection\";\r\nimport highlightTextSelection from \"utils/highlightTextSelection\";\r\nimport deHighlightTextSelection from \"utils/deHighlightTextSelection\";\r\nimport getBlockText from \"utils/getBlockText\";\r\nimport filterAlreadyConfirmedLinksInEditor from \"utils/filterAlreadyConfirmedLinksInEditor\";\r\nimport nlp from \"compromise\";\r\n\r\nconst AUTOMATIC_SUGGESTION_TIMEOUT = 30000;\r\n\r\nexport default function Editor(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n    const charts = useSelector((state) => getCharts(state, docId));\r\n    const storedEditorState = useSelector((state) => state.docs[docId].editorRawState);\r\n    const chartsInEditor = useSelector((state) => getChartsInEditor(state, docId));\r\n    const selectedLink = useSelector((state) => state.ui.selectedLink);\r\n    const allLinks = useSelector((state) => state.links);\r\n    const exitManualLink = useSelector((state) => state.ui.exitManualLink);\r\n    const manualLinkId = useSelector((state) => state.ui.manualLinkId);\r\n\r\n    const textSelectionInStore = useSelector((state) => state.ui.textSelection);\r\n    const [tempTextSelection, setTempTextSelection] = useState(textSelectionInStore);\r\n\r\n    const editorEl = useRef(null); //https://reactjs.org/docs/hooks-reference.html#useref\r\n    const [suggestions, setSuggestions] = useState([]);\r\n\r\n    const contentState =\r\n        storedEditorState === null\r\n            ? EditorState.createEmpty().getCurrentContent()\r\n            : convertFromRaw(storedEditorState);\r\n    const [editorState, setEditorState] = useState(EditorState.createWithContent(contentState));\r\n\r\n    const [currentSelectionState, setCurrentSelectionState] = useState(null);\r\n    const [blockText, setBlockText] = useState(\"\");\r\n    const [pastedText, setPastedText] = useState(null);\r\n\r\n    let interval = useRef();\r\n\r\n    const startTimer = () => {\r\n        interval = setInterval(() => {\r\n            console.log(\"Checking for autosuggestions every:\", AUTOMATIC_SUGGESTION_TIMEOUT);\r\n            if (editorEl?.current?.props?.editorState)\r\n                setBlockText(getBlockText(editorEl.current.props.editorState));\r\n        }, AUTOMATIC_SUGGESTION_TIMEOUT);\r\n        return () => clearInterval(interval.current);\r\n    };\r\n\r\n    useEffect(() => {\r\n        startTimer();\r\n        return () => clearInterval(interval.current);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (exitManualLink) {\r\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\r\n            editorEl.current.focus();\r\n            dispatch(exitManualLinkMode(false));\r\n            setCurrentSelectionState(null);\r\n        }\r\n    }, [exitManualLink]);\r\n\r\n    useEffect(() => {\r\n        if (exitManualLink && allLinks[manualLinkId] === undefined) {\r\n            //clear selection in case no brushing and pressing 'Accept'\r\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\r\n            setCurrentSelectionState(null);\r\n        }\r\n        if (allLinks[manualLinkId]) {\r\n            setEditorState(\r\n                insertLinks([allLinks[manualLinkId]], editorState, currentSelectionState)\r\n            );\r\n            dispatch(setManualLinkId(null));\r\n            setCurrentSelectionState(null);\r\n        }\r\n    }, [manualLinkId, exitManualLink]);\r\n\r\n    useEffect(() => {\r\n        if (exitManualLink && allLinks[manualLinkId] === undefined) {\r\n            //clear selection in case no brushing and pressing 'Accept'\r\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\r\n            setCurrentSelectionState(null);\r\n        }\r\n    }, [editorState]);\r\n\r\n    useEffect(() => {\r\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\r\n        dispatch(updateDoc(doc.id, { editorRawState }));\r\n    }, [editorState]);\r\n\r\n    useEffect(() => {\r\n        const asyncExec = async () => {\r\n            if (blockText !== \"\") {\r\n                const sentences = await nlp(blockText).sentences().json();\r\n                let sentenceOffset = 0;\r\n                let allLinksInCurrentBlockText = [];\r\n                for (let i = 0; i < sentences.length; i++) {\r\n                    const { text } = sentences[i];\r\n                    const sentenceObject = {\r\n                        text: text,\r\n                        startIndex: blockText.indexOf(text),\r\n                        endIndex: sentenceOffset + text.length,\r\n                    };\r\n                    const links = await findLinks(chartsInEditor, sentenceObject);\r\n                    allLinksInCurrentBlockText = allLinksInCurrentBlockText.concat(links);\r\n                }\r\n                if (allLinksInCurrentBlockText.length > 0) {\r\n                    const rawEditorState = convertToRaw(editorState.getCurrentContent());\r\n                    allLinksInCurrentBlockText = filterAlreadyConfirmedLinksInEditor(\r\n                        rawEditorState,\r\n                        allLinksInCurrentBlockText\r\n                    );\r\n                    const action = createLinks(doc.id, allLinksInCurrentBlockText);\r\n                    setEditorState(insertLinks(action.links, editorState));\r\n                    dispatch(action);\r\n                }\r\n                setBlockText(\"\");\r\n            }\r\n        };\r\n        asyncExec();\r\n    }, [blockText]);\r\n\r\n    async function handleEditorChange(editorState) {\r\n        setEditorState(editorState);\r\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\r\n        const lastTypedWord = getLastTypedWord(editorState);\r\n\r\n        //Enable SuggestionMenu on @\r\n        if (lastTypedWord.text.startsWith(\"@\")) {\r\n            const suggestions = findSuggestions(\r\n                chartsInEditor,\r\n                lastTypedWord.text.slice(1),\r\n                lastTypedWord.startIndex\r\n            );\r\n\r\n            setSuggestions(suggestions);\r\n        } else {\r\n            setSuggestions([]);\r\n        }\r\n        // TODO: see if we can catch an event for adding or removing a chart.\r\n        // Updating charts in store when a chart is added to or removed from document\r\n        const entityMap = editorRawState.entityMap;\r\n        const numCharts = Object.keys(entityMap).length;\r\n        if (numCharts !== chartsInEditor.length) {\r\n            const ids = Object.values(entityMap).reduce((acc, entity) => {\r\n                if (entity.type === \"CHART\") {\r\n                    acc.push(entity.data.id);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            dispatch(updateChartsInEditor(doc.id, ids));\r\n        }\r\n\r\n        const currentSelection = editorState.getSelection();\r\n        const caretPosition = currentSelection.getAnchorOffset();\r\n        const activeBlockKey = currentSelection.getAnchorKey();\r\n        //Hide the link accept/delete button when cursor not in link range\r\n        //TODO: what if selection spans more than one block?\r\n        if (selectedLink && activeBlockKey) {\r\n            if (\r\n                activeBlockKey !== selectedLink.blockKey ||\r\n                caretPosition < selectedLink.startIndex ||\r\n                caretPosition > selectedLink.endIndex\r\n            ) {\r\n                dispatch(setSelectedLink(null));\r\n            }\r\n        }\r\n\r\n        let textSelection = getTextSelection(\r\n            editorState.getCurrentContent(),\r\n            currentSelection,\r\n            \" \" //delimiter\r\n        );\r\n        //Hide the floating controls when no text is selected\r\n        setTempTextSelection(textSelection);\r\n\r\n        //search for suggestions on text selection\r\n        if (textSelection) {\r\n            const suggestions = findSuggestions(\r\n                chartsInEditor,\r\n                textSelection.text.trim(),\r\n                textSelection.startIndex\r\n            );\r\n            suggestions.length !== 0\r\n                ? setSuggestions(suggestions)\r\n                : setSuggestions([{ text: \"NoLinkFound!\" }]);\r\n        }\r\n\r\n        //Quickfix: when text (having links) is pasted, the links are still pointing to their old location and causes problems when accepting or discarding them!\r\n        //The following block re-runs the findLinks() to update (rediscover) them thus setting their locations right\r\n        //TODO: fix it properly (combine with setBlockText() )\r\n        if (pastedText) {\r\n            const links = await findLinks(chartsInEditor, pastedText);\r\n\r\n            if (links.length > 0) {\r\n                const action = createLinks(doc.id, links); // need ids\r\n                editorState = insertLinks(action.links, editorState);\r\n                setEditorState(editorState);\r\n                dispatch(action);\r\n            }\r\n            setPastedText(null);\r\n        }\r\n    }\r\n\r\n    function handleKeyCommand(command) {\r\n        // handle common key bindings (e.g., bold, italic, etc.)\r\n        const newEditorState = RichUtils.handleKeyCommand(editorState, command);\r\n        if (newEditorState) {\r\n            setEditorState(newEditorState);\r\n            return \"handled\";\r\n        }\r\n        return \"not-handled\";\r\n    }\r\n    function handleTab(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setBlockText(getBlockText(editorState));\r\n        return \"handled\";\r\n    }\r\n\r\n    function handleDragOver(e) {\r\n        // may need to throttle for performance\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        editorEl.current.focus();\r\n        // e.persist(); //conflict with asynchronous setTimeout in throuttle:\r\n        //https://stackoverflow.com/questions/38142880/react-js-throttle-mousemove-event-keep-throwing-event-persist-error\r\n    }\r\n\r\n    function handleDrop(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const chartId = e.dataTransfer.getData(\"chartId\");\r\n        const chart = charts.find((d) => d.id === chartId);\r\n        const exists = chartsInEditor.find((d) => d.id === chartId);\r\n        // console.log(chartsInEditor, chartId, editorState.getCurrentContent().getEntityMap().mapEntries());\r\n        if (chart && !exists) {\r\n            insertChart(chart);\r\n            e.dataTransfer.clearData();\r\n        }\r\n    }\r\n\r\n    function blockRendererFn(block) {\r\n        //TODO: is this necessary given the plugin is there\r\n        // ChartBlock Removed\r\n    }\r\n    function insertChart(chart) {\r\n        // console.log(chartId, charts[chart.id])\r\n        let contentState = editorState.getCurrentContent();\r\n\r\n        contentState = contentState.createEntity(\"CHART\", \"IMMUTABLE\", {\r\n            id: chart.id, // wil get chart info from store\r\n        });\r\n        const entityKey = contentState.getLastCreatedEntityKey();\r\n        const newEditorState = AtomicBlockUtils.insertAtomicBlock(editorState, entityKey, \" \");\r\n        setEditorState(newEditorState);\r\n    }\r\n    function handleBlur() {\r\n        setSuggestions([]);\r\n    }\r\n    function handleSuggestionSelected(suggestion) {\r\n        //TODO: there should be a single place generating a link (see find links)\r\n        const action = createLink(doc.id, {\r\n            text: suggestion.text,\r\n            feature: suggestion.feature,\r\n            chartId: suggestion.chartId,\r\n            active: false,\r\n            type: \"point\", //TODO: range selection\r\n            sentence: suggestion.text,\r\n            data: [isNaN(Number(suggestion.text)) ? suggestion.text : Number(suggestion.text)],\r\n            startIndex: suggestion.startIndex,\r\n            endIndex: suggestion.startIndex + suggestion.text.length,\r\n            isConfirmed: true,\r\n        }); // need ids\r\n        const newEditorState = insertLinks([action.attrs], editorState);\r\n        dispatch(action);\r\n\r\n        setSuggestions([]);\r\n        setEditorState(newEditorState);\r\n    }\r\n    function handleCreateLinkSelect() {\r\n        dispatch(exitManualLinkMode(false));\r\n        setCurrentSelectionState(editorState.getSelection());\r\n        setEditorState(highlightTextSelection(tempTextSelection, editorState));\r\n    }\r\n\r\n    function handleLinkDiscard(link) {\r\n        //TODO: Some code is similar to insertLinks.js. Consider refactoring!\r\n        const currentSelection = editorState.getSelection();\r\n        let newContent = ContentState.createFromText(\"\");\r\n        const insertTextSelection = currentSelection.merge({\r\n            anchorOffset: link.startIndex,\r\n            focusOffset: link.endIndex,\r\n        });\r\n        newContent = Modifier.replaceText(\r\n            editorState.getCurrentContent(),\r\n            insertTextSelection,\r\n            link.text,\r\n            [] //inline styling\r\n        );\r\n        let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n        let newSelection = newEditorState.getSelection().merge({\r\n            focusOffset: link.endIndex,\r\n            anchorOffset: link.endIndex,\r\n        });\r\n        newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n        newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n        setEditorState(newEditorState);\r\n\r\n        dispatch(deleteLink(link.id));\r\n    }\r\n    function handleLinkAccept(linkId) {\r\n        setEditorState(insertLinks([allLinks[linkId]], editorState, editorState.getSelection()));\r\n    }\r\n\r\n    function handlePastedText(text) {\r\n        const end = editorState.getSelection().getAnchorOffset() + text.length;\r\n        const offset = end - text.length;\r\n        setPastedText({\r\n            text: text,\r\n            startIndex: offset,\r\n            endIndex: end,\r\n        });\r\n    }\r\n\r\n    return (\r\n        <Fragment>\r\n            {<EditorToolbar />}\r\n            <div className={css.editor} onDragOver={handleDragOver} onDrop={handleDrop}>\r\n                <DraftEditor\r\n                    editorState={editorState}\r\n                    plugins={EditorPlugins}\r\n                    onChange={handleEditorChange}\r\n                    onBlur={handleBlur}\r\n                    handleKeyCommand={handleKeyCommand}\r\n                    blockRendererFn={blockRendererFn}\r\n                    decorators={editorDecorators}\r\n                    ref={editorEl}\r\n                    onTab={handleTab}\r\n                    handlePastedText={handlePastedText}\r\n                />\r\n            </div>\r\n            {suggestions.length >= 1 && chartsInEditor.length > 0 && (\r\n                <SuggestionPanel\r\n                    suggestions={suggestions.filter((s) => s.text !== \"NoLinkFound!\")}\r\n                    textSelection={tempTextSelection}\r\n                    onSelected={handleSuggestionSelected}\r\n                    onCreateLinkSelect={handleCreateLinkSelect}\r\n                />\r\n            )}\r\n            <PotentialLinkControls\r\n                selectedLink={selectedLink}\r\n                onDiscard={handleLinkDiscard}\r\n                onAccept={handleLinkAccept}\r\n            />\r\n        </Fragment>\r\n    );\r\n}\r\n\r\n//Define the public proptypes of this componenet\r\nEditor.propTypes = {\r\n    editor: PropTypes.object,\r\n    updateEditorState: PropTypes.func,\r\n    addSelectedChart: PropTypes.func,\r\n};\r\n","import { Modifier, EditorState, ContentState } from \"draft-js\";\r\n\r\nexport default (textSelection, editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n\r\n    let newContent = currentContent.createEntity(`TEXT_SELECTION`, \"MUTABLE\", {\r\n        ...textSelection,\r\n    });\r\n\r\n    const entityKey = newContent.getLastCreatedEntityKey();\r\n\r\n    const insertTextSelection = currentSelection.merge({\r\n        anchorOffset: textSelection.startIndex,\r\n        focusOffset: textSelection.endIndex,\r\n    });\r\n    newContent = Modifier.replaceText(\r\n        editorState.getCurrentContent(),\r\n        insertTextSelection,\r\n        textSelection.text,\r\n        [], //inline styling\r\n        entityKey\r\n    );\r\n    let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n    let newSelection = newEditorState.getSelection().merge({\r\n        focusOffset: textSelection.endIndex,\r\n        anchorOffset: textSelection.endIndex,\r\n    });\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n    return newEditorState;\r\n};\r\n","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\n// import TextField from '@material-ui/core/TextField';\r\nimport ChartGallery from \"components/ChartGallery\";\r\nimport Editor from \"components/Editor\";\r\n\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport { setViewMode } from \"ducks/ui\";\r\n\r\nexport default function Edit(props) {\r\n    const dispatch = useDispatch();\r\n    dispatch(setViewMode(false));\r\n    return (\r\n        <Grid container spacing={2}>\r\n            <Grid item xs={4}>\r\n                <Typography variant=\"overline\" display=\"block\" gutterBottom>\r\n                    Chart Gallery\r\n                </Typography>\r\n                <ChartGallery />\r\n            </Grid>\r\n            <Grid item xs={8}>\r\n                <Editor />\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport Navbar from \"components/Navbar\";\r\nimport Home from 'components/Home';\r\nimport Docs from 'components/Docs';\r\nimport View from 'components/View';\r\nimport Edit from 'components/Edit';\r\nimport { BrowserRouter as Router, Switch, Route } from \"react-router-dom\";\r\nimport Container from '@material-ui/core/Container';\r\n\r\nfunction App() {\r\n  return (\r\n    <Router>\r\n      <Navbar />\r\n      <Container maxWidth=\"lg\" mt={2}>\r\n        <Switch>\r\n          <Route path=\"/docs/:docId/view\">\r\n            <View />\r\n          </Route>\r\n          <Route path=\"/docs/:docId\">\r\n            <Edit />\r\n          </Route>\r\n          <Route path=\"/docs\">\r\n            <Docs />\r\n          </Route>\r\n          <Route path=\"/\">\r\n            <Home />\r\n          </Route>\r\n          \r\n        </Switch>\r\n      </Container>\r\n    </Router>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import { combineReducers } from \"redux\";\r\n// import editor from \"./editor\";\r\nimport charts from \"./charts\";\r\nimport docs from \"./docs\";\r\nimport links from \"./links\";\r\nimport ui from \"./ui\";\r\n\r\nexport default combineReducers({\r\n  docs,\r\n  charts,\r\n  links,\r\n  ui\r\n});\r\n\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\nimport { createLogger } from \"redux-logger\";\r\nimport reduxFreeze from \"redux-freeze\";\r\nimport { Provider } from \"react-redux\";\r\nimport { applyMiddleware, createStore } from \"redux\";\r\nimport rootReducer from \"./ducks\";\r\nimport localforage from \"localforage\";\r\nimport throttle from \"./utils/throttle\";\r\n\r\nimport { createMuiTheme, ThemeProvider } from \"@material-ui/core/styles\";\r\nconst theme = createMuiTheme({\r\n    //https://material-ui.com/customization/palette/\r\n    palette: {\r\n        primary: {\r\n            main: \"#2196f3\",\r\n        },\r\n        secondary: {\r\n            main: \"#e91e63\",\r\n        },\r\n        info: {\r\n            main: \"#1976d2\",\r\n        },\r\n        error: {\r\n            main: \"#f44336\",\r\n        },\r\n        warning: {\r\n            main: \"#ff9800\",\r\n        },\r\n        success: {\r\n            main: \"#4caf50\",\r\n        },\r\n    },\r\n    secondary: {\r\n        main: \"#e91e63\",\r\n    },\r\n    info: {\r\n        main: \"#1976d2\",\r\n    },\r\n    error: {\r\n        main: \"#f44336\",\r\n    },\r\n    warning: {\r\n        main: \"#ff9800\",\r\n    },\r\n    success: {\r\n        main: \"#4caf50\",\r\n    },\r\n    textSecondary: {\r\n        main: \"#bdbdbd\",\r\n    },\r\n});\r\n// console.log(logger);\r\n\r\nlet loadData = new Promise((resolve, reject) => {\r\n    localforage\r\n        .getItem(\"state\")\r\n        .then((data) => {\r\n            resolve(data);\r\n        })\r\n        .catch((err) => {\r\n            reject(err);\r\n        });\r\n});\r\n\r\nloadData\r\n    .then((data) => {\r\n        let middleware = [reduxFreeze, createLogger()];\r\n        let store = createStore(\r\n            rootReducer,\r\n            // {},\r\n            data ? data : {},\r\n            applyMiddleware(...middleware)\r\n        );\r\n        // initialize if ne\r\n        if (!data) {\r\n        }\r\n        store.subscribe(\r\n            throttle(() => {\r\n                let state = { ...store.getState() };\r\n                delete state[\"ui\"]; // don't persist ui sate\r\n                localforage.setItem(\"state\", state);\r\n            }, 1000)\r\n        );\r\n        // localforage.clear(function(err) {\r\n        //   // Run this code once the database has been entirely deleted.\r\n        //   console.log(\"Database is now empty.\");\r\n        // });\r\n        ReactDOM.render(\r\n            <Provider store={store}>\r\n                <ThemeProvider theme={theme}>\r\n                    <App />\r\n                </ThemeProvider>\r\n            </Provider>,\r\n            document.getElementById(\"root\")\r\n        );\r\n    })\r\n    .catch((err) => {\r\n        console.log(err);\r\n        ReactDOM.render(<div>Failed to initialize data!</div>, document.getElementById(\"root\"));\r\n    });\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}