{"version":3,"sources":["components/ChartConfigPanel/index.module.css","components/Link/index.module.css","components/ChartGallery/index.module.css","components/Viewer/index.module.css","components/ManualLinkControls/index.module.css","components/HighlightTextSelection/index.module.css","components/Chart/index.module.css","components/Editor/index.module.css","components/SuggestionPanel/index.module.css","components/PotentialLinkControls/index.module.css","utils/uniqueId.js","ducks/charts.js","ducks/docs.js","components/Navbar/index.jsx","components/Home/index.jsx","ducks/ui.js","components/Doc/index.jsx","components/Docs/index.jsx","utils/addSignalToChartSpec.js","utils/addBrushToVegaLiteSpec.js","utils/throttle.js","components/ChartConfigPanel/index.jsx","ducks/links.js","utils/createLink.js","components/ManualLinkControls/index.jsx","components/ChartBlock/index.jsx","components/EditorToolbar/index.jsx","utils/createChartBlockPlugin.js","utils/editorDecorators.js","components/HighlightTextSelection/index.jsx","components/Link/index.jsx","components/Viewer/index.jsx","utils/removePotentialLinks.js","components/View/index.jsx","components/Alert/index.jsx","components/Chart/index.jsx","utils/extractChartFeatures.js","utils/createThumbnail.js","components/ChartGallery/index.jsx","components/SuggestionPanel/index.jsx","components/PotentialLinkControls/index.jsx","utils/findSuggestions.js","utils/searchLinks.js","utils/getLastTypedWord.js","utils/insertLinks.js","utils/deHighlightTextSelection.js","utils/getBlockText.js","utils/filterAlreadyConfirmedLinksInEditor.js","components/Editor/index.jsx","utils/getTextSelection.js","utils/highlightTextSelection.js","components/Edit/index.jsx","App.js","serviceWorker.js","ducks/index.js","index.js"],"names":["module","exports","nanoid","customAlphabet","prefix","createChart","docId","spec","liteSpec","attrs","chartId","uniqueId","type","timestamp","Date","now","highlight","channel","active","inactive","id","updateChart","getCharts","createSelector","state","docs","charts","_","map","cid","getChartsInEditor","chartsInEditor","initialState","testchart","thumbnail","properties","axes","name","field","data","title","features","value","barChartSpec","barChartLiteSpec","updateDoc","testdoc","searchedSentences","editorRawState","blocks","key","text","depth","inlineStyleRanges","offset","length","style","entityRanges","entityMap","useStyles","makeStyles","theme","root","flexGrow","marginBottom","spacing","classes","dispatch","useDispatch","useSelector","ui","currentDocId","doc","AppBar","className","position","color","Toolbar","variant","Link","underline","component","RouterLink","to","TextField","onChange","e","target","size","fullWidth","margin","marginLeft","marginRight","label","Button","Home","Grid","container","justify","item","xs","Typography","gutterBottom","Box","Fab","aria-label","display","setSelectedLink","link","setTextSelection","textSelection","setManualLinkId","linkId","exitManualLinkMode","exit","setViewMode","val","setLinkActiveNoAutoTrigger","button","width","padding","paper","justifyContent","alignItems","palette","secondary","height","Doc","props","onClick","Paper","elevation","Docs","Object","values","action","createDoc","selections","includes","mark","paintbrush","toggle","clear","brush","encoding","condition","selection","addBrushToVegaLiteSpec","compile","forEach","d","url","startsWith","process","signals","start","end","enabled","marks","addSignalToMark","isMap","activePredicate","inactivePredicate","oldProp","encode","update","highlightProp","test","concat","isArray","func","last","deferTimer","wait","throttled","args","clearTimeout","setTimeout","ChartConfigPanel","channelOptions","opacity","fill","colors","chart","useState","setActive","setInactive","handleActiveChangeCommitted","event","newValue","handleInactiveChangeCommitted","zIndex","css","panel","top","left","onMouseDown","stopPropagation","p","direction","Select","option","keys","MenuItem","Slider","aria-labelledby","valueLabelDisplay","min","max","step","onChangeCommitted","picker","bgcolor","border","onMouseUp","createLinks","links","deleteLink","deactivateLink","getLinks","fromEntries","entries","filter","trigger","extent","blockKey","feature","fieldX","rangeX","fieldY","rangeY","startIndex","endIndex","isConfirmed","ManualLinkControls","window","getSelection","pos","rangeCount","getRangeAt","getBoundingClientRect","chartProperties","selectedChart","right","potentialLinkControls","ButtonGroup","preventDefault","multiPoint","viewData","points","i","j","_vgsid_","push","axis","hasOwnProperty","commonProps","createLink","console","log","brushField","rangeMin","rangeMax","fields","rangeField","currentDoc","makeManualLink","selectedMarks","memo","block","blockProps","customStyleMap","customStyleFn","decorator","forceSelection","offsetKey","tree","contentState","blockStyleFn","preventScroll","elementProps","view","setView","containerEl","useRef","chartEl","ratio","setRatio","useParams","setSelectedMarks","setViewData","setBrush","toggleSettings","setToggleSettings","viewMode","shallowEqual","useMemo","addSignalToChartSpec","JSON","parse","stringify","resize","current","useEffect","a","runtime","View","runAsync","tempView","toCanvas","canvas","vegaEmbed","actions","result","addDataListener","error","asyncExec","throttle","some","signal","showConfig","getAnchorKey","getKey","highlightStyle","indexOf","borderStyle","borderColor","Fragment","ref","IconButton","toolbarPlugin","createToolbarPlugin","focusPlugin","createFocusPlugin","alignmentPlugin","createAlignmentPlugin","resizeablePlugin","createResizeablePlugin","AlignmentTool","EditorPlugins","config","ChartBlock","blockRendererFn","getEditorState","getType","getCurrentContent","getEntityAt","entity","getEntity","getData","editable","createChartBlockPlugin","composeDecorators","EditorToolbar","externalProps","strategy","contentBlock","callback","findEntityRanges","character","entityKey","data-offset-key","children","potentialLink","onMouseOver","onMouseLeave","updatedLink","Viewer","rawEditorState","editorEl","EditorState","createEmpty","convertFromRaw","removePotentialLinks","createWithContent","editorState","setEditorState","viewer","plugins","handleKeyCommand","command","newEditorState","RichUtils","decorators","editorDecorators","readOnly","Alert","errorMsg","setErrorMsg","hover","setHover","onKeyDown","tabIndex","draggable","onDragStart","dataTransfer","setData","onMouseEnter","Avatar","src","Snackbar","open","anchorOrigin","vertical","horizontal","autoHideDuration","onClose","severity","featureMap","getState","truthy","falsy","recurse","datum","isString","axesMap","extractChartAxes","scales","scale","row","domain","isDate","toString","searchFieldName","scaleName","enter","relatedAxis","undefined","toImageURL","img","resized","orgImg","Promise","resolve","reject","Image","onload","document","createElement","ctx","getContext","drawImage","this","toDataURL","ChartGallery","dragging","setDragging","onDragEnter","onDragLeave","onDragOver","onDrop","file","files","match","reader","FileReader","createThumbnail","extractChartFeatures","readAsText","draggingArea","SuggestionPanel","handleClick","suggestion","onSelected","x","y","suggestionPanel","List","ListItem","onCreateLinkSelect","ListItemIcon","suggestions","slice","dense","bind","ListItemAvatar","alt","ListItemText","primary","PotentialLinkControls","selectedLink","onAccept","onDiscard","partialText","toLowerCase","request","require","sentence","sentenceOffset","options","uri","method","headers","Accept","json","body","requestPromise","util","promisify","response","currentContent","currentSelection","currentBlock","getBlockForKey","caretOffset","getAnchorOffset","blockTextBeforeCaret","getText","substr","lastWord","split","pop","insertLink","activeBlockKey","activeBlockEndIndex","newContent","createEntity","getLastCreatedEntityKey","insertLinkSelection","merge","anchorKey","focusKey","anchorOffset","focusOffset","insertSuggestionSelection","getLastTypedWord","Modifier","replaceText","getCurrentInlineStyle","caretPosition","newSelection","moveSelectionToEnd","currentSelectionState","currentContentState","newContentState","applyEntity","newCaretPosition","Math","getFocusOffset","blockText","allLinksInCurrentBlockText","linkInCurrentBlockText","shouldKeep","Editor","storedEditorState","allLinks","exitManualLink","manualLinkId","linkActiveNoAutoTrigger","textSelectionInStore","tempTextSelection","setTempTextSelection","setSuggestions","alreadySearchedSentences","setCurrentSelectionState","setCurrentBlock","infoMsg","setInfoMsg","autoLinksToInsert","setAutoLinksToInsert","interval","getUpdatedLinkExtent","convertToRaw","BlkKey","activeBlock","find","er","setInterval","getBlockText","clearInterval","deHighlightTextSelection","focus","dispatchEvent","KeyboardEvent","insertLinks","linkIdsToKeep","nlp","sentences","sentenceObject","searchLinks","filterAlreadyConfirmedLinksInEditor","editor","exists","AtomicBlockUtils","insertAtomicBlock","insertChart","clearData","lastTypedWord","allText","getPlainText","trim","updatedSearchedSentences","alreadySearchedSentence","findSuggestions","ids","reduce","acc","updateChartsInEditor","blockDelimiter","startKey","getStartKey","endKey","getEndKey","getBlockMap","lastWasEnd","selectedBlock","skipUntil","takeUntil","getStartOffset","getEndOffset","join","sIndex","eIndex","isBackward","getTextSelection","onBlur","handlePastedText","stripPastedStyles","onTab","s","createLinkObject","isNaN","Number","insertTextSelection","highlightTextSelection","ContentState","createFromText","updateLinkExtent","confirmedLink","Edit","App","Navbar","Container","maxWidth","mt","path","Boolean","location","hostname","combineReducers","newState","createMuiTheme","main","info","warning","success","textSecondary","localforage","getItem","then","catch","err","middleware","reduxFreeze","createLogger","store","createStore","rootReducer","applyMiddleware","subscribe","setItem","ReactDOM","render","ThemeProvider","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"+EACAA,EAAOC,QAAU,CAAC,MAAQ,gCAAgC,OAAS,iCAAiC,MAAQ,kC,oBCA5GD,EAAOC,QAAU,CAAC,KAAO,mBAAmB,cAAgB,8B,oBCA5DD,EAAOC,QAAU,CAAC,UAAY,gCAAgC,aAAe,qC,g0ECA7ED,EAAOC,QAAU,CAAC,OAAS,yB,oBCA3BD,EAAOC,QAAU,CAAC,MAAQ,kCAAkC,QAAU,oCAAoC,sBAAwB,oD,oBCAlID,EAAOC,QAAU,CAAC,cAAgB,gD,oBCAlCD,EAAOC,QAAU,CAAC,UAAY,2B,oBCA9BD,EAAOC,QAAU,CAAC,OAAS,yB,oBCA3BD,EAAOC,QAAU,CAAC,gBAAkB,2C,oBCApCD,EAAOC,QAAU,CAAC,sBAAwB,uD,4XCApCC,EAASC,YAAe,uCAAwC,IACvD,WAACC,GACf,OAAQA,EAASA,EAASF,IAAWA,K,2BCQzBG,EAAc,SAACC,EAAOC,EAAMC,GAA0B,IAAhBC,EAAe,uDAAP,GACnDC,EAAUC,EAAS,UAUvB,MAAO,CAAEC,KAhBe,eAgBKF,UAASD,MATtCA,EAAK,aACDH,QACAC,OACAC,WACAK,UAAWC,KAAKC,MAChBC,UAAW,CAAEC,QAAS,UAAWC,OAAQ,EAAKC,SAAU,KACrDV,EANF,CAODW,GAAIV,MAKCW,EAAc,SAACX,EAASD,GACjC,MAAO,CAAEG,KAnBe,eAmBKF,UAASD,UAW7Ba,EAAYC,aACrB,SAACC,GAAD,OAAWA,EAAMC,QACjB,SAACD,GAAD,OAAWA,EAAME,UACjB,SAACC,EAAGrB,GAAJ,OAAcA,KACd,SAACmB,EAAMC,EAAQpB,GAAf,OAAyBmB,EAAKnB,GAAOoB,OAAOE,KAAI,SAACC,GAAD,OAASH,EAAOG,SAGvDC,EAAoBP,aAC7B,SAACC,GAAD,OAAWA,EAAMC,QACjB,SAACD,GAAD,OAAWA,EAAME,UACjB,SAACC,EAAGrB,GAAJ,OAAcA,KACd,SAACmB,EAAMC,EAAQpB,GAAf,OAAyBmB,EAAKnB,GAAOyB,eAAeH,KAAI,SAACC,GAAD,OAASH,EAAOG,SAGtEG,EAAe,CACjBC,UAAW,CACPb,GAAI,YACJd,MAAO,UACPO,UAAWC,KAAKC,MAChBmB,UACI,6oLACJlB,UAAW,CAAEC,QAAS,UAAWC,OAAQ,EAAKC,SAAU,IACxDgB,WAAY,CACRC,KAAM,CACF,CACIC,KAAM,IACNC,MAAO,WACPC,KAAM,SACN3B,KAAM,UACN4B,MAAO,YAEX,CAAEH,KAAM,IAAKC,MAAO,SAAUC,KAAM,SAAU3B,KAAM,SAAU4B,MAAO,WAEzEC,SAAU,CACN,CAAEC,MAAO,QAAS9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC3D,CAAEG,MAAO,SAAU9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC5D,CAAEG,MAAO,WAAY9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC9D,CAAEG,MAAO,UAAW9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC7D,CAAEG,MAAO,YAAa9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC/D,CAAEG,MAAO,UAAW9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC7D,CAAEG,MAAO,UAAW9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,UAC7D,CAAEG,MAAO,WAAY9B,KAAM,SAAU0B,MAAO,WAAYC,KAAM,YAGtEhC,KAAMoC,EACNnC,SAAUoC,ICxDLC,EAAY,SAACvC,EAAOG,GAC7B,MAAO,CAAEG,KAvBa,aAuBKN,QAAOG,UAkBhCuB,EAAe,CACjBc,QAAS,CACL1B,GAAI,UACJoB,MAAO,aACP3B,UAAWC,KAAKC,MAChBW,OAAQ,CAAC,aACTK,eAAgB,GAChBgB,kBAAmB,GACnBC,eAAgB,CACZC,OAAQ,CACJ,CACIC,IAAK,QACLC,KAAM,6BACNvC,KAAM,WACNwC,MAAO,EACPC,kBAAmB,CACf,CACIC,OAAQ,EACRC,OAAQ,GACRC,MAAO,SAGfC,aAAc,GACdlB,KAAM,IAEV,CACIW,IAAK,QACLC,KAAM,4CACNvC,KAAM,WACNwC,MAAO,EACPC,kBAAmB,CACf,CACIC,OAAQ,EACRC,OAAQ,GACRC,MAAO,cAGfC,aAAc,GACdlB,KAAM,IAEV,CACIW,IAAK,QACLC,KACI,mFACJvC,KAAM,WACNwC,MAAO,EACPC,kBAAmB,CACf,CACIC,OAAQ,EACRC,OAAQ,GACRC,MAAO,WAGfC,aAAc,GACdlB,KAAM,KAGdmB,UAAW,MC3FjBC,EAAYC,aAAW,SAACC,GAAD,MAAY,CACrCC,KAAM,CACFC,SAAU,EACVC,aAAcH,EAAMI,QAAQ,IAKhCzB,MAAO,CACHuB,SAAU,OAIH,aACX,IAAMG,EAAUP,IACVQ,EAAWC,cACX9D,EAAQ+D,aAAY,SAAC7C,GAAD,OAAWA,EAAM8C,GAAGC,gBACxCC,EAAMH,aAAY,SAAC7C,GAAD,OAAWA,EAAMC,KAAKnB,MAK9C,OACI,kBAACmE,EAAA,EAAD,CAAQC,UAAWR,EAAQJ,KAAMa,SAAS,SAASC,MAAM,WACrD,kBAACC,EAAA,EAAD,CAASC,QAAQ,SAMb,kBAACC,EAAA,EAAD,CACID,QAAQ,KACRJ,UAAWR,EAAQ1B,MACnBwC,UAAU,OACVJ,MAAM,UACNK,UAAWC,IACXC,GAAG,KANP,QAcC7E,GACG,kBAAC8E,EAAA,EAAD,CACI1C,MAAO8B,EAAIhC,MACX6C,SA5BpB,SAAsBC,GAClBnB,EAAStB,EAAUvC,EAAO,CAAEkC,MAAO8C,EAAEC,OAAO7C,UA4B5B8C,KAAK,QACLC,WAAS,EACTC,OAAO,QACPZ,QAAQ,SACRtB,MAAO,CAAEmC,WAAY,QAASC,YAAa,QAC3CC,MAAM,mBAGd,kBAACC,EAAA,EAAD,CAAQlB,MAAM,UAAUK,UAAWC,IAAYC,GAAG,SAAlD,QAIC7E,GACG,kBAAC,WAAD,KACI,0BAAMkD,MAAO,CAAEmC,WAAY,OAAQC,YAAa,SAAhD,OACA,kBAACE,EAAA,EAAD,CAAQlB,MAAM,UAAUK,UAAWC,IAAYC,GAAE,gBAAW7E,IAA5D,QAGA,kBAACwF,EAAA,EAAD,CAAQlB,MAAM,UAAUK,UAAWC,IAAYC,GAAE,gBAAW7E,EAAX,UAAjD,Y,sDCtCTyF,MAhCf,WACI,OACI,kBAACC,EAAA,EAAD,CAAMC,WAAS,EAAChC,QAAS,EAAGiC,QAAQ,UAChC,kBAACF,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAACC,EAAA,EAAD,CAAYvB,QAAQ,KAAKwB,cAAY,GAArC,QAGA,kBAACC,EAAA,EAAD,CAAKvC,aAAc,GACf,kBAACqC,EAAA,EAAD,CAAYvB,QAAQ,QAAQwB,cAAY,GAAxC,aAIJ,kBAACE,EAAA,EAAD,CACI1B,QAAQ,WACRF,MAAM,UACN6B,aAAW,MACXxB,UAAWF,IACXI,GAAG,SAEH,kBAAC,IAAD,MAPJ,gBAWJ,kBAACa,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAACC,EAAA,EAAD,CAAYvB,QAAQ,WAAW4B,QAAQ,QAAQJ,cAAY,GAA3D,yB,2BCvBHK,EAAkB,SAACC,GAC5B,MAAO,CAAEhG,KAToB,oBASKgG,SAEzBC,EAAmB,SAACC,GAC7B,MAAO,CAAElG,KAXqB,qBAWKkG,kBAE1BC,EAAkB,SAACC,GAC5B,MAAO,CAAEpG,KAbqB,qBAaKoG,WAE1BC,EAAqB,SAACC,GAC/B,MAAO,CAAEtG,KAfwB,wBAeKsG,SAM7BC,EAAc,SAACC,GACxB,MAAO,CAAExG,KApBgB,gBAoBKwG,QAErBC,EAA6B,SAACD,GACvC,MAAO,CAAExG,KAtB8B,8BAsBKwG,QAG1CpF,EAAe,GCnBf2B,EAAYC,aAAW,SAACC,GAAD,MAAY,CACrCyD,OAAQ,CACJC,MAAO,OACPC,QAAS3D,EAAMI,QAAQ,GACvByB,OAAQ7B,EAAMI,QAAQ,IAE1BwD,MAAO,CACHf,QAAS,OACTgB,eAAgB,SAChBC,WAAY,SACZ/C,MAAOf,EAAM+D,QAAQzE,KAAK0E,UAC1BC,OAAQjE,EAAMI,QAAQ,IACtBsD,MAAO,YA2BAQ,MAvBf,SAAaC,GACT,IAAM9D,EAAUP,IACVQ,EAAWC,cAMjB,OACI,kBAAC0B,EAAA,EAAD,CACIpB,UAAWR,EAAQoD,OACnBrC,UAAWC,IACXC,GAAE,gBAAW6C,EAAM1H,OACnB2H,QATR,WACI9D,EDXG,CAAEvD,KAlBqB,qBAkBKN,MCWN0H,EAAM1H,UAU3B,kBAAC4H,EAAA,EAAD,CAAOxD,UAAWR,EAAQuD,MAAOU,UAAW,GACvCH,EAAMxD,IAAIhC,MACX,iCClCVmB,EAAYC,aAAW,SAACC,GAAD,MAAY,CACrCyD,OAAQ,CACJC,MAAO,OACPC,QAAS3D,EAAMI,QAAQ,GACvByB,OAAQ7B,EAAMI,QAAQ,IAE1BwD,MAAO,CACHf,QAAS,OACTgB,eAAgB,SAChBC,WAAY,SACZ/C,MAAOf,EAAM+D,QAAQzE,KAAK0E,UAC1BC,OAAQjE,EAAMI,QAAQ,IACtBsD,MAAO,YAgCAa,MA5Bf,WACI,IAAMlE,EAAUP,IACVQ,EAAWC,cACX3C,EAAO4C,aAAY,SAAC7C,GAAD,OAAW6G,OAAOC,OAAO9G,EAAMC,SAOxD,OACI,kBAACuE,EAAA,EAAD,CAAMC,WAAS,EAAChC,QAAS,GACrB,kBAAC+B,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAACN,EAAA,EAAD,CAAQpB,UAAWR,EAAQoD,OAAQW,QAR/C,WACI,IAAMM,ELtBW,WAAiB,IAAhB9H,EAAe,uDAAP,GAC1BH,EAAQK,IAWZ,MAAO,CAAEC,KApBa,aAoBKN,QAAOG,MAVlCA,EAAK,aACD+B,MAAO,WACPQ,eAAgB,KAChBnC,UAAWC,KAAKC,MAChBgC,kBAAmB,GACnBrB,OAAQ,GACRK,eAAgB,IACbtB,EAPF,CAQDW,GAAId,KKYWkI,GACfrE,EAASoE,KAOG,kBAACL,EAAA,EAAD,CAAOxD,UAAWR,EAAQuD,MAAO3C,QAAQ,YACrC,kBAAC,IAAD,SAIXrD,EAAKG,KAAI,SAAC4C,GAAD,OACN,kBAACwB,EAAA,EAAD,CAAM9C,IAAKsB,EAAIpD,GAAI+E,MAAI,EAACC,GAAI,GACxB,kBAAC,EAAD,CAAK5B,IAAKA,EAAKlE,MAAOkE,EAAIpD,W,8OC3C/B,YAACJ,EAAWR,GACvB,KCNW,SAACA,GAEZ,IACMiI,EADU,CAAC,MAAO,OAAQ,YAAYC,SAASlI,EAASmI,OAAgC,QAAvBnI,EAASmI,KAAK/H,KAE/E,CACIgI,WAAY,CAAEhI,KAAM,QAASiI,QAAQ,EAAMC,MAAO,oBAGtD,CACIC,MAAO,CACHnI,KAAM,WACNkI,MAAO,mBAEXF,WAAY,CACRhI,KAAM,QACNiI,QAAQ,EACRC,MAAO,oBAIrBtI,EAAQ,UAAgBiI,EAExBjI,EAASwI,SAAT,QAA+B,CAC3BC,UAAW,CAKP,CACIC,UAAW,aACXxG,MAAO,IAGfA,MAAO,ID1BPyG,CAAuB3I,GACzB,MAAO8E,IAET,IAAM/E,EAAO6I,mBAAQ5I,GAAUD,KAqB/B,OAlBAA,EAAKgC,KAAK8G,SAAQ,SAACC,GACXA,EAAEC,KAAOD,EAAEC,IAAIC,WAAW,UAC1BF,EAAEC,IAAME,oBAA+BH,EAAEC,QAKjDhJ,EAAKmJ,QAAL,uBACQnJ,EAAKmJ,SAAW,IADxB,CAEI,CACIrH,KAAM,YACNK,MAAO,CAAEH,KAAM,GAAIoH,MAAO,EAAGC,IAAK,IAAKC,SAAS,MAIxDtJ,EAAKuJ,MAAMT,SAAQ,SAACV,IAMjB,SAASoB,EAAgBpB,EAAM3H,GAClC,GAAkB,UAAd2H,EAAK/H,KAKL,YAHI+H,EAAKmB,OACLnB,EAAKmB,MAAMT,SAAQ,SAACV,GAAD,OAAUoB,EAAgBpB,EAAM3H,OAI3D,IAAMgJ,EAAsB,UAAdrB,EAAK/H,MAAoB+H,EAAKnF,MAAMkF,SAAS,YACrDuB,EAAe,sIAEbD,EAAQ,qEAAuE,IAFlE,6GAKbA,EAAQ,qEAAuE,IALlE,ybAYfE,EAAiB,uIAEfF,EAAQ,qEAAuE,IAFhE,6GAKfA,EAAQ,qEAAuE,IALhE,wbAWjBG,EAAUxB,EAAKyB,OAAOC,OAAOrJ,EAAUC,SACvCqJ,EAAgB,CAClB,CACIC,KAAMN,EACNvH,MAAO1B,EAAUE,QAErB,CACIqJ,KAAML,EACNxH,MAAO1B,EAAUG,WAMzBwH,EAAKyB,OAAOC,OAAZ,eACO1B,EAAKyB,OAAOC,OADnB,eAEKrJ,EAAUC,QAAUqJ,EAAcE,OAAOC,mBAAQN,GAAWA,EAAU,MArDvEJ,CAAgBpB,EAAM3H,MAEnBT,G,cE/BI,YAACmK,GAAqB,IAC/BC,EACAC,EAFgBC,EAAc,uDAAP,GAIrBC,EAAY,WAAc,IAAD,uBAATC,EAAS,yBAATA,EAAS,gBAC7B,IAAMhK,EAAMD,KAAKC,MAEb4J,GAAQ5J,EAAM4J,EAAOE,GACvBG,aAAaJ,GAEbA,EAAaK,YAAW,WACtBN,EAAO5J,EACP2J,EAAI,WAAJ,EAAQK,KACPF,KAEHF,EAAO5J,EACP2J,EAAI,WAAJ,EAAQK,KAIZ,OAAOD,G,uECPM,SAASI,GAAiBlD,GACrC,IAAM7D,EAAWC,cACX+G,EAAiB,CACnBC,QAAS,CAAElK,OAAQ,EAAKC,SAAU,IAClCkK,KAAM,CAAEnK,OAAQ,UAAWC,SAAU,YAEnCmK,EAAS,CACX,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEEtK,EAAYgH,EAAMuD,MAAMvK,UA5Bc,EA6BhBwK,mBAASxK,EAAUE,QA7BH,mBA6BrCA,EA7BqC,KA6B7BuK,EA7B6B,OA8BZD,mBAASxK,EAAUG,UA9BP,mBA8BrCA,EA9BqC,KA8B3BuK,EA9B2B,KAkD5C,SAASC,EAA4BC,EAAOC,GACxCJ,EAAUI,GACV1H,EAAS9C,EAAY2G,EAAMuD,MAAMnK,GAAI,CAAEJ,UAAU,eAAMA,EAAP,CAAkBE,OAAQ2K,OAE9E,SAASC,EAA8BF,EAAOC,GAC1CH,EAAYG,GACZ1H,EAAS9C,EAAY2G,EAAMuD,MAAMnK,GAAI,CAAEJ,UAAU,eAAMA,EAAP,CAAkBG,SAAU0K,OAEhF,OACI,6BACI,kBAACtF,EAAA,EAAD,CACIwF,OAAO,QACPrH,UAAWsH,KAAIC,MACfC,IAAK,GACLC,KAAM,MACNC,YAAa,SAAC9G,GAAD,OAAOA,EAAE+G,oBAEtB,kBAAC9F,EAAA,EAAD,CAAKtB,UAAWiD,IAAOoE,EAAG,GACtB,kBAACtG,EAAA,EAAD,CAAMC,WAAS,EAACsG,UAAU,SAAStI,QAAS,GACxC,kBAAC+B,EAAA,EAAD,CAAMG,MAAI,GACN,kBAACE,EAAA,EAAD,CAAYC,cAAY,GAAxB,qBAEJ,kBAACN,EAAA,EAAD,CAAMG,MAAI,GACN,kBAACE,EAAA,EAAD,CAAYvB,QAAQ,WAApB,WACA,kBAACyB,EAAA,EAAD,KACI,kBAACiG,GAAA,EAAD,CAAQ9J,MAAO1B,EAAUC,QAASoE,SA5C9D,SAA6BuG,GAEzB,IAAM3K,EAAU2K,EAAMrG,OAAO7C,MAE7B,GAAIzB,IAAYD,EAAUC,QAAS,CAC/B,IAAMwL,EAAStB,EAAelK,GAC9BwK,EAAUgB,EAAOvL,QACjBwK,EAAYe,EAAOtL,UACnBgD,EACI9C,EAAY2G,EAAMuD,MAAMnK,GAAI,CAAEJ,UAAU,aAAGC,WAAYkK,EAAelK,UAoCjDoH,OAAOqE,KAAKvB,GAAgBvJ,KAAI,SAAC6K,GAAD,OAC7B,kBAACE,GAAA,EAAD,CAAUzJ,IAAKuJ,EAAQ/J,MAAO+J,GACzBA,SAMrB,kBAACzG,EAAA,EAAD,CAAMG,MAAI,GACN,kBAACE,EAAA,EAAD,CAAYvB,QAAQ,WAApB,UACuB,YAAtB9D,EAAUC,QACP,kBAAC2L,GAAA,EAAD,CACIlK,MAAOxB,EACP2L,kBAAgB,kBAChBC,kBAAkB,OAClBC,IAAK,EACLC,IAAK,EACLC,KAAM,IACN5H,SAlDhC,SAA4BuG,EAAOC,GAC/BJ,EAAUI,IAkDkBqB,kBAAmBvB,IAGvB,kBAACpF,EAAA,EAAD,CAAK7B,UAAWsH,KAAImB,QACf7B,EAAO1J,KAAI,SAACgD,GAAD,OACR,kBAAC2B,EAAA,EAAD,CACI7B,UAAWsH,KAAIpH,MACfwI,QAASxI,EACTyI,OAAQzI,IAAU1D,EAAS,EAAI,EAC/BoM,UAAW,SAAChI,GAAD,OAAOqG,EAA4BrG,EAAGV,UAKjE,kBAACyB,EAAA,EAAD,CAAYvB,QAAQ,WAApB,YACuB,YAAtB9D,EAAUC,QACP,kBAAC2L,GAAA,EAAD,CACIlK,MAAOvB,EACP0L,kBAAgB,kBAChBC,kBAAkB,OAClBC,IAAK,EACLC,IAAK,EACLC,KAAM,IACN5H,SAvEhC,SAA8BuG,EAAOC,GACjCH,EAAYG,IAuEgBqB,kBAAmBpB,IAGvB,kBAACvF,EAAA,EAAD,CAAK7B,UAAWsH,KAAImB,QACf7B,EAAO1J,KAAI,SAACgD,GAAD,OACR,kBAAC2B,EAAA,EAAD,CACI7B,UAAWsH,KAAIpH,MACfwI,QAASxI,EACTyI,OAAQzI,IAAUzD,EAAW,EAAI,EACjCmM,UAAW,SAAChI,GAAD,OACPwG,EAA8BxG,EAAGV,e,mCCtHpE2I,GAAc,SAACjN,EAAOkN,GAC/B,MAAO,CACH5M,KAjBoB,eAkBpB4M,MAAOA,EAAM5L,KAAI,SAACgF,GAAD,sBACVA,EADU,CAEb/F,UAAWC,KAAKC,MAChBT,QACAc,GAAIT,EAAS,gBASZ8M,GAAa,SAACzG,GACvB,MAAO,CACHpG,KApCmB,cAqCnBoG,WAWK0G,GAAiB,SAAC1G,GAC3B,MAAO,CACHpG,KAhDuB,kBAiDvBoG,WAYK2G,GAAWpM,aACpB,SAACC,GAAD,OAAWA,EAAMgM,SACjB,SAAC7L,EAAGrB,GAAJ,OAAcA,KACd,SAACkN,EAAOlN,GAAR,OAAkB+H,OAAOuF,YAAYvF,OAAOwF,QAAQL,GAAOM,QAAO,oDAAaxN,QAAUA,SClE9E,kBAAyFyN,GAAa,IAApG5K,EAAmG,EAAnGA,KAAM6K,EAA6F,EAA7FA,OAAQC,EAAqF,EAArFA,SAAUvN,EAA2E,EAA3EA,QAAWwN,EAAgE,EAAhEA,QAAS5F,EAAuD,EAAvDA,OAAU6F,EAA6C,EAA7CA,OAAQC,EAAqC,EAArCA,OAAQC,EAA6B,EAA7BA,OAAQC,EAAqB,EAArBA,OAC3F,MAAO,CAGHnL,KAAMA,EACNoL,WAAYP,EAAO,GACnBQ,SAAUR,EAAO,GACjBC,SAASA,EACTvN,QAASA,EAGTwN,QAASA,EACT3L,KAAM+F,EAGN6F,OAAQA,EACRC,OAAQA,EACRC,OAAQA,EACRC,OAAQA,EAGRpN,QAAQ,EACRuN,aAAa,EACbV,QAASA,IChBF,SAASW,GAAmB1G,GACvC,IAAM7D,EAAWC,cACX8E,EAAYyF,OAAOC,eACnBC,EAAM3F,EAAU4F,WAAa,EAAI5F,EAAU6F,WAAW,GAAGC,wBAA0B,KAEnFC,EAAkBjH,EAAMkH,cAAc/M,WAiG5C,OAAO0M,GAAO7G,EAAMlB,cAChB,kBAACP,EAAA,EAAD,CAAK4I,MAAO,EAAGjD,IAAK,EAAGxH,UAAWsH,KAAIoD,uBAClC,kBAAClH,EAAA,EAAD,CAAOC,UAAW,GACd,kBAACkH,GAAA,EAAD,CAAa7J,KAAK,QAAQV,QAAQ,OAAOW,WAAS,EAACgB,aAAW,sBAC1D,kBAACX,EAAA,EAAD,CAAQsG,YA7FxB,SAA2BR,GACvBA,EAAM0D,iBACN1D,EAAMS,kBAMV,SAAwBvF,EAAeyI,EAAYxG,EAAOyG,GACtD,IAAI5I,EAAO,KACX,GAAI2I,EAAWhM,OAAS,EAAG,CAEvB,IAFwB,IAAD,EACnBkM,EAAS,GACJC,EAAI,EAAGA,EAAIH,EAAWhM,OAAQmM,IACnC,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAASjM,OAAQoM,IAC7BJ,EAAWG,GAAGpH,OAAO,KAAOkH,EAASG,GAAGC,SAASH,EAAOI,KAAKL,EAASG,IAGlF,IACIrN,EADAC,EAAO,GAEXkN,EAAOpG,SAAQ,SAAUiD,GAAI,IAAD,EAIY,IAMI,GATxChK,EAAK,OAAG2M,QAAH,IAAGA,OAAH,EAAGA,EAAiB7M,KAAK0L,QAAO,SAACgC,GAAD,MACjC,CAAC,UAAW,OAAQ,SAASpH,SAASoH,EAAKlP,SAC7C,GACE0L,EAAEyD,eAAe,gBACjBzN,EAAK,OAAG2M,QAAH,IAAGA,OAAH,EAAGA,EAAiBxM,SAASqL,QAC9B,SAACI,GAAD,MAA+B,YAAX,OAAPA,QAAO,IAAPA,OAAA,EAAAA,EAASxL,UACxB,GAGG4J,EAAC,WAAD,UAAgBhK,SAAhB,aAAgB,EAAOA,OAErBC,EAAKsN,KAAKvD,EAAC,WAAD,UAAgBhK,SAAhB,aAAgB,EAAOA,QADpCC,EAAKsN,KAAKvD,EAAC,UAAChK,SAAD,aAAC,EAAOA,SAEpBC,EAAKsN,KAAKvD,EAAC,UAAChK,SAAD,aAAC,EAAOA,WAE9B,IAAM4L,EAAQ,CAAE5L,MAAK,UAAEA,SAAF,aAAE,EAAOA,OACxB0N,EAAc,CAAC7M,KAAM2D,EAAc3D,KAAM6K,OAAO,CAAChG,EAAMlB,cAAcyH,WAAYvG,EAAMlB,cAAc0H,UAAWP,SAASjG,EAAMlB,cAAcmH,SAAUvN,QAASsH,EAAMkH,cAAc9N,IAC1LwF,EAAOqJ,GAAWD,EAAa,CAAC9B,UAAQ5F,OAAO/F,GAAO,IACtD2N,QAAQC,IAAI,kBAAmBvJ,GAEnC,GAAImC,EAAMxF,OAAS,EAAG,CAAC,IAAD,IACdkM,EACAtB,EACAE,EACAD,EACAE,EACA8B,EACAC,EACAC,EAI2B,IAA3BvH,EAAM,GAAGwH,OAAOhN,QACY,MAA5BwF,EAAM,GAAGwH,OAAO,GAAG3P,MACS,MAA5BmI,EAAM,GAAGwH,OAAO,GAAG3P,MAEnBuN,EAASpF,EAAM,GAAGwH,OAAO,GAAGjO,MAC5B+L,EAAStF,EAAM,GAAGwH,OAAO,GAAGjO,MAC5B8L,EAASrF,EAAM,GAAGT,OAAO,GACzBgG,EAASvF,EAAM,GAAGT,OAAO,GACzBmH,EAAS,KAGuB,MAA5B1G,EAAM,GAAGwH,OAAO,GAAG3P,OACnBwP,EAAarH,EAAM,GAAGwH,OAAO,GAAGjO,MAChCmN,EAAS1G,EAAM,GAAGT,OAAO,IAEG,MAA5BS,EAAM,GAAGwH,OAAO,GAAG3P,OACnBwP,EAAarH,EAAM,GAAGwH,OAAO,GAAGjO,MAChCmN,EAAS,GACTY,EAAWtH,EAAM,GAAGT,OAAO,GAAG,GAC9BgI,EAAWvH,EAAM,GAAGT,OAAO,GAAG,KAGtC,IAAM0H,EAAc,CAAC7M,KAAK2D,EAAc3D,KAAM6K,OAAO,CAAChG,EAAMlB,cAAcyH,WAAYvG,EAAMlB,cAAc0H,UAAWP,SAASjG,EAAMlB,cAAcmH,SAAUvN,QAAQsH,EAAMkH,cAAc9N,IAGxLwF,EAAOqJ,GAAWD,EAFA,CAAC9B,QAAS,CAAE5L,MAAO8N,GAAc9H,OAAOmH,GACvC,CAACtB,OAAQA,EAAQC,OAAQA,EAAQC,OAAQA,EAAQC,OAAQA,IAE5E4B,QAAQC,IAAI,yBAA0BvJ,IAElC,UAAAmC,EAAM,UAAN,eAAUwH,OAAOhN,QAAS,GAAkC,OAA7B,UAAAwF,EAAM,UAAN,eAAUwH,OAAO,GAAG3P,QACnDgG,EAAI,eAAQA,EAAR,CAAc4J,WAAYJ,EAAYC,WAAUC,cACxDJ,QAAQC,IAAI,yBAA0BvJ,GAE1C,GAAa,OAATA,EAAe,CACf,IAAM2B,EAASgF,GAAYvF,EAAMyI,WAAWrP,GAAI,CAACwF,IACjDzC,EAASoE,GACTpE,EAAS4C,EAAgBwB,EAAOiF,MAAM,GAAGpM,UACtC+C,EAAS4C,EAAgB,OApFhC2J,CAAe1I,EAAMlB,cAAekB,EAAM2I,cAAe3I,EAAMe,MAAOf,EAAMwH,UAC5ErL,EAAS0C,EAAiB,OAC1B1C,EAAS8C,GAAmB,MAwFhB,UACA,kBAACnB,EAAA,EAAD,CAAQsG,YApGxB,SAA0BR,GACtBzH,EAAS8C,GAAmB,IAC5B2E,EAAM0D,iBACN1D,EAAMS,kBACNlI,EAAS0C,EAAiB,SAgGd,aAKZ,G,mCChHO+J,mBAAK,YAehB,IAdAC,EAcD,EAdCA,MACAC,EAaD,EAbCA,WAMA5H,GAOD,EAZC6H,eAYD,EAXCC,cAWD,EAVCC,UAUD,EATCC,eASD,EARCC,UAQD,EAPCjI,WAKA1F,GAED,EANC4N,KAMD,EALCC,aAKD,EAJCC,aAID,EAHCC,cAGD,EAFC/N,OACGgO,EACJ,6LAGkBpN,cACOoH,mBAAS,OAJlC,mBAIQiG,EAJR,KAIcC,EAJd,KAKOC,EAAcC,iBAAO,MACrBC,EAAUD,iBAAO,MANxB,EAO2BpG,mBAAS,GAPpC,mBAOQsG,EAPR,KAOeC,EAPf,KAQOxG,EAAQlH,aAAY,SAAC7C,GAAD,OAAWA,EAAME,OAAOoP,EAAW1P,OACvD0F,EAAgBzC,aAAY,SAAC7C,GAAD,OAAWA,EAAM8C,GAAGwC,iBAChDxG,EAAU0R,eAAV1R,MACAkE,EAAMH,aAAY,SAAC7C,GAAD,OAAWA,EAAMC,KAAKnB,MACxCyB,EAAiBsC,aAAY,SAAC7C,GAAD,OAAWA,EAAMC,KAAKnB,GAAOyB,kBAZjE,EAa2CyJ,mBAAS,IAbpD,mBAaQmF,EAbR,KAauBsB,EAbvB,OAciCzG,mBAAS,IAd1C,mBAcQgE,EAdR,KAckB0C,EAdlB,OAe2B1G,mBAAS,IAfpC,mBAeQzC,EAfR,KAeeoJ,EAff,OAgB6C3G,oBAAS,GAhBtD,mBAgBQ4G,EAhBR,KAgBwBC,EAhBxB,KAiBOC,EAAWjO,aAAY,SAAC7C,GAAD,OAAWA,EAAM8C,GAAGgO,YAG3C9E,EAAQnJ,aACV,SAAC7C,GAAD,OAAW6G,OAAOC,OAAO9G,EAAMgM,OAAOM,QAAO,SAAClH,GAAD,OAAUA,EAAKlG,UAAYoQ,EAAW1P,QACnFmR,KAEEhS,EAAOiS,mBACT,kBACIC,GAEIlH,EAAMvK,UACN0R,KAAKC,MAAMD,KAAKE,UAAUrH,EAAM/K,cAExC,CAAC+K,EAAMhL,KAAMgL,EAAMvK,YAuDvB,SAAS6R,EAAOpB,EAAMK,GAClB,GAAIL,EACkBE,EAAYmB,QAAQ9D,wBAA9BzH,MAtDhBwL,qBAAU,YACS,yCAAG,yCAAAC,EAAA,6DAGRC,EAAUN,aAAMpS,GAHR,SAIS,IAAI2S,KAAKD,GAASE,WAJ3B,cAIRC,EAJQ,gBAMOA,EAASC,WANhB,cAMRC,EANQ,OAORxB,EAAQwB,EAAOxL,OAASwL,EAAO/L,MACrCwK,EAASD,GARK,UAmBOyB,aAAU1B,EAAQiB,QAASvS,EAAM,CAAEiT,SAAS,IAnBnD,QAmBRC,EAnBQ,OAoBRhC,EAAOgC,EAAOhC,KAGdjC,EAAYjE,EAAM/K,SAAS+B,KAAKwN,eAAe,OAE/C0B,EAAKlP,KAAK,YADVkP,EAAKlP,KAAK,UAEhB2P,EAAY1C,GACZ,IACIiC,EAAKiC,gBAAgB,oBAAoB,SAAUrR,EAAMK,GACrDwN,QAAQC,IAAI9N,EAAMK,GAClBuP,EAAiBtB,EAAcnG,OAAO9H,OAG1C+O,EAAKiC,gBAAgB,eAAe,SAAUrR,EAAMK,GAChDwN,QAAQC,IAAI9N,EAAMK,GAClByP,EAASpJ,EAAMyB,OAAO9H,OAE5B,MAAOiR,IAGTjC,EAAQD,GAxCM,4CAAH,qDA0CfmC,KACD,CAACrT,IAEJwS,oBACIc,GAAQ,wBAAC,uBAAAb,EAAA,sDACLH,EAAOpB,EAAMK,GADR,2CAEN,MAWPiB,qBAAU,WACDtB,IAGDjE,EAAMsG,MAAK,SAAClN,GAAD,OAAUA,EAAK1F,UAE1BsM,EACKM,QAAO,SAAClH,GAAD,OAAUA,EAAK1F,UACtBmI,SAAQ,SAACzC,GACN6K,EAAKsC,OAAO,YAAa,CACrBnT,KAAMgG,EAAKhG,KACX2B,KAAMqE,EAAKrE,KACXD,MAAOsE,EAAKsH,QAAQ5L,MACpBuH,SAAS,EAET2G,WAAY5J,EAAK4J,YAAc,GAC/BH,SAAUzJ,EAAKyJ,UAAY,EAC3BC,SAAU1J,EAAK0J,UAAY,EAE3BnC,OAAQvH,EAAKuH,QAAU,GACvBE,OAAQzH,EAAKyH,QAAU,GACvBD,OAAQxH,EAAKwH,QAAU,CAAC,EAAG,GAC3BE,OAAQ1H,EAAK0H,QAAU,CAAC,EAAG,KAC5B6E,cAGX1B,EAAKsC,OAAO,YAAa,CAAElK,SAAS,IAASsJ,cAElD,CAAC3F,IAMJ,IAAMwG,GAAa1B,GAAmBpJ,EAAU+K,iBAAmBpD,EAAMqD,SACnEC,EACFpS,EAAeqS,QAAQ7I,EAAMnK,KAAO,IAAM4S,GAAclN,EAAxD,eAEatD,EAFb,CAGUmB,SAAU,WACV0P,YAAa,QACbC,YAAa,OACb/M,MAAO,gBANjB,eASa/D,EATb,CAUUmB,SAAU,WACV4C,MAAO,gBAGrB,OACI,kBAAC,IAAMgN,SAAP,KACI,uCAAKC,IAAK7C,GAAiBH,EAA3B,CAAyChO,MAAO2Q,IAC5C,6BACKH,GACG,kBAACS,GAAA,EAAD,CACIrI,YA1BxB,WACIiG,GAAmBD,IA0BC3L,aAAW,YAGX,kBAAC,KAAD,QAIZ,yBAAK+N,IAAK3C,IAETmC,GAAc5B,GAAkB,kBAAClH,GAAD,CAAkBK,MAAOA,IAEzDyI,GAAclN,GACX,kBAAC4H,GAAD,CACI+B,WAAYjM,EACZ0K,cAAe3D,EACfzE,cAAeA,EACf6J,cAAeA,EACf5H,MAAOA,EACPyG,SAAUA,S,SCvK5BkF,GAAgBC,OAChBC,GAAcC,OACdC,GAAkBC,OAClBC,GAAmBC,OAEjBC,GAAkBJ,GAAlBI,cACArQ,GAAY6P,GAAZ7P,QAQKsQ,GAAgB,CAACP,GAAaI,GAAkBF,GAAiBJ,GCzC/D,WAAkB,IAAjBU,EAAgB,uDAAP,GACfnQ,EAAYmQ,EAAOnE,UACnBmE,EAAOnE,UAAUoE,IACjBA,GAEN,MAAO,CACHC,gBAAiB,SAACzE,EAAD,GAAgC,IAAtB0E,EAAqB,EAArBA,eACvB,GAAwB,WAApB1E,EAAM2E,UAAwB,CAC9B,IAAMnE,EAAekE,IAAiBE,oBACtC,IAAK5E,EAAM6E,YAAY,GAAI,OAC3B,IAAMC,EAAStE,EAAauE,UAAU/E,EAAM6E,YAAY,IAClDnT,EAAOoT,EAAOE,UAEpB,GAAa,UADAF,EAAOH,UAEhB,MAAO,CACHvQ,YACA6Q,UAAU,EACV9N,MAAM,eACCzF,IAKnB,OAAO,MAEX8S,eDeiBU,CAAuB,CAAE9E,UANhC+E,6BAChBpB,GAAY3D,UACZ+D,GAAiB/D,UACjB6D,GAAgB7D,cAMH,SAASgF,KACtB,OACE,kBAAC,WAAD,KACE,kBAAC,GAAD,MAEI,SAAAC,GAAa,OACX,6BACE,kBAAC,cAAeA,GAChB,kBAAC,gBAAiBA,GAClB,kBAAC,mBAAoBA,GACrB,kBAAC,cAAeA,GAChB,kBAAC,aAAcA,GACf,kBAAC,qBAAsBA,GACvB,kBAAC,qBAAsBA,GACvB,kBAAC,uBAAwBA,GACzB,kBAAC,uBAAwBA,GACzB,kBAAC,qBAAsBA,GACvB,kBAAC,oBAAqBA,GACtB,kBAAC,mBAAoBA,OAI7B,kBAAChB,GAAD,O,kDE7BS,QACX,CACIiB,SAXD,SAAiCC,EAAcC,EAAUhF,GAC5D+E,EAAaE,kBAAiB,SAACC,GAC3B,IAAMC,EAAYD,EAAUX,YAC5B,OACkB,OAAdY,GAAsE,mBAAhDnF,EAAauE,UAAUY,GAAWhB,YAE7Da,IAMCpR,UCvCO,SAAc+C,GACzB,OACI,0BAAMtD,UAAWsH,KAAIlF,cAAe2P,kBAAiBzO,EAAMmJ,WACtDnJ,EAAM0O,YDsCf,CACIP,SArBD,SAA0BC,EAAcC,EAAUhF,GACrD+E,EAAaE,kBAAiB,SAACC,GAC3B,IAAMC,EAAYD,EAAUX,YAC5B,OAAqB,OAAdY,GAAsE,SAAhDnF,EAAauE,UAAUY,GAAWhB,YAChEa,IAkBCpR,UExCO,SAAc+C,GACzB,IAAM7D,EAAWC,cACXoJ,EAAQnJ,aAAY,SAAC7C,GAAD,OAAWA,EAAMgM,SAEvChK,EAAQwI,KAAI2K,cACV/P,EAAOoB,EAAMqJ,aAAauE,UAAU5N,EAAMwO,WAAWX,UAwB3D,OAvBIrI,EAAM5G,EAAKxF,KACPoM,EAAM5G,EAAKxF,IAAIqN,cAAajL,EAAQwI,KAAIpF,MAuB5C,0BACIlC,UAAWlB,EACXoT,YAtBR,WAEIzS,ER8BG,CACHvD,KA1CqB,gBA2CrBoG,OQhCsBJ,EAAKxF,KAC3B+C,EAASkD,GAA2B,KAoBhCwP,aAlBR,WACInJ,GAAe9G,EAAKxF,IACpB+C,EAASuJ,GAAe9G,EAAKxF,KAC7B+C,EAASkD,GAA2B,KAgBhCY,QAdR,WAGI,IAAM6O,EAAcpE,KAAKC,MAAMD,KAAKE,UAAUhM,IAC9CkQ,EAAYvI,WAAavG,EAAM2B,MAC/BmN,EAAYtI,SAAWxG,EAAM4B,IAC7BzF,EAASwC,EAAgBmQ,KASrBL,kBAAiBzO,EAAMmJ,WAEtBnJ,EAAM0O,aC9BJ,SAASK,GAAO/O,GACV5D,cAAjB,IACM9D,EAAU0R,eAAV1R,MAGA0W,GAFM3S,aAAY,SAAC7C,GAAD,OAAWA,EAAMC,KAAKnB,MAEvB+D,aAAY,SAAC7C,GAAD,OAAWA,EAAMC,KAAKnB,GAAO0C,mBAC1DiU,EAAWrF,iBAAO,MAElBP,EACiB,OAAnB2F,EACME,eAAYC,cAAc1B,oBAC1B2B,0BCxBC,SAACJ,GACZ,IAAItT,EAAS,eAAQsT,EAAetT,WAOpC,OANA2E,OAAOqE,KAAKhJ,GAAW2F,SAAQ,SAAUnG,GACT,SAAxBQ,EAAUR,GAAKtC,OACV8C,EAAUR,GAAKX,KAAKkM,oBAAoB/K,EAAUR,OAGrC,CAAED,OAAQ+T,EAAe/T,OAAQS,UAAWA,GDiB7C2T,CAAqBL,IAXZ,EAYIxL,mBAAS0L,eAAYI,kBAAkBjG,IAZ3C,mBAY3BkG,EAZ2B,KAYdC,EAZc,KAe5BlF,EAAWtK,EAAMsK,SAgBvB,OACI,kBAAC,WAAD,KACI,yBAAK5N,UAAWsH,KAAIyL,QAChB,kBAAC,KAAD,CACIF,YAAaA,EACbG,QAASvC,GACT9P,SApBhB,SAA4BkS,GACxBC,EAAeD,IAoBHI,iBAjBhB,SAA0BC,GAEtB,IAAMC,EAAiBC,aAAUH,iBAAiBJ,EAAaK,GAC/D,OAAIC,GACAL,EAAeK,GACR,WAEJ,eAWKE,WAAYC,GACZxD,IAAKyC,EACLgB,SAAU3F,ME9Cf,SAASY,GAAKlL,GACzBkI,QAAQC,IAAI,yBAEZ,IAAMhM,EAAWC,cAKjB,OAJA2O,qBAAU,WACN5O,EAASgD,GAAY,MACtB,IAGC,kBAACnB,EAAA,EAAD,CAAMC,WAAS,EAAChC,QAAS,GACrB,kBAAC+B,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAAC2Q,GAAD,CAAQzE,UAAU,M,kEChBnB,SAAS4F,GAAMlQ,GAC1B,OAAO,kBAAC,KAAD,eAAUG,UAAW,EAAGrD,QAAQ,UAAakD,I,cC4EzC4I,uBApER,SAAe5I,GAClB,IAAM7D,EAAWC,cAEXrC,GADU6P,iBAAO,MACAvN,aAAY,SAAC7C,GAAD,OAAWA,EAAMC,KAAKuG,EAAM1H,OAAOyB,mBAH7C,GAKZyQ,mBAAQ,kBAAME,KAAKC,MAAMD,KAAKE,UAAU5K,EAAMzH,SAAQ,CAACyH,EAAMzH,OAE1CiL,mBAAS,OAPhB,mBAOlB2M,EAPkB,KAORC,EAPQ,OAcC5M,oBAAS,GAdV,mBAclB6M,EAdkB,KAcXC,EAdW,KA4BzB,OACI,kBAACpQ,EAAA,EAAD,CACIxD,UAAWsH,KAAI/F,UACfsS,UAVR,SAAwB3M,GxBJD,IAAClL,EAASD,EwBKX,WAAdmL,EAAM1I,MACDnB,EAAe2G,SAASV,EAAM5G,IAE9BgX,EAAY,yDADbjU,GxBPYzD,EwBOSsH,EAAM5G,GxBPNX,EwBOU,CAAEH,MAAO0H,EAAM1H,OxBNnD,CACHM,KAvBoB,eAwBpBF,UACAD,awBWI+X,SAAS,IACTrQ,UAAWkQ,EAAQ,EAAI,GAEvB,yBACII,WAAW,EACXC,YA5BZ,SAAyBpT,GACrB4K,QAAQC,IAAI,kBAAmBnI,GAC/B1C,EAAEqT,aAAaC,QAAQ,UAAW5Q,EAAM5G,KA2BhCyX,aAvBZ,WACIP,GAAS,IAuBDzB,aArBZ,WACIyB,GAAS,KAsBD,kBAACQ,GAAA,EAAD,CAAQC,IAAK/Q,EAAM9F,UAAW4C,QAAQ,UAAUtB,MAAO,CAAEsE,OAAQ,QAASP,MAAO,YAGrF,kBAACyR,GAAA,EAAD,CACIC,KAAmB,OAAbd,EACNe,aAAc,CACVC,SAAU,SACVC,WAAY,QAEhBC,iBAAkB,IAClBC,QAAS,WACLlB,EAAY,QAGhB,kBAAC,GAAD,CAAOmB,SAAS,SAASpB,QCtD1B,gD,gDAAA,WAAgB5X,GAAhB,wEAAAyS,EAAA,yDACNzS,EAAKgC,KADC,yCAEA,IAFA,cAILiX,EAAa,GACbvG,EAAUN,aAAMpS,GALX,SAMQ,IAAI2S,KAAKD,GAASE,WAN1B,OAML1B,EANK,OAOLjQ,EAAQiQ,EAAKgI,SAAS,CACxBlX,KAAMmX,UACNhQ,QAASiQ,SACTC,SAAS,IAVF,+BAcQrZ,EAAKuJ,MAdb,mEAcAnB,EAdA,QAgBDpG,EAAOf,EAAMe,KAAKoG,EAAKtG,MAAMT,KAAI,SAAC0H,GAAD,OAAOA,EAAEuQ,SAhBzC,+BAkBatX,EAlBb,mEAkBIsX,EAlBJ,QAmBG7P,EAAsB,UAAdrB,EAAK/H,MAAoB+H,EAAKnF,MAAMkF,SAAS,YACvDmF,EAAUxF,OAAOwF,QAAQgM,GACzB7P,IAEA6D,EAAUA,EAAQrD,OAAOnC,OAAOwF,QAAQgM,EAAM1X,cAvB/C,+BAyB0B0L,EAzB1B,+FAyBSvL,EAzBT,KAyBgBI,EAzBhB,KA0BMoX,oBAASpX,GA1Bf,wDA8BC8W,EAAW9W,GAAS,CAChBA,QACA9B,KAAM,SACN0B,QACAC,KAAMsX,EAAMxX,MAlCjB,oyBA2CX9B,EAAKgC,KAAK8G,SAAQ,SAACwQ,GAEEpI,EAAKlP,KAAKsX,EAAMxX,SAI/B0X,EAAUC,GAAiBzZ,GACjCA,EAAK0Z,OACAnM,QAAO,SAACoM,GAAD,MAAW,CAAC,UAAW,OAAQ,SAASxR,SAASwR,EAAMtZ,SAC9DyI,SAAQ,SAAC6Q,GAEN3Z,EAAKgC,KAAK8G,SAAQ,SAACwQ,GAEEpI,EAAKlP,KAAKsX,EAAMxX,MACxBgH,SAAQ,SAAC8Q,GAGd,GAAID,EAAME,OAAO9X,MAAO,CACpB,IAAMA,EAAQ4X,EAAME,OAAO9X,MACrBI,EAAQ2X,kBAAOF,EAAI7X,IAAU6X,EAAI7X,GAASgY,oBAASH,EAAI7X,IACvD1B,EAAOyZ,kBAAO3X,GAAS,OAAS,SACtC8W,EAAW9W,GAAS,CAChBA,QACA9B,OACA0B,QACAC,KAAMsX,EAAMxX,WAET6X,EAAME,OAAO7J,QAEpB2J,EAAME,OAAO7J,OAAOlH,SAAQ,SAACC,GACzB,IAAMhH,EAAQwX,oBAASxQ,GAAKA,EAAIA,EAAEhH,MAC5BI,EAAQ2X,kBAAOF,EAAI7X,IAAU6X,EAAI7X,GAASgY,oBAASH,EAAI7X,IACvD1B,EAAOyZ,kBAAO3X,GAAS,OAAS,SACtC8W,EAAW9W,GAAS,CAChBA,QACA9B,OACA0B,QACAC,KAAMsX,EAAMxX,eAM5BoI,mBAAQyP,EAAME,SAEdF,EAAME,OAAO/Q,SAAQ,SAAC3G,GAClBA,EAAQ2X,kBAAO3X,GAASA,EAAQ4X,oBAAS5X,GACzC,IAAM9B,EAAOyZ,kBAAO3X,GAAS,OAAS,SAChCJ,EAAQiY,GAAgBha,EAAM2Z,EAAM7X,MAC1CmX,EAAW9W,GAAS,CAChBA,QACA9B,OACA0B,QACAC,KAAM,YAKpBJ,EAAa,CAAEC,KAAMiG,OAAOC,OAAOyR,GAAUtX,SAAU4F,OAAOC,OAAOkR,IArGhE,kBAsGJrX,GAtGI,kI,sBAyGR,IAAMoY,GAAkB,SAACha,EAAMia,GAAe,IAAD,uBAChD,YAAmBja,EAAKuJ,MAAxB,+CAA+B,CAAC,IAArBnB,EAAoB,QAC3B,GAAIA,EAAKyB,OAAOqQ,MACZ,cAAwBpS,OAAOwF,QAAQlF,EAAKyB,OAAOqQ,OAAnD,eAA2D,CAAC,IAA9CzS,EAA6C,uBACvD,GAAIA,EAAMkS,QAAUM,GAAaxS,EAAM1F,MACnC,OAAO0F,EAAM1F,MAIzB,GAAIqG,EAAKyB,OAAOC,OACZ,cAAwBhC,OAAOwF,QAAQlF,EAAKyB,OAAOC,QAAnD,eAA4D,CAAC,IAA/CrC,EAA8C,uBACxD,GAAIA,EAAMkS,QAAUM,GAAaxS,EAAM1F,MACnC,OAAO0F,EAAM1F,QAZmB,kFAiBhD,OAAO,MAGE0X,GAAmB,SAACzZ,GAC7B,IAAIwZ,EAAU,GA8Bd,OA7BAxZ,EAAK0Z,OAAO5Q,SAAQ,SAAC6Q,GAEjB,IAAM7X,EAAO6X,EAAM7X,KACbC,EAEFmI,mBAAQyP,EAAME,OAAO7J,SAAW2J,EAAME,OAAO7J,OAAO,GAAGR,eAAe,SAChEmK,EAAME,OAAO7J,OAAO,GAAGjO,MAEzBmI,mBAAQyP,EAAME,OAAO7J,QACnB2J,EAAME,OAAO7J,OACb2J,EAAME,OAAO9X,MACjBC,EAAO2X,EAAME,OAAO7X,KACpB3B,EAAOsZ,EAAMtZ,KAEb8Z,EAAcna,EAAK6B,KACnB7B,EAAK6B,KAAK0L,QAAO,SAACgC,GACd,OAAQA,EAAKoK,QAAU7X,QAAuBsY,IAAf7K,EAAKtN,OAAwB,aAEhEmY,EACAnY,EACFiI,mBAAQiQ,IAAgBA,EAAYnX,OAAS,GAAKmX,EAAY,GAAG3K,eAAe,SAC1E2K,EAAY,GAAGlY,MACfF,QAEAqY,EAEJ7K,EAAO,CAAEzN,KAAMA,EAAMC,MAAOA,EAAOC,KAAMA,EAAM3B,KAAMA,EAAM4B,MAAOA,GACxEuX,EAAQ1X,GAAQyN,KAEbiK,GCrKX,4CAAe,WAAOxZ,GAAP,sBAAAyS,EAAA,6DAELC,EAAUN,aAAMpS,GAFX,SAGQ,IAAI2S,KAAKD,GAASE,WAH1B,cAGL1B,EAHK,gBAKOA,EAAKmJ,WAAW,OALvB,cAKLC,EALK,gBAOWhI,GAAOgI,GAPlB,cAOLC,EAPK,yBAQJA,GARI,4CAAf,sDAWA,SAASjI,GAAOkI,GACZ,OAAO,IAAIC,SAAQ,SAACC,EAASC,GACzB,IAAML,EAAM,IAAIM,MAChBN,EAAI9B,IAAMgC,EACVF,EAAIO,OAAS,WAET,IACM7T,EAnBO,IAmBWsT,EAAI/S,OAAU+S,EAAItT,MACpC+L,EAAS+H,SAASC,cAAc,UAClCC,EAAMjI,EAAOkI,WAAW,MAE5BlI,EAAO/L,MAAQA,EACf+L,EAAOxL,OAxBM,IA0BbyT,EAAIE,UAAUC,KAAM,EAAG,EAAGnU,EA1Bb,KA6Bb0T,EAAQ3H,EAAOqI,iBCpBZ,SAASC,GAAa5T,GACjC,IAAM7D,EAAWC,cACX9D,EAAU0R,eAAV1R,MAFkC,EAGRkL,oBAAS,GAHD,mBAGjCqQ,EAHiC,KAGvBC,EAHuB,OAIRtQ,mBAAS,MAJD,mBAIjC2M,EAJiC,KAIvBC,EAJuB,KAMlC1W,EAAS2C,aAAY,SAAC7C,GAAD,OAAWF,EAAUE,EAAOlB,MAyDvD,OACI,yBACIoE,UAAWsH,KAAI/F,UACf8V,YA1DR,WACID,GAAY,IA0DRE,YAxDR,WACIF,GAAY,IAwDRG,WAtDR,SAAwB3W,GACpBA,EAAEgK,iBACFhK,EAAE+G,mBAqDE6P,OAlDR,SAAoB5W,GAChBA,EAAEgK,iBACFhK,EAAE+G,kBAEF,IAAI8P,EAAO7W,EAAEqT,aAAayD,MAAM,GAChC,GAAKD,EAAL,CAQA,GAAIA,EAAKvb,KAAKyb,MAAM,oBAAqB,CACrC,IAAMC,EAAS,IAAIC,WAGnBD,EAAOlB,OAAP,yCAAgB,WAAO9V,GAAP,sBAAA0N,EAAA,sEAEFxS,EAAWkS,KAAKC,MAAMrN,EAAEC,OAAOkO,SAC/BlT,EAAO6I,mBAAQ5I,GAAUD,MAG1BgC,KAAK8G,SAAQ,SAACC,GACXA,EAAEC,KAAOD,EAAEC,IAAIC,WAAW,UAC1BF,EAAEC,IAAME,oBAA+BH,EAAEC,QARzC,SAWgBiT,GAAgBjc,GAXhC,cAWF2B,EAXE,gBAaiBua,GAAqBlc,GAbtC,OAaF4B,EAbE,OAcRgC,EAAS9D,EAAYC,EAAOC,EAAMC,EAAU,CAAE2B,aAAYD,eAdlD,kDAgBRkW,EAAY,uCAhBJ,0DAAhB,sDAoBAkE,EAAOI,WAAWP,QAElB/D,EAAY,iBAEhB0D,GAAY,MAWR,kBAAC9C,GAAA,EAAD,CACIC,KAAmB,OAAbd,EACNe,aAAc,CACVC,SAAU,SACVC,WAAY,QAEhBC,iBAAkB,IAClBC,QAAS,WACLlB,EAAY,QAGhB,kBAAC,GAAD,CAAOmB,SAAS,SAASpB,IAG7B,yBAAKzT,UAAWsH,KAAI2Q,aAAcnZ,MAAO,CAAE4H,QAASyQ,EAAW,GAAM,IAArE,uBAGCna,EAAOE,KAAI,SAAC2J,GAAD,OACR,kBAAC,GAAD,CAAOrI,IAAKqI,EAAMnK,GAAId,MAAOA,EAAOc,GAAImK,EAAMnK,GAAIb,KAAMgL,EAAMhL,KAAM2B,UAAWqJ,EAAMrJ,gB,qHChFtF,SAAS0a,GAAgB5U,GACpC,IAAM7D,EAAWC,cACX8E,EAAYyF,OAAOC,eACnBC,EAAM3F,EAAU4F,WAAa,EAAI5F,EAAU6F,WAAW,GAAGC,wBAA0B,KAIzF,SAAS6N,EAAYC,EAAYlR,GAC7BA,EAAM0D,iBACN1D,EAAMS,kBACNrE,EAAM+U,WAAWD,GAOrB,OAAOjO,EACH,kBAACtI,EAAA,EAAD,CACIwF,OAAO,QACPI,KAAM0C,EAAImO,EAfF,GAgBR9Q,IAAK2C,EAAIoO,EAhBD,GAiBRvY,UAAWsH,KAAIkR,iBAEf,kBAAChV,EAAA,EAAD,KAEI,kBAACiV,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAU9V,QAAM,EAAC8E,YAdjC,WACIpE,EAAMqV,qBACNlZ,EAAS0C,EAAiBmB,EAAMlB,kBAkBhB,kBAACwW,GAAA,EAAD,KACI,kBAAC,KAAD,OAPR,eAcItV,EAAMuV,YAAYC,MAAM,EA1CvB,GA0C4C5b,KAAI,SAACkb,EAAYpN,GAAb,OAC7C,kBAAC0N,GAAA,EAAD,CACIla,IAAKwM,EACLpI,QAAM,EACNmW,OAAK,EACLrR,YAAayQ,EAAYa,KAAK,KAAMZ,IAEpC,kBAACa,GAAA,EAAD,KACI,kBAAC7E,GAAA,EAAD,CAAQ8E,IAAI,QAAQ7E,IAAK+D,EAAW5a,aAExC,kBAAC2b,GAAA,EAAD,CACIC,QAAShB,EAAW3Z,KACpB0E,UACI,kBAACxB,EAAA,EAAD,CAAYpB,UAAU,OAAOH,QAAQ,UAAUF,MAAM,iBAChDkY,EAAWpc,kBAWhD,G,yBC3EO,SAASqd,GAAsB/V,GAC1C,IAAM7D,EAAWC,cACX8E,EAAYyF,OAAOC,eACnBC,EAAM3F,EAAU4F,WAAa,EAAI5F,EAAU6F,WAAW,GAAGC,wBAA0B,KAiBzF,OAAOH,GAAO7G,EAAMgW,eAAiBhW,EAAMgW,aAAavP,cAAgBzG,EAAMlB,cAC1E,kBAACP,EAAA,EAAD,CACIwF,OAAO,QACPI,KAAM0C,EAAImO,EAnBF,GAoBR9Q,IAAK2C,EAAIoO,EApBD,GAqBRvY,UAAWsH,KAAIoD,uBAEf,kBAAClH,EAAA,EAAD,CAAOC,UAAW,GACd,kBAACkH,GAAA,EAAD,CAAa7J,KAAK,QAAQV,QAAQ,OAAOW,WAAS,EAACgB,aAAW,sBAC1D,kBAACX,EAAA,EAAD,CAAQsG,YAjBxB,SAA2BR,GACvBA,EAAM0D,iBACN1D,EAAMS,kBAENlI,ElBkCG,CACHvD,KArDoB,eAsDpBoG,OkBpCqBgB,EAAMgW,aAAa5c,KACxC4G,EAAMiW,SAASjW,EAAMgW,cACrB7Z,EAASwC,EAAgB,SAWb,UACA,kBAACb,EAAA,EAAD,CAAQsG,YAxBxB,SAA4BR,GACxBA,EAAM0D,iBACN1D,EAAMS,kBACNrE,EAAMkW,UAAUlW,EAAMgW,cACtB7Z,EAASwC,EAAgB,SAoBb,cAKZ,GC/CO,gBAACjF,EAAQyc,EAAa5P,GAAgB,IAAD,EAChD,OAA8B,IAAvB4P,EAAY5a,OACb,IACA,MAAGiH,OAAH,qBACO9I,EAAOE,KAAI,SAAC2J,GAAD,OACVA,EAAMpJ,WAAWM,SACZqL,QAAO,SAACxE,GACL,MAAe,WAAXA,EAAE1I,MAAqB0I,EAAE5G,MAClB4G,EAAE5G,MAAM0b,cAAc5U,WAAW2U,EAAYC,eAClC,SAAX9U,EAAE1I,MAEF0I,EAAE5G,MACJ4X,WACA8D,cACA1V,SAASyV,EAAYC,kBAIjCxc,KAAI,SAAC0H,GAAD,MAAQ,CACT5I,QAAS6K,EAAMnK,GACfc,UAAWqJ,EAAMrJ,UACjBgM,QAAS5E,EACTnG,KAAMmG,EAAE5G,MAAM4X,WACd/L,uB,oBCtBpB8P,GAAUC,EAAQ,KAExB,4CAAe,WAAOC,EAAUC,EAAgB9c,EAAQuM,GAAzC,oBAAA+E,EAAA,6DAELyL,EAAU,CACZC,IAAK,gDACLC,OAAQ,OACRC,QAAS,CACLC,OAAQ,mBACR,iBAAkB,SAEtBC,MAAM,EACNC,KATY,CAAE5b,KAAMob,EAAUC,iBAAgB9c,OAAQA,EAAQuM,aAY5D+Q,EAAiBC,KAAKC,UAAUb,IAb3B,SAcYW,EAAeP,GAd3B,cAcLU,EAdK,yBAeJA,EAASJ,KAAKxc,MAfV,2CAAf,4DCHe,YAACgV,GACZ,IAAM6H,EAAiB7H,EAAY9B,oBAC7B4J,EAAmB9H,EAAY3I,eAC/BX,EAAWoR,EAAiBpL,eAC5BqL,EAAeF,EAAeG,eAAetR,GAC7CuR,EAAcH,EAAiBI,kBAC/BC,EAAuBJ,EAAaK,UAAUC,OAAO,EAAGJ,GACxD5V,EAAMyV,EAAiBI,kBAEvBI,EAAWH,EAAqBI,MAAM,KAAKtC,OAAO,GAAGuC,MAE3D,MAAO,CACH5c,KAAM0c,EACNtR,WAHU3E,EAAMiW,EAAStc,OAIzBiL,SAAU5E,ICZH,YAAC4D,EAAO+J,GAInB,OAHA/J,EAAMnE,SAAQ,SAACzC,GACX2Q,EAAcyI,GAAWpZ,EAAM2Q,MAE5BA,GAEEyI,GAAa,SAACpZ,EAAM2Q,GAE7B,IAAM6H,EAAiB7H,EAAY9B,oBAC7B4J,EAAmB9H,EAAY3I,eAC/BqR,EAAiBZ,EAAiBpL,eAClCiM,EAAsBb,EAAiBI,kBAEzC9V,EAAQ/C,EAAK2H,WACb3E,EAAMhD,EAAK4H,SACX7E,EAAQ,IAAGA,EAAQ,GAEvB,IAAIwW,EAAaf,EAAegB,aAAf,OAAoC,UAApC,eACVxZ,IAED4P,EAAY2J,EAAWE,0BAEvBC,EAAsBjB,EAAiBkB,MAAM,CAC/CC,UAAW5Z,EAAKqH,SAChBwS,SAAU7Z,EAAKqH,SACfyS,aAAc/W,EACdgX,YAAa/W,IAGXgX,EAA6BrJ,EAAY3I,eAAe2R,MAAM,CAChEG,aAAcG,GAAiBtJ,GAAahJ,aAGhD4R,EAAaW,YAASC,YAClBxJ,EAAY9B,oBACM,OAAd,OAAJ7O,QAAI,IAAJA,OAAA,EAAAA,EAAMmH,SAAkB6S,EAA4BN,EACpD1Z,EAAKzD,KACLoU,EAAYyJ,wBACZxK,GAIJ,IAAMyK,EAAgBrX,EAAMsW,EAAsBtW,EAAMsW,EACpDrI,EAAiBX,eAAYrH,KAAK0H,EAAa4I,EAAY,qBAC3De,EAAerJ,EAAejJ,eAAe2R,MAAM,CACnDC,UAAWP,EACXQ,SAAUR,EACVU,YAAaM,EACbP,aAAcO,IAIlB,OAFApJ,EAAiBX,eAAYiK,mBAAmBtJ,GAChDA,EAAiBX,eAAYhG,eAAe2G,EAAgBqJ,ICnDjD,YAACE,EAAuB7J,GACnC,GAAK6J,EAAL,CACA,IAAMC,EAAsB9J,EAAY9B,oBAElC6L,EAAkBR,YAASS,YAAYF,EAAqBD,EAAuB,MACrFvJ,EAAiBX,eAAYrH,KAAK0H,EAAa+J,EAAiB,gBAE9DE,EAAmBC,KAAKzU,IAC1BoU,EAAsB3B,kBACtB2B,EAAsBM,kBAGpBR,EAAerJ,EAAejJ,eAAe2R,MAAM,CACrDI,YAAaa,EACbd,aAAcc,IAKlB,OAHA3J,EAAiBX,eAAYiK,mBAAmBtJ,GAChDA,EAAiBX,eAAYhG,eAAe2G,EAAgBqJ,KCnBjD,YAAC3J,GACZ,IAAM6H,EAAiB7H,EAAY9B,oBAE7BxH,EADmBsJ,EAAY3I,eACHqF,eAIlC,MAAO,CAAC0N,UAHavC,EAAeG,eAAetR,GACpB0R,UAEZ1R,aCPR,YAAC+I,EAAgB4K,EAA4BD,GACxD,IAAMje,EAAS,eAAQsT,EAAetT,WAgBtC,OAfAke,EAA6BA,EAA2B9T,QAAO,SAAC+T,GAC5D,IAAIC,GAAa,EAYjB,OAXAzZ,OAAOqE,KAAKhJ,GAAW2F,SAAQ,SAAUnG,GACT,SAAxBQ,EAAUR,GAAKtC,MAEX8C,EAAUR,GAAKX,KAAKkM,aACpB/K,EAAUR,GAAKX,KAAKY,QAApB,OAA6B0e,QAA7B,IAA6BA,OAA7B,EAA6BA,EAAwB1e,OACrDwe,EAAUjZ,SAAShF,EAAUR,GAAKX,KAAKY,QAEvC2e,GAAa,MAIlBA,M,UC8BA,SAASC,GAAO/Z,GAC3B,IAAM7D,EAAWC,cACX9D,EAAU0R,eAAV1R,MACAkE,EAAMH,aAAY,SAAC7C,GAAD,OAAWA,EAAMC,KAAKnB,MACxCoB,EAAS2C,aAAY,SAAC7C,GAAD,OAAWF,EAAUE,EAAOlB,MACjD0hB,EAAoB3d,aAAY,SAAC7C,GAAD,OAAWA,EAAMC,KAAKnB,GAAO0C,kBAC7DjB,EAAiBsC,aAAY,SAAC7C,GAAD,OAAWM,EAAkBN,EAAOlB,MACjE0d,EAAe3Z,aAAY,SAAC7C,GAAD,OAAWA,EAAM8C,GAAG0Z,gBAC/CiE,EAAW5d,aAAY,SAAC7C,GAAD,OAAWmM,GAASnM,EAAMlB,MACjD4hB,EAAiB7d,aAAY,SAAC7C,GAAD,OAAWA,EAAM8C,GAAG4d,kBACjDC,EAAe9d,aAAY,SAAC7C,GAAD,OAAWA,EAAM8C,GAAG6d,gBAC/CC,EAA0B/d,aAAY,SAAC7C,GAAD,OAAWA,EAAM8C,GAAG8d,2BAC1DC,EAAuBhe,aAAY,SAAC7C,GAAD,OAAWA,EAAM8C,GAAGwC,iBAZ3B,EAcgB0E,mBAAS6W,GAdzB,mBAc3BC,EAd2B,KAcRC,EAdQ,KAe5BtL,EAAWrF,iBAAO,MAfU,EAgBIpG,mBAAS,IAhBb,mBAgB3B+R,EAhB2B,KAgBdiF,EAhBc,KAiB5BC,EAA2Bpe,aAAY,SAAC7C,GAAD,OAAWA,EAAMC,KAAKnB,GAAOyC,qBAEpEsO,EACoB,OAAtB2Q,EACM9K,eAAYC,cAAc1B,oBAC1B2B,0BAAe4K,GAtBS,EAuBIxW,mBAAS0L,eAAYI,kBAAkBjG,IAvB3C,mBAuB3BkG,EAvB2B,KAuBdC,EAvBc,OAwBwBhM,mBAAS,MAxBjC,mBAwB3B4V,EAxB2B,KAwBJsB,EAxBI,OAyBMlX,mBAAS,MAzBf,mBAyB3B8T,EAzB2B,KAyBbqD,EAzBa,OA0BJnX,mBAAS,MA1BL,mBA0B3BoX,EA1B2B,KA0BlBC,EA1BkB,QA2BgBrX,mBAAS,IA3BzB,qBA2B3BsX,GA3B2B,MA2BRC,GA3BQ,MA6B9BC,GAAWpR,mBAoTf,SAASqR,GAAqB1L,GAC1B,IAAMvU,EAAiBkgB,wBAAa3L,EAAY9B,qBAC1C4J,EAAmB9H,EAAY3I,eAC/BuU,EAAS9D,EAAiBpL,eAC1BmP,EAAcpgB,EAAeC,OAAOogB,MAAK,qBAAEngB,MAAeigB,KAC1DlC,EAAgB5B,EAAiBI,kBAEvC,OADyB2D,EAAY3f,aAAa4f,MAAK,SAAAC,GAAE,OAAKrC,GAAiBqC,EAAGhgB,QAAU2d,GAAiBqC,EAAGhgB,OAASggB,EAAG/f,UAkBhI,OAjUAwP,qBAAU,WAMN,OALA5O,EAAS8C,GAAmB,IAC5Byb,EAAyB,MACzBve,EAAS0C,EAAiB,OAC1B1C,EAAS4C,EAAgB,OAZzBic,GAAWO,aAAY,WAAO,IAAD,IACzBrT,QAAQC,IAAI,sCAnCa,MAoCzB,OAAI8G,QAAJ,IAAIA,OAAJ,YAAIA,EAAUnE,eAAd,uBAAI,EAAmB9K,aAAvB,aAAI,EAA0BuP,cAC1BoL,EAAgBa,GAAavM,EAASnE,QAAQ9K,MAAMuP,gBArC/B,KAgDtB,kBAAMkM,cAAcT,GAASlQ,YACrC,IAEHC,qBAAU,WACFmP,IACA1K,EAAekM,GAAyBtC,EAAuB7J,IAC/DN,EAASnE,QAAQ6Q,QACjBxf,EAAS8C,GAAmB,IAC5Byb,EAAyB,MAEzB/T,OAAOiV,cAAc,IAAIC,cAAc,WAAY,CAAE3gB,IAAK,UAE/D,CAACgf,IAEJnP,qBAAU,WACFmP,QAA6CvH,IAA3BsH,EAASE,KAE3B3K,EAAekM,GAAyBtC,EAAuB7J,IAC/DmL,EAAyB,OAEzBT,EAASE,KACT3K,EACIsM,GAAY,CAAC7B,EAASE,IAAgB5K,IAE1CpT,EAAS4C,EAAgB,OACzB2b,EAAyB,MAEzB/T,OAAOiV,cAAc,IAAIC,cAAc,WAAY,CAAE3gB,IAAK,UAE/D,CAACif,EAAcD,IAElBnP,qBAAU,WACN,IAAM/P,EAAiBkgB,wBAAa3L,EAAY9B,qBAChDtR,EAAStB,EAAU2B,EAAIpD,GAAI,CAAE4B,sBAC9B,CAACuU,IAEJxE,qBAAU,WACN,IAAMrP,EAAYwf,wBAAa3L,EAAY9B,qBAAqB/R,UAC5DqgB,EAAgB,GACpB1b,OAAOqE,KAAKhJ,GAAW2F,SAAQ,SAASnG,GACT,SAAxBQ,EAAUR,GAAKtC,MACXqhB,EAASve,EAAUR,GAAKX,KAAKnB,KAC5B2iB,EAAclU,KAAKnM,EAAUR,GAAKX,KAAKnB,OAInDiH,OAAOqE,KAAKuV,GAAU5Y,SAAQ,SAASnG,GAC9B6gB,EAAcrb,SAASxF,IACxBiB,EAASsJ,GAAWvK,SAI9B,CAACmF,OAAOqE,KAAKwW,wBAAa3L,EAAY9B,qBAAqB/R,WAAWH,SAExEwP,qBAAU,YACS,yCAAG,6CAAAC,EAAA,yDACO,OAAjBsM,EADU,oBAEJqC,EAAYrC,EAAaqC,WAC3BS,EAHM,qDAINpE,EAJM,qDAKNsE,GAA0C,WAArBA,EALf,kEAMc0B,aAAIrC,GAAWsC,YAAYnF,OANzC,QAMJmF,EANI,OAONrC,EAA6B,GAC7B7e,EAAoB,GACf2M,EAAI,EATH,aASMA,EAAIuU,EAAU1gB,QATpB,qBAUEJ,EAAS8gB,EAAUvU,GAAnBvM,MACEuF,SAAS,KAXb,oEAYF+Z,QAZE,IAYFA,OAZE,EAYFA,EAA0B/Z,SAASvF,IAZjC,+DAaNJ,EAAkB8M,KAAK1M,GAEjB+gB,EAAiB,CACnB/gB,KAAMA,EACNoL,WAAYoT,EAAUvN,QAAQjR,GAC9BqL,SAAUmT,EAAUvN,QAAQjR,GAAQA,EAAKI,QAlBvC,UAoBc4gB,GAAYD,EAAe/gB,KAAM+gB,EAAe3V,WAAYxM,EAAgBud,EAAarR,UApBvG,QAoBAT,EApBA,OAqBNoU,EAA6BA,EAA2BpX,OAAOgD,GArBzD,QAS4BkC,IAT5B,wBAuBVvL,EACItB,EAAU2B,EAAIpD,GAAI,CACd2B,kBAAiB,OAAE0f,QAAF,IAAEA,OAAF,EAAEA,EAA0BjY,OAAOzH,MAGxD6e,EAA2Bre,OAAS,IAC9ByT,EAAiBkM,wBAAa3L,EAAY9B,sBAChDmM,EAA6BwC,GACzBpN,EACA4K,EACAD,IAE2Bpe,OAAS,GACpCwf,GAAqBnB,IAG7Be,EAAgB,MAvCN,4CAAH,qDA0Cf/O,KACD,CAAC0L,IA0NA,kBAAC,WAAD,KACK,kBAACrJ,GAAD,MACD,yBAAKvR,UAAWsH,KAAIqY,OAAQpI,WA1GpC,SAAwB3W,GAEpBA,EAAEgK,iBACFhK,EAAE+G,kBACF4K,EAASnE,QAAQ6Q,SAsG2CzH,OAjGhE,SAAoB5W,GAChBA,EAAEgK,iBACFhK,EAAE+G,kBACF,IAAM3L,EAAU4E,EAAEqT,aAAa9C,QAAQ,WACjCtK,EAAQ7J,EAAO2hB,MAAK,SAAC/Z,GAAD,OAAOA,EAAElI,KAAOV,KACpC4jB,EAASviB,EAAeshB,MAAK,SAAC/Z,GAAD,OAAOA,EAAElI,KAAOV,KAC/C6K,IAAU+Y,KAMlB,SAAqB/Y,GACjB,IAAI8F,EAAekG,EAAY9B,oBAKzBe,GAHNnF,EAAeA,EAAa+O,aAAa,QAAS,YAAa,CAC3Dhf,GAAImK,EAAMnK,MAEiBif,0BACzBxI,EAAiB0M,oBAAiBC,kBAAkBjN,EAAaf,EAAW,KAClFgB,EAAeK,GAbX4M,CAAYlZ,GACZjG,EAAEqT,aAAa+L,eA0FX,kBAAC,KAAD,aACInN,YAAaA,EACbG,QAASvC,GACT9P,SA9NhB,SAA4BkS,GAExB,GADAC,EAAeD,GACZuL,GAAkBvf,OAAO,EAAE,CAC1B,IAAMgF,EAASgF,GAAY/I,EAAIpD,GAAI0hB,IACnCtL,EAAesM,GAAYvb,EAAOiF,MAAO+J,IACzCpT,EAASoE,GAETwa,GAAqB,IAGzB,IAAM/f,EAAiBkgB,wBAAa3L,EAAY9B,qBAC1CkP,EAAgB9D,GAAiBtJ,GAEjCqN,EAAUrN,EAAY9B,oBAAoBoP,aAAa,KAAKC,OAC5DC,EAAwB,OAAGtC,QAAH,IAAGA,OAAH,EAAGA,EAA0B3U,QACvD,SAACkX,GAAD,OAA6BJ,EAAQlc,SAASsc,MASlD,GAPA7gB,EACItB,EAAU2B,EAAIpD,GAAI,CACd2B,kBAAmBgiB,KAKvBJ,EAAcxhB,KAAKqG,WAAW,KAAM,CACpC,IAAM+T,EAAc0H,GAChBljB,EACA4iB,EAAcxhB,KAAKqa,MAAM,GACzBmH,EAAcpW,YAGlBiU,EAAejF,QAEfiF,EAAe,IAInB,IAAM9e,EAAYV,EAAeU,UAEjC,GADkB2E,OAAOqE,KAAKhJ,GAAWH,SACvBxB,EAAewB,OAAQ,CACrC,IAAM2hB,EAAM7c,OAAOC,OAAO5E,GAAWyhB,QAAO,SAACC,EAAKzP,GAI9C,MAHoB,UAAhBA,EAAO/U,MACPwkB,EAAIvV,KAAK8F,EAAOpT,KAAKnB,IAElBgkB,IACR,IACHjhB,EpCxMwB,SAAC7D,EAAOoB,GACxC,MAAO,CAAEd,KA9B0B,0BA8BKN,QAAOoB,UoCuM9B2jB,CAAqB7gB,EAAIpD,GAAI8jB,IAG1C,IAAM7F,EAAmB9H,EAAY3I,eAC/BqS,EAAgB5B,EAAiBI,kBACjCQ,EAAiBZ,EAAiBpL,eAGpC+J,GAAgBiC,IAEZA,IAAmBjC,EAAa/P,UAChCgT,EAAgBjD,EAAazP,YAC7B0S,EAAgBjD,EAAaxP,WAE7BrK,EAASwC,EAAgB,OAGjC,IAAIG,EC3PG,SAACuK,EAAcnI,EAAWoc,GACrCA,EAAiBA,GAAkB,KACnC,IAAIC,EAAWrc,EAAUsc,cACrBC,EAASvc,EAAUwc,YACnBziB,EAASoO,EAAasU,cACtB1X,EAAU,GAEV2X,GAAa,EACbC,EAAgB5iB,EACf6iB,WAAU,SAAUjV,GACjB,OAAOA,EAAMqD,WAAaqR,KAE7BQ,WAAU,SAAUlV,GACjB,IAAI4C,EAASmS,EAMb,OAJI/U,EAAMqD,WAAauR,IACnBG,GAAa,GAGVnS,KAGf,GAAIoS,EAActiB,OAAS,EAAG,MAAO,UACrC,IAAMJ,EAAO0iB,EACRjkB,KAAI,SAAUiP,GACX,IAAI3N,EAAM2N,EAAMqD,SACZ/Q,EAAO0N,EAAM8O,UAEbhW,EAAQ,EACRC,EAAMzG,EAAKI,OAUf,OARIL,IAAQqiB,IACR5b,EAAQT,EAAU8c,kBAElB9iB,IAAQuiB,IACR7b,EAAMV,EAAU+c,gBAEpB9iB,EAAOA,EAAKqa,MAAM7T,EAAOC,GACzBqE,EAAS/K,EACFC,KAEV+iB,KAAKZ,GACNa,EAASjd,EAAU8c,iBACnBI,EAASld,EAAU+c,eAKvB,OAJI/c,EAAUmd,aACVD,EAASld,EAAU+c,eACnBE,EAASjd,EAAU8c,kBAEhB9c,EAAU8c,mBAAqB9c,EAAU+c,eAC1C,CAAE9iB,KAAMA,EAAMoL,WAAY4X,EAAQ3X,SAAU4X,EAAQnY,WAAUoY,WAAWnd,EAAUmd,YACnF,KDyMkBC,CAChB/O,EAAY9B,oBACZ4J,EACA,KAOJ,GAHAkD,EAAqBzb,GAGjBA,GAAkC,WAAjBA,EAA4B,CAC7C,IAAMyW,EAAc0H,GAChBljB,EACA+E,EAAc3D,KAAK2hB,OACnBhe,EAAcyH,YAEK,IAAvBgP,EAAYha,OACNif,EAAejF,GACfiF,EAAe,CAAC,CAAErf,KAAM,kBAKV,aAFVoU,EAAY9B,oBAAoB8J,eAAeU,GAEnDzK,WACL0M,IACDd,GACCkB,IAEDne,EAAS8C,GAAmB,IAC5B9C,EAAS0C,EAAiB,SAmIlB0f,OAhFhB,WACI/D,EAAe,KAgFH7K,iBAhIhB,SAA0BC,GAEtB,IAAMC,EAAiBC,aAAUH,iBAAiBJ,EAAaK,GAC/D,OAAIC,GACAL,EAAeK,GACR,WAEJ,eA0HK2O,iBAjBhB,SAA0BrjB,GAItB,OADAwf,EAAgB,CAAChB,UAAWxe,EAAK2c,MAAM,MAAM,GAAI7R,SAASuV,GAAajM,GAAatJ,WAC7E,eAcKwY,mBAAmB,EACnB1O,WAAYC,GACZxD,IAAKyC,EACLyP,MA5HhB,SAAmBphB,GAIf,OAHAA,EAAEgK,iBACFhK,EAAE+G,kBACFsW,EAAgBa,GAAajM,IACtB,YA8GC,qBAWuB,KAG1BgG,EAAYha,QAAU,GAAKxB,EAAewB,OAAS,GAChD,kBAACqZ,GAAD,CACIW,YAAaA,EAAYzP,QAAO,SAAC6Y,GAAD,MAAkB,iBAAXA,EAAExjB,QACzC2D,cAAewb,EACfvF,WA3FhB,SAAkCD,GAC9B,IAAM9M,EAAc,CAAC7M,KAAK2Z,EAAW3Z,KAAM6K,OAAO,CAAC8O,EAAWvO,WAAYuO,EAAWvO,WAAauO,EAAW3Z,KAAKI,QAAS0K,SAASsJ,EAAY3I,eAAeqF,eAAgBvT,QAASoc,EAAWpc,SAC7LkG,EAAOggB,GAAiB5W,EAAY,CAAE9B,QAAS4O,EAAW5O,QAAS5F,OAAQ,CAACue,MAAMC,OAAOhK,EAAW3Z,OAAS2Z,EAAW3Z,KAAO2jB,OAAOhK,EAAW3Z,QAAQ,GAAG,KAC5JoF,E1BxUY,SAACjI,EAAOsG,GAAsB,IAAhBnG,EAAe,uDAAP,GACxCuG,EAASrG,EAAS,SAQtB,MAAO,CAAEC,KAjBc,cAiBKoG,SAAQvG,MAPpCA,EAAK,aACDH,QACAO,UAAWC,KAAKC,OACb6F,EAHF,GAIEnG,EAJF,CAKDW,GAAI4F,K0BiUWiJ,CAAWzL,EAAIpD,GAAIwF,GAC5BiR,EAAiBiM,GAAY,CAACvb,EAAO9H,OAAQ8W,GACnDpT,EAASoE,GAETia,EAAe,IACfhL,EAAeK,IAoFHwF,mBAlFhB,WACIlZ,EAAS8C,GAAmB,IAC5Byb,EAAyBnL,EAAY3I,gBACrC4I,EE5VO,SAAC1Q,EAAeyQ,GAC3B,IAAM6H,EAAiB7H,EAAY9B,oBAC7B4J,EAAmB9H,EAAY3I,eAEjCuR,EAAaf,EAAegB,aAAf,iBAA8C,UAA9C,eACVtZ,IAGH6C,EAAQ7C,EAAcyH,WACtB3E,EAAM9C,EAAc0H,SAErB1H,EAAcuf,aACb1c,EAAQ7C,EAAc0H,SACtB5E,EAAM9C,EAAcyH,YAGxB,IAAMiI,EAAY2J,EAAWE,0BAEvB0G,EAAsB1H,EAAiBkB,MAAM,CAC/CG,aAAa/W,EACbgX,YAAa/W,IAEjBuW,EAAaW,YAASC,YAClBxJ,EAAY9B,oBACZsR,EACAjgB,EAAc3D,KACdoU,EAAYyJ,wBACZxK,GAEJ,IAAIqB,EAAiBX,eAAYrH,KAAK0H,EAAa4I,EAAY,gBAC3De,EAAerJ,EAAejJ,eAAe2R,MAAM,CACnDI,YAAa7Z,EAAc0H,SAC3BkS,aAAc5Z,EAAc0H,WAIhC,OAFAqJ,EAAiBX,eAAYiK,mBAAmBtJ,GAChDA,EAAiBX,eAAYhG,eAAe2G,EAAgBqJ,GFyTzC8F,CAAuB1E,EAAmB/K,IACzDsL,EACI,kIAgFA,kBAAC9E,GAAD,CACIjX,cAAewb,EACftE,aAAcA,EACdE,UA/EZ,SAA2BtX,GAEvB,IAAMyY,EAAmB9H,EAAY3I,eACjCuR,EAAa8G,gBAAaC,eAAe,IACvCC,EAAmBlE,GAAqB1L,GACxCwP,EAAsB1H,EAAiBkB,MAAM,CAC/CG,aAAcyG,EAAiB7jB,OAC/Bqd,YAAawG,EAAiB7jB,OAAS6jB,EAAiB5jB,SAE5D4c,EAAaW,YAASC,YAClBxJ,EAAY9B,oBACZsR,EACAngB,EAAKzD,KACLoU,EAAYyJ,yBAEhB,IAAInJ,EAAiBX,eAAYrH,KAAK0H,EAAa4I,EAAY,gBAC3De,EAAerJ,EAAejJ,eAAe2R,MAAM,CACnDI,YAAa/Z,EAAK4H,SAClBkS,aAAc9Z,EAAK4H,WAEvBqJ,EAAiBX,eAAYiK,mBAAmBtJ,GAChDA,EAAiBX,eAAYhG,eAAe2G,EAAgBqJ,GAC5D1J,EAAeK,GAEf1T,EAASsJ,GAAW7G,EAAKxF,MAwDjB6c,SA7CZ,SAA0BrX,GACtB,IAAMugB,EAAmBlE,GAAqB1L,GACxC6P,EAAgB1U,KAAKC,MAAMD,KAAKE,UAAUhM,IAChDwgB,EAAc7Y,WAAa4Y,EAAiB7jB,OAC5C8jB,EAAc5Y,SAAW2Y,EAAiB7jB,OAAS6jB,EAAiB5jB,OACpE6jB,EAAc3Y,aAAc,EAC5B+I,EAAesM,GAAY,CAACsD,GAAgB7P,OAyCxC,kBAACyB,GAAA,EAAD,CACIC,KAAkB,OAAZ2J,EACN1J,aAAc,CACVC,SAAU,SACVC,WAAY,QAEhBC,iBAAkB,IAClBC,QAAS,WACLuJ,EAAW,QAGf,kBAAC,GAAD,CAAOtJ,SAAS,QAAQqJ,KGtbzB,SAASyE,GAAKrf,GACzB,IAAM7D,EAAWC,cAKjB,OAJA2O,qBAAU,WACN5O,EAASgD,GAAY,MACtB,IAGC,kBAACnB,EAAA,EAAD,CAAMC,WAAS,EAAChC,QAAS,GACrB,kBAAC+B,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAACC,EAAA,EAAD,CAAYvB,QAAQ,WAAW4B,QAAQ,QAAQJ,cAAY,GAA3D,iBAGA,kBAACsV,GAAD,OAEJ,kBAAC5V,EAAA,EAAD,CAAMG,MAAI,EAACC,GAAI,GACX,kBAAC2b,GAAD,Q,cCQDuF,OAzBf,WACE,OACE,kBAAC,IAAD,KACE,kBAACC,EAAD,MACA,kBAACC,GAAA,EAAD,CAAWC,SAAS,KAAKC,GAAI,GAC3B,kBAAC,KAAD,KACE,kBAAC,KAAD,CAAOC,KAAK,qBACV,kBAACzU,GAAD,OAEF,kBAAC,KAAD,CAAOyU,KAAK,gBACV,kBAACN,GAAD,OAEF,kBAAC,KAAD,CAAOM,KAAK,SACV,kBAAC,EAAD,OAEF,kBAAC,KAAD,CAAOA,KAAK,KACV,kBAAC,EAAD,WCbQC,QACW,cAA7BjZ,OAAOkZ,SAASC,UAEe,UAA7BnZ,OAAOkZ,SAASC,UAEhBnZ,OAAOkZ,SAASC,SAASzL,MACvB,2D,6CCXS0L,gBAAgB,CAC7BtmB,K1CkGa,WAAmC,IAAlCD,EAAiC,uDAAzBQ,EAAcuG,EAAW,uCAC7C,OAAQA,EAAO3H,MACX,IAzGkB,aA0GlB,IAzGkB,aA0Gd,OAAO,eACAY,EADP,eAEK+G,EAAOjI,MAFZ,eAGYkB,EAAM+G,EAAOjI,QAAU,GAHnC,GAIWiI,EAAO9H,SAGtB,IAhHkB,aAiHd,IAAIunB,EAAQ,eACLxmB,GAGP,cADOwmB,EAASzf,EAAOjI,OAChB0nB,EAEX,IDtHoB,eCuHhB,OAAO,eACAxmB,EADP,eAEK+G,EAAO9H,MAAMH,MAFlB,eAGWkB,EAAM+G,EAAO9H,MAAMH,OAH9B,CAIQoB,OAAQF,EAAM+G,EAAO9H,MAAMH,OAAOoB,OAAO8I,OAAOjC,EAAO7H,aAGnE,ID5HoB,eC6HhB,OAAO,eACAc,EADP,eAEK+G,EAAO9H,MAAMH,MAFlB,eAGWkB,EAAM+G,EAAO9H,MAAMH,OAH9B,CAIQoB,OAAQF,EAAM+G,EAAO9H,MAAMH,OAAOoB,OAAOoM,QACrC,SAACjM,GAAD,OAASA,IAAQ0G,EAAO7H,eAKxC,IAvI+B,0BAwI3B,OAAO,eACAc,EADP,eAEK+G,EAAOjI,MAFZ,eAGWkB,EAAM+G,EAAOjI,OAHxB,CAIQyB,eAAgBwG,EAAO7G,WAGnC,IAhJ2B,sBAiJvB,OAAO,eACAF,EADP,eAEK+G,EAAOjI,MAFZ,eAGWkB,EAAM+G,EAAOjI,OAHxB,CAIQ0C,eAAgBuF,EAAOvF,mBAGnC,QACI,OAAOxB,I0CvJjBE,O3C6Ea,WAAmC,IAAlCF,EAAiC,uDAAzBQ,EAAcuG,EAAW,uCAC7C,OAAQA,EAAO3H,MACX,IAlFoB,eAmFpB,IAlFoB,eAmFhB,OAAO,eACAY,EADP,eAEK+G,EAAO7H,QAFZ,eAGYc,EAAM+G,EAAO7H,UAAY,GAHrC,GAIW6H,EAAO9H,SAGtB,IAzFoB,eA0FhB,IAAIunB,EAAQ,eACLxmB,GAGP,cADOwmB,EAASzf,EAAO7H,SAChBsnB,EAGX,QACI,OAAOxmB,I2ChGjBgM,MhCkEa,WAAyB,IAAxBhM,EAAuB,uDAAf,GAAI+G,EAAW,uCACnC,OAAQA,EAAO3H,MACX,IA1EmB,cA2EnB,IA1EmB,cA2Ef,OAAO,eACAY,EADP,eAEK+G,EAAOvB,OAFZ,eAGYxF,EAAM+G,EAAOvB,SAAW,GAHpC,GAIWuB,EAAO9H,SAGtB,IA9EoB,eA+EhB,OAAO8H,EAAOiF,MAAM2X,QAAO,SAAC3jB,EAAOoF,GAC/B,OAAO,eACApF,EADP,eAEKoF,EAAKxF,GAAKwF,MAEhBpF,GACP,IAxFmB,cAyFf,IAAIwmB,EAAQ,eACLxmB,GAGP,cADOwmB,EAASzf,EAAOvB,QAChBghB,EAEX,IA9FqB,gBA+FjB,OAAO,eACAxmB,EADP,eAEK+G,EAAOvB,OAFZ,eAGWxF,EAAM+G,EAAOvB,QAHxB,CAIQ9F,QAAQ,MAGpB,IArGuB,kBAsGnB,OAAO,eACAM,EADP,eAEK+G,EAAOvB,OAFZ,eAGWxF,EAAM+G,EAAOvB,QAHxB,CAIQ9F,QAAQ,MAGpB,IA3GoB,eA4GhB,OAAO,eACAM,EADP,eAEK+G,EAAOvB,OAFZ,eAGWxF,EAAM+G,EAAOvB,QAHxB,CAIQyH,aAAa,MAGzB,QACI,OAAOjN,IgCnHjB8C,GvCsBa,WAAmC,IAAlC9C,EAAiC,uDAAzBQ,EAAcuG,EAAW,uCAC7C,OAAQA,EAAO3H,MACX,IAnCyB,oBAoCrB,OAAO,eACAY,EADP,CAEIwc,aAAczV,EAAO3B,OAE7B,IAvC0B,qBAwCtB,OAAO,eACApF,EADP,CAEIsF,cAAeyB,EAAOzB,gBAE9B,IA3C0B,qBA4CtB,OAAO,eACAtF,EADP,CAEI2gB,aAAc5Z,EAAOvB,SAE7B,IA/C6B,wBAgDzB,OAAO,eACAxF,EADP,CAEI0gB,eAAgB3Z,EAAOrB,OAE/B,IAnD0B,qBAoDtB,OAAO,eACA1F,EADP,CAEI+C,aAAcgE,EAAOjI,QAE7B,IAvDqB,gBAwDjB,OAAO,eAAKkB,EAAZ,CAAmB8Q,SAAU/J,EAAOnB,MACxC,IAxDmC,8BAyD/B,OAAO,eAAK5F,EAAZ,CAAmB4gB,wBAAyB7Z,EAAOnB,MACvD,QACI,OAAO5F,M,yCwCnDbqC,GAAQokB,aAAe,CAEzBrgB,QAAS,CACLkW,QAAS,CACLoK,KAAM,WAEVrgB,UAAW,CACPqgB,KAAM,WAEVC,KAAM,CACFD,KAAM,WAEVvU,MAAO,CACHuU,KAAM,WAEVE,QAAS,CACLF,KAAM,WAEVG,QAAS,CACLH,KAAM,YAGdrgB,UAAW,CACPqgB,KAAM,WAEVC,KAAM,CACFD,KAAM,WAEVvU,MAAO,CACHuU,KAAM,WAEVE,QAAS,CACLF,KAAM,WAEVG,QAAS,CACLH,KAAM,WAEVI,cAAe,CACXJ,KAAM,aAKC,IAAIlN,SAAQ,SAACC,EAASC,GACjCqN,KACKC,QAAQ,SACRC,MAAK,SAAClmB,GACH0Y,EAAQ1Y,MAEXmmB,OAAM,SAACC,GACJzN,EAAOyN,SAKdF,MAAK,SAAClmB,GACH,IAAIqmB,EAAa,CAACC,KAAaC,2BAC3BC,EAAQC,aACRC,GAEA1mB,GAAc,GACd2mB,KAAe,WAAf,EAAmBN,IAKvBG,EAAMI,UACFtV,IAAS,WACL,IAAIrS,EAAK,eAAQunB,EAAMtP,YAEvB8O,KAAYa,QAAQ,QAAS5nB,KAC9B,MAMP6nB,IAASC,OACL,kBAAC,IAAD,CAAUP,MAAOA,GACb,kBAACQ,GAAA,EAAD,CAAe1lB,MAAOA,IAClB,kBAAC,GAAD,QAGRwX,SAASmO,eAAe,YAG/Bd,OAAM,SAACC,GACJzY,QAAQC,IAAIwY,GACZU,IAASC,OAAO,2DAAuCjO,SAASmO,eAAe,YF6BjF,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAMlB,MAAK,SAAAmB,GACjCA,EAAaC,kB","file":"static/js/main.6248306c.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"panel\":\"ChartConfigPanel_panel__1OEWt\",\"picker\":\"ChartConfigPanel_picker__2cC4T\",\"color\":\"ChartConfigPanel_color__2Pmzu\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"link\":\"Link_link__jXHvo\",\"potentialLink\":\"Link_potentialLink__3JiCy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ChartGallery_container__pQIvT\",\"draggingArea\":\"ChartGallery_draggingArea__Wft5P\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"viewer\":\"Viewer_viewer__2m97m\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"panel\":\"ManualLinkControls_panel__Ke1GF\",\"message\":\"ManualLinkControls_message__3Av28\",\"potentialLinkControls\":\"ManualLinkControls_potentialLinkControls__3YAy9\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"textSelection\":\"HighlightTextSelection_textSelection__2uV3y\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Chart_container__-PcK5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"editor\":\"Editor_editor__2c4G6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"suggestionPanel\":\"SuggestionPanel_suggestionPanel__2eTnI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"potentialLinkControls\":\"PotentialLinkControls_potentialLinkControls__7i3RY\"};","import { customAlphabet } from 'nanoid'\r\nconst nanoid = customAlphabet('1234567890abcdefghijklmnopqrstuvwxyz', 10)\r\nexport default (prefix) => { \r\n\treturn (prefix ? prefix + nanoid() : nanoid());\r\n};","import uniqueId from \"utils/uniqueId\";\r\nimport barChartSpec from \"./specs/barchart.json\";\r\nimport barChartLiteSpec from \"./specs/barChartLite.json\";\r\nimport { createSelector } from \"reselect\";\r\n\r\n// action types\r\nexport const CREATE_CHART = \"CREATE_CHART\";\r\nexport const UPDATE_CHART = \"UPDATE_CHART\";\r\nexport const DELETE_CHART = \"DELETE_CHART\";\r\n\r\n// actions\r\nexport const createChart = (docId, spec, liteSpec, attrs = {}) => {\r\n    let chartId = uniqueId(\"chart-\");\r\n    attrs = {\r\n        docId,\r\n        spec,\r\n        liteSpec,\r\n        timestamp: Date.now(),\r\n        highlight: { channel: \"opacity\", active: 1.0, inactive: 0.1 },\r\n        ...attrs,\r\n        id: chartId,\r\n    };\r\n    return { type: CREATE_CHART, chartId, attrs };\r\n};\r\n\r\nexport const updateChart = (chartId, attrs) => {\r\n    return { type: UPDATE_CHART, chartId, attrs };\r\n};\r\n\r\nexport const deleteChart = (chartId, attrs) => {\r\n    return {\r\n        type: DELETE_CHART,\r\n        chartId,\r\n        attrs,\r\n    };\r\n};\r\n// selectors\r\nexport const getCharts = createSelector(\r\n    (state) => state.docs,\r\n    (state) => state.charts,\r\n    (_, docId) => docId,\r\n    (docs, charts, docId) => docs[docId].charts.map((cid) => charts[cid])\r\n);\r\n\r\nexport const getChartsInEditor = createSelector(\r\n    (state) => state.docs,\r\n    (state) => state.charts,\r\n    (_, docId) => docId,\r\n    (docs, charts, docId) => docs[docId].chartsInEditor.map((cid) => charts[cid])\r\n);\r\n// reducers\r\nconst initialState = {\r\n    testchart: {\r\n        id: \"testchart\",\r\n        docId: \"testdoc\",\r\n        timestamp: Date.now(),\r\n        thumbnail:\r\n            \"data:image/png;base64,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\",\r\n        highlight: { channel: \"opacity\", active: 1.0, inactive: 0.1 },\r\n        properties: {\r\n            axes: [\r\n                {\r\n                    name: \"x\",\r\n                    field: \"category\",\r\n                    data: \"data_0\",\r\n                    type: \"ordinal\",\r\n                    title: \"category\",\r\n                },\r\n                { name: \"y\", field: \"amount\", data: \"data_0\", type: \"linear\", title: \"amount\" },\r\n            ],\r\n            features: [\r\n                { value: \"Apple\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Amazon\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Facebook\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Netflix\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Microsoft\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Samsung\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Twitter\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Linkedin\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n            ],\r\n        },\r\n        spec: barChartSpec,\r\n        liteSpec: barChartLiteSpec,\r\n    },\r\n};\r\n\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case CREATE_CHART:\r\n        case UPDATE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.chartId]: {\r\n                    ...(state[action.chartId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case DELETE_CHART: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.chartId];\r\n            return newState;\r\n        }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import uniqueId from \"utils/uniqueId\";\r\nimport { CREATE_CHART, DELETE_CHART } from \"ducks/charts\";\r\n// action types\r\nexport const CREATE_DOC = \"CREATE_DOC\";\r\nexport const UPDATE_DOC = \"UPDATE_DOC\";\r\nexport const DELETE_DOC = \"DELETE_DOC\";\r\n\r\nexport const UPDATE_EDITOR_STATE = \"UPDATE_EDITOR_STATE\";\r\nexport const UPDATE_CHARTS_IN_EDITOR = \"UPDATE_CHARTS_IN_EDITOR\";\r\n\r\n// actions\r\nexport const createDoc = (attrs = {}) => {\r\n    let docId = uniqueId();\r\n    attrs = {\r\n        title: \"Untitled\",\r\n        editorRawState: null,\r\n        timestamp: Date.now(),\r\n        searchedSentences: [],\r\n        charts: [],\r\n        chartsInEditor: [],\r\n        ...attrs,\r\n        id: docId,\r\n    };\r\n    return { type: CREATE_DOC, docId, attrs };\r\n};\r\n\r\nexport const updateDoc = (docId, attrs) => {\r\n    return { type: UPDATE_DOC, docId, attrs };\r\n};\r\n\r\nexport const deleteDoc = (docId) => {\r\n    return {\r\n        type: DELETE_DOC,\r\n        docId,\r\n    };\r\n};\r\n\r\nexport const updateChartsInEditor = (docId, charts) => {\r\n    return { type: UPDATE_CHARTS_IN_EDITOR, docId, charts };\r\n};\r\n\r\n// selectors\r\n\r\n// reducers\r\n\r\nconst initialState = {\r\n    testdoc: {\r\n        id: \"testdoc\",\r\n        title: \"Testing...\",\r\n        timestamp: Date.now(),\r\n        charts: [\"testchart\"],\r\n        chartsInEditor: [],\r\n        searchedSentences: [],\r\n        editorRawState: {\r\n            blocks: [\r\n                {\r\n                    key: \"8i090\",\r\n                    text: \"Welcome to Vis-Text Editor\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 26,\r\n                            style: \"BOLD\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n                {\r\n                    key: \"42ncd\",\r\n                    text: \"Here you can compose interactive articles\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 42,\r\n                            style: \"UNDERLINE\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n                {\r\n                    key: \"327r6\",\r\n                    text:\r\n                        \"Start dragging the chart from Chart Gallery to the editor and start creating! ;)\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 81,\r\n                            style: \"ITALIC\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n            ],\r\n            entityMap: {},\r\n        },\r\n    },\r\n};\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case CREATE_DOC:\r\n        case UPDATE_DOC:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...(state[action.docId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case DELETE_DOC: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.docId];\r\n            return newState;\r\n        }\r\n        case CREATE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.attrs.docId]: {\r\n                    ...state[action.attrs.docId],\r\n                    charts: state[action.attrs.docId].charts.concat(action.chartId),\r\n                },\r\n            };\r\n        case DELETE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.attrs.docId]: {\r\n                    ...state[action.attrs.docId],\r\n                    charts: state[action.attrs.docId].charts.filter(\r\n                        (cid) => cid !== action.chartId\r\n                    ),\r\n                },\r\n            };\r\n\r\n        case UPDATE_CHARTS_IN_EDITOR:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...state[action.docId],\r\n                    chartsInEditor: action.charts,\r\n                },\r\n            };\r\n        case UPDATE_EDITOR_STATE:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...state[action.docId],\r\n                    editorRawState: action.editorRawState,\r\n                },\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React, { Fragment } from \"react\";\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport AppBar from \"@material-ui/core/AppBar\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Link from \"@material-ui/core/Link\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { updateDoc } from \"ducks/docs\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    root: {\r\n        flexGrow: 1,\r\n        marginBottom: theme.spacing(3),\r\n    },\r\n    // menuButton: {\r\n    //   marginRight: theme.spacing(2),\r\n    // },\r\n    title: {\r\n        flexGrow: 1,\r\n    },\r\n}));\r\n\r\nexport default function () {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n    const docId = useSelector((state) => state.ui.currentDocId);\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n\r\n    function handleChange(e) {\r\n        dispatch(updateDoc(docId, { title: e.target.value }));\r\n    }\r\n    return (\r\n        <AppBar className={classes.root} position=\"static\" color=\"inherit\">\r\n            <Toolbar variant=\"dense\">\r\n                {/* <Button  color=\"inherit\" component={RouterLink} to=\"/docs\">\r\n        <Typography variant=\"h6\" className={classes.title}>\r\n        GORI\r\n          </Typography>\r\n        </Button> */}\r\n                <Link\r\n                    variant=\"h6\"\r\n                    className={classes.title}\r\n                    underline=\"none\"\r\n                    color=\"inherit\"\r\n                    component={RouterLink}\r\n                    to=\"/\"\r\n                >\r\n                    KORI\r\n                </Link>\r\n                {/* <Typography variant=\"h6\" className={classes.title} >\r\n\r\n          \r\n          </Typography> */}\r\n                {docId && (\r\n                    <TextField\r\n                        value={doc.title}\r\n                        onChange={handleChange}\r\n                        size=\"small\"\r\n                        fullWidth\r\n                        margin=\"dense\"\r\n                        variant=\"filled\"\r\n                        style={{ marginLeft: \"100px\", marginRight: \"20px\" }}\r\n                        label=\"Document Title\"\r\n                    />\r\n                )}\r\n                <Button color=\"inherit\" component={RouterLink} to=\"/docs\">\r\n                    Docs\r\n                </Button>\r\n\r\n                {docId && (\r\n                    <Fragment>\r\n                        <span style={{ marginLeft: \"10px\", marginRight: \"10px\" }}> | </span>\r\n                        <Button color=\"inherit\" component={RouterLink} to={`/docs/${docId}`}>\r\n                            Edit\r\n                        </Button>\r\n                        <Button color=\"inherit\" component={RouterLink} to={`/docs/${docId}/view`}>\r\n                            View\r\n                        </Button>\r\n                    </Fragment>\r\n                )}\r\n            </Toolbar>\r\n        </AppBar>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport Fab from \"@material-ui/core/Fab\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport NavigationIcon from \"@material-ui/icons/Navigation\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport { Link } from \"react-router-dom\";\r\nfunction Home() {\r\n    return (\r\n        <Grid container spacing={3} justify=\"center\">\r\n            <Grid item xs={6}>\r\n                <Typography variant=\"h2\" gutterBottom>\r\n                    KORI\r\n                </Typography>\r\n                <Box marginBottom={2}>\r\n                    <Typography variant=\"body1\" gutterBottom>\r\n                        Abstract\r\n                    </Typography>\r\n                </Box>\r\n                <Fab\r\n                    variant=\"extended\"\r\n                    color=\"primary\"\r\n                    aria-label=\"add\"\r\n                    component={Link}\r\n                    to=\"/docs\"\r\n                >\r\n                    <NavigationIcon />\r\n                    Get Started\r\n                </Fab>\r\n            </Grid>\r\n            <Grid item xs={6}>\r\n                <Typography variant=\"overline\" display=\"block\" gutterBottom>\r\n                    Teaser Image/Video\r\n                </Typography>\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n\r\nexport default Home;\r\n","export const SET_SELECTED_LINK = \"SET_SELECTED_LINK\";\r\nexport const SET_TEXT_SELECTION = \"SET_TEXT_SELECTION\";\r\nexport const SET_MANUAL_LINK_ID = \"SET_MANUAL_LINK_ID\";\r\nexport const EXIT_MANUAL_LINK_MODE = \"EXIT_MANUAL_LINK_MODE\";\r\nexport const SET_CURRENT_DOC_ID = \"SET_CURRENT_DOC_ID\";\r\nexport const SET_VIEW_MODE = \"SET_VIEW_MODE\";\r\nexport const LINK_ACTIVE_NO_AUTO_TRIGGER = \"LINK_ACTIVE_NO_AUTO_TRIGGER\";\r\n\r\nexport const setSelectedLink = (link) => {\r\n    return { type: SET_SELECTED_LINK, link };\r\n};\r\nexport const setTextSelection = (textSelection) => {\r\n    return { type: SET_TEXT_SELECTION, textSelection };\r\n};\r\nexport const setManualLinkId = (linkId) => {\r\n    return { type: SET_MANUAL_LINK_ID, linkId };\r\n};\r\nexport const exitManualLinkMode = (exit) => {\r\n    return { type: EXIT_MANUAL_LINK_MODE, exit };\r\n};\r\n\r\nexport const SetCurrentDocId = (docId) => {\r\n    return { type: SET_CURRENT_DOC_ID, docId };\r\n};\r\nexport const setViewMode = (val) => {\r\n    return { type: SET_VIEW_MODE, val };\r\n};\r\nexport const setLinkActiveNoAutoTrigger = (val) => {\r\n    return { type: LINK_ACTIVE_NO_AUTO_TRIGGER, val };\r\n};\r\n//reducers\r\nconst initialState = {};\r\n\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case SET_SELECTED_LINK:\r\n            return {\r\n                ...state,\r\n                selectedLink: action.link,\r\n            };\r\n        case SET_TEXT_SELECTION:\r\n            return {\r\n                ...state,\r\n                textSelection: action.textSelection,\r\n            };\r\n        case SET_MANUAL_LINK_ID:\r\n            return {\r\n                ...state,\r\n                manualLinkId: action.linkId,\r\n            };\r\n        case EXIT_MANUAL_LINK_MODE:\r\n            return {\r\n                ...state,\r\n                exitManualLink: action.exit,\r\n            };\r\n        case SET_CURRENT_DOC_ID:\r\n            return {\r\n                ...state,\r\n                currentDocId: action.docId,\r\n            };\r\n        case SET_VIEW_MODE:\r\n            return { ...state, viewMode: action.val };\r\n        case LINK_ACTIVE_NO_AUTO_TRIGGER:\r\n            return { ...state, linkActiveNoAutoTrigger: action.val };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React from \"react\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\n\r\nimport { createDoc } from \"ducks/docs\";\r\nimport { SetCurrentDocId } from \"ducks/ui\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    button: {\r\n        width: \"100%\",\r\n        padding: theme.spacing(1),\r\n        margin: theme.spacing(1),\r\n    },\r\n    paper: {\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        color: theme.palette.text.secondary,\r\n        height: theme.spacing(16),\r\n        width: \"100%\",\r\n    },\r\n}));\r\n\r\nfunction Doc(props) {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n\r\n    function handleClick() {\r\n        dispatch(SetCurrentDocId(props.docId));\r\n    }\r\n\r\n    return (\r\n        <Button\r\n            className={classes.button}\r\n            component={RouterLink}\r\n            to={`/docs/${props.docId}`}\r\n            onClick={handleClick}\r\n        >\r\n            <Paper className={classes.paper} elevation={2}>\r\n                {props.doc.title}\r\n                <div></div>\r\n            </Paper>\r\n        </Button>\r\n    );\r\n}\r\n\r\nexport default Doc;\r\n","import React from \"react\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport Doc from \"components/Doc\";\r\n\r\nimport { createDoc } from \"ducks/docs\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    button: {\r\n        width: \"100%\",\r\n        padding: theme.spacing(1),\r\n        margin: theme.spacing(1),\r\n    },\r\n    paper: {\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        color: theme.palette.text.secondary,\r\n        height: theme.spacing(16),\r\n        width: \"100%\",\r\n    },\r\n}));\r\n\r\nfunction Docs() {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n    const docs = useSelector((state) => Object.values(state.docs));\r\n\r\n    function handleClick() {\r\n        const action = createDoc();\r\n        dispatch(action);\r\n    }\r\n\r\n    return (\r\n        <Grid container spacing={1}>\r\n            <Grid item xs={2}>\r\n                <Button className={classes.button} onClick={handleClick}>\r\n                    <Paper className={classes.paper} variant=\"outlined\">\r\n                        <AddIcon />\r\n                    </Paper>\r\n                </Button>\r\n            </Grid>\r\n            {docs.map((doc) => (\r\n                <Grid key={doc.id} item xs={2}>\r\n                    <Doc doc={doc} docId={doc.id} />\r\n                </Grid>\r\n            ))}\r\n        </Grid>\r\n    );\r\n}\r\n\r\nexport default Docs;\r\n","// TODO: support different encodings?\r\nimport { isArray, isObject } from \"vega-util\";\r\nimport addBrushToVegaLiteSpec from \"utils/addBrushToVegaLiteSpec\";\r\nimport { compile } from \"vega-lite/build/vega-lite\";\r\n\r\nexport default (highlight, liteSpec) => {\r\n    try {\r\n        addBrushToVegaLiteSpec(liteSpec);\r\n    } catch (e) {}\r\n\r\n    const spec = compile(liteSpec).spec; // vega spec\r\n    // support vega-lite sample datasets\r\n\r\n    spec.data.forEach((d) => {\r\n        if (d.url && d.url.startsWith(\"data\")) {\r\n            d.url = process.env.PUBLIC_URL + \"/\" + d.url;\r\n        }\r\n    });\r\n\r\n    // highlight\r\n    spec.signals = [\r\n        ...(spec.signals || []),\r\n        {\r\n            name: \"highlight\", // should we add a prefix to avoid conflict with existing signals\r\n            value: { data: [], start: 0, end: 100, enabled: false },\r\n        },\r\n    ];\r\n\r\n    spec.marks.forEach((mark) => {\r\n        addSignalToMark(mark, highlight);\r\n    });\r\n    return spec;\r\n};\r\n\r\nexport function addSignalToMark(mark, highlight) {\r\n    if (mark.type === \"group\") {\r\n        // recursive\r\n        if (mark.marks) {\r\n            mark.marks.forEach((mark) => addSignalToMark(mark, highlight)); // will this generalize to all charts?\r\n        }\r\n        return;\r\n    }\r\n    const isMap = mark.type === \"shape\" && mark.style.includes(\"geoshape\");\r\n    const activePredicate = `highlight.enabled===true && (\r\n        (highlight.rangeField === '' && (indexof(highlight.data, datum[highlight.field])!=-1 ${\r\n            isMap ? \"|| indexof(highlight.data, datum.properties[highlight.field])!=-1)\" : \")\"\r\n        }) ||\r\n        (highlight.rangeField != '' && (indexof(highlight.data, datum[highlight.field])!=-1 ${\r\n            isMap ? \"|| indexof(highlight.data, datum.properties[highlight.field])!=-1)\" : \")\"\r\n        } && (datum[highlight.rangeField] > highlight.rangeMin && datum[highlight.rangeField]<highlight.rangeMax)) ||\r\n        (datum[highlight.field] > highlight.rangeMin && datum[highlight.field]<highlight.rangeMax) ||\r\n        (datum[highlight.fieldX] > highlight.rangeX[0] && datum[highlight.fieldX] < highlight.rangeX[1] &&\r\n            datum[highlight.fieldY] < highlight.rangeY[0] && datum[highlight.fieldY] > highlight.rangeY[1] ) \r\n    )`;\r\n    //TODO: reduce redundant checking\r\n    const inactivePredicate = `highlight.enabled===true && !(\r\n        (highlight.rangeField === '' && (indexof(highlight.data, datum[highlight.field])!=-1 ${\r\n            isMap ? \"|| indexof(highlight.data, datum.properties[highlight.field])!=-1)\" : \")\"\r\n        }) ||\r\n        (highlight.rangeField != '' && (indexof(highlight.data, datum[highlight.field])!=-1 ${\r\n            isMap ? \"|| indexof(highlight.data, datum.properties[highlight.field])!=-1)\" : \")\"\r\n        } && (datum[highlight.rangeField] > highlight.rangeMin && datum[highlight.rangeField]<highlight.rangeMax)) ||\r\n        (datum[highlight.field] > highlight.rangeMin && datum[highlight.field]<highlight.rangeMax) ||\r\n        (datum[highlight.fieldX] > highlight.rangeX[0] && datum[highlight.fieldX] < highlight.rangeX[1] &&\r\n            datum[highlight.fieldY] < highlight.rangeY[0] && datum[highlight.fieldY] > highlight.rangeY[1] )\r\n    )`;\r\n    const oldProp = mark.encode.update[highlight.channel];\r\n    const highlightProp = [\r\n        {\r\n            test: activePredicate,\r\n            value: highlight.active,\r\n        },\r\n        {\r\n            test: inactivePredicate,\r\n            value: highlight.inactive,\r\n        },\r\n        // put existing property if exists either in array or object form\r\n        //TODO: see if we need the Object Check?\r\n        // ...(isObject(oldProp) ? [oldProp] : isArray(oldProp) ? oldProp : []),\r\n    ];\r\n    mark.encode.update = {\r\n        ...mark.encode.update,\r\n        [highlight.channel]: highlightProp.concat(isArray(oldProp) ? oldProp : []),\r\n    };\r\n}\r\n","export default (liteSpec) => {\r\n    // No rectangular brush for bar, area, pie charts and maps\r\n    const noBrush = [\"bar\", \"area\", \"geoshape\"].includes(liteSpec.mark) || liteSpec.mark.type === \"arc\";\r\n    const selections = noBrush\r\n        ? {\r\n              paintbrush: { type: \"multi\", toggle: true, clear: \"window:keypress\", },\r\n              \r\n          }\r\n        : {\r\n              brush: {\r\n                  type: \"interval\",\r\n                  clear: \"window:keypress\",\r\n              },\r\n              paintbrush: {\r\n                  type: \"multi\",\r\n                  toggle: true,\r\n                  clear: \"window:keypress\",\r\n              },\r\n          };\r\n\r\n    liteSpec[\"selection\"] = selections;\r\n    //TODO: Check what's wrong with multiple conditions https://github.com/vega/vega-lite/issues/3040\r\n    liteSpec.encoding[\"opacity\"] = {\r\n        condition: [\r\n            // {\r\n            //     selection: \"brush\",\r\n            //     value: 1,\r\n            // },\r\n            {\r\n                selection: \"paintbrush\",\r\n                value: 1,\r\n            },\r\n        ],\r\n        value: 0.1,\r\n    };\r\n    return liteSpec;\r\n};\r\n","export default (func, wait = 50) => {\r\n  let last;\r\n  let deferTimer;\r\n\r\n  const throttled = (...args) => {\r\n    const now = Date.now();\r\n\r\n    if (last && now < last + wait) {\r\n      clearTimeout(deferTimer);\r\n\r\n      deferTimer = setTimeout(() => {\r\n        last = now;\r\n        func(...args);\r\n      }, wait);\r\n    } else {\r\n      last = now;\r\n      func(...args);\r\n    }\r\n  };\r\n\r\n  return throttled;\r\n};\r\n","import React, { useState } from \"react\";\r\nimport css from \"./index.module.css\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Slider from \"@material-ui/core/Slider\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Select from \"@material-ui/core/Select\";\r\nimport PropTypes from \"prop-types\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { updateChart } from \"ducks/charts\";\r\n\r\nexport default function ChartConfigPanel(props) {\r\n    const dispatch = useDispatch();\r\n    const channelOptions = {\r\n        opacity: { active: 1.0, inactive: 0.1 },\r\n        fill: { active: \"#1f77b4\", inactive: \"#c7c7c7\" },\r\n    };\r\n    const colors = [\r\n        \"#1f77b4\",\r\n        \"#aec7e8\",\r\n        \"#ff7f0e\",\r\n        \"#ffbb78\",\r\n        \"#2ca02c\",\r\n        \"#98df8a\",\r\n        \"#d62728\",\r\n        \"#ff9896\",\r\n        \"#9467bd\",\r\n        \"#c5b0d5\",\r\n        \"#8c564b\",\r\n        \"#c49c94\",\r\n        \"#e377c2\",\r\n        \"#f7b6d2\",\r\n        \"#7f7f7f\",\r\n        \"#c7c7c7\",\r\n        \"#bcbd22\",\r\n        \"#dbdb8d\",\r\n        \"#17becf\",\r\n        \"#9edae5\",\r\n    ];\r\n    const highlight = props.chart.highlight;\r\n    const [active, setActive] = useState(highlight.active); // necessary for handling intermediate changes\r\n    const [inactive, setInactive] = useState(highlight.inactive); // to prevent constant flickering chart updates\r\n    function handleChannelChange(event) {\r\n        // setChannel(event.target.value);\r\n        const channel = event.target.value;\r\n\r\n        if (channel !== highlight.channel) {\r\n            const option = channelOptions[channel];\r\n            setActive(option.active);\r\n            setInactive(option.inactive);\r\n            dispatch(\r\n                updateChart(props.chart.id, { highlight: { channel, ...channelOptions[channel] } })\r\n            );\r\n        }\r\n    }\r\n    function handleActiveChange(event, newValue) {\r\n        setActive(newValue);\r\n    }\r\n    function handleInactiveChange(event, newValue) {\r\n        setInactive(newValue);\r\n    }\r\n    function handleActiveChangeCommitted(event, newValue) {\r\n        setActive(newValue);\r\n        dispatch(updateChart(props.chart.id, { highlight: { ...highlight, active: newValue } }));\r\n    }\r\n    function handleInactiveChangeCommitted(event, newValue) {\r\n        setInactive(newValue);\r\n        dispatch(updateChart(props.chart.id, { highlight: { ...highlight, inactive: newValue } }));\r\n    }\r\n    return (\r\n        <div>\r\n            <Box\r\n                zIndex=\"modal\"\r\n                className={css.panel}\r\n                top={40}\r\n                left={\"45%\"}\r\n                onMouseDown={(e) => e.stopPropagation()}\r\n            >\r\n                <Box component={Paper} p={2}>\r\n                    <Grid container direction=\"column\" spacing={2}>\r\n                        <Grid item>\r\n                            <Typography gutterBottom>Highlight Option</Typography>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <Typography variant=\"caption\">Channel</Typography>\r\n                            <Box>\r\n                                <Select value={highlight.channel} onChange={handleChannelChange}>\r\n                                    {Object.keys(channelOptions).map((option) => (\r\n                                        <MenuItem key={option} value={option}>\r\n                                            {option}\r\n                                        </MenuItem>\r\n                                    ))}\r\n                                </Select>\r\n                            </Box>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <Typography variant=\"caption\">Active</Typography>\r\n                            {highlight.channel === \"opacity\" ? (\r\n                                <Slider\r\n                                    value={active}\r\n                                    aria-labelledby=\"discrete-slider\"\r\n                                    valueLabelDisplay=\"auto\"\r\n                                    min={0.0}\r\n                                    max={1.0}\r\n                                    step={0.05}\r\n                                    onChange={handleActiveChange}\r\n                                    onChangeCommitted={handleActiveChangeCommitted}\r\n                                />\r\n                            ) : (\r\n                                <Box className={css.picker}>\r\n                                    {colors.map((color) => (\r\n                                        <Box\r\n                                            className={css.color}\r\n                                            bgcolor={color}\r\n                                            border={color === active ? 1 : 0}\r\n                                            onMouseUp={(e) => handleActiveChangeCommitted(e, color)}\r\n                                        />\r\n                                    ))}\r\n                                </Box>\r\n                            )}\r\n                            <Typography variant=\"caption\">Inactive</Typography>\r\n                            {highlight.channel === \"opacity\" ? (\r\n                                <Slider\r\n                                    value={inactive}\r\n                                    aria-labelledby=\"discrete-slider\"\r\n                                    valueLabelDisplay=\"auto\"\r\n                                    min={0.0}\r\n                                    max={1.0}\r\n                                    step={0.05}\r\n                                    onChange={handleInactiveChange}\r\n                                    onChangeCommitted={handleInactiveChangeCommitted}\r\n                                />\r\n                            ) : (\r\n                                <Box className={css.picker}>\r\n                                    {colors.map((color) => (\r\n                                        <Box\r\n                                            className={css.color}\r\n                                            bgcolor={color}\r\n                                            border={color === inactive ? 1 : 0}\r\n                                            onMouseUp={(e) =>\r\n                                                handleInactiveChangeCommitted(e, color)\r\n                                            }\r\n                                        />\r\n                                    ))}\r\n                                </Box>\r\n                            )}\r\n                        </Grid>\r\n                    </Grid>\r\n                </Box>\r\n            </Box>\r\n        </div>\r\n    );\r\n}\r\n\r\nChartConfigPanel.propTypes = {\r\n    chart: PropTypes.object,\r\n    onUpdated: PropTypes.func,\r\n};\r\n","import uniqueId from \"utils/uniqueId\";\r\nimport { createSelector } from \"reselect\";\r\n\r\n// action types\r\nexport const CREATE_LINK = \"CREATE_LINK\";\r\nexport const UPDATE_LINK = \"UPDATE_LINK\";\r\nexport const DELETE_LINK = \"DELETE_LINK\";\r\nexport const ACTIVATE_LINK = \"ACTIVATE_LINK\";\r\nexport const DEACTIVATE_LINK = \"DEACTIVATE_LINK\";\r\nexport const CREATE_LINKS = \"CREATE_LINKS\";\r\nexport const CONFIRM_LINK = \"CONFIRM_LINK\";\r\n\r\nexport const createLink = (docId, link, attrs = {}) => {\r\n    let linkId = uniqueId(\"link-\");\r\n    attrs = {\r\n        docId,\r\n        timestamp: Date.now(),\r\n        ...link, // chartId, text, etc\r\n        ...attrs, // will override the above properties if any attr is set in attrs\r\n        id: linkId,\r\n    };\r\n    return { type: CREATE_LINK, linkId, attrs };\r\n};\r\n\r\nexport const createLinks = (docId, links) => {\r\n    return {\r\n        type: CREATE_LINKS,\r\n        links: links.map((link) => ({\r\n            ...link,\r\n            timestamp: Date.now(),\r\n            docId,\r\n            id: uniqueId(\"link-\"),\r\n        })),\r\n    };\r\n};\r\n\r\nexport const updateLink = (linkId, attrs) => {\r\n    return { type: UPDATE_LINK, linkId, attrs };\r\n};\r\n\r\nexport const deleteLink = (linkId) => {\r\n    return {\r\n        type: DELETE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const activateLink = (linkId) => {\r\n    return {\r\n        type: ACTIVATE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const deactivateLink = (linkId) => {\r\n    return {\r\n        type: DEACTIVATE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const confirmLink = (linkId) => {\r\n    return {\r\n        type: CONFIRM_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\n// selectors\r\nexport const getLinks = createSelector(\r\n    (state) => state.links,\r\n    (_, docId) => docId,\r\n    (links, docId) => Object.fromEntries(Object.entries(links).filter(([k,v]) => v.docId === docId))\r\n);\r\n\r\n// reducers\r\nexport default (state = {}, action) => {\r\n    switch (action.type) {\r\n        case CREATE_LINK:\r\n        case UPDATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...(state[action.linkId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case CREATE_LINKS:\r\n            return action.links.reduce((state, link) => {\r\n                return {\r\n                    ...state,\r\n                    [link.id]: link,\r\n                };\r\n            }, state);\r\n        case DELETE_LINK: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.linkId];\r\n            return newState;\r\n        }\r\n        case ACTIVATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    active: true,\r\n                },\r\n            };\r\n        case DEACTIVATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    active: false,\r\n                },\r\n            };\r\n        case CONFIRM_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    isConfirmed: true,\r\n                },\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","//Arguments//\r\n        //commonProps={text, extent, chartId}, \r\n        //dataProps={feature, values}, \r\n        //rangeProps={fieldX, rangeX, fieldY, rangeY}, \r\n        //suggestionProps={trigger}\r\n\r\nexport default ({text, extent, blockKey, chartId}, {feature, values}, {fieldX, rangeX, fieldY, rangeY}, trigger) => {\r\n    return { \r\n\r\n        // common props\r\n        text: text,\r\n        startIndex: extent[0],\r\n        endIndex: extent[1],\r\n        blockKey:blockKey,\r\n        chartId: chartId,\r\n        \r\n        //data props\r\n        feature: feature,\r\n        data: values,\r\n\r\n        //range link props\r\n        fieldX: fieldX,\r\n        rangeX: rangeX,\r\n        fieldY: fieldY,\r\n        rangeY: rangeY,\r\n\r\n\r\n        active: false,\r\n        isConfirmed: true,\r\n        trigger: trigger\r\n    };\r\n}","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\n\r\nimport { setTextSelection } from \"ducks/ui\";\r\nimport { createLinks } from \"ducks/links\";\r\nimport { setManualLinkId, exitManualLinkMode } from \"ducks/ui\";\r\nimport createLink from \"utils/createLink\"\r\n\r\nexport default function ManualLinkControls(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n\r\n    const chartProperties = props.selectedChart.properties;\r\n\r\n    function handleResetClick(event) {\r\n        dispatch(exitManualLinkMode(true));\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        dispatch(setTextSelection(null));\r\n    }\r\n    function handleAcceptClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        makeManualLink(props.textSelection, props.selectedMarks, props.brush, props.viewData);\r\n        dispatch(setTextSelection(null));\r\n        dispatch(exitManualLinkMode(true));\r\n    }\r\n\r\n    function makeManualLink(textSelection, multiPoint, brush, viewData) {\r\n        let link = null;\r\n        if (multiPoint.length > 0) {\r\n            let points = [];\r\n            for (let i = 0; i < multiPoint.length; i++) {\r\n                for (let j = 0; j < viewData.length; j++) {\r\n                    if (multiPoint[i].values[0] === viewData[j]._vgsid_) points.push(viewData[j]);\r\n                }\r\n            }\r\n            let data = [];\r\n            let field;\r\n            points.forEach(function (p) {\r\n                field = chartProperties?.axes.filter((axis) =>\r\n                    [\"ordinal\", \"band\", \"point\"].includes(axis.type)\r\n                )[0];\r\n                if (p.hasOwnProperty(\"properties\")) {\r\n                    field = chartProperties?.features.filter(\r\n                        (feature) => feature?.value != \"Feature\"\r\n                    )[0];\r\n                    //Special case: Maps\r\n                    //Look for data in TopoJSON Properties or in the datafile!\r\n                    if (!p[\"properties\"][field?.field]) {\r\n                        data.push(p[field?.field]);\r\n                    } else data.push(p[\"properties\"][field?.field]);\r\n                } else data.push(p[field?.field]);\r\n            });\r\n            const feature={ field: field?.field };\r\n            const commonProps = {text: textSelection.text, extent:[props.textSelection.startIndex, props.textSelection.endIndex], blockKey:props.textSelection.blockKey, chartId: props.selectedChart.id};\r\n            link = createLink(commonProps, {feature,values:data}, {});\r\n            console.log('MultiPoint Link', link);\r\n        }\r\n        if (brush.length > 0) {\r\n            let points;\r\n            let fieldX;\r\n            let fieldY;\r\n            let rangeX;\r\n            let rangeY;\r\n            let brushField;\r\n            let rangeMin;\r\n            let rangeMax;\r\n\r\n            //Rectangular Brush\r\n            if (\r\n                brush[0].fields.length === 2 &&\r\n                brush[0].fields[0].type === \"R\" &&\r\n                brush[0].fields[1].type === \"R\"\r\n            ) {\r\n                fieldX = brush[0].fields[0].field;\r\n                fieldY = brush[0].fields[1].field;\r\n                rangeX = brush[0].values[0];\r\n                rangeY = brush[0].values[1];\r\n                points = [];\r\n            } else {\r\n                //Single Axis Brush\r\n                if (brush[0].fields[0].type === \"E\") {\r\n                    brushField = brush[0].fields[0].field;\r\n                    points = brush[0].values[0];\r\n                }\r\n                if (brush[0].fields[0].type === \"R\") {\r\n                    brushField = brush[0].fields[0].field;\r\n                    points = [];\r\n                    rangeMin = brush[0].values[0][0];\r\n                    rangeMax = brush[0].values[0][1];\r\n                }\r\n            }\r\n            const commonProps = {text:textSelection.text, extent:[props.textSelection.startIndex, props.textSelection.endIndex], blockKey:props.textSelection.blockKey, chartId:props.selectedChart.id};\r\n            const dataProps = {feature: { field: brushField }, values:points }\r\n            const rangeProps = {fieldX: fieldX, rangeX: rangeX, fieldY: fieldY, rangeY: rangeY}\r\n            link = createLink(commonProps, dataProps,rangeProps);\r\n            console.log('Single Axis Brush Link', link);\r\n\r\n            if (brush[0]?.fields.length < 2 && brush[0]?.fields[0].type === \"R\")\r\n                link = { ...link, rangeField: brushField, rangeMin, rangeMax };\r\n            console.log('Rectangular Brush Link', link);\r\n        }\r\n        if (link !== null) {\r\n            const action = createLinks(props.currentDoc.id, [link]);\r\n            dispatch(action);\r\n            dispatch(setManualLinkId(action.links[0].id));\r\n        } else dispatch(setManualLinkId(null));\r\n    }\r\n    return pos && props.textSelection ? (\r\n        <Box right={0} top={0} className={css.potentialLinkControls}>\r\n            <Paper elevation={1}>\r\n                <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\r\n                    <Button onMouseDown={handleAcceptClick}>Accept</Button>\r\n                    <Button onMouseDown={handleResetClick}>Cancel</Button>\r\n                </ButtonGroup>\r\n            </Paper>\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n","import React, { useEffect, useMemo, memo, useState, useRef } from \"react\";\r\nimport { useDispatch, useSelector, shallowEqual, connect } from \"react-redux\";\r\nimport addSignalToChartSpec from \"utils/addSignalToChartSpec\";\r\nimport vegaEmbed from \"vega-embed\";\r\nimport throttle from \"utils/throttle\";\r\nimport { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\nimport ChartConfigPanel from \"components/ChartConfigPanel\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport ManualLinkControls from \"components/ManualLinkControls\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport SettingsIcon from \"@material-ui/icons/Settings\";\r\n\r\nexport default memo(function ChartBlock({\r\n    block,\r\n    blockProps,\r\n    customStyleMap,\r\n    customStyleFn,\r\n    decorator,\r\n    forceSelection,\r\n    offsetKey,\r\n    selection,\r\n    tree,\r\n    contentState,\r\n    blockStyleFn, //weird props passed from editor\r\n    preventScroll, //weird props passed from editor\r\n    style,\r\n    ...elementProps\r\n}) {\r\n    // const data = props.contentState.getEntity(props.block.getEntityAt(0)).getData();\r\n    // let view = null;\r\n    const dispatch = useDispatch();\r\n    const [view, setView] = useState(null);\r\n    const containerEl = useRef(null);\r\n    const chartEl = useRef(null);\r\n    const [ratio, setRatio] = useState(1);\r\n    const chart = useSelector((state) => state.charts[blockProps.id]);\r\n    const textSelection = useSelector((state) => state.ui.textSelection);\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n    const chartsInEditor = useSelector((state) => state.docs[docId].chartsInEditor);\r\n    const [selectedMarks, setSelectedMarks] = useState([]);\r\n    const [viewData, setViewData] = useState([]);\r\n    const [brush, setBrush] = useState([]);\r\n    const [toggleSettings, setToggleSettings] = useState(false);\r\n    const viewMode = useSelector((state) => state.ui.viewMode);\r\n\r\n    // TODO: use a memoized selector for performance\r\n    const links = useSelector(\r\n        (state) => Object.values(state.links).filter((link) => link.chartId === blockProps.id),\r\n        shallowEqual\r\n    );\r\n    const spec = useMemo(\r\n        () =>\r\n            addSignalToChartSpec(\r\n                // JSON.parse(JSON.stringify(chart.spec)),\r\n                chart.highlight,\r\n                JSON.parse(JSON.stringify(chart.liteSpec))\r\n            ),\r\n        [chart.spec, chart.highlight]\r\n    );\r\n\r\n    useEffect(() => {\r\n        const asyncExec = async () => {\r\n            // compute canvas aspect ratio to maintain it while resizing\r\n\r\n            const runtime = parse(spec);\r\n            const tempView = await new View(runtime).runAsync();\r\n\r\n            const canvas = await tempView.toCanvas();\r\n            const ratio = canvas.height / canvas.width;\r\n            setRatio(ratio);\r\n\r\n            // add autosize: has limitations: https://vega.github.io/vega-lite/docs/size.html#limitations\r\n            //TODO: brush interfere with autosize\r\n\r\n            // spec.autosize = {\r\n            //     type: \"fit\",\r\n            //     contains: \"padding\",\r\n            //     resize: true,\r\n            // };\r\n\r\n            const result = await vegaEmbed(chartEl.current, spec, { actions: false });\r\n            const view = result.view;\r\n\r\n            // const viewData = view.data(\"source_0\");\r\n            const viewData = !chart.liteSpec.data.hasOwnProperty(\"url\")\r\n                ? view.data(\"data_0\")\r\n                : view.data(\"source_0\");\r\n            setViewData(viewData);\r\n            try {\r\n                view.addDataListener(\"paintbrush_store\", function (name, value) {\r\n                    console.log(name, value);\r\n                    setSelectedMarks(selectedMarks.concat(value));\r\n                });\r\n\r\n                view.addDataListener(\"brush_store\", function (name, value) {\r\n                    console.log(name, value);\r\n                    setBrush(brush.concat(value));\r\n                });\r\n            } catch (error) {\r\n                //No brush_store if no brush added\r\n            }\r\n            setView(view);\r\n        };\r\n        asyncExec();\r\n    }, [spec]);\r\n\r\n    useEffect(\r\n        throttle(async () => {\r\n            resize(view, ratio);\r\n        }, 500)\r\n    );\r\n\r\n    function resize(view, ratio) {\r\n        if (view) {\r\n            const { width } = containerEl.current.getBoundingClientRect();\r\n            const height = ratio * width;\r\n            // view.resize().height(height).width(width).runAsync();\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!view) {\r\n            return;\r\n        }\r\n        if (links.some((link) => link.active)) {\r\n            // Should we send all signals at once? would it improve performance?\r\n            links\r\n                .filter((link) => link.active)\r\n                .forEach((link) => {\r\n                    view.signal(\"highlight\", {\r\n                        type: link.type,\r\n                        data: link.data,\r\n                        field: link.feature.field,\r\n                        enabled: true,\r\n                        //Next 2 fields refer to range selection links\r\n                        rangeField: link.rangeField || \"\",\r\n                        rangeMin: link.rangeMin || 0,\r\n                        rangeMax: link.rangeMax || 0,\r\n                        //Rectangular Brushes\r\n                        fieldX: link.fieldX || \"\",\r\n                        fieldY: link.fieldY || \"\",\r\n                        rangeX: link.rangeX || [0, 0],\r\n                        rangeY: link.rangeY || [0, 0],\r\n                    }).runAsync();\r\n                });\r\n        } else {\r\n            view.signal(\"highlight\", { enabled: false }).runAsync();\r\n        }\r\n    }, [links]);\r\n\r\n    function handleSettingClick() {\r\n        setToggleSettings(!toggleSettings);\r\n    }\r\n\r\n    const showConfig = viewMode ? false : selection.getAnchorKey() === block.getKey(); // show only clicking this block\r\n    const highlightStyle =\r\n        chartsInEditor.indexOf(chart.id) > -1 && !showConfig && textSelection\r\n            ? {\r\n                  ...style,\r\n                  position: \"relative\",\r\n                  borderStyle: \"solid\",\r\n                  borderColor: \"gray\",\r\n                  width: \"fit-content\",\r\n              }\r\n            : {\r\n                  ...style,\r\n                  position: \"relative\",\r\n                  width: \"fit-content\",\r\n              };\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <div ref={containerEl} {...elementProps} style={highlightStyle}>\r\n                <div>\r\n                    {showConfig && (\r\n                        <IconButton\r\n                            onMouseDown={handleSettingClick}\r\n                            aria-label=\"settings\"\r\n                            // color=\"primary\"\r\n                        >\r\n                            <SettingsIcon />\r\n                        </IconButton>\r\n                    )}\r\n                </div>\r\n                <div ref={chartEl} />\r\n                {/* {showConfig && !textSelection && <ChartConfigPanel chart={chart} />} */}\r\n                {showConfig && toggleSettings && <ChartConfigPanel chart={chart} />}\r\n                {/* {resizing && <AspectRatioIcon style={{color: grey[500], zIndex:2, marginLeft:\"-30px\"}}/>} */}\r\n                {showConfig && textSelection && (\r\n                    <ManualLinkControls\r\n                        currentDoc={doc}\r\n                        selectedChart={chart}\r\n                        textSelection={textSelection}\r\n                        selectedMarks={selectedMarks}\r\n                        brush={brush}\r\n                        viewData={viewData}\r\n                    />\r\n                )}\r\n            </div>\r\n        </React.Fragment>\r\n    );\r\n});\r\n","\r\nimport React, { Fragment } from 'react';\r\nimport createToolbarPlugin, { Separator } from \"draft-js-static-toolbar-plugin\";\r\nimport createAlignmentPlugin from \"draft-js-alignment-plugin\";\r\nimport createFocusPlugin from \"draft-js-focus-plugin\";\r\nimport createResizeablePlugin from 'draft-js-resizeable-plugin';\r\n\r\nimport \"draft-js-static-toolbar-plugin/lib/plugin.css\";\r\nimport \"draft-js-alignment-plugin/lib/plugin.css\";\r\nimport \"draft-js-focus-plugin/lib/plugin.css\";\r\n// import \"draft-js-resizeable-plugin/lib/plugin.css\";\r\n\r\nimport createChartBlockPlugin from 'utils/createChartBlockPlugin';\r\n\r\nimport {\r\n  ItalicButton,\r\n  BoldButton,\r\n  UnderlineButton,\r\n  CodeButton,\r\n  HeadlineOneButton,\r\n  HeadlineTwoButton,\r\n  HeadlineThreeButton,\r\n  UnorderedListButton,\r\n  OrderedListButton,\r\n  BlockquoteButton,\r\n  CodeBlockButton\r\n} from \"draft-js-buttons\";\r\nimport { composeDecorators } from \"draft-js-plugins-editor\";\r\n\r\n\r\nconst toolbarPlugin = createToolbarPlugin();\r\nconst focusPlugin = createFocusPlugin();\r\nconst alignmentPlugin = createAlignmentPlugin();\r\nconst resizeablePlugin = createResizeablePlugin();\r\n\r\nconst { AlignmentTool } = alignmentPlugin;\r\nconst { Toolbar } = toolbarPlugin;\r\nconst decorator = composeDecorators(\r\n  focusPlugin.decorator,\r\n  resizeablePlugin.decorator,\r\n  alignmentPlugin.decorator\r\n);\r\n\r\nconst chartBlockPlugin = createChartBlockPlugin({ decorator });\r\nexport const EditorPlugins = [focusPlugin, resizeablePlugin, alignmentPlugin, toolbarPlugin, chartBlockPlugin];\r\n\r\nexport default function EditorToolbar() {\r\n  return (\r\n    <Fragment>\r\n      <Toolbar>\r\n        {// may be use React.Fragment instead of div to improve perfomance after React 16\r\n          externalProps => (\r\n            <div>\r\n              <BoldButton {...externalProps} />\r\n              <ItalicButton {...externalProps} />\r\n              <UnderlineButton {...externalProps} />\r\n              <CodeButton {...externalProps} />\r\n              <Separator {...externalProps} />\r\n              <HeadlineOneButton {...externalProps} />\r\n              <HeadlineTwoButton {...externalProps} />\r\n              <HeadlineThreeButton {...externalProps} />\r\n              <UnorderedListButton {...externalProps} />\r\n              <OrderedListButton {...externalProps} />\r\n              <BlockquoteButton {...externalProps} />\r\n              <CodeBlockButton {...externalProps} />\r\n            </div>\r\n          )}\r\n      </Toolbar>\r\n      <AlignmentTool />\r\n    </Fragment>\r\n\r\n  )\r\n}","\r\nimport ChartBlock from 'components/ChartBlock';\r\n\r\nexport default (config = {}) => {\r\n    const component = config.decorator\r\n        ? config.decorator(ChartBlock)\r\n        : ChartBlock;\r\n\r\n    return {\r\n        blockRendererFn: (block, { getEditorState }) => {\r\n            if (block.getType() === \"atomic\") {\r\n                const contentState = getEditorState().getCurrentContent();\r\n                if (!block.getEntityAt(0)) return;\r\n                const entity = contentState.getEntity(block.getEntityAt(0));\r\n                const data = entity.getData();\r\n                const type = entity.getType();\r\n                if (type === \"CHART\") {\r\n                    return {\r\n                        component,\r\n                        editable: false,\r\n                        props:{\r\n                            ...data\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n            return null;\r\n        },\r\n        ChartBlock\r\n    };\r\n};","/**\r\n * Super simple decorators for handles and hashtags, for demonstration\r\n * purposes only. Don't reuse these regexes.\r\n */\r\n//TODO: REGEX needs to be improved and crafted to our use case!\r\n// import LinkText from 'components/LinkText';\r\n// import AutoLink from 'components/AutoLink';\r\nimport Link from \"components/Link\";\r\nimport HighlightTextSelection from \"components/HighlightTextSelection\";\r\n// const HANDLE_REGEX = /\\@[\\w]+/g;\r\n\r\n// export function handleStrategy(contentBlock, callback, contentState) {\r\n//   findWithRegex(HANDLE_REGEX, contentBlock, callback);\r\n// }\r\n\r\n// export function findWithRegex(regex, contentBlock, callback) {\r\n//   const text = contentBlock.getText();\r\n//   let matchArr, start;\r\n//   while ((matchArr = regex.exec(text)) !== null) {\r\n//     start = matchArr.index;\r\n//     callback(start, start + matchArr[0].length);\r\n//   }\r\n// }\r\n\r\nexport function findLinkEntities(contentBlock, callback, contentState) {\r\n    contentBlock.findEntityRanges((character) => {\r\n        const entityKey = character.getEntity();\r\n        return entityKey !== null && contentState.getEntity(entityKey).getType() === \"LINK\";\r\n    }, callback);\r\n}\r\nexport function findTextSelectionEntity(contentBlock, callback, contentState) {\r\n    contentBlock.findEntityRanges((character) => {\r\n        const entityKey = character.getEntity();\r\n        return (\r\n            entityKey !== null && contentState.getEntity(entityKey).getType() === \"TEXT_SELECTION\"\r\n        );\r\n    }, callback);\r\n}\r\n\r\nexport default [\r\n    {\r\n        strategy: findTextSelectionEntity,\r\n        component: HighlightTextSelection, // decorateComponentWithProps(LinkText, EditorState)\r\n    },\r\n    {\r\n        strategy: findLinkEntities,\r\n        component: Link,\r\n    },\r\n    // {\r\n    //     strategy: findAutoLinkEntities,\r\n    //     component: AutoLink\r\n    // }\r\n];\r\n","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\n\r\nexport default function Link(props) {\r\n    return (\r\n        <span className={css.textSelection} data-offset-key={props.offsetKey}>\r\n            {props.children}\r\n        </span>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport css from \"./index.module.css\";\r\nimport { activateLink, deactivateLink, updateLink } from \"ducks/links\";\r\nimport { setSelectedLink, setLinkActiveNoAutoTrigger } from \"ducks/ui\";\r\n\r\nexport default function Link(props) {\r\n    const dispatch = useDispatch();\r\n    const links = useSelector((state) => state.links);\r\n\r\n    let style = css.potentialLink;\r\n    const link = props.contentState.getEntity(props.entityKey).getData();\r\n    if (links[link.id]) {\r\n        if (links[link.id].isConfirmed) style = css.link;\r\n    }\r\n\r\n    function handleMouseOver() {\r\n        // if (links[link.id].isConfirmed)\r\n        dispatch(activateLink(link.id));\r\n        dispatch(setLinkActiveNoAutoTrigger(true));\r\n    }\r\n    function handleMouseLeave() {\r\n        deactivateLink(link.id);\r\n        dispatch(deactivateLink(link.id));\r\n        dispatch(setLinkActiveNoAutoTrigger(false));\r\n    }\r\n    function handleClick() {\r\n        //Quick and dirty fix! //TODO: Check later\r\n        //TODO: only store ID of link in editor.\r\n        const updatedLink = JSON.parse(JSON.stringify(link));\r\n        updatedLink.startIndex = props.start;\r\n        updatedLink.endIndex = props.end;\r\n        dispatch(setSelectedLink(updatedLink));\r\n    }\r\n\r\n    return (\r\n        <span\r\n            className={style}\r\n            onMouseOver={handleMouseOver}\r\n            onMouseLeave={handleMouseLeave}\r\n            onClick={handleClick}\r\n            data-offset-key={props.offsetKey}\r\n        >\r\n            {props.children}\r\n        </span>\r\n    );\r\n}\r\n","import React, { Fragment, useState, useRef, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { EditorState, RichUtils, convertFromRaw } from \"draft-js\";\r\n\r\nimport DraftEditor from \"draft-js-plugins-editor\";\r\n\r\nimport css from \"./index.module.css\";\r\n\r\nimport { EditorPlugins } from \"components/EditorToolbar\";\r\nimport editorDecorators from \"utils/editorDecorators\";\r\nimport removePotentialLinks from \"utils/removePotentialLinks\";\r\n\r\nexport default function Viewer(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n\r\n    const rawEditorState = useSelector((state) => state.docs[docId].editorRawState);\r\n    const editorEl = useRef(null); //https://reactjs.org/docs/hooks-reference.html#useref\r\n\r\n    const contentState =\r\n        rawEditorState === null\r\n            ? EditorState.createEmpty().getCurrentContent()\r\n            : convertFromRaw(removePotentialLinks(rawEditorState));\r\n    const [editorState, setEditorState] = useState(EditorState.createWithContent(contentState));\r\n\r\n    //Disabling edit functions in view mode!\r\n    const viewMode = props.viewMode;\r\n\r\n    function handleEditorChange(editorState) {\r\n        setEditorState(editorState);\r\n    }\r\n\r\n    function handleKeyCommand(command) {\r\n        // handle common key bindings (e.g., bold, italic, etc.)\r\n        const newEditorState = RichUtils.handleKeyCommand(editorState, command);\r\n        if (newEditorState) {\r\n            setEditorState(newEditorState);\r\n            return \"handled\";\r\n        }\r\n        return \"not-handled\";\r\n    }\r\n\r\n    return (\r\n        <Fragment>\r\n            <div className={css.viewer}>\r\n                <DraftEditor\r\n                    editorState={editorState}\r\n                    plugins={EditorPlugins}\r\n                    onChange={handleEditorChange}\r\n                    handleKeyCommand={handleKeyCommand}\r\n                    decorators={editorDecorators}\r\n                    ref={editorEl}\r\n                    readOnly={viewMode}\r\n                />\r\n            </div>\r\n        </Fragment>\r\n    );\r\n}\r\n","export default (rawEditorState) => {\r\n    let entityMap = { ...rawEditorState.entityMap };\r\n    Object.keys(entityMap).forEach(function (key) {\r\n        if (entityMap[key].type === \"LINK\") {\r\n            if (!entityMap[key].data.isConfirmed) delete entityMap[key];\r\n        }\r\n    });\r\n    const newRawEditorState = { blocks: rawEditorState.blocks, entityMap: entityMap };\r\n    return newRawEditorState;\r\n};\r\n","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport Viewer from \"components/Viewer\";\r\n\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport { setViewMode } from \"ducks/ui\";\r\nimport { useEffect } from \"react\";\r\n\r\nexport default function View(props) {\r\n    console.log(\"Viewer Mode Active!!!\");\r\n\r\n    const dispatch = useDispatch();\r\n    useEffect(() => {\r\n        dispatch(setViewMode(true));\r\n    }, []);\r\n\r\n    return (\r\n        <Grid container spacing={2}>\r\n            <Grid item xs={8}>\r\n                <Viewer viewMode={true} />\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n","import MuiAlert from \"@material-ui/lab/Alert\";\r\nimport React from \"react\";\r\n\r\nexport default function Alert(props) {\r\n    return <MuiAlert elevation={6} variant=\"filled\" {...props} />;\r\n}\r\n","import React, { useMemo, memo, useRef, useState, useEffect } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport vegaEmbed from \"vega-embed\";\r\nimport PropTypes from \"prop-types\";\r\nimport css from \"./index.module.css\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport { deleteChart } from \"ducks/charts\";\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport Alert from \"components/Alert\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\n\r\n// See ChartBlock for a chart in the editor\r\nexport function Chart(props) {\r\n    const dispatch = useDispatch();\r\n    const chartEl = useRef(null);\r\n    const chartsInEditor = useSelector((state) => state.docs[props.docId].chartsInEditor);\r\n    // why we need to stringify and parse it back? needs further investigation\r\n    const spec = useMemo(() => JSON.parse(JSON.stringify(props.spec)), [props.spec]);\r\n    // const [view, setView] = useState(null);\r\n    const [errorMsg, setErrorMsg] = useState(null);\r\n\r\n    function handleDragStart(e) {\r\n        console.log('props  in chart', props)\r\n        e.dataTransfer.setData(\"chartId\", props.id);\r\n    }\r\n\r\n    const [hover, setHover] = useState(false);\r\n    function handleEnter() {\r\n        setHover(true);\r\n    }\r\n    function handleLeave() {\r\n        setHover(false);\r\n    }\r\n    function handleKeyPress(event) {\r\n        if (event.key === \"Delete\") {\r\n            if (!chartsInEditor.includes(props.id))\r\n                dispatch(deleteChart(props.id, { docId: props.docId }));\r\n            else setErrorMsg(\"Chart can not be deleted. It is active in the editor!\");\r\n        }\r\n    }\r\n    return (\r\n        <Paper\r\n            className={css.container}\r\n            onKeyDown={handleKeyPress}\r\n            tabIndex=\"0\"\r\n            elevation={hover ? 2 : 0}\r\n        >\r\n            <div\r\n                draggable={true}\r\n                onDragStart={handleDragStart}\r\n                onMouseEnter={handleEnter}\r\n                onMouseLeave={handleLeave}\r\n            >\r\n                <Avatar src={props.thumbnail} variant='rounded' style={{ height: '150px', width: '150px' }}/>\r\n                {/* <div ref={chartEl}  /> */}\r\n            </div>\r\n            <Snackbar\r\n                open={errorMsg !== null}\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                autoHideDuration={5000}\r\n                onClose={() => {\r\n                    setErrorMsg(null);\r\n                }}\r\n            >\r\n                <Alert severity=\"error\">{errorMsg}</Alert>\r\n            </Snackbar>\r\n        </Paper>\r\n    );\r\n}\r\n\r\nChart.propTypes = {\r\n    id: PropTypes.any,\r\n    spec: PropTypes.object,\r\n    width: PropTypes.number,\r\n    height: PropTypes.number,\r\n};\r\n\r\nexport default memo(Chart);\r\n","//Parsing ChartInEditor for extracting chart features from vegalite spec\r\n\r\nimport { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\nimport { truthy, falsy } from \"vega-util\";\r\nimport { toString, isDate, isString, isArray } from \"vega-util\";\r\n\r\n// potential features?\r\n// data categories (discrete)\r\n// data values (continuous)\r\n// axis titles\r\n// legends\r\n// scales etc\r\nexport default async function (spec) {\r\n    if (!spec.data) {\r\n        return [];\r\n    }\r\n    const featureMap = {};\r\n    const runtime = parse(spec);\r\n    const view = await new View(runtime).runAsync();\r\n    const state = view.getState({\r\n        data: truthy,\r\n        signals: falsy,\r\n        recurse: true,\r\n    });\r\n\r\n    // sometimes, individual data points are not explicitely encoded using scales\r\n    for (const mark of spec.marks) {\r\n        // mu\r\n        const data = state.data[mark.name].map((d) => d.datum);\r\n\r\n        for (const datum of data) {\r\n            const isMap = mark.type === \"shape\" && mark.style.includes(\"geoshape\");\r\n            let entries = Object.entries(datum); //Object.entries(isMap ? datum : datum);\r\n            if (isMap) {\r\n                // combine with map properties\r\n                entries = entries.concat(Object.entries(datum.properties));\r\n            }\r\n            for (const [field, value] of entries) {\r\n                if (!isString(value)) {\r\n                    // only categorical data\r\n                    continue;\r\n                }\r\n                featureMap[value] = {\r\n                    value,\r\n                    type: \"string\",\r\n                    field,\r\n                    data: datum.name,\r\n                };\r\n            }\r\n        }\r\n    }\r\n    // Note: The following logic addressses two missing cases\r\n    // 1. Nested marks\r\n    // 2. Categorical scale with numeric data domain\r\n    // TODO: Can we combine the two logics elegantly?\r\n    spec.data.forEach((datum) => {\r\n        // for each data table\r\n        const viewdata = view.data(datum.name);\r\n        // console.log(\"viewdata\", viewdata);\r\n    });\r\n    //Extracting Axes of the charts\r\n    const axesMap = extractChartAxes(spec);\r\n    spec.scales\r\n        .filter((scale) => [\"ordinal\", \"band\", \"point\"].includes(scale.type))\r\n        .forEach((scale) => {\r\n            // each discrete scale\r\n            spec.data.forEach((datum) => {\r\n                // for each data table\r\n                const viewdata = view.data(datum.name);\r\n                viewdata.forEach((row) => {\r\n                    // for each row in the table\r\n                    // a single field\r\n                    if (scale.domain.field) {\r\n                        const field = scale.domain.field;\r\n                        const value = isDate(row[field]) ? row[field] : toString(row[field]);\r\n                        const type = isDate(value) ? \"date\" : \"string\";\r\n                        featureMap[value] = {\r\n                            value,\r\n                            type,\r\n                            field,\r\n                            data: datum.name,\r\n                        };\r\n                    } else if (scale.domain.fields) {\r\n                        //multiple fields from the same data\r\n                        scale.domain.fields.forEach((d) => {\r\n                            const field = isString(d) ? d : d.field;\r\n                            const value = isDate(row[field]) ? row[field] : toString(row[field]);\r\n                            const type = isDate(value) ? \"date\" : \"string\";\r\n                            featureMap[value] = {\r\n                                value,\r\n                                type,\r\n                                field,\r\n                                data: datum.name,\r\n                            };\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n            if (isArray(scale.domain)) {\r\n                // literal array\r\n                scale.domain.forEach((value) => {\r\n                    value = isDate(value) ? value : toString(value);\r\n                    const type = isDate(value) ? \"date\" : \"string\";\r\n                    const field = searchFieldName(spec, scale.name);\r\n                    featureMap[value] = {\r\n                        value,\r\n                        type,\r\n                        field,\r\n                        data: null,\r\n                    };\r\n                });\r\n            }\r\n        });\r\n    const properties = { axes: Object.values(axesMap), features: Object.values(featureMap) };\r\n    return properties;\r\n}\r\n\r\nexport const searchFieldName = (spec, scaleName) => {\r\n    for (const mark of spec.marks) {\r\n        if (mark.encode.enter) {\r\n            for (const [, props] of Object.entries(mark.encode.enter)) {\r\n                if (props.scale === scaleName && props.field) {\r\n                    return props.field;\r\n                }\r\n            }\r\n        }\r\n        if (mark.encode.update) {\r\n            for (const [, props] of Object.entries(mark.encode.update)) {\r\n                if (props.scale === scaleName && props.field) {\r\n                    return props.field;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return null;\r\n};\r\n\r\nexport const extractChartAxes = (spec) => {\r\n    let axesMap = {};\r\n    spec.scales.forEach((scale) => {\r\n        //TODO: handle cases where data is aggregated e.g., stack bar chart, stack area chart, pie chart,\r\n        const name = scale.name;\r\n        const field =\r\n            //field is array of objects\r\n            isArray(scale.domain.fields) && scale.domain.fields[0].hasOwnProperty(\"field\")\r\n                ? scale.domain.fields[0].field\r\n                : //field is simple array\r\n                isArray(scale.domain.fields)\r\n                ? scale.domain.fields\r\n                : scale.domain.field;\r\n        const data = scale.domain.data;\r\n        const type = scale.type;\r\n\r\n        const relatedAxis = spec.axes\r\n            ? spec.axes.filter((axis) => {\r\n                  return (axis.scale === name && axis.title !== undefined) || null;\r\n              })\r\n            : undefined;\r\n        const title =\r\n            isArray(relatedAxis) && relatedAxis.length > 0 && relatedAxis[0].hasOwnProperty(\"title\")\r\n                ? relatedAxis[0].title\r\n                : field //if title is not found, saving field as title (needed for maps!)\r\n                ? field\r\n                : undefined;\r\n\r\n        const axis = { name: name, field: field, data: data, type: type, title: title };\r\n        axesMap[name] = axis;\r\n    });\r\n    return axesMap;\r\n};\r\n","import { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\n\r\nconst THUMBNAIL_HEIGHT = 250;\r\nexport default async (spec) => {\r\n    // parse the spec and get the view\r\n    const runtime = parse(spec);\r\n    const view = await new View(runtime).runAsync();\r\n    // conver the view to an image\r\n    const img = await view.toImageURL(\"png\"); // base64\r\n    // resize the image to a thumbnail size\r\n    const resized = await resize(img);\r\n    return resized;\r\n};\r\n\r\nfunction resize(orgImg) {\r\n    return new Promise((resolve, reject) => {\r\n        const img = new Image();\r\n        img.src = orgImg;\r\n        img.onload = function () {\r\n            // draw the image into a thumbnail scale\r\n            const height = THUMBNAIL_HEIGHT;\r\n            const width = (height / img.height) * img.width;\r\n            const canvas = document.createElement(\"canvas\"),\r\n                ctx = canvas.getContext(\"2d\");\r\n\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n\r\n            ctx.drawImage(this, 0, 0, width, height);\r\n\r\n            // return rescaled base64 image url\r\n            resolve(canvas.toDataURL());\r\n        };\r\n    });\r\n}\r\n","import React, { useState } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport css from \"./index.module.css\";\r\nimport Chart from \"components/Chart\";\r\nimport { createChart, getCharts } from \"ducks/charts\";\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport { compile } from \"vega-lite/build/vega-lite\";\r\nimport extractChartFeatures from \"utils/extractChartFeatures\";\r\nimport createThumbnail from \"utils/createThumbnail\";\r\nimport Alert from \"components/Alert\";\r\n\r\nexport default function ChartGallery(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const [dragging, setDragging] = useState(false);\r\n    const [errorMsg, setErrorMsg] = useState(null);\r\n\r\n    const charts = useSelector((state) => getCharts(state, docId));\r\n\r\n    function handleDragEnter() {\r\n        setDragging(true);\r\n    }\r\n    function handleDragLeave() {\r\n        setDragging(false);\r\n    }\r\n    function handleDragOver(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    }\r\n\r\n    function handleDrop(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // console.log('VegaLite', VegaLite);\r\n        let file = e.dataTransfer.files[0];\r\n        if (!file) {\r\n            return;\r\n        }\r\n        // if (file.size > 1000000) {\r\n        //     // larger than 1 MB\r\n        //     setErrorMsg(\"Size too big (>1MB)!\");\r\n        //     return;\r\n        // }\r\n        if (file.type.match(\"application/json\")) {\r\n            const reader = new FileReader();\r\n\r\n            // Closure to capture the file information.\r\n            reader.onload = async (e) => {\r\n                try {\r\n                    const liteSpec = JSON.parse(e.target.result);\r\n                    const spec = compile(liteSpec).spec; // vega spec\r\n                    // support vega-lite sample datasets\r\n\r\n                    spec.data.forEach((d) => {\r\n                        if (d.url && d.url.startsWith(\"data\")) {\r\n                            d.url = process.env.PUBLIC_URL + \"/\" + d.url;\r\n                        }\r\n                    });\r\n                    const thumbnail = await createThumbnail(spec);\r\n\r\n                    const properties = await extractChartFeatures(spec);\r\n                    dispatch(createChart(docId, spec, liteSpec, { properties, thumbnail }));\r\n                } catch (e) {\r\n                    setErrorMsg(\"Syntex error in specification file!\");\r\n                }\r\n            };\r\n\r\n            reader.readAsText(file);\r\n        } else {\r\n            setErrorMsg(\"Wrong format!\");\r\n        }\r\n        setDragging(false);\r\n    }\r\n\r\n    return (\r\n        <div\r\n            className={css.container}\r\n            onDragEnter={handleDragEnter}\r\n            onDragLeave={handleDragLeave}\r\n            onDragOver={handleDragOver}\r\n            onDrop={handleDrop}\r\n        >\r\n            <Snackbar\r\n                open={errorMsg !== null}\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                autoHideDuration={5000}\r\n                onClose={() => {\r\n                    setErrorMsg(null);\r\n                }}\r\n            >\r\n                <Alert severity=\"error\">{errorMsg}</Alert>\r\n            </Snackbar>\r\n\r\n            <div className={css.draggingArea} style={{ opacity: dragging ? 0.5 : 0.0 }}>\r\n                Drop Vega-lite Spec\r\n            </div>\r\n            {charts.map((chart) => (\r\n                <Chart key={chart.id} docId={docId} id={chart.id} spec={chart.spec} thumbnail={chart.thumbnail} />\r\n            ))}\r\n        </div>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport css from \"./index.module.css\";\r\n// import { addTextLink, deactivateSuggestions } from \"../ducks/ui\";\r\n// import insertSuggestion from \"utils/insertSuggestion\";\r\n// import createTextLink from \"utils/createTextLink\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport ListItemAvatar from \"@material-ui/core/ListItemAvatar\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport LinkIcon from '@material-ui/icons/Link';\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport { setTextSelection } from \"ducks/ui\";\r\n\r\nconst SUGGESTION_LIMIT = 5;\r\nexport default function SuggestionPanel(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n\r\n    const padding = 20;\r\n\r\n    function handleClick(suggestion, event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        props.onSelected(suggestion);\r\n    }\r\n\r\n    function handleCreateLink() {\r\n        props.onCreateLinkSelect();\r\n        dispatch(setTextSelection(props.textSelection));\r\n    }\r\n    return pos ? (\r\n        <Box\r\n            zIndex=\"modal\"\r\n            left={pos.x + padding}\r\n            top={pos.y + padding}\r\n            className={css.suggestionPanel}\r\n        >\r\n            <Paper>\r\n\r\n                <List>\r\n                    <ListItem button onMouseDown={handleCreateLink}>\r\n                        {/* <ListItemAvatar>\r\n                            <Avatar>\r\n                            <LinkIcon />\r\n                            </Avatar>\r\n                        </ListItemAvatar> */}\r\n                        <ListItemIcon>\r\n                            <LinkIcon />\r\n                        </ListItemIcon>\r\n                        Create Link\r\n                    </ListItem>\r\n                    {\r\n                        // should we rank suggestions\r\n\r\n                        props.suggestions.slice(0, SUGGESTION_LIMIT).map((suggestion, i) => (\r\n                            <ListItem\r\n                                key={i}\r\n                                button\r\n                                dense\r\n                                onMouseDown={handleClick.bind(null, suggestion)}\r\n                            >\r\n                                <ListItemAvatar>\r\n                                    <Avatar alt=\"chart\" src={suggestion.thumbnail} />\r\n                                </ListItemAvatar>\r\n                                <ListItemText\r\n                                    primary={suggestion.text}\r\n                                    secondary={\r\n                                        <Typography component=\"span\" variant=\"caption\" color='textSecondary'>\r\n                                            {suggestion.chartId}\r\n                                        </Typography>\r\n                                    }\r\n                                />\r\n                            </ListItem>\r\n                        ))\r\n                    }\r\n                </List>\r\n            </Paper>\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n\r\nSuggestionPanel.propTypes = {\r\n    suggestions: PropTypes.array,\r\n    onSelected: PropTypes.func,\r\n};\r\n","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\n\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\r\nimport PropTypes from \"prop-types\";\r\nimport { setSelectedLink } from \"ducks/ui\";\r\nimport { confirmLink, deleteLink } from \"ducks/links\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\n\r\nexport default function PotentialLinkControls(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n    const padding = 10;\r\n\r\n    function handleDiscardClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        props.onDiscard(props.selectedLink);\r\n        dispatch(setSelectedLink(null));\r\n    }\r\n    function handleAcceptClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        dispatch(confirmLink(props.selectedLink.id));\r\n        props.onAccept(props.selectedLink);\r\n        dispatch(setSelectedLink(null));\r\n    }\r\n    return pos && props.selectedLink && !props.selectedLink.isConfirmed && !props.textSelection ? (\r\n        <Box\r\n            zIndex=\"modal\"\r\n            left={pos.x + padding}\r\n            top={pos.y + padding}\r\n            className={css.potentialLinkControls}\r\n        >\r\n            <Paper elevation={1}>\r\n                <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\r\n                    <Button onMouseDown={handleAcceptClick}>Accept</Button>\r\n                    <Button onMouseDown={handleDiscardClick}>Discard</Button>\r\n                </ButtonGroup>\r\n            </Paper>\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n","export default (charts, partialText, startIndex) => {\r\n    return partialText.length === 0\r\n        ? []\r\n        : [].concat(\r\n              ...charts.map((chart) =>\r\n                  chart.properties.features\r\n                      .filter((d) => {\r\n                          if (d.type === \"string\" && d.value) {\r\n                              return d.value.toLowerCase().startsWith(partialText.toLowerCase());\r\n                          } else if (d.type === \"date\") {\r\n                              //temporary\r\n                              return d.value\r\n                                  .toString()\r\n                                  .toLowerCase()\r\n                                  .includes(partialText.toLowerCase());\r\n                          }\r\n                          return false;\r\n                      })\r\n                      .map((d) => ({\r\n                          chartId: chart.id,\r\n                          thumbnail: chart.thumbnail,\r\n                          feature: d,\r\n                          text: d.value.toString(),\r\n                          startIndex,\r\n                      }))\r\n              )\r\n          );\r\n};\r\n","import util from \"util\";\r\nconst request = require(\"request\");\r\n\r\nexport default async (sentence, sentenceOffset, charts, blockKey) => {\r\n    const payload = { text: sentence, sentenceOffset, charts: charts, blockKey};\r\n    const options = {\r\n        uri: \"https://koriserver.namwkim.org/discover-links\",\r\n        method: \"POST\",\r\n        headers: {\r\n            Accept: \"application/json\",\r\n            \"Accept-Charset\": \"utf-8\",\r\n        },\r\n        json: true,\r\n        body: payload,\r\n    };\r\n\r\n    const requestPromise = util.promisify(request);\r\n    const response = await requestPromise(options);\r\n    return response.body.data;\r\n}","export default (editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n    const blockKey = currentSelection.getAnchorKey();\r\n    const currentBlock = currentContent.getBlockForKey(blockKey);\r\n    const caretOffset = currentSelection.getAnchorOffset();\r\n    const blockTextBeforeCaret = currentBlock.getText().substr(0, caretOffset);\r\n    const end = currentSelection.getAnchorOffset();\r\n\r\n    const lastWord = blockTextBeforeCaret.split(\" \").slice(-1).pop();\r\n    const start = end - lastWord.length;\r\n    return {\r\n        text: lastWord,\r\n        startIndex: start,\r\n        endIndex: end,\r\n    };\r\n};\r\n","import { Modifier, EditorState } from \"draft-js\";\r\nimport getLastTypedWord from \"./getLastTypedWord\";\r\nexport default (links, editorState) => {\r\n    links.forEach((link) => {\r\n        editorState = insertLink(link, editorState);\r\n    });\r\n    return editorState;\r\n};\r\nexport const insertLink = (link, editorState) => {\r\n\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n    const activeBlockKey = currentSelection.getAnchorKey();\r\n    const activeBlockEndIndex = currentSelection.getAnchorOffset();\r\n\r\n    let start = link.startIndex;\r\n    let end = link.endIndex;\r\n    if (start < 0) start = 0;\r\n\r\n    let newContent = currentContent.createEntity(`LINK`, \"MUTABLE\", {\r\n        ...link,\r\n    });\r\n    const entityKey = newContent.getLastCreatedEntityKey();\r\n\r\n    const insertLinkSelection = currentSelection.merge({\r\n        anchorKey: link.blockKey,\r\n        focusKey: link.blockKey,\r\n        anchorOffset: start,\r\n        focusOffset: end,\r\n    });\r\n    \r\n    const insertSuggestionSelection =  editorState.getSelection().merge({\r\n        anchorOffset: getLastTypedWord(editorState).startIndex\r\n    });\r\n\r\n    newContent = Modifier.replaceText(\r\n        editorState.getCurrentContent(),\r\n        link?.trigger === \"@\" ? insertSuggestionSelection : insertLinkSelection,\r\n        link.text,\r\n        editorState.getCurrentInlineStyle(), //inline styling\r\n        entityKey\r\n    );\r\n\r\n    //Stop cursor from jumping to beginning of a line\r\n    const caretPosition = end > activeBlockEndIndex ? end : activeBlockEndIndex;\r\n    let newEditorState = EditorState.push(editorState, newContent, \"insert-characters\");\r\n    let newSelection = newEditorState.getSelection().merge({\r\n        anchorKey: activeBlockKey,\r\n        focusKey: activeBlockKey,\r\n        focusOffset: caretPosition,\r\n        anchorOffset: caretPosition,\r\n    });\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n    return newEditorState;\r\n};\r\n","import { Modifier, EditorState } from \"draft-js\";\r\n\r\nexport default (currentSelectionState, editorState) => {\r\n    if (!currentSelectionState) return;\r\n    const currentContentState = editorState.getCurrentContent();\r\n\r\n    const newContentState = Modifier.applyEntity(currentContentState, currentSelectionState, null);\r\n    let newEditorState = EditorState.push(editorState, newContentState, \"apply-entity\");\r\n\r\n    const newCaretPosition = Math.max(\r\n        currentSelectionState.getAnchorOffset(),\r\n        currentSelectionState.getFocusOffset()\r\n    );\r\n\r\n    const newSelection = newEditorState.getSelection().merge({\r\n        focusOffset: newCaretPosition,\r\n        anchorOffset: newCaretPosition,\r\n    });\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n\r\n    return newEditorState;\r\n};\r\n","export default (editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n    const blockKey = currentSelection.getAnchorKey();\r\n    const currentBlock = currentContent.getBlockForKey(blockKey);\r\n    const blockText = currentBlock.getText();\r\n\r\n    return {blockText, blockKey};\r\n};\r\n","export default (rawEditorState, allLinksInCurrentBlockText, blockText) => {\r\n    const entityMap = { ...rawEditorState.entityMap };\r\n    allLinksInCurrentBlockText = allLinksInCurrentBlockText.filter((linkInCurrentBlockText) => {\r\n        let shouldKeep = true;\r\n        Object.keys(entityMap).forEach(function (key) {\r\n            if (entityMap[key].type === \"LINK\") {\r\n                if (\r\n                    entityMap[key].data.isConfirmed &&\r\n                    entityMap[key].data.text === linkInCurrentBlockText?.text &&\r\n                    blockText.includes(entityMap[key].data.text)\r\n                ) {\r\n                    shouldKeep = false;\r\n                }\r\n            }\r\n        });\r\n        return shouldKeep;\r\n    });\r\n    return allLinksInCurrentBlockText;\r\n};\r\n","import React, { Fragment, useState, useRef, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport PropTypes from \"prop-types\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport {\r\n    EditorState,\r\n    AtomicBlockUtils,\r\n    RichUtils,\r\n    convertToRaw,\r\n    convertFromRaw,\r\n    Modifier,\r\n    ContentState,\r\n} from \"draft-js\";\r\n\r\nimport DraftEditor from \"draft-js-plugins-editor\";\r\n\r\nimport css from \"./index.module.css\";\r\n\r\nimport EditorToolbar, { EditorPlugins } from \"components/EditorToolbar\";\r\n\r\nimport SuggestionPanel from \"components/SuggestionPanel\";\r\nimport PotentialLinkControls from \"components/PotentialLinkControls\";\r\n\r\nimport { updateDoc, updateChartsInEditor } from \"ducks/docs\";\r\nimport { createLinks, createLink, deleteLink, getLinks } from \"ducks/links\";\r\nimport { getChartsInEditor, getCharts } from \"ducks/charts\";\r\nimport { setSelectedLink, setManualLinkId, exitManualLinkMode, setTextSelection } from \"ducks/ui\";\r\n\r\nimport editorDecorators from \"utils/editorDecorators\";\r\nimport findSuggestions from \"utils/findSuggestions\";\r\nimport searchLinks from \"utils/searchLinks\";\r\nimport insertLinks from \"utils/insertLinks\";\r\nimport getLastTypedWord from \"utils/getLastTypedWord\";\r\nimport getTextSelection from \"utils/getTextSelection\";\r\nimport highlightTextSelection from \"utils/highlightTextSelection\";\r\nimport deHighlightTextSelection from \"utils/deHighlightTextSelection\";\r\nimport getBlockText from \"utils/getBlockText\";\r\nimport filterAlreadyConfirmedLinksInEditor from \"utils/filterAlreadyConfirmedLinksInEditor\";\r\nimport nlp from \"compromise\";\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport Alert from \"components/Alert\";\r\nimport createLinkObject from \"utils/createLink\"\r\n\r\nconst AUTOMATIC_SUGGESTION_TIMEOUT = 5000;\r\n\r\nexport default function Editor(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n    const charts = useSelector((state) => getCharts(state, docId));\r\n    const storedEditorState = useSelector((state) => state.docs[docId].editorRawState);\r\n    const chartsInEditor = useSelector((state) => getChartsInEditor(state, docId));\r\n    const selectedLink = useSelector((state) => state.ui.selectedLink);\r\n    const allLinks = useSelector((state) => getLinks(state,docId));\r\n    const exitManualLink = useSelector((state) => state.ui.exitManualLink);\r\n    const manualLinkId = useSelector((state) => state.ui.manualLinkId);\r\n    const linkActiveNoAutoTrigger = useSelector((state) => state.ui.linkActiveNoAutoTrigger);\r\n    const textSelectionInStore = useSelector((state) => state.ui.textSelection);\r\n\r\n    const [tempTextSelection, setTempTextSelection] = useState(textSelectionInStore);\r\n    const editorEl = useRef(null); //https://reactjs.org/docs/hooks-reference.html#useref\r\n    const [suggestions, setSuggestions] = useState([]);\r\n    const alreadySearchedSentences = useSelector((state) => state.docs[docId].searchedSentences);\r\n\r\n    const contentState =\r\n        storedEditorState === null\r\n            ? EditorState.createEmpty().getCurrentContent()\r\n            : convertFromRaw(storedEditorState);\r\n    const [editorState, setEditorState] = useState(EditorState.createWithContent(contentState));\r\n    const [currentSelectionState, setCurrentSelectionState] = useState(null);\r\n    const [currentBlock, setCurrentBlock] = useState(null);\r\n    const [infoMsg, setInfoMsg] = useState(null);\r\n    const [autoLinksToInsert, setAutoLinksToInsert] = useState([]);\r\n\r\n    let interval = useRef();\r\n\r\n    const startTimer = () => {\r\n        interval = setInterval(() => {\r\n            console.log(\"Checking for autosuggestions every:\", AUTOMATIC_SUGGESTION_TIMEOUT);\r\n            if (editorEl?.current?.props?.editorState)\r\n                setCurrentBlock(getBlockText(editorEl.current.props.editorState));\r\n        }, AUTOMATIC_SUGGESTION_TIMEOUT);\r\n        return () => clearInterval(interval.current);\r\n    };\r\n\r\n    useEffect(() => {\r\n        dispatch(exitManualLinkMode(false));\r\n        setCurrentSelectionState(null);\r\n        dispatch(setTextSelection(null));\r\n        dispatch(setManualLinkId(null));\r\n        startTimer();\r\n        return () => clearInterval(interval.current);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (exitManualLink) {\r\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\r\n            editorEl.current.focus();\r\n            dispatch(exitManualLinkMode(false));\r\n            setCurrentSelectionState(null);\r\n            //Quick and dirty fix! //Clearing Chart Selections\r\n            window.dispatchEvent(new KeyboardEvent(\"keypress\", { key: \"a\" }));\r\n        }\r\n    }, [exitManualLink]);\r\n\r\n    useEffect(() => {\r\n        if (exitManualLink && allLinks[manualLinkId] === undefined) {\r\n            //clear selection in case no brushing and pressing 'Accept'\r\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\r\n            setCurrentSelectionState(null);\r\n        }\r\n        if (allLinks[manualLinkId]) {\r\n            setEditorState(\r\n                insertLinks([allLinks[manualLinkId]], editorState, currentSelectionState)\r\n            );\r\n            dispatch(setManualLinkId(null));\r\n            setCurrentSelectionState(null);\r\n            //Quick and dirty fix! //Clearing Chart Selections\r\n            window.dispatchEvent(new KeyboardEvent(\"keypress\", { key: \"a\" }));\r\n        }\r\n    }, [manualLinkId, exitManualLink]);\r\n\r\n    useEffect(() => {\r\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\r\n        dispatch(updateDoc(doc.id, { editorRawState }));\r\n    }, [editorState]);\r\n\r\n    useEffect(()=> {\r\n        const entityMap = convertToRaw(editorState.getCurrentContent()).entityMap;\r\n        let linkIdsToKeep = [];\r\n        Object.keys(entityMap).forEach(function(key) {\r\n            if(entityMap[key].type === \"LINK\"){\r\n                if(allLinks[entityMap[key].data.id]){\r\n                    linkIdsToKeep.push(entityMap[key].data.id);\r\n                }\r\n            }     \r\n        });\r\n        Object.keys(allLinks).forEach(function(key){\r\n            if (!linkIdsToKeep.includes(key)){\r\n                dispatch(deleteLink(key));\r\n            }\r\n        });\r\n\r\n    },[Object.keys(convertToRaw(editorState.getCurrentContent()).entityMap).length]);\r\n\r\n    useEffect(() => {\r\n        const asyncExec = async () => {\r\n            if (currentBlock !== null) {\r\n                const blockText = currentBlock.blockText;\r\n                if (linkActiveNoAutoTrigger) return;\r\n                if (selectedLink) return;\r\n                if (tempTextSelection || tempTextSelection == \"INVALID\") return;\r\n                const sentences = await nlp(blockText).sentences().json();\r\n                let allLinksInCurrentBlockText = [];\r\n                let searchedSentences = [];\r\n                for (let i = 0; i < sentences.length; i++) {\r\n                    const { text } = sentences[i];\r\n                    if (!text.includes(\".\")) continue;\r\n                    if (alreadySearchedSentences?.includes(text)) continue;\r\n                    searchedSentences.push(text);\r\n\r\n                    const sentenceObject = {\r\n                        text: text,\r\n                        startIndex: blockText.indexOf(text),\r\n                        endIndex: blockText.indexOf(text) + text.length,\r\n                    };\r\n                    const links = await searchLinks(sentenceObject.text, sentenceObject.startIndex, chartsInEditor, currentBlock.blockKey);\r\n                    allLinksInCurrentBlockText = allLinksInCurrentBlockText.concat(links);\r\n                }\r\n                dispatch(\r\n                    updateDoc(doc.id, {\r\n                        searchedSentences: alreadySearchedSentences?.concat(searchedSentences),\r\n                    })\r\n                );\r\n                if (allLinksInCurrentBlockText.length > 0) {\r\n                    const rawEditorState = convertToRaw(editorState.getCurrentContent());\r\n                    allLinksInCurrentBlockText = filterAlreadyConfirmedLinksInEditor(\r\n                        rawEditorState,\r\n                        allLinksInCurrentBlockText,\r\n                        blockText\r\n                    );\r\n                    if (allLinksInCurrentBlockText.length > 0) {\r\n                        setAutoLinksToInsert(allLinksInCurrentBlockText);\r\n                    }\r\n                }\r\n                setCurrentBlock(null);\r\n            }\r\n        };\r\n        asyncExec();\r\n    }, [currentBlock]);\r\n\r\n    function handleEditorChange(editorState) {\r\n        setEditorState(editorState);\r\n        if(autoLinksToInsert.length>0){\r\n            const action = createLinks(doc.id, autoLinksToInsert);\r\n            setEditorState(insertLinks(action.links, editorState));\r\n            dispatch(action);\r\n\r\n            setAutoLinksToInsert([]);\r\n        }\r\n\r\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\r\n        const lastTypedWord = getLastTypedWord(editorState);\r\n\r\n        const allText = editorState.getCurrentContent().getPlainText(\" \").trim();\r\n        const updatedSearchedSentences = alreadySearchedSentences?.filter(\r\n            (alreadySearchedSentence) => allText.includes(alreadySearchedSentence)\r\n        );\r\n        dispatch(\r\n            updateDoc(doc.id, {\r\n                searchedSentences: updatedSearchedSentences,\r\n            })\r\n        );\r\n\r\n        //Enable SuggestionMenu on @\r\n        if (lastTypedWord.text.startsWith(\"@\")) {\r\n            const suggestions = findSuggestions(\r\n                chartsInEditor,\r\n                lastTypedWord.text.slice(1),\r\n                lastTypedWord.startIndex\r\n            );\r\n\r\n            setSuggestions(suggestions);\r\n        } else {\r\n            setSuggestions([]);\r\n        }\r\n        // TODO: see if we can catch an event for adding or removing a chart.\r\n        // Updating charts in store when a chart is added to or removed from document\r\n        const entityMap = editorRawState.entityMap;\r\n        const numCharts = Object.keys(entityMap).length;\r\n        if (numCharts !== chartsInEditor.length) {\r\n            const ids = Object.values(entityMap).reduce((acc, entity) => {\r\n                if (entity.type === \"CHART\") {\r\n                    acc.push(entity.data.id);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            dispatch(updateChartsInEditor(doc.id, ids));\r\n        }\r\n       \r\n        const currentSelection = editorState.getSelection();\r\n        const caretPosition = currentSelection.getAnchorOffset();\r\n        const activeBlockKey = currentSelection.getAnchorKey();\r\n        //Hide the link accept/delete button when cursor not in link range\r\n        //TODO: what if selection spans more than one block?\r\n        if (selectedLink && activeBlockKey) {\r\n            if (\r\n                activeBlockKey !== selectedLink.blockKey ||\r\n                caretPosition < selectedLink.startIndex ||\r\n                caretPosition > selectedLink.endIndex\r\n            ) {\r\n                dispatch(setSelectedLink(null));\r\n            }\r\n        }\r\n        let textSelection = getTextSelection(\r\n            editorState.getCurrentContent(),\r\n            currentSelection,\r\n            \" \" //delimiter\r\n        );\r\n  \r\n        //Hide the floating controls when no text is selected\r\n        setTempTextSelection(textSelection);\r\n\r\n        //search for suggestions on text selection\r\n        if (textSelection && textSelection != \"INVALID\") {\r\n            const suggestions = findSuggestions(\r\n                chartsInEditor,\r\n                textSelection.text.trim(),\r\n                textSelection.startIndex\r\n            );\r\n            suggestions.length !== 0\r\n                ? setSuggestions(suggestions)\r\n                : setSuggestions([{ text: \"NoLinkFound!\" }]);\r\n        }\r\n\r\n        const block = editorState.getCurrentContent().getBlockForKey(activeBlockKey);\r\n        if (\r\n            block.getType() === \"unstyled\" &&\r\n            !exitManualLink &&\r\n            currentSelectionState &&\r\n            !tempTextSelection\r\n        ) {\r\n            dispatch(exitManualLinkMode(true));\r\n            dispatch(setTextSelection(null));\r\n        }\r\n    }\r\n\r\n    function handleKeyCommand(command) {\r\n        // handle common key bindings (e.g., bold, italic, etc.)\r\n        const newEditorState = RichUtils.handleKeyCommand(editorState, command);\r\n        if (newEditorState) {\r\n            setEditorState(newEditorState);\r\n            return \"handled\";\r\n        }\r\n        return \"not-handled\";\r\n    }\r\n    function handleTab(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setCurrentBlock(getBlockText(editorState));\r\n        return \"handled\";\r\n    }\r\n\r\n    function handleDragOver(e) {\r\n        // may need to throttle for performance\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        editorEl.current.focus();\r\n        // e.persist(); //conflict with asynchronous setTimeout in throuttle:\r\n        //https://stackoverflow.com/questions/38142880/react-js-throttle-mousemove-event-keep-throwing-event-persist-error\r\n    }\r\n\r\n    function handleDrop(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const chartId = e.dataTransfer.getData(\"chartId\");\r\n        const chart = charts.find((d) => d.id === chartId);\r\n        const exists = chartsInEditor.find((d) => d.id === chartId);\r\n        if (chart && !exists) {\r\n            insertChart(chart);\r\n            e.dataTransfer.clearData();\r\n        }\r\n    }\r\n\r\n    function insertChart(chart) {\r\n        let contentState = editorState.getCurrentContent();\r\n\r\n        contentState = contentState.createEntity(\"CHART\", \"IMMUTABLE\", {\r\n            id: chart.id, // wil get chart info from store\r\n        });\r\n        const entityKey = contentState.getLastCreatedEntityKey();\r\n        const newEditorState = AtomicBlockUtils.insertAtomicBlock(editorState, entityKey, \" \");\r\n        setEditorState(newEditorState);\r\n    }\r\n    function handleBlur() {\r\n        setSuggestions([]);\r\n    }\r\n    function handleSuggestionSelected(suggestion) {\r\n        const commonProps = {text:suggestion.text, extent:[suggestion.startIndex, suggestion.startIndex + suggestion.text.length], blockKey:editorState.getSelection().getAnchorKey(), chartId: suggestion.chartId};\r\n        const link = createLinkObject(commonProps,{ feature: suggestion.feature, values: [isNaN(Number(suggestion.text)) ? suggestion.text : Number(suggestion.text)]},{},'@');\r\n        const action = createLink(doc.id, link); // need ids\r\n        const newEditorState = insertLinks([action.attrs], editorState);\r\n        dispatch(action);\r\n\r\n        setSuggestions([]);\r\n        setEditorState(newEditorState);\r\n    }\r\n    function handleCreateLinkSelect() {\r\n        dispatch(exitManualLinkMode(false));\r\n        setCurrentSelectionState(editorState.getSelection());\r\n        setEditorState(highlightTextSelection(tempTextSelection, editorState));\r\n        setInfoMsg(\r\n            \"Click on any chart. Use brushing or clicking to select visual marks. Multiple points can be selected holding the SHIFT key.\"\r\n        );\r\n    }\r\n\r\n    function handleLinkDiscard(link) {\r\n        //TODO: Some code is similar to insertLinks.js. Consider refactoring!\r\n        const currentSelection = editorState.getSelection();\r\n        let newContent = ContentState.createFromText(\"\");\r\n        const updateLinkExtent = getUpdatedLinkExtent(editorState);\r\n        const insertTextSelection = currentSelection.merge({\r\n            anchorOffset: updateLinkExtent.offset,\r\n            focusOffset: updateLinkExtent.offset + updateLinkExtent.length,\r\n        });\r\n        newContent = Modifier.replaceText(\r\n            editorState.getCurrentContent(),\r\n            insertTextSelection,\r\n            link.text,\r\n            editorState.getCurrentInlineStyle(), //inline styling\r\n        );\r\n        let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n        let newSelection = newEditorState.getSelection().merge({\r\n            focusOffset: link.endIndex,\r\n            anchorOffset: link.endIndex,\r\n        });\r\n        newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n        newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n        setEditorState(newEditorState);\r\n\r\n        dispatch(deleteLink(link.id));\r\n    }\r\n    function getUpdatedLinkExtent(editorState){\r\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\r\n        const currentSelection = editorState.getSelection();\r\n        const BlkKey = currentSelection.getAnchorKey();\r\n        const activeBlock = editorRawState.blocks.find(({key})=>key === BlkKey);\r\n        const caretPosition = currentSelection.getAnchorOffset();\r\n        const updateLinkExtent = activeBlock.entityRanges.find(er => (caretPosition >= er.offset && caretPosition <= er.offset + er.length));\r\n        return updateLinkExtent; \r\n    }\r\n    function handleLinkAccept(link) {\r\n        const updateLinkExtent = getUpdatedLinkExtent(editorState);\r\n        const confirmedLink = JSON.parse(JSON.stringify(link));\r\n        confirmedLink.startIndex = updateLinkExtent.offset; \r\n        confirmedLink.endIndex = updateLinkExtent.offset + updateLinkExtent.length;\r\n        confirmedLink.isConfirmed = true;\r\n        setEditorState(insertLinks([confirmedLink], editorState));\r\n    }\r\n    function handlePastedText(text){\r\n        //immediatly search for suggestions in pasted text\r\n        //TODO: for now it only searches for links in the first pargraph immediately\r\n        setCurrentBlock({blockText: text.split(\"\\n\")[0], blockKey:getBlockText(editorState).blockKey});\r\n        return \"not-handled\";\r\n    }\r\n\r\n    return (\r\n        <Fragment>\r\n            {<EditorToolbar />}\r\n            <div className={css.editor} onDragOver={handleDragOver} onDrop={handleDrop}>\r\n                <DraftEditor\r\n                    editorState={editorState}\r\n                    plugins={EditorPlugins}\r\n                    onChange={handleEditorChange}\r\n                    onBlur={handleBlur}\r\n                    handleKeyCommand={handleKeyCommand}\r\n                    handlePastedText={handlePastedText}\r\n                    stripPastedStyles={true}\r\n                    decorators={editorDecorators}\r\n                    ref={editorEl}\r\n                    onTab={handleTab}\r\n                    stripPastedStyles={true}\r\n                />\r\n            </div>\r\n            {suggestions.length >= 1 && chartsInEditor.length > 0 && (\r\n                <SuggestionPanel\r\n                    suggestions={suggestions.filter((s) => s.text !== \"NoLinkFound!\")}\r\n                    textSelection={tempTextSelection}\r\n                    onSelected={handleSuggestionSelected}\r\n                    onCreateLinkSelect={handleCreateLinkSelect}\r\n                />\r\n            )}\r\n            <PotentialLinkControls\r\n                textSelection={tempTextSelection}\r\n                selectedLink={selectedLink}\r\n                onDiscard={handleLinkDiscard}\r\n                onAccept={handleLinkAccept}\r\n            />\r\n            <Snackbar\r\n                open={infoMsg !== null}\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                autoHideDuration={5000}\r\n                onClose={() => {\r\n                    setInfoMsg(null);\r\n                }}\r\n            >\r\n                <Alert severity=\"info\">{infoMsg}</Alert>\r\n            </Snackbar>\r\n        </Fragment>\r\n    );\r\n}\r\n\r\n//Define the public proptypes of this componenet\r\nEditor.propTypes = {\r\n    editor: PropTypes.object,\r\n    updateEditorState: PropTypes.func,\r\n    addSelectedChart: PropTypes.func,\r\n};\r\n","//https://github.com/facebook/draft-js/issues/442#issuecomment-223816158\r\n//TODO: Maybe follow the next comment (on the above) and use getContentStateFragment function!\r\n\r\nexport default (contentState, selection, blockDelimiter) => {\r\n    blockDelimiter = blockDelimiter || \"\\n\";\r\n    var startKey = selection.getStartKey();\r\n    var endKey = selection.getEndKey();\r\n    var blocks = contentState.getBlockMap();\r\n    let blockKey ='';\r\n\r\n    var lastWasEnd = false;\r\n    var selectedBlock = blocks\r\n        .skipUntil(function (block) {\r\n            return block.getKey() === startKey;\r\n        })\r\n        .takeUntil(function (block) {\r\n            var result = lastWasEnd;\r\n\r\n            if (block.getKey() === endKey) {\r\n                lastWasEnd = true;\r\n            }\r\n\r\n            return result;\r\n        });\r\n    //Don't allow linking across multiple blocks\r\n    if (selectedBlock.length > 1) return \"INVALID\";\r\n    const text = selectedBlock\r\n        .map(function (block) {\r\n            var key = block.getKey();\r\n            var text = block.getText();\r\n\r\n            let start = 0;\r\n            let end = text.length;\r\n\r\n            if (key === startKey) {\r\n                start = selection.getStartOffset();\r\n            }\r\n            if (key === endKey) {\r\n                end = selection.getEndOffset();\r\n            }\r\n            text = text.slice(start, end);\r\n            blockKey=key;\r\n            return text;\r\n        })\r\n        .join(blockDelimiter);\r\n    let sIndex = selection.getStartOffset();\r\n    let eIndex = selection.getEndOffset();\r\n    if (selection.isBackward) {\r\n        eIndex = selection.getEndOffset();\r\n        sIndex = selection.getStartOffset();\r\n    }\r\n    return selection.getStartOffset() !== selection.getEndOffset()\r\n        ? { text: text, startIndex: sIndex, endIndex: eIndex, blockKey, isBackward:selection.isBackward}\r\n        : null;\r\n};\r\n","import { Modifier, EditorState } from \"draft-js\";\r\n\r\nexport default (textSelection, editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n\r\n    let newContent = currentContent.createEntity(`TEXT_SELECTION`, \"MUTABLE\", {\r\n        ...textSelection,\r\n    });\r\n\r\n    let start = textSelection.startIndex;\r\n    let end = textSelection.endIndex;\r\n\r\n    if(textSelection.isBackward){\r\n        start = textSelection.endIndex;\r\n        end = textSelection.startIndex\r\n    }\r\n\r\n    const entityKey = newContent.getLastCreatedEntityKey();\r\n\r\n    const insertTextSelection = currentSelection.merge({\r\n        anchorOffset:start,\r\n        focusOffset: end,\r\n    });\r\n    newContent = Modifier.replaceText(\r\n        editorState.getCurrentContent(),\r\n        insertTextSelection,\r\n        textSelection.text,\r\n        editorState.getCurrentInlineStyle(), //inline styling\r\n        entityKey\r\n    );\r\n    let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n    let newSelection = newEditorState.getSelection().merge({\r\n        focusOffset: textSelection.endIndex,\r\n        anchorOffset: textSelection.endIndex,\r\n    });\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n    return newEditorState;\r\n};\r\n","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\n// import TextField from '@material-ui/core/TextField';\r\nimport ChartGallery from \"components/ChartGallery\";\r\nimport Editor from \"components/Editor\";\r\n\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport { setViewMode } from \"ducks/ui\";\r\nimport { useEffect } from \"react\";\r\n\r\nexport default function Edit(props) {\r\n    const dispatch = useDispatch();\r\n    useEffect(() => {\r\n        dispatch(setViewMode(false));\r\n    }, []);\r\n\r\n    return (\r\n        <Grid container spacing={2}>\r\n            <Grid item xs={2}>\r\n                <Typography variant=\"overline\" display=\"block\" gutterBottom>\r\n                    Chart Gallery\r\n                </Typography>\r\n                <ChartGallery />\r\n            </Grid>\r\n            <Grid item xs={8}>\r\n                <Editor />\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport Navbar from \"components/Navbar\";\r\nimport Home from 'components/Home';\r\nimport Docs from 'components/Docs';\r\nimport View from 'components/View';\r\nimport Edit from 'components/Edit';\r\nimport { BrowserRouter as Router, Switch, Route } from \"react-router-dom\";\r\nimport Container from '@material-ui/core/Container';\r\n\r\nfunction App() {\r\n  return (\r\n    <Router>\r\n      <Navbar />\r\n      <Container maxWidth=\"lg\" mt={2}>\r\n        <Switch>\r\n          <Route path=\"/docs/:docId/view\">\r\n            <View />\r\n          </Route>\r\n          <Route path=\"/docs/:docId\">\r\n            <Edit />\r\n          </Route>\r\n          <Route path=\"/docs\">\r\n            <Docs />\r\n          </Route>\r\n          <Route path=\"/\">\r\n            <Home />\r\n          </Route>\r\n          \r\n        </Switch>\r\n      </Container>\r\n    </Router>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import { combineReducers } from \"redux\";\r\n// import editor from \"./editor\";\r\nimport charts from \"./charts\";\r\nimport docs from \"./docs\";\r\nimport links from \"./links\";\r\nimport ui from \"./ui\";\r\n\r\nexport default combineReducers({\r\n  docs,\r\n  charts,\r\n  links,\r\n  ui\r\n});\r\n\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\nimport { createLogger } from \"redux-logger\";\r\nimport reduxFreeze from \"redux-freeze\";\r\nimport { Provider } from \"react-redux\";\r\nimport { applyMiddleware, createStore } from \"redux\";\r\nimport rootReducer from \"./ducks\";\r\nimport localforage from \"localforage\";\r\nimport throttle from \"./utils/throttle\";\r\n\r\nimport { createMuiTheme, ThemeProvider } from \"@material-ui/core/styles\";\r\nconst theme = createMuiTheme({\r\n    //https://material-ui.com/customization/palette/\r\n    palette: {\r\n        primary: {\r\n            main: \"#2196f3\",\r\n        },\r\n        secondary: {\r\n            main: \"#e91e63\",\r\n        },\r\n        info: {\r\n            main: \"#1976d2\",\r\n        },\r\n        error: {\r\n            main: \"#f44336\",\r\n        },\r\n        warning: {\r\n            main: \"#ff9800\",\r\n        },\r\n        success: {\r\n            main: \"#4caf50\",\r\n        },\r\n    },\r\n    secondary: {\r\n        main: \"#e91e63\",\r\n    },\r\n    info: {\r\n        main: \"#1976d2\",\r\n    },\r\n    error: {\r\n        main: \"#f44336\",\r\n    },\r\n    warning: {\r\n        main: \"#ff9800\",\r\n    },\r\n    success: {\r\n        main: \"#4caf50\",\r\n    },\r\n    textSecondary: {\r\n        main: \"#bdbdbd\",\r\n    },\r\n});\r\n// console.log(logger);\r\n\r\nlet loadData = new Promise((resolve, reject) => {\r\n    localforage\r\n        .getItem(\"state\")\r\n        .then((data) => {\r\n            resolve(data);\r\n        })\r\n        .catch((err) => {\r\n            reject(err);\r\n        });\r\n});\r\n\r\nloadData\r\n    .then((data) => {\r\n        let middleware = [reduxFreeze, createLogger()];\r\n        let store = createStore(\r\n            rootReducer,\r\n            // {},\r\n            data ? data : {},\r\n            applyMiddleware(...middleware)\r\n        );\r\n        // initialize if ne\r\n        if (!data) {\r\n        }\r\n        store.subscribe(\r\n            throttle(() => {\r\n                let state = { ...store.getState() };\r\n                // delete state[\"ui\"]; // don't persist ui sate\r\n                localforage.setItem(\"state\", state);\r\n            }, 1000)\r\n        );\r\n        // localforage.clear(function(err) {\r\n        //   // Run this code once the database has been entirely deleted.\r\n        //   console.log(\"Database is now empty.\");\r\n        // });\r\n        ReactDOM.render(\r\n            <Provider store={store}>\r\n                <ThemeProvider theme={theme}>\r\n                    <App />\r\n                </ThemeProvider>\r\n            </Provider>,\r\n            document.getElementById(\"root\")\r\n        );\r\n    })\r\n    .catch((err) => {\r\n        console.log(err);\r\n        ReactDOM.render(<div>Failed to initialize data!</div>, document.getElementById(\"root\"));\r\n    });\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}