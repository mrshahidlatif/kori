{"version":3,"sources":["components/ChartConfigPanel/index.module.css","components/Link/index.module.css","components/ChartGallery/index.module.css","components/Viewer/index.module.css","components/HighlightTextSelection/index.module.css","components/Chart/index.module.css","components/Editor/index.module.css","components/SuggestionPanel/index.module.css","components/PotentialLinkControls/index.module.css","utils/uniqueId.js","ducks/charts.js","ducks/docs.js","components/Navbar/index.jsx","components/Home/index.jsx","ducks/ui.js","components/Doc/index.jsx","components/Docs/index.jsx","utils/addSignalToChartSpec.js","utils/addBrushToVegaLiteSpec.js","utils/throttle.js","components/ChartConfigPanel/index.jsx","components/ChartBlock/index.jsx","components/EditorToolbar/index.jsx","utils/createChartBlockPlugin.js","ducks/links.js","utils/editorDecorators.js","components/HighlightTextSelection/index.jsx","components/Link/index.jsx","components/Viewer/index.jsx","utils/removePotentialLinks.js","components/View/index.jsx","components/Alert/index.jsx","components/Chart/index.jsx","utils/extractChartFeatures.js","utils/createThumbnail.js","components/ChartGallery/index.jsx","components/SuggestionPanel/index.jsx","components/PotentialLinkControls/index.jsx","utils/findSuggestions.js","utils/searchLinks.js","utils/getBlockText.js","utils/getLastTypedWord.js","utils/insertLinks.js","utils/deHighlightTextSelection.js","utils/filterAlreadyConfirmedLinksInEditor.js","utils/createLink.js","components/Editor/index.jsx","utils/getTextSelection.js","utils/highlightTextSelection.js","components/Filter/index.jsx","components/ManualLinkControls/index.jsx","components/EditLinkSetting/index.jsx","components/ChartSetting/index.jsx","components/LinkSetting/index.jsx","components/Edit/index.jsx","App.js","serviceWorker.js","ducks/index.js","index.js"],"names":["module","exports","nanoid","customAlphabet","prefix","createChart","docId","spec","liteSpec","attrs","chartId","uniqueId","type","timestamp","Date","now","highlight","channel","active","inactive","id","updateChart","getCharts","createSelector","state","docs","charts","_","map","cid","getChartsInEditor","chartsInEditor","initialState","testchart","thumbnail","properties","axes","name","field","data","title","features","value","barChartSpec","barChartLiteSpec","updateDoc","testdoc","searchedSentences","editorRawState","blocks","key","text","depth","inlineStyleRanges","offset","length","style","entityRanges","entityMap","useStyles","makeStyles","theme","root","flexGrow","marginBottom","spacing","classes","dispatch","useDispatch","useSelector","ui","currentDocId","doc","AppBar","className","position","color","Toolbar","variant","Link","underline","component","RouterLink","to","TextField","onChange","e","target","size","fullWidth","margin","marginLeft","marginRight","label","Button","Home","Grid","container","justify","item","xs","Typography","gutterBottom","Box","Fab","aria-label","display","setSelectedLink","link","setTextSelection","textSelection","setManualLinkId","linkId","exitManualLinkMode","exit","setViewMode","val","setLinkActiveNoAutoTrigger","showLinkSettingFor","button","width","padding","paper","justifyContent","alignItems","palette","secondary","height","Doc","props","onClick","Paper","elevation","Docs","Object","values","action","createDoc","addBrush","selections","includes","mark","paintbrush","toggle","clear","brush","encoding","condition","selection","addBrushToVegaLiteSpec","compile","forEach","d","url","startsWith","process","signals","start","end","enabled","marks","addSignalToMark","isMap","activePredicate","inactivePredicate","oldProp","encode","update","highlightProp","test","concat","isArray","func","last","deferTimer","wait","throttled","args","clearTimeout","setTimeout","ChartConfigPanel","channelOptions","opacity","fill","colors","chart","useState","setActive","setInactive","handleActiveChangeCommitted","event","newValue","handleInactiveChangeCommitted","zIndex","css","panel","top","left","onMouseDown","stopPropagation","p","direction","Select","option","keys","MenuItem","Slider","aria-labelledby","valueLabelDisplay","min","max","step","onChangeCommitted","picker","bgcolor","border","onMouseUp","memo","block","blockProps","customStyleMap","customStyleFn","decorator","forceSelection","offsetKey","tree","contentState","blockStyleFn","preventScroll","elementProps","view","setView","containerEl","useRef","chartEl","ratio","setRatio","toggleSettings","setToggleSettings","viewMode","links","filter","shallowEqual","useMemo","addSignalToChartSpec","JSON","parse","stringify","resize","current","getBoundingClientRect","useEffect","a","runtime","View","runAsync","tempView","toCanvas","canvas","vegaEmbed","actions","result","asyncExec","throttle","some","signal","feature","rangeField","range","showConfig","getAnchorKey","getKey","Fragment","ref","IconButton","toolbarPlugin","createToolbarPlugin","focusPlugin","createFocusPlugin","alignmentPlugin","createAlignmentPlugin","resizeablePlugin","createResizeablePlugin","AlignmentTool","EditorPlugins","config","ChartBlock","blockRendererFn","getEditorState","getType","getCurrentContent","getEntityAt","entity","getEntity","getData","editable","createChartBlockPlugin","composeDecorators","EditorToolbar","externalProps","createLinks","deleteLink","deactivateLink","getLinks","fromEntries","entries","strategy","contentBlock","callback","findEntityRanges","character","entityKey","data-offset-key","children","potentialLink","isConfirmed","onMouseOver","onMouseLeave","updatedLink","startIndex","endIndex","Viewer","useParams","rawEditorState","editorEl","EditorState","createEmpty","convertFromRaw","removePotentialLinks","createWithContent","editorState","setEditorState","viewer","plugins","handleKeyCommand","command","newEditorState","RichUtils","decorators","editorDecorators","readOnly","console","log","Alert","errorMsg","setErrorMsg","hover","setHover","onKeyDown","tabIndex","draggable","onDragStart","dataTransfer","setData","onMouseEnter","Avatar","src","Snackbar","open","anchorOrigin","vertical","horizontal","autoHideDuration","onClose","severity","featureMap","getState","truthy","falsy","recurse","datum","isString","axesMap","extractChartAxes","scales","scale","row","domain","isDate","toString","fields","searchFieldName","scaleName","enter","hasOwnProperty","relatedAxis","axis","undefined","toImageURL","img","resized","orgImg","Promise","resolve","reject","Image","onload","document","createElement","ctx","getContext","drawImage","this","toDataURL","ChartGallery","dragging","setDragging","onDragEnter","onDragLeave","onDragOver","preventDefault","onDrop","file","files","match","reader","FileReader","createThumbnail","extractChartFeatures","readAsText","draggingArea","SuggestionPanel","window","getSelection","pos","rangeCount","getRangeAt","handleClick","suggestion","onSelected","x","y","suggestionPanel","List","ListItem","onCreateLinkSelect","ListItemIcon","suggestions","slice","i","dense","bind","ListItemAvatar","alt","ListItemText","primary","PotentialLinkControls","selectedLink","potentialLinkControls","ButtonGroup","onAccept","onDiscard","partialText","toLowerCase","request","require","sentence","sentenceOffset","blockKey","options","uri","method","headers","Accept","json","body","requestPromise","util","promisify","response","currentContent","blockText","getBlockForKey","getText","currentSelection","currentBlock","caretOffset","getAnchorOffset","blockTextBeforeCaret","substr","lastWord","split","pop","currentBlockText","getBlockText","insertLink","activeBlockKey","find","allInstancesOfLink","indexOf","push","newContent","createEntity","getLastCreatedEntityKey","insertLinkSelection","merge","anchorKey","focusKey","anchorOffset","focusOffset","insertSuggestionSelection","getLastTypedWord","Modifier","replaceText","trigger","getCurrentInlineStyle","caretPosition","newSelection","currentSelectionState","currentContentState","newContentState","applyEntity","newCaretPosition","Math","getFocusOffset","moveSelectionToEnd","allLinksInCurrentBlockText","linkInCurrentBlockText","shouldKeep","extent","Editor","storedEditorState","allLinks","exitManualLink","manualLinkId","linkActiveNoAutoTrigger","textSelectionInStore","tempTextSelection","setTempTextSelection","setSuggestions","alreadySearchedSentences","setCurrentSelectionState","setCurrentBlock","infoMsg","setInfoMsg","autoLinksToInsert","setAutoLinksToInsert","getUpdatedLinkExtent","convertToRaw","BlkKey","activeBlock","er","deHighlightTextSelection","focus","dispatchEvent","KeyboardEvent","insertLinks","msg","linkIdsToKeep","nlp","sentences","sentenceObject","searchLinks","filterAlreadyConfirmedLinksInEditor","seen","Set","el","duplicate","has","add","editor","exists","AtomicBlockUtils","insertAtomicBlock","insertChart","clearData","lastTypedWord","allText","getPlainText","trim","updatedSearchedSentences","alreadySearchedSentence","findSuggestions","ids","reduce","acc","updateChartsInEditor","blockDelimiter","startKey","getStartKey","endKey","getEndKey","getBlockMap","lastWasEnd","selectedBlock","skipUntil","takeUntil","getStartOffset","getEndOffset","join","sIndex","eIndex","isBackward","getTextSelection","onBlur","handlePastedText","stripPastedStyles","onTab","s","commonProps","createLinkObject","isNaN","Number","createLink","insertTextSelection","highlightTextSelection","ContentState","createFromText","updateLinkExtent","confirmedLink","ValueLabelComponent","Tooltip","enterTouchDelay","placement","Filter","setAxis","React","setValue","textValue","setTextValue","setMarks","showSlider","setShowSlider","pointFeatures","setPointFeatures","chartProperties","filterOptions","featureFields","f","showRightControlsForFilter","filterField","Array","axisObj","myArray","tmp","lowest","POSITIVE_INFINITY","highest","NEGATIVE_INFINITY","getMinMax","viewData","vd","minDate","maxDate","newMarks","toLocaleDateString","toLocaleString","axisFeatures","onFilterUpdate","intervalValues","fontSize","onDelete","FormControl","formControl","InputLabel","htmlFor","native","o","Autocomplete","multiple","getOptionLabel","renderInput","params","valueLabelFormat","chartAvatars","ManualLinkControls","showField","setShowField","setLink","selectedPoints","setSelectedPoints","filters","setFilters","selectedChart","axisOptions","makeManualLink","multiPoint","points","j","_vgsid_","brushField","handleFilterDelete","filterId","updatedFilters","handleFilterUpdate","filterState","newFilters","nf","selectedMarks","mode","dataProps","currentDoc","showSelectedLinkSetting","selectedAxis","sp","ao","FormHelperText","EditLinkSetting","linkToUpdate","stringValues","setStringValues","multiline","rowsMax","hidden","ChartSetting","setSelectedMarks","setViewData","setBrush","addDataListener","error","marginTop","toggleBtn","largeAvatar","largeAvatarActive","LinkSetting","setSelectedChart","creationMode","setCreationMode","createNewLink","setCreateNewLink","c","handleChartAvatarClick","ToggleButtonGroup","exclusive","ToggleButton","Edit","App","Navbar","Container","maxWidth","mt","path","Boolean","location","hostname","combineReducers","newState","createMuiTheme","main","info","warning","success","textSecondary","localforage","getItem","then","catch","err","reduxFreeze","createLogger","store","createStore","rootReducer","subscribe","setItem","ReactDOM","render","ThemeProvider","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.10219d5e.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"panel\":\"ChartConfigPanel_panel__1RNdy\",\"picker\":\"ChartConfigPanel_picker__2a-s5\",\"color\":\"ChartConfigPanel_color__20B1t\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"link\":\"Link_link__1gb_b\",\"potentialLink\":\"Link_potentialLink__1rq0F\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ChartGallery_container__1wEZt\",\"draggingArea\":\"ChartGallery_draggingArea__1Gg2j\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"viewer\":\"Viewer_viewer__HAVcj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"textSelection\":\"HighlightTextSelection_textSelection__1oqm1\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Chart_container__yFe1W\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"editor\":\"Editor_editor__3K1fD\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"suggestionPanel\":\"SuggestionPanel_suggestionPanel__2D0HC\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"potentialLinkControls\":\"PotentialLinkControls_potentialLinkControls__2Lyp9\"};","import { customAlphabet } from 'nanoid'\nconst nanoid = customAlphabet('1234567890abcdefghijklmnopqrstuvwxyz', 10)\nexport default (prefix) => { \n\treturn (prefix ? prefix + nanoid() : nanoid());\n};","import uniqueId from \"utils/uniqueId\";\nimport barChartSpec from \"./specs/barchart.json\";\nimport barChartLiteSpec from \"./specs/barChartLite.json\";\nimport { createSelector } from \"reselect\";\n\n// action types\nexport const CREATE_CHART = \"CREATE_CHART\";\nexport const UPDATE_CHART = \"UPDATE_CHART\";\nexport const DELETE_CHART = \"DELETE_CHART\";\n\n// actions\nexport const createChart = (docId, spec, liteSpec, attrs = {}) => {\n    let chartId = uniqueId(\"chart-\");\n    attrs = {\n        docId,\n        spec,\n        liteSpec,\n        timestamp: Date.now(),\n        highlight: { channel: \"opacity\", active: 1.0, inactive: 0.1 },\n        ...attrs,\n        id: chartId,\n    };\n    return { type: CREATE_CHART, chartId, attrs };\n};\n\nexport const updateChart = (chartId, attrs) => {\n    return { type: UPDATE_CHART, chartId, attrs };\n};\n\nexport const deleteChart = (chartId, attrs) => {\n    return {\n        type: DELETE_CHART,\n        chartId,\n        attrs,\n    };\n};\n// selectors\nexport const getCharts = createSelector(\n    (state) => state.docs,\n    (state) => state.charts,\n    (_, docId) => docId,\n    (docs, charts, docId) => docs[docId].charts.map((cid) => charts[cid])\n);\n\nexport const getChartsInEditor = createSelector(\n    (state) => state.docs,\n    (state) => state.charts,\n    (_, docId) => docId,\n    (docs, charts, docId) => docs[docId].chartsInEditor.map((cid) => charts[cid])\n);\n// reducers\nconst initialState = {\n    testchart: {\n        id: \"testchart\",\n        docId: \"testdoc\",\n        timestamp: Date.now(),\n        thumbnail:\n            \"data:image/png;base64,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\",\n        highlight: { channel: \"opacity\", active: 1.0, inactive: 0.1 },\n        properties: {\n            axes: [\n                {\n                    name: \"x\",\n                    field: \"category\",\n                    data: \"data_0\",\n                    type: \"ordinal\",\n                    title: \"category\",\n                },\n                { name: \"y\", field: \"amount\", data: \"data_0\", type: \"linear\", title: \"amount\" },\n            ],\n            features: [\n                { value: \"Apple\", type: \"string\", field: \"category\", data: \"data_0\" },\n                { value: \"Amazon\", type: \"string\", field: \"category\", data: \"data_0\" },\n                { value: \"Facebook\", type: \"string\", field: \"category\", data: \"data_0\" },\n                { value: \"Netflix\", type: \"string\", field: \"category\", data: \"data_0\" },\n                { value: \"Microsoft\", type: \"string\", field: \"category\", data: \"data_0\" },\n                { value: \"Samsung\", type: \"string\", field: \"category\", data: \"data_0\" },\n                { value: \"Twitter\", type: \"string\", field: \"category\", data: \"data_0\" },\n                { value: \"Linkedin\", type: \"string\", field: \"category\", data: \"data_0\" },\n            ],\n        },\n        spec: barChartSpec,\n        liteSpec: barChartLiteSpec,\n    },\n};\n\nexport default (state = initialState, action) => {\n    switch (action.type) {\n        case CREATE_CHART:\n        case UPDATE_CHART:\n            return {\n                ...state,\n                [action.chartId]: {\n                    ...(state[action.chartId] || {}),\n                    ...action.attrs,\n                },\n            };\n        case DELETE_CHART: {\n            let newState = {\n                ...state,\n            };\n            delete newState[action.chartId];\n            return newState;\n        }\n\n        default:\n            return state;\n    }\n};\n","import uniqueId from \"utils/uniqueId\";\nimport { CREATE_CHART, DELETE_CHART } from \"ducks/charts\";\n// action types\nexport const CREATE_DOC = \"CREATE_DOC\";\nexport const UPDATE_DOC = \"UPDATE_DOC\";\nexport const DELETE_DOC = \"DELETE_DOC\";\n\nexport const UPDATE_EDITOR_STATE = \"UPDATE_EDITOR_STATE\";\nexport const UPDATE_CHARTS_IN_EDITOR = \"UPDATE_CHARTS_IN_EDITOR\";\n\n// actions\nexport const createDoc = (attrs = {}) => {\n    let docId = uniqueId();\n    attrs = {\n        title: \"Untitled\",\n        editorRawState: null,\n        timestamp: Date.now(),\n        searchedSentences: [],\n        charts: [],\n        chartsInEditor: [],\n        ...attrs,\n        id: docId,\n    };\n    return { type: CREATE_DOC, docId, attrs };\n};\n\nexport const updateDoc = (docId, attrs) => {\n    return { type: UPDATE_DOC, docId, attrs };\n};\n\nexport const deleteDoc = (docId) => {\n    return {\n        type: DELETE_DOC,\n        docId,\n    };\n};\n\nexport const updateChartsInEditor = (docId, charts) => {\n    return { type: UPDATE_CHARTS_IN_EDITOR, docId, charts };\n};\n\n// selectors\n\n// reducers\n\nconst initialState = {\n    testdoc: {\n        id: \"testdoc\",\n        title: \"Testing...\",\n        timestamp: Date.now(),\n        charts: [\"testchart\"],\n        chartsInEditor: [],\n        searchedSentences: [],\n        editorRawState: {\n            blocks: [\n                {\n                    key: \"8i090\",\n                    text: \"Welcome to Vis-Text Editor\",\n                    type: \"unstyled\",\n                    depth: 0,\n                    inlineStyleRanges: [\n                        {\n                            offset: 0,\n                            length: 26,\n                            style: \"BOLD\",\n                        },\n                    ],\n                    entityRanges: [],\n                    data: {},\n                },\n                {\n                    key: \"42ncd\",\n                    text: \"Here you can compose interactive articles\",\n                    type: \"unstyled\",\n                    depth: 0,\n                    inlineStyleRanges: [\n                        {\n                            offset: 0,\n                            length: 42,\n                            style: \"UNDERLINE\",\n                        },\n                    ],\n                    entityRanges: [],\n                    data: {},\n                },\n                {\n                    key: \"327r6\",\n                    text:\n                        \"Start dragging the chart from Chart Gallery to the editor and start creating! ;)\",\n                    type: \"unstyled\",\n                    depth: 0,\n                    inlineStyleRanges: [\n                        {\n                            offset: 0,\n                            length: 81,\n                            style: \"ITALIC\",\n                        },\n                    ],\n                    entityRanges: [],\n                    data: {},\n                },\n            ],\n            entityMap: {},\n        },\n    },\n};\nexport default (state = initialState, action) => {\n    switch (action.type) {\n        case CREATE_DOC:\n        case UPDATE_DOC:\n            return {\n                ...state,\n                [action.docId]: {\n                    ...(state[action.docId] || {}),\n                    ...action.attrs,\n                },\n            };\n        case DELETE_DOC: {\n            let newState = {\n                ...state,\n            };\n            delete newState[action.docId];\n            return newState;\n        }\n        case CREATE_CHART:\n            return {\n                ...state,\n                [action.attrs.docId]: {\n                    ...state[action.attrs.docId],\n                    charts: state[action.attrs.docId].charts.concat(action.chartId),\n                },\n            };\n        case DELETE_CHART:\n            return {\n                ...state,\n                [action.attrs.docId]: {\n                    ...state[action.attrs.docId],\n                    charts: state[action.attrs.docId].charts.filter(\n                        (cid) => cid !== action.chartId\n                    ),\n                },\n            };\n\n        case UPDATE_CHARTS_IN_EDITOR:\n            return {\n                ...state,\n                [action.docId]: {\n                    ...state[action.docId],\n                    chartsInEditor: action.charts,\n                },\n            };\n        case UPDATE_EDITOR_STATE:\n            return {\n                ...state,\n                [action.docId]: {\n                    ...state[action.docId],\n                    editorRawState: action.editorRawState,\n                },\n            };\n        default:\n            return state;\n    }\n};\n","import React, { Fragment } from \"react\";\nimport { Link as RouterLink } from \"react-router-dom\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport AppBar from \"@material-ui/core/AppBar\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport Button from \"@material-ui/core/Button\";\nimport Link from \"@material-ui/core/Link\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { updateDoc } from \"ducks/docs\";\n\nconst useStyles = makeStyles((theme) => ({\n    root: {\n        flexGrow: 1,\n        marginBottom: theme.spacing(3),\n    },\n    // menuButton: {\n    //   marginRight: theme.spacing(2),\n    // },\n    title: {\n        flexGrow: 1,\n    },\n}));\n\nexport default function () {\n    const classes = useStyles();\n    const dispatch = useDispatch();\n    const docId = useSelector((state) => state.ui.currentDocId);\n    const doc = useSelector((state) => state.docs[docId]);\n\n    function handleChange(e) {\n        dispatch(updateDoc(docId, { title: e.target.value }));\n    }\n    return (\n        <AppBar className={classes.root} position=\"static\" color=\"inherit\">\n            <Toolbar variant=\"dense\">\n                {/* <Button  color=\"inherit\" component={RouterLink} to=\"/docs\">\n        <Typography variant=\"h6\" className={classes.title}>\n        GORI\n          </Typography>\n        </Button> */}\n                <Link\n                    variant=\"h6\"\n                    className={classes.title}\n                    underline=\"none\"\n                    color=\"inherit\"\n                    component={RouterLink}\n                    to=\"/\"\n                >\n                    KORI\n                </Link>\n                {/* <Typography variant=\"h6\" className={classes.title} >\n\n          \n          </Typography> */}\n                {docId && (\n                    <TextField\n                        value={doc.title}\n                        onChange={handleChange}\n                        size=\"small\"\n                        fullWidth\n                        margin=\"dense\"\n                        variant=\"filled\"\n                        style={{ marginLeft: \"100px\", marginRight: \"20px\" }}\n                        label=\"Document Title\"\n                    />\n                )}\n                <Button color=\"inherit\" component={RouterLink} to=\"/docs\">\n                    Docs\n                </Button>\n\n                {docId && (\n                    <Fragment>\n                        <span style={{ marginLeft: \"10px\", marginRight: \"10px\" }}> | </span>\n                        <Button color=\"inherit\" component={RouterLink} to={`/docs/${docId}`}>\n                            Edit\n                        </Button>\n                        <Button color=\"inherit\" component={RouterLink} to={`/docs/${docId}/view`}>\n                            View\n                        </Button>\n                    </Fragment>\n                )}\n            </Toolbar>\n        </AppBar>\n    );\n}\n","import React from \"react\";\nimport Fab from \"@material-ui/core/Fab\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Box from \"@material-ui/core/Box\";\nimport NavigationIcon from \"@material-ui/icons/Navigation\";\nimport Grid from \"@material-ui/core/Grid\";\nimport { Link } from \"react-router-dom\";\nfunction Home() {\n    return (\n        <Grid container spacing={3} justify=\"center\">\n            <Grid item xs={6}>\n                <Typography variant=\"h2\" gutterBottom>\n                    KORI\n                </Typography>\n                <Box marginBottom={2}>\n                    <Typography variant=\"body1\" gutterBottom>\n                        Abstract\n                    </Typography>\n                </Box>\n                <Fab\n                    variant=\"extended\"\n                    color=\"primary\"\n                    aria-label=\"add\"\n                    component={Link}\n                    to=\"/docs\"\n                >\n                    <NavigationIcon />\n                    Get Started\n                </Fab>\n            </Grid>\n            <Grid item xs={6}>\n                <Typography variant=\"overline\" display=\"block\" gutterBottom>\n                    Teaser Image/Video\n                </Typography>\n            </Grid>\n        </Grid>\n    );\n}\n\nexport default Home;\n","export const SET_SELECTED_LINK = \"SET_SELECTED_LINK\";\nexport const SET_TEXT_SELECTION = \"SET_TEXT_SELECTION\";\nexport const SET_MANUAL_LINK_ID = \"SET_MANUAL_LINK_ID\";\nexport const EXIT_MANUAL_LINK_MODE = \"EXIT_MANUAL_LINK_MODE\";\nexport const SET_CURRENT_DOC_ID = \"SET_CURRENT_DOC_ID\";\nexport const SET_VIEW_MODE = \"SET_VIEW_MODE\";\nexport const LINK_ACTIVE_NO_AUTO_TRIGGER = \"LINK_ACTIVE_NO_AUTO_TRIGGER\";\nexport const SHOW_LINK_SETTING_FOR = \"SHOW_LINK_SETTING_FOR\"\n\nexport const setSelectedLink = (link) => {\n    return { type: SET_SELECTED_LINK, link };\n};\nexport const setTextSelection = (textSelection) => {\n    return { type: SET_TEXT_SELECTION, textSelection };\n};\nexport const setManualLinkId = (linkId) => {\n    return { type: SET_MANUAL_LINK_ID, linkId };\n};\nexport const exitManualLinkMode = (exit) => {\n    return { type: EXIT_MANUAL_LINK_MODE, exit };\n};\n\nexport const SetCurrentDocId = (docId) => {\n    return { type: SET_CURRENT_DOC_ID, docId };\n};\nexport const setViewMode = (val) => {\n    return { type: SET_VIEW_MODE, val };\n};\nexport const setLinkActiveNoAutoTrigger = (val) => {\n    return { type: LINK_ACTIVE_NO_AUTO_TRIGGER, val };\n};\nexport const showLinkSettingFor = (val) => {\n    return { type: SHOW_LINK_SETTING_FOR, val };\n};\n//reducers\nconst initialState = {};\n\nexport default (state = initialState, action) => {\n    switch (action.type) {\n        case SET_SELECTED_LINK:\n            return {\n                ...state,\n                selectedLink: action.link,\n            };\n        case SET_TEXT_SELECTION:\n            return {\n                ...state,\n                textSelection: action.textSelection,\n            };\n        case SET_MANUAL_LINK_ID:\n            return {\n                ...state,\n                manualLinkId: action.linkId,\n            };\n        case EXIT_MANUAL_LINK_MODE:\n            return {\n                ...state,\n                exitManualLink: action.exit,\n            };\n        case SET_CURRENT_DOC_ID:\n            return {\n                ...state,\n                currentDocId: action.docId,\n            };\n        case SET_VIEW_MODE:\n            return { ...state, viewMode: action.val };\n        case LINK_ACTIVE_NO_AUTO_TRIGGER:\n            return { ...state, linkActiveNoAutoTrigger: action.val };\n        case SHOW_LINK_SETTING_FOR:\n            return { ...state, showLinkSettingFor: action.val};\n        default:\n            return state;\n    }\n};\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Grid from \"@material-ui/core/Grid\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport Button from \"@material-ui/core/Button\";\nimport { Link as RouterLink } from \"react-router-dom\";\nimport { useSelector, useDispatch } from \"react-redux\";\n\nimport { createDoc } from \"ducks/docs\";\nimport { SetCurrentDocId } from \"ducks/ui\";\n\nconst useStyles = makeStyles((theme) => ({\n    button: {\n        width: \"100%\",\n        padding: theme.spacing(1),\n        margin: theme.spacing(1),\n    },\n    paper: {\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        color: theme.palette.text.secondary,\n        height: theme.spacing(16),\n        width: \"100%\",\n    },\n}));\n\nfunction Doc(props) {\n    const classes = useStyles();\n    const dispatch = useDispatch();\n\n    function handleClick() {\n        dispatch(SetCurrentDocId(props.docId));\n    }\n\n    return (\n        <Button\n            className={classes.button}\n            component={RouterLink}\n            to={`/docs/${props.docId}`}\n            onClick={handleClick}\n        >\n            <Paper className={classes.paper} elevation={2}>\n                {props.doc.title}\n                <div></div>\n            </Paper>\n        </Button>\n    );\n}\n\nexport default Doc;\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Grid from \"@material-ui/core/Grid\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport Button from \"@material-ui/core/Button\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport Doc from \"components/Doc\";\n\nimport { createDoc } from \"ducks/docs\";\n\nconst useStyles = makeStyles((theme) => ({\n    button: {\n        width: \"100%\",\n        padding: theme.spacing(1),\n        margin: theme.spacing(1),\n    },\n    paper: {\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        color: theme.palette.text.secondary,\n        height: theme.spacing(16),\n        width: \"100%\",\n    },\n}));\n\nfunction Docs() {\n    const classes = useStyles();\n    const dispatch = useDispatch();\n    const docs = useSelector((state) => Object.values(state.docs));\n\n    function handleClick() {\n        const action = createDoc();\n        dispatch(action);\n    }\n\n    return (\n        <Grid container spacing={1}>\n            <Grid item xs={2}>\n                <Button className={classes.button} onClick={handleClick}>\n                    <Paper className={classes.paper} variant=\"outlined\">\n                        <AddIcon />\n                    </Paper>\n                </Button>\n            </Grid>\n            {docs.map((doc) => (\n                <Grid key={doc.id} item xs={2}>\n                    <Doc doc={doc} docId={doc.id} />\n                </Grid>\n            ))}\n        </Grid>\n    );\n}\n\nexport default Docs;\n","// TODO: support different encodings?\nimport { isArray, isObject } from \"vega-util\";\nimport addBrushToVegaLiteSpec from \"utils/addBrushToVegaLiteSpec\";\nimport { compile } from \"vega-lite/build/vega-lite\";\n\nexport default (highlight, liteSpec, addBrush) => {\n    try {\n        if(addBrush) addBrushToVegaLiteSpec(liteSpec);\n        \n    } catch (e) {}\n\n    const spec = compile(liteSpec).spec; // vega spec\n    // support vega-lite sample datasets\n\n    spec.data.forEach((d) => {\n        if (d.url && d.url.startsWith(\"data\")) {\n            d.url = process.env.PUBLIC_URL + \"/\" + d.url;\n        }\n    });\n\n    // highlight\n    spec.signals = [\n        ...(spec.signals || []),\n        {\n            name: \"highlight\", // should we add a prefix to avoid conflict with existing signals\n            value: { data: [], start: 0, end: 100, enabled: false },\n        },\n    ];\n\n    spec.marks.forEach((mark) => {\n        addSignalToMark(mark, highlight);\n    });\n    return spec;\n};\n\nexport function addSignalToMark(mark, highlight) {\n    if (mark.type === \"group\") {\n        // recursive\n        if (mark.marks) {\n            mark.marks.forEach((mark) => addSignalToMark(mark, highlight)); // will this generalize to all charts?\n        }\n        return;\n    }\n    const isMap = mark.type === \"shape\" && mark.style.includes(\"geoshape\");\n    //Warning: Not scalable solution, only handles combination of a categorical with upto 3 numerical axis\n    //TODO: see if we can combine two categorical variables using the same logic\n    const activePredicate = `highlight.enabled===true && (\n        (length(highlight.rangeField) === 0 && ${\n            isMap ? \"indexof(highlight.data, datum.properties[highlight.field]) != -1 || indexof(highlight.data, datum[highlight.field]) != -1\"  : \"indexof(highlight.data, datum[highlight.field]) != -1\"\n        }) || \n\n        length(highlight.rangeField) === 0 && length(highlight.field) === 2 && indexof(highlight.data, datum[highlight.field[0]]) != -1 && \n        indexof(highlight.data, datum[highlight.field[1]]) || \n\n        (length(highlight.rangeField) === 1 && ${\n            isMap ? \"indexof(highlight.data, datum.properties[highlight.field]) != -1 || indexof(highlight.data, datum[highlight.field]) != -1\" : \"indexof(highlight.data, datum[highlight.field]) != -1\"\n        }) && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) || \n\n        length(highlight.rangeField) === 1 && length(highlight.data) === 0 && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) ||\n\n        length(highlight.rangeField) === 2 && length(highlight.data) === 0 && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) && \n        inrange(datum[highlight.rangeField[1]], [highlight.range[2], highlight.range[3]]) ||\n\n        (length(highlight.rangeField) === 2 && ${\n            isMap ? \"indexof(highlight.data, datum.properties[highlight.field]) != -1 || indexof(highlight.data, datum[highlight.field]) != -1\" : \"indexof(highlight.data, datum[highlight.field]) != -1\"\n        }) && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) && inrange(datum[highlight.rangeField[1]], [highlight.range[2], highlight.range[3]]) ||\n\n        length(highlight.rangeField) === 3 && length(highlight.data) === 0 && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) && \n        inrange(datum[highlight.rangeField[1]], [highlight.range[2], highlight.range[3]]) && inrange(datum[highlight.rangeField[2]], [highlight.range[4], highlight.range[5]]) ||\n\n        (length(highlight.rangeField) === 3 && ${\n            isMap ? \"indexof(highlight.data, datum.properties[highlight.field]) != -1 || indexof(highlight.data, datum[highlight.field]) != -1\" : \"indexof(highlight.data, datum[highlight.field]) != -1\"\n        }) && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) && inrange(datum[highlight.rangeField[1]], [highlight.range[2], highlight.range[3]]) &&\n        inrange(datum[highlight.rangeField[2]], [highlight.range[4], highlight.range[5]])\n\n\n    )`;\n    //TODO: reduce redundant checking, Also check if we need this at all\n    const inactivePredicate =`highlight.enabled===true && !(\n        (length(highlight.rangeField) === 0 && ${\n            isMap ? \"indexof(highlight.data, datum.properties[highlight.field]) != -1\" : \"indexof(highlight.data, datum[highlight.field]) != -1\"\n        })\n    )`;\n    const oldProp = mark.encode.update[highlight.channel];\n    const highlightProp = [\n        {\n            test: activePredicate,\n            value: highlight.active,\n        },\n        {\n            test: inactivePredicate,\n            value: highlight.inactive,\n        },\n        // put existing property if exists either in array or object form\n        //TODO: see if we need the Object Check?\n        // ...(isObject(oldProp) ? [oldProp] : isArray(oldProp) ? oldProp : []),\n    ];\n    mark.encode.update = {\n        ...mark.encode.update,\n        [highlight.channel]: highlightProp.concat(isArray(oldProp) ? oldProp : []),\n    };\n}\n","export default (liteSpec) => {\n    // No rectangular brush for maps\n    const noBrush = [\"geoshape\"].includes(liteSpec.mark) || liteSpec.mark.type === \"arc\";\n    const selections = noBrush\n        ? {\n              paintbrush: { type: \"multi\", toggle: true, clear: \"window:keypress\", },\n              \n          }\n        : {\n              brush: {\n                  type: \"interval\",\n                  clear: \"window:keypress\",\n              },\n              paintbrush: {\n                  type: \"multi\",\n                  toggle: true,\n                  clear: \"window:keypress\",\n              },\n          };\n\n    liteSpec[\"selection\"] = selections;\n    //TODO: Check what's wrong with multiple conditions https://github.com/vega/vega-lite/issues/3040\n    liteSpec.encoding[\"opacity\"] = {\n        condition: [\n            // {\n            //     selection: \"brush\",\n            //     value: 1,\n            // },\n            {\n                selection: \"paintbrush\",\n                value: 1,\n            },\n        ],\n        value: 0.1,\n    };\n    return liteSpec;\n};\n","export default (func, wait = 50) => {\n  let last;\n  let deferTimer;\n\n  const throttled = (...args) => {\n    const now = Date.now();\n\n    if (last && now < last + wait) {\n      clearTimeout(deferTimer);\n\n      deferTimer = setTimeout(() => {\n        last = now;\n        func(...args);\n      }, wait);\n    } else {\n      last = now;\n      func(...args);\n    }\n  };\n\n  return throttled;\n};\n","import React, { useState } from \"react\";\nimport css from \"./index.module.css\";\nimport Box from \"@material-ui/core/Box\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Typography from \"@material-ui/core/Typography\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Slider from \"@material-ui/core/Slider\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Select from \"@material-ui/core/Select\";\nimport PropTypes from \"prop-types\";\nimport { useDispatch } from \"react-redux\";\nimport { updateChart } from \"ducks/charts\";\n\nexport default function ChartConfigPanel(props) {\n    const dispatch = useDispatch();\n    const channelOptions = {\n        opacity: { active: 1.0, inactive: 0.1 },\n        fill: { active: \"#1f77b4\", inactive: \"#c7c7c7\" },\n    };\n    const colors = [\n        \"#1f77b4\",\n        \"#aec7e8\",\n        \"#ff7f0e\",\n        \"#ffbb78\",\n        \"#2ca02c\",\n        \"#98df8a\",\n        \"#d62728\",\n        \"#ff9896\",\n        \"#9467bd\",\n        \"#c5b0d5\",\n        \"#8c564b\",\n        \"#c49c94\",\n        \"#e377c2\",\n        \"#f7b6d2\",\n        \"#7f7f7f\",\n        \"#c7c7c7\",\n        \"#bcbd22\",\n        \"#dbdb8d\",\n        \"#17becf\",\n        \"#9edae5\",\n    ];\n    const highlight = props.chart.highlight;\n    const [active, setActive] = useState(highlight.active); // necessary for handling intermediate changes\n    const [inactive, setInactive] = useState(highlight.inactive); // to prevent constant flickering chart updates\n    function handleChannelChange(event) {\n        // setChannel(event.target.value);\n        const channel = event.target.value;\n\n        if (channel !== highlight.channel) {\n            const option = channelOptions[channel];\n            setActive(option.active);\n            setInactive(option.inactive);\n            dispatch(\n                updateChart(props.chart.id, { highlight: { channel, ...channelOptions[channel] } })\n            );\n        }\n    }\n    function handleActiveChange(event, newValue) {\n        setActive(newValue);\n    }\n    function handleInactiveChange(event, newValue) {\n        setInactive(newValue);\n    }\n    function handleActiveChangeCommitted(event, newValue) {\n        setActive(newValue);\n        dispatch(updateChart(props.chart.id, { highlight: { ...highlight, active: newValue } }));\n    }\n    function handleInactiveChangeCommitted(event, newValue) {\n        setInactive(newValue);\n        dispatch(updateChart(props.chart.id, { highlight: { ...highlight, inactive: newValue } }));\n    }\n    return (\n        <div>\n            <Box\n                zIndex=\"modal\"\n                className={css.panel}\n                top={40}\n                left={\"45%\"}\n                onMouseDown={(e) => e.stopPropagation()}\n            >\n                <Box component={Paper} p={2}>\n                    <Grid container direction=\"column\" spacing={2}>\n                        <Grid item>\n                            <Typography gutterBottom>Highlight Option</Typography>\n                        </Grid>\n                        <Grid item>\n                            <Typography variant=\"caption\">Channel</Typography>\n                            <Box>\n                                <Select value={highlight.channel} onChange={handleChannelChange}>\n                                    {Object.keys(channelOptions).map((option) => (\n                                        <MenuItem key={option} value={option}>\n                                            {option}\n                                        </MenuItem>\n                                    ))}\n                                </Select>\n                            </Box>\n                        </Grid>\n                        <Grid item>\n                            <Typography variant=\"caption\">Active</Typography>\n                            {highlight.channel === \"opacity\" ? (\n                                <Slider\n                                    value={active}\n                                    aria-labelledby=\"discrete-slider\"\n                                    valueLabelDisplay=\"auto\"\n                                    min={0.0}\n                                    max={1.0}\n                                    step={0.05}\n                                    onChange={handleActiveChange}\n                                    onChangeCommitted={handleActiveChangeCommitted}\n                                />\n                            ) : (\n                                <Box className={css.picker}>\n                                    {colors.map((color) => (\n                                        <Box\n                                            className={css.color}\n                                            bgcolor={color}\n                                            border={color === active ? 1 : 0}\n                                            onMouseUp={(e) => handleActiveChangeCommitted(e, color)}\n                                        />\n                                    ))}\n                                </Box>\n                            )}\n                            <Typography variant=\"caption\">Inactive</Typography>\n                            {highlight.channel === \"opacity\" ? (\n                                <Slider\n                                    value={inactive}\n                                    aria-labelledby=\"discrete-slider\"\n                                    valueLabelDisplay=\"auto\"\n                                    min={0.0}\n                                    max={1.0}\n                                    step={0.05}\n                                    onChange={handleInactiveChange}\n                                    onChangeCommitted={handleInactiveChangeCommitted}\n                                />\n                            ) : (\n                                <Box className={css.picker}>\n                                    {colors.map((color) => (\n                                        <Box\n                                            className={css.color}\n                                            bgcolor={color}\n                                            border={color === inactive ? 1 : 0}\n                                            onMouseUp={(e) =>\n                                                handleInactiveChangeCommitted(e, color)\n                                            }\n                                        />\n                                    ))}\n                                </Box>\n                            )}\n                        </Grid>\n                    </Grid>\n                </Box>\n            </Box>\n        </div>\n    );\n}\n\nChartConfigPanel.propTypes = {\n    chart: PropTypes.object,\n    onUpdated: PropTypes.func,\n};\n","import React, { useEffect, useMemo, memo, useState, useRef } from \"react\";\nimport { useSelector, shallowEqual } from \"react-redux\";\nimport addSignalToChartSpec from \"utils/addSignalToChartSpec\";\nimport vegaEmbed from \"vega-embed\";\nimport throttle from \"utils/throttle\";\nimport { parse } from \"vega-parser\";\nimport { View } from \"vega-view\";\nimport ChartConfigPanel from \"components/ChartConfigPanel\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport SettingsIcon from \"@material-ui/icons/Settings\";\n\nexport default memo(function ChartBlock({\n    block,\n    blockProps,\n    customStyleMap,\n    customStyleFn,\n    decorator,\n    forceSelection,\n    offsetKey,\n    selection,\n    tree,\n    contentState,\n    blockStyleFn, //weird props passed from editor\n    preventScroll, //weird props passed from editor\n    style,\n    ...elementProps\n}) {\n    const [view, setView] = useState(null);\n    const containerEl = useRef(null);\n    const chartEl = useRef(null);\n    const [ratio, setRatio] = useState(1);\n    const chart = useSelector((state) => state.charts[blockProps.id]);\n    const [toggleSettings, setToggleSettings] = useState(false);\n    const viewMode = useSelector((state) => state.ui.viewMode);\n\n    // TODO: use a memoized selector for performance\n    const links = useSelector(\n        (state) => Object.values(state.links).filter((link) => link.chartId === blockProps.id),\n        shallowEqual\n    );\n    const spec = useMemo(\n        () =>\n            addSignalToChartSpec(\n                chart.highlight,\n                JSON.parse(JSON.stringify(chart.liteSpec)),\n                false\n            ),\n        [chart.spec, chart.highlight]\n    );\n\n    useEffect(() => {\n        const asyncExec = async () => {\n            // compute canvas aspect ratio to maintain it while resizing\n\n            const runtime = parse(spec);\n            const tempView = await new View(runtime).runAsync();\n\n            const canvas = await tempView.toCanvas();\n            const ratio = canvas.height / canvas.width;\n            setRatio(ratio);\n\n            // add autosize: has limitations: https://vega.github.io/vega-lite/docs/size.html#limitations\n\n            // spec.autosize = {\n            //     type: \"fit\",\n            //     contains: \"padding\",\n            //     resize: true,\n            // };\n            const result = await vegaEmbed(chartEl.current, spec, { actions: false });\n            const view = result.view;\n            setView(view);\n        };\n        asyncExec();\n    }, [spec]);\n\n    useEffect(\n        throttle(async () => {\n            resize(view, ratio);\n        }, 500)\n    );\n\n    function resize(view, ratio) {\n        if (view) {\n            const { width } = containerEl.current.getBoundingClientRect();\n            const height = ratio * width;\n            // view.resize().height(height).width(width).runAsync();\n        }\n    }\n    useEffect(() => {\n        if (!view) {\n            return;\n        }\n        if (links.some((link) => link.active)) {\n            // Should we send all signals at once? would it improve performance?\n            links\n                .filter((link) => link.active)\n                .forEach((link) => {\n                    view.signal(\"highlight\", {\n                        type: link.type,\n                        data: link.data || [],\n                        field: link.feature?.field || '',\n                        enabled: true,\n                        rangeField: link.rangeField || [],\n                        range: link.range || [],\n                    }).runAsync();\n                });\n        } else {\n            view.signal(\"highlight\", { enabled: false }).runAsync();\n        }\n    }, [links]);\n\n    function handleSettingClick() {\n        setToggleSettings(!toggleSettings);\n    }\n\n    const showConfig = viewMode ? false : selection.getAnchorKey() === block.getKey(); // show only clicking this block\n\n    return (\n        <React.Fragment>\n            <div ref={containerEl} {...elementProps} style={{...style, position: \"relative\", width: \"fit-content\"}}>\n                <div>\n                    {showConfig && (\n                        <IconButton\n                            onMouseDown={handleSettingClick}\n                            aria-label=\"settings\"\n                            // color=\"primary\"\n                        >\n                            <SettingsIcon />\n                        </IconButton>\n                    )}\n                </div>\n                <div ref={chartEl} />\n                {showConfig && toggleSettings && <ChartConfigPanel chart={chart} />}\n            </div>\n        </React.Fragment>\n    );\n});\n","\nimport React, { Fragment } from 'react';\nimport createToolbarPlugin, { Separator } from \"draft-js-static-toolbar-plugin\";\nimport createAlignmentPlugin from \"draft-js-alignment-plugin\";\nimport createFocusPlugin from \"draft-js-focus-plugin\";\nimport createResizeablePlugin from 'draft-js-resizeable-plugin';\n\nimport \"draft-js-static-toolbar-plugin/lib/plugin.css\";\nimport \"draft-js-alignment-plugin/lib/plugin.css\";\nimport \"draft-js-focus-plugin/lib/plugin.css\";\n// import \"draft-js-resizeable-plugin/lib/plugin.css\";\n\nimport createChartBlockPlugin from 'utils/createChartBlockPlugin';\n\nimport {\n  ItalicButton,\n  BoldButton,\n  UnderlineButton,\n  CodeButton,\n  HeadlineOneButton,\n  HeadlineTwoButton,\n  HeadlineThreeButton,\n  UnorderedListButton,\n  OrderedListButton,\n  BlockquoteButton,\n  CodeBlockButton\n} from \"draft-js-buttons\";\nimport { composeDecorators } from \"draft-js-plugins-editor\";\n\n\nconst toolbarPlugin = createToolbarPlugin();\nconst focusPlugin = createFocusPlugin();\nconst alignmentPlugin = createAlignmentPlugin();\nconst resizeablePlugin = createResizeablePlugin();\n\nconst { AlignmentTool } = alignmentPlugin;\nconst { Toolbar } = toolbarPlugin;\nconst decorator = composeDecorators(\n  focusPlugin.decorator,\n  resizeablePlugin.decorator,\n  alignmentPlugin.decorator\n);\n\nconst chartBlockPlugin = createChartBlockPlugin({ decorator });\nexport const EditorPlugins = [focusPlugin, resizeablePlugin, alignmentPlugin, toolbarPlugin, chartBlockPlugin];\n\nexport default function EditorToolbar() {\n  return (\n    <Fragment>\n      <Toolbar>\n        {// may be use React.Fragment instead of div to improve perfomance after React 16\n          externalProps => (\n            <div>\n              <BoldButton {...externalProps} />\n              <ItalicButton {...externalProps} />\n              <UnderlineButton {...externalProps} />\n              <CodeButton {...externalProps} />\n              <Separator {...externalProps} />\n              <HeadlineOneButton {...externalProps} />\n              <HeadlineTwoButton {...externalProps} />\n              <HeadlineThreeButton {...externalProps} />\n              <UnorderedListButton {...externalProps} />\n              <OrderedListButton {...externalProps} />\n              <BlockquoteButton {...externalProps} />\n              <CodeBlockButton {...externalProps} />\n            </div>\n          )}\n      </Toolbar>\n      <AlignmentTool />\n    </Fragment>\n\n  )\n}","\nimport ChartBlock from 'components/ChartBlock';\n\nexport default (config = {}) => {\n    const component = config.decorator\n        ? config.decorator(ChartBlock)\n        : ChartBlock;\n\n    return {\n        blockRendererFn: (block, { getEditorState }) => {\n            if (block.getType() === \"atomic\") {\n                const contentState = getEditorState().getCurrentContent();\n                if (!block.getEntityAt(0)) return;\n                const entity = contentState.getEntity(block.getEntityAt(0));\n                const data = entity.getData();\n                const type = entity.getType();\n                if (type === \"CHART\") {\n                    return {\n                        component,\n                        editable: false,\n                        props:{\n                            ...data\n                        }\n                    };\n                }\n            }\n            return null;\n        },\n        ChartBlock\n    };\n};","import uniqueId from \"utils/uniqueId\";\nimport { createSelector } from \"reselect\";\n\n// action types\nexport const CREATE_LINK = \"CREATE_LINK\";\nexport const UPDATE_LINK = \"UPDATE_LINK\";\nexport const DELETE_LINK = \"DELETE_LINK\";\nexport const ACTIVATE_LINK = \"ACTIVATE_LINK\";\nexport const DEACTIVATE_LINK = \"DEACTIVATE_LINK\";\nexport const CREATE_LINKS = \"CREATE_LINKS\";\nexport const CONFIRM_LINK = \"CONFIRM_LINK\";\n\nexport const createLink = (docId, link, attrs = {}) => {\n    let linkId = uniqueId(\"link-\");\n    attrs = {\n        docId,\n        timestamp: Date.now(),\n        ...link, // chartId, text, etc\n        ...attrs, // will override the above properties if any attr is set in attrs\n        id: linkId,\n    };\n    return { type: CREATE_LINK, linkId, attrs };\n};\n\nexport const createLinks = (docId, links) => {\n    return {\n        type: CREATE_LINKS,\n        links: links.map((link) => ({\n            ...link,\n            timestamp: Date.now(),\n            docId,\n            id: uniqueId(\"link-\"),\n        })),\n    };\n};\n\nexport const updateLink = (linkId, attrs) => {\n    return { type: UPDATE_LINK, linkId, attrs };\n};\n\nexport const deleteLink = (linkId) => {\n    return {\n        type: DELETE_LINK,\n        linkId,\n    };\n};\n\nexport const activateLink = (linkId) => {\n    return {\n        type: ACTIVATE_LINK,\n        linkId,\n    };\n};\n\nexport const deactivateLink = (linkId) => {\n    return {\n        type: DEACTIVATE_LINK,\n        linkId,\n    };\n};\n\nexport const confirmLink = (linkId) => {\n    return {\n        type: CONFIRM_LINK,\n        linkId,\n    };\n};\n\n// selectors\nexport const getLinks = createSelector(\n    (state) => state.links,\n    (_, docId) => docId,\n    (links, docId) => Object.fromEntries(Object.entries(links).filter(([k,v]) => v.docId === docId))\n);\n\n// reducers\nexport default (state = {}, action) => {\n    switch (action.type) {\n        case CREATE_LINK:\n        case UPDATE_LINK:\n            return {\n                ...state,\n                [action.linkId]: {\n                    ...(state[action.linkId] || {}),\n                    ...action.attrs,\n                },\n            };\n        case CREATE_LINKS:\n            return action.links.reduce((state, link) => {\n                return {\n                    ...state,\n                    [link.id]: link,\n                };\n            }, state);\n        case DELETE_LINK: {\n            let newState = {\n                ...state,\n            };\n            delete newState[action.linkId];\n            return newState;\n        }\n        case ACTIVATE_LINK:\n            return {\n                ...state,\n                [action.linkId]: {\n                    ...state[action.linkId],\n                    active: true,\n                },\n            };\n        case DEACTIVATE_LINK:\n            return {\n                ...state,\n                [action.linkId]: {\n                    ...state[action.linkId],\n                    active: false,\n                },\n            };\n        case CONFIRM_LINK:\n            return {\n                ...state,\n                [action.linkId]: {\n                    ...state[action.linkId],\n                    isConfirmed: true,\n                },\n            };\n        default:\n            return state;\n    }\n};\n","/**\n * Super simple decorators for handles and hashtags, for demonstration\n * purposes only. Don't reuse these regexes.\n */\n//TODO: REGEX needs to be improved and crafted to our use case!\n// import LinkText from 'components/LinkText';\n// import AutoLink from 'components/AutoLink';\nimport Link from \"components/Link\";\nimport HighlightTextSelection from \"components/HighlightTextSelection\";\n// const HANDLE_REGEX = /\\@[\\w]+/g;\n\n// export function handleStrategy(contentBlock, callback, contentState) {\n//   findWithRegex(HANDLE_REGEX, contentBlock, callback);\n// }\n\n// export function findWithRegex(regex, contentBlock, callback) {\n//   const text = contentBlock.getText();\n//   let matchArr, start;\n//   while ((matchArr = regex.exec(text)) !== null) {\n//     start = matchArr.index;\n//     callback(start, start + matchArr[0].length);\n//   }\n// }\n\nexport function findLinkEntities(contentBlock, callback, contentState) {\n    contentBlock.findEntityRanges((character) => {\n        const entityKey = character.getEntity();\n        return entityKey !== null && contentState.getEntity(entityKey).getType() === \"LINK\";\n    }, callback);\n}\nexport function findTextSelectionEntity(contentBlock, callback, contentState) {\n    contentBlock.findEntityRanges((character) => {\n        const entityKey = character.getEntity();\n        return (\n            entityKey !== null && contentState.getEntity(entityKey).getType() === \"TEXT_SELECTION\"\n        );\n    }, callback);\n}\n\nexport default [\n    {\n        strategy: findTextSelectionEntity,\n        component: HighlightTextSelection, // decorateComponentWithProps(LinkText, EditorState)\n    },\n    {\n        strategy: findLinkEntities,\n        component: Link,\n    },\n    // {\n    //     strategy: findAutoLinkEntities,\n    //     component: AutoLink\n    // }\n];\n","import React from \"react\";\nimport css from \"./index.module.css\";\n\nexport default function Link(props) {\n    return (\n        <span className={css.textSelection} data-offset-key={props.offsetKey}>\n            {props.children}\n        </span>\n    );\n}\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport css from \"./index.module.css\";\nimport { activateLink, deactivateLink, updateLink } from \"ducks/links\";\nimport { setSelectedLink, setLinkActiveNoAutoTrigger } from \"ducks/ui\";\n\nexport default function Link(props) {\n    const dispatch = useDispatch();\n    const links = useSelector((state) => state.links);\n\n    let style = css.potentialLink;\n    const link = props.contentState.getEntity(props.entityKey).getData();\n    if (links[link.id]) {\n        if (links[link.id].isConfirmed) style = css.link;\n    }\n\n    function handleMouseOver() {\n        // if (links[link.id].isConfirmed)\n        dispatch(activateLink(link.id));\n        dispatch(setLinkActiveNoAutoTrigger(true));\n    }\n    function handleMouseLeave() {\n        deactivateLink(link.id);\n        dispatch(deactivateLink(link.id));\n        dispatch(setLinkActiveNoAutoTrigger(false));\n    }\n    function handleClick() {\n        //Quick and dirty fix! //TODO: Check later\n        //TODO: only store ID of link in editor.\n        const updatedLink = JSON.parse(JSON.stringify(link));\n        updatedLink.startIndex = props.start;\n        updatedLink.endIndex = props.end;\n        dispatch(setSelectedLink(updatedLink));\n    }\n\n    return (\n        <span\n            className={style}\n            onMouseOver={handleMouseOver}\n            onMouseLeave={handleMouseLeave}\n            onClick={handleClick}\n            data-offset-key={props.offsetKey}\n        >\n            {props.children}\n        </span>\n    );\n}\n","import React, { Fragment, useState, useRef, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useParams } from \"react-router-dom\";\nimport { EditorState, RichUtils, convertFromRaw } from \"draft-js\";\n\nimport DraftEditor from \"draft-js-plugins-editor\";\n\nimport css from \"./index.module.css\";\n\nimport { EditorPlugins } from \"components/EditorToolbar\";\nimport editorDecorators from \"utils/editorDecorators\";\nimport removePotentialLinks from \"utils/removePotentialLinks\";\n\nexport default function Viewer(props) {\n    const dispatch = useDispatch();\n    let { docId } = useParams();\n    const doc = useSelector((state) => state.docs[docId]);\n\n    const rawEditorState = useSelector((state) => state.docs[docId].editorRawState);\n    const editorEl = useRef(null); //https://reactjs.org/docs/hooks-reference.html#useref\n\n    const contentState =\n        rawEditorState === null\n            ? EditorState.createEmpty().getCurrentContent()\n            : convertFromRaw(removePotentialLinks(rawEditorState));\n    const [editorState, setEditorState] = useState(EditorState.createWithContent(contentState));\n\n    //Disabling edit functions in view mode!\n    const viewMode = props.viewMode;\n\n    function handleEditorChange(editorState) {\n        setEditorState(editorState);\n    }\n\n    function handleKeyCommand(command) {\n        // handle common key bindings (e.g., bold, italic, etc.)\n        const newEditorState = RichUtils.handleKeyCommand(editorState, command);\n        if (newEditorState) {\n            setEditorState(newEditorState);\n            return \"handled\";\n        }\n        return \"not-handled\";\n    }\n\n    return (\n        <Fragment>\n            <div className={css.viewer}>\n                <DraftEditor\n                    editorState={editorState}\n                    plugins={EditorPlugins}\n                    onChange={handleEditorChange}\n                    handleKeyCommand={handleKeyCommand}\n                    decorators={editorDecorators}\n                    ref={editorEl}\n                    readOnly={viewMode}\n                />\n            </div>\n        </Fragment>\n    );\n}\n","export default (rawEditorState) => {\n    let entityMap = { ...rawEditorState.entityMap };\n    Object.keys(entityMap).forEach(function (key) {\n        if (entityMap[key].type === \"LINK\") {\n            if (!entityMap[key].data.isConfirmed) delete entityMap[key];\n        }\n    });\n    const newRawEditorState = { blocks: rawEditorState.blocks, entityMap: entityMap };\n    return newRawEditorState;\n};\n","import React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport Viewer from \"components/Viewer\";\n\nimport Grid from \"@material-ui/core/Grid\";\nimport { setViewMode } from \"ducks/ui\";\nimport { useEffect } from \"react\";\n\nexport default function View(props) {\n    console.log(\"Viewer Mode Active!!!\");\n\n    const dispatch = useDispatch();\n    useEffect(() => {\n        dispatch(setViewMode(true));\n    }, []);\n\n    return (\n        <Grid container spacing={2}>\n            <Grid item xs={8}>\n                <Viewer viewMode={true} />\n            </Grid>\n        </Grid>\n    );\n}\n","import MuiAlert from \"@material-ui/lab/Alert\";\nimport React from \"react\";\n\nexport default function Alert(props) {\n    return <MuiAlert elevation={6} variant=\"filled\" {...props} />;\n}\n","import React, { memo, useState} from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport css from \"./index.module.css\";\nimport Paper from \"@material-ui/core/Paper\";\nimport { deleteChart } from \"ducks/charts\";\nimport Snackbar from \"@material-ui/core/Snackbar\";\nimport Alert from \"components/Alert\";\nimport Avatar from \"@material-ui/core/Avatar\";\n\n// See ChartBlock for a chart in the editor\nexport function Chart(props) {\n    const dispatch = useDispatch();\n    const chartsInEditor = useSelector((state) => state.docs[props.docId].chartsInEditor);\n    const [errorMsg, setErrorMsg] = useState(null);\n\n    function handleDragStart(e) {\n        e.dataTransfer.setData(\"chartId\", props.id);\n    }\n\n    const [hover, setHover] = useState(false);\n    function handleEnter() {\n        setHover(true);\n    }\n    function handleLeave() {\n        setHover(false);\n    }\n    function handleKeyPress(event) {\n        if (event.key === \"Delete\") {\n            if (!chartsInEditor.includes(props.id))\n                dispatch(deleteChart(props.id, { docId: props.docId }));\n            else setErrorMsg(\"Chart can not be deleted. It is active in the editor!\");\n        }\n    }\n    return (\n        <Paper\n            className={css.container}\n            onKeyDown={handleKeyPress}\n            tabIndex=\"0\"\n            elevation={hover ? 2 : 0}\n        >\n            <div\n                draggable={true}\n                onDragStart={handleDragStart}\n                onMouseEnter={handleEnter}\n                onMouseLeave={handleLeave}\n            >\n                <Avatar src={props.thumbnail} variant='rounded' style={{ height: '150px', width: '150px' }}/>\n            </div>\n            <Snackbar\n                open={errorMsg !== null}\n                anchorOrigin={{\n                    vertical: \"bottom\",\n                    horizontal: \"left\",\n                }}\n                autoHideDuration={5000}\n                onClose={() => {\n                    setErrorMsg(null);\n                }}\n            >\n                <Alert severity=\"error\">{errorMsg}</Alert>\n            </Snackbar>\n        </Paper>\n    );\n}\n\nChart.propTypes = {\n    id: PropTypes.any,\n    width: PropTypes.number,\n    height: PropTypes.number,\n};\n\nexport default memo(Chart);\n","//Parsing ChartInEditor for extracting chart features from vegalite spec\n\nimport { parse } from \"vega-parser\";\nimport { View } from \"vega-view\";\nimport { truthy, falsy } from \"vega-util\";\nimport { toString, isDate, isString, isArray } from \"vega-util\";\n\n// potential features?\n// data categories (discrete)\n// data values (continuous)\n// axis titles\n// legends\n// scales etc\nexport default async function (spec) {\n    if (!spec.data) {\n        return [];\n    }\n    const featureMap = {};\n    const runtime = parse(spec);\n    const view = await new View(runtime).runAsync();\n    const state = view.getState({\n        data: truthy,\n        signals: falsy,\n        recurse: true,\n    });\n\n    // sometimes, individual data points are not explicitely encoded using scales\n    for (const mark of spec.marks) {\n        // mu\n        const data = state.data[mark.name].map((d) => d.datum);\n\n        for (const datum of data) {\n            const isMap = mark.type === \"shape\" && mark.style.includes(\"geoshape\");\n            let entries = Object.entries(datum); //Object.entries(isMap ? datum : datum);\n            if (isMap) {\n                // combine with map properties\n                entries = entries.concat(Object.entries(datum.properties));\n            }\n            for (const [field, value] of entries) {\n                if (!isString(value)) {\n                    // only categorical data\n                    continue;\n                }\n                featureMap[value] = {\n                    value,\n                    type: \"string\",\n                    field,\n                    data: datum.name,\n                };\n            }\n        }\n    }\n    // Note: The following logic addressses two missing cases\n    // 1. Nested marks\n    // 2. Categorical scale with numeric data domain\n    // TODO: Can we combine the two logics elegantly?\n    spec.data.forEach((datum) => {\n        // for each data table\n        const viewdata = view.data(datum.name);\n        // console.log(\"viewdata\", viewdata);\n    });\n    //Extracting Axes of the charts\n    const axesMap = extractChartAxes(spec);\n    spec.scales\n        .filter((scale) => [\"ordinal\", \"band\", \"point\"].includes(scale.type))\n        .forEach((scale) => {\n            // each discrete scale\n            spec.data.forEach((datum) => {\n                // for each data table\n                const viewdata = view.data(datum.name);\n                viewdata.forEach((row) => {\n                    // for each row in the table\n                    // a single field\n                    if (scale.domain.field) {\n                        const field = scale.domain.field;\n                        const value = isDate(row[field]) ? row[field] : toString(row[field]);\n                        const type = isDate(value) ? \"date\" : \"string\";\n                        featureMap[value] = {\n                            value,\n                            type,\n                            field,\n                            data: datum.name,\n                        };\n                    } else if (scale.domain.fields) {\n                        //multiple fields from the same data\n                        scale.domain.fields.forEach((d) => {\n                            const field = isString(d) ? d : d.field;\n                            const value = isDate(row[field]) ? row[field] : toString(row[field]);\n                            const type = isDate(value) ? \"date\" : \"string\";\n                            featureMap[value] = {\n                                value,\n                                type,\n                                field,\n                                data: datum.name,\n                            };\n                        });\n                    }\n                });\n            });\n            if (isArray(scale.domain)) {\n                // literal array\n                scale.domain.forEach((value) => {\n                    value = isDate(value) ? value : toString(value);\n                    const type = isDate(value) ? \"date\" : \"string\";\n                    const field = searchFieldName(spec, scale.name);\n                    featureMap[value] = {\n                        value,\n                        type,\n                        field,\n                        data: null,\n                    };\n                });\n            }\n        });\n    const properties = { axes: Object.values(axesMap), features: Object.values(featureMap) };\n    return properties;\n}\n\nexport const searchFieldName = (spec, scaleName) => {\n    for (const mark of spec.marks) {\n        if (mark.encode.enter) {\n            for (const [, props] of Object.entries(mark.encode.enter)) {\n                if (props.scale === scaleName && props.field) {\n                    return props.field;\n                }\n            }\n        }\n        if (mark.encode.update) {\n            for (const [, props] of Object.entries(mark.encode.update)) {\n                if (props.scale === scaleName && props.field) {\n                    return props.field;\n                }\n            }\n        }\n    }\n    return null;\n};\n\nexport const extractChartAxes = (spec) => {\n    let axesMap = {};\n    spec.scales.forEach((scale) => {\n        //TODO: handle cases where data is aggregated e.g., stack bar chart, stack area chart, pie chart,\n        const name = scale.name;\n        const field =\n            //field is array of objects\n            isArray(scale.domain.fields) && scale.domain.fields[0].hasOwnProperty(\"field\")\n                ? scale.domain.fields[0].field\n                : //field is simple array\n                isArray(scale.domain.fields)\n                ? scale.domain.fields\n                : scale.domain.field;\n        const data = scale.domain.data;\n        const type = scale.type;\n\n        const relatedAxis = spec.axes\n            ? spec.axes.filter((axis) => {\n                  return (axis.scale === name && axis.title !== undefined) || null;\n              })\n            : undefined;\n        const title =\n            isArray(relatedAxis) && relatedAxis.length > 0 && relatedAxis[0].hasOwnProperty(\"title\")\n                ? relatedAxis[0].title\n                : field //if title is not found, saving field as title (needed for maps!)\n                ? field\n                : undefined;\n\n        const axis = { name: name, field: field, data: data, type: type, title: title };\n        axesMap[name] = axis;\n    });\n    return axesMap;\n};\n","import { parse } from \"vega-parser\";\nimport { View } from \"vega-view\";\n\nconst THUMBNAIL_HEIGHT = 250;\nexport default async (spec) => {\n    // parse the spec and get the view\n    const runtime = parse(spec);\n    const view = await new View(runtime).runAsync();\n    // conver the view to an image\n    const img = await view.toImageURL(\"png\"); // base64\n    // resize the image to a thumbnail size\n    const resized = await resize(img);\n    return resized;\n};\n\nfunction resize(orgImg) {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.src = orgImg;\n        img.onload = function () {\n            // draw the image into a thumbnail scale\n            const height = THUMBNAIL_HEIGHT;\n            const width = (height / img.height) * img.width;\n            const canvas = document.createElement(\"canvas\"),\n                ctx = canvas.getContext(\"2d\");\n\n            canvas.width = width;\n            canvas.height = height;\n\n            ctx.drawImage(this, 0, 0, width, height);\n\n            // return rescaled base64 image url\n            resolve(canvas.toDataURL());\n        };\n    });\n}\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useParams } from \"react-router-dom\";\nimport css from \"./index.module.css\";\nimport Chart from \"components/Chart\";\nimport { createChart, getCharts } from \"ducks/charts\";\nimport Snackbar from \"@material-ui/core/Snackbar\";\nimport { compile } from \"vega-lite/build/vega-lite\";\nimport extractChartFeatures from \"utils/extractChartFeatures\";\nimport createThumbnail from \"utils/createThumbnail\";\nimport Alert from \"components/Alert\";\n\nexport default function ChartGallery(props) {\n    const dispatch = useDispatch();\n    let { docId } = useParams();\n    const [dragging, setDragging] = useState(false);\n    const [errorMsg, setErrorMsg] = useState(null);\n\n    const charts = useSelector((state) => getCharts(state, docId));\n\n    function handleDragEnter() {\n        setDragging(true);\n    }\n    function handleDragLeave() {\n        setDragging(false);\n    }\n    function handleDragOver(e) {\n        e.preventDefault();\n        e.stopPropagation();\n    }\n\n    function handleDrop(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        // console.log('VegaLite', VegaLite);\n        let file = e.dataTransfer.files[0];\n        if (!file) {\n            return;\n        }\n        // if (file.size > 1000000) {\n        //     // larger than 1 MB\n        //     setErrorMsg(\"Size too big (>1MB)!\");\n        //     return;\n        // }\n        if (file.type.match(\"application/json\")) {\n            const reader = new FileReader();\n\n            // Closure to capture the file information.\n            reader.onload = async (e) => {\n                try {\n                    const liteSpec = JSON.parse(e.target.result);\n                    const spec = compile(liteSpec).spec; // vega spec\n                    // support vega-lite sample datasets\n\n                    spec.data.forEach((d) => {\n                        if (d.url && d.url.startsWith(\"data\")) {\n                            d.url = process.env.PUBLIC_URL + \"/\" + d.url;\n                        }\n                    });\n                    const thumbnail = await createThumbnail(spec);\n\n                    const properties = await extractChartFeatures(spec);\n                    dispatch(createChart(docId, spec, liteSpec, { properties, thumbnail }));\n                } catch (e) {\n                    setErrorMsg(\"Syntex error in specification file!\");\n                }\n            };\n\n            reader.readAsText(file);\n        } else {\n            setErrorMsg(\"Wrong format!\");\n        }\n        setDragging(false);\n    }\n\n    return (\n        <div\n            className={css.container}\n            onDragEnter={handleDragEnter}\n            onDragLeave={handleDragLeave}\n            onDragOver={handleDragOver}\n            onDrop={handleDrop}\n        >\n            <Snackbar\n                open={errorMsg !== null}\n                anchorOrigin={{\n                    vertical: \"bottom\",\n                    horizontal: \"left\",\n                }}\n                autoHideDuration={5000}\n                onClose={() => {\n                    setErrorMsg(null);\n                }}\n            >\n                <Alert severity=\"error\">{errorMsg}</Alert>\n            </Snackbar>\n\n            <div className={css.draggingArea} style={{ opacity: dragging ? 0.5 : 0.0 }}>\n                Drop Vega-lite Spec\n            </div>\n            {charts.map((chart) => (\n                <Chart key={chart.id} docId={docId} id={chart.id} spec={chart.spec} thumbnail={chart.thumbnail} />\n            ))}\n        </div>\n    );\n}\n","import React from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport css from \"./index.module.css\";\n// import { addTextLink, deactivateSuggestions } from \"../ducks/ui\";\n// import insertSuggestion from \"utils/insertSuggestion\";\n// import createTextLink from \"utils/createTextLink\";\nimport Box from \"@material-ui/core/Box\";\nimport Paper from \"@material-ui/core/Paper\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport Typography from \"@material-ui/core/Typography\";\nimport ListItemAvatar from \"@material-ui/core/ListItemAvatar\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\nimport LinkIcon from '@material-ui/icons/Link';\nimport PropTypes from \"prop-types\";\n\nimport { setTextSelection } from \"ducks/ui\";\n\nconst SUGGESTION_LIMIT = 5;\nexport default function SuggestionPanel(props) {\n    const dispatch = useDispatch();\n    const selection = window.getSelection();\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\n\n    const padding = 20;\n\n    function handleClick(suggestion, event) {\n        event.preventDefault();\n        event.stopPropagation();\n        props.onSelected(suggestion);\n    }\n\n    function handleCreateLink() {\n        props.onCreateLinkSelect();\n        dispatch(setTextSelection(props.textSelection));\n    }\n    return pos ? (\n        <Box\n            zIndex=\"modal\"\n            left={pos.x + padding}\n            top={pos.y + padding}\n            className={css.suggestionPanel}\n        >\n            <Paper>\n\n                <List>\n                    <ListItem button onMouseDown={handleCreateLink}>\n                        {/* <ListItemAvatar>\n                            <Avatar>\n                            <LinkIcon />\n                            </Avatar>\n                        </ListItemAvatar> */}\n                        <ListItemIcon>\n                            <LinkIcon />\n                        </ListItemIcon>\n                        Create Link\n                    </ListItem>\n                    {\n                        // should we rank suggestions\n\n                        props.suggestions.slice(0, SUGGESTION_LIMIT).map((suggestion, i) => (\n                            <ListItem\n                                key={i}\n                                button\n                                dense\n                                onMouseDown={handleClick.bind(null, suggestion)}\n                            >\n                                <ListItemAvatar>\n                                    <Avatar alt=\"chart\" src={suggestion.thumbnail} />\n                                </ListItemAvatar>\n                                <ListItemText\n                                    primary={suggestion.text}\n                                    secondary={\n                                        <Typography component=\"span\" variant=\"caption\" color='textSecondary'>\n                                            {suggestion.chartId}\n                                        </Typography>\n                                    }\n                                />\n                            </ListItem>\n                        ))\n                    }\n                </List>\n            </Paper>\n        </Box>\n    ) : (\n        \"\"\n    );\n}\n\nSuggestionPanel.propTypes = {\n    suggestions: PropTypes.array,\n    onSelected: PropTypes.func,\n};\n","import React from \"react\";\nimport css from \"./index.module.css\";\n\nimport { useDispatch, useSelector } from \"react-redux\";\nimport Box from \"@material-ui/core/Box\";\nimport Button from \"@material-ui/core/Button\";\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\nimport PropTypes from \"prop-types\";\nimport { setSelectedLink, showLinkSettingFor, showSelectedLinkSetting } from \"ducks/ui\";\nimport { confirmLink, deleteLink } from \"ducks/links\";\nimport Paper from \"@material-ui/core/Paper\";\n\nexport default function PotentialLinkControls(props) {\n    const dispatch = useDispatch();\n    const selection = window.getSelection();\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\n    const padding = 10;\n\n    function handleDiscardClick(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        props.onDiscard(props.selectedLink);\n        dispatch(setSelectedLink(null));\n    }\n    function handleAcceptClick(event) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        dispatch(confirmLink(props.selectedLink.id));\n        props.onAccept(props.selectedLink);\n        dispatch(setSelectedLink(null));\n    }\n    function handleSettingClick(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch(showLinkSettingFor(props.selectedLink));\n        dispatch(setSelectedLink(null));\n        \n    }\n    return pos && props.selectedLink && !props.selectedLink.isConfirmed && !props.textSelection ? (\n        <Box\n            zIndex=\"modal\"\n            left={pos.x + padding}\n            top={pos.y + padding}\n            className={css.potentialLinkControls}\n        >\n            <Paper elevation={1}>\n                <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\n                    <Button onMouseDown={handleAcceptClick}>Accept</Button>\n                    <Button onMouseDown={handleDiscardClick}>Discard</Button>\n                    {/* <Button onMouseDown={handleSettingClick}>Setting</Button> */}\n                </ButtonGroup>\n            </Paper>\n        </Box>\n    ) : (\n        \"\"\n    );\n}\n","export default (charts, partialText, startIndex) => {\n    return partialText.length === 0\n        ? []\n        : [].concat(\n              ...charts.map((chart) =>\n                  chart.properties.features\n                      .filter((d) => {\n                          if (d.type === \"string\" && d.value) {\n                              return d.value.toLowerCase().startsWith(partialText.toLowerCase());\n                          } else if (d.type === \"date\") {\n                              //temporary\n                              return d.value\n                                  .toString()\n                                  .toLowerCase()\n                                  .includes(partialText.toLowerCase());\n                          }\n                          return false;\n                      })\n                      .map((d) => ({\n                          chartId: chart.id,\n                          thumbnail: chart.thumbnail,\n                          feature: d,\n                          text: d.value.toString(),\n                          startIndex,\n                      }))\n              )\n          );\n};\n","import util from \"util\";\nconst request = require(\"request\");\n\nexport default async (sentence, sentenceOffset, charts, blockKey) => {\n    const payload = { text: sentence, sentenceOffset, charts: charts, blockKey};\n    const options = {\n        uri: \"https://koriserver.namwkim.org/discover-links\",\n        method: \"POST\",\n        headers: {\n            Accept: \"application/json\",\n            \"Accept-Charset\": \"utf-8\",\n        },\n        json: true,\n        body: payload,\n    };\n\n    const requestPromise = util.promisify(request);\n    try{\n        const response = await requestPromise(options);\n        return response?.body?.data;\n    }\n    catch(e){\n        return []\n    }\n}","export default (editorState) => {\n    const currentContent = editorState.getCurrentContent();\n    const currentSelection = editorState.getSelection();\n    const blockKey = currentSelection.getAnchorKey();\n    const currentBlock = currentContent.getBlockForKey(blockKey);\n    const blockText = currentBlock.getText();\n\n    return {blockText, blockKey};\n};\n","export default (editorState) => {\n    const currentContent = editorState.getCurrentContent();\n    const currentSelection = editorState.getSelection();\n    const blockKey = currentSelection.getAnchorKey();\n    const currentBlock = currentContent.getBlockForKey(blockKey);\n    const caretOffset = currentSelection.getAnchorOffset();\n    const blockTextBeforeCaret = currentBlock.getText().substr(0, caretOffset);\n    const end = currentSelection.getAnchorOffset();\n\n    const lastWord = blockTextBeforeCaret.split(\" \").slice(-1).pop();\n    const start = end - lastWord.length;\n    return {\n        text: lastWord,\n        startIndex: start,\n        endIndex: end,\n    };\n};\n","import { Modifier, EditorState } from \"draft-js\";\nimport getBlockText from \"./getBlockText\";\nimport getLastTypedWord from \"./getLastTypedWord\";\nexport default (links, editorState) => {\n    const currentBlockText = getBlockText(editorState)?.blockText;\n    links.forEach((link) => {\n        editorState = insertLink(link, editorState, currentBlockText);\n    });\n    return editorState;\n};\nexport const insertLink = (link, editorState, currentBlockText) => {\n\n    const currentContent = editorState.getCurrentContent();\n    const currentSelection = editorState.getSelection();\n    const activeBlockKey = currentSelection.getAnchorKey();\n\n    let start = link.startIndex;\n    let end = link.endIndex;\n    if (start < 0) start = 0;\n\n    // Handle situation when paragraph changes before inserting links\n    const find = link.text\n    let allInstancesOfLink = [];\n    let i = 0, j=0;\n    while (~(i = currentBlockText.indexOf (find,i + find.length))) allInstancesOfLink.push(i);\n    \n    if (allInstancesOfLink.length > 0 && !allInstancesOfLink.includes(link.startIndex)){\n       return editorState;\n    }\n\n    let newContent = currentContent.createEntity(`LINK`, \"MUTABLE\", {\n        ...link,\n    });\n    const entityKey = newContent.getLastCreatedEntityKey();\n\n    const insertLinkSelection = currentSelection.merge({\n        anchorKey: link.blockKey,\n        focusKey: link.blockKey,\n        anchorOffset: start,\n        focusOffset: end,\n    });\n    \n    const insertSuggestionSelection =  editorState.getSelection().merge({\n        anchorOffset: getLastTypedWord(editorState).startIndex\n    });\n\n    newContent = Modifier.replaceText(\n        editorState.getCurrentContent(),\n        link?.trigger === \"@\" ? insertSuggestionSelection : insertLinkSelection,\n        link.text,\n        editorState.getCurrentInlineStyle(), //inline styling\n        entityKey\n    );\n\n    //Stop cursor from jumping to beginning of a line\n    const caretPosition = currentSelection.getAnchorOffset();\n    let newEditorState = EditorState.push(editorState, newContent, \"insert-characters\");\n    let newSelection = newEditorState.getSelection().merge({\n        anchorKey: activeBlockKey,\n        focusKey: activeBlockKey,\n        focusOffset: caretPosition,\n        anchorOffset: caretPosition,\n    });\n    // newEditorState = EditorState.moveSelectionToEnd(newEditorState);\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\n    return newEditorState;\n};\n","import { Modifier, EditorState } from \"draft-js\";\n\nexport default (currentSelectionState, editorState) => {\n    if (!currentSelectionState) return;\n    const currentContentState = editorState.getCurrentContent();\n\n    const newContentState = Modifier.applyEntity(currentContentState, currentSelectionState, null);\n    let newEditorState = EditorState.push(editorState, newContentState, \"apply-entity\");\n\n    const newCaretPosition = Math.max(\n        currentSelectionState.getAnchorOffset(),\n        currentSelectionState.getFocusOffset()\n    );\n\n    const newSelection = newEditorState.getSelection().merge({\n        focusOffset: newCaretPosition,\n        anchorOffset: newCaretPosition,\n    });\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\n\n    return newEditorState;\n};\n","export default (rawEditorState, allLinksInCurrentBlockText, blockText) => {\n    const entityMap = { ...rawEditorState.entityMap };\n    allLinksInCurrentBlockText = allLinksInCurrentBlockText.filter((linkInCurrentBlockText) => {\n        let shouldKeep = true;\n        Object.keys(entityMap).forEach(function (key) {\n            if (entityMap[key].type === \"LINK\") {\n                if (\n                    entityMap[key].data.isConfirmed &&\n                    entityMap[key].data.text === linkInCurrentBlockText?.text &&\n                    blockText.includes(entityMap[key].data.text)\n                ) {\n                    shouldKeep = false;\n                }\n            }\n        });\n        return shouldKeep;\n    });\n    return allLinksInCurrentBlockText;\n};\n","//Arguments//\n        //commonProps={text, extent, chartId}, \n        //dataProps={feature, values}, \n        //rangeProps={fieldX, rangeX, fieldY, rangeY}, \n        //suggestionProps={trigger}\n\nexport default ({text, extent, blockKey, chartId}, {feature, values}, {rangeField, range}, trigger) => {\n    return { \n        // common props\n        text: text,\n        startIndex: extent[0],\n        endIndex: extent[1],\n        blockKey:blockKey,\n        chartId: chartId,\n        \n        //data props\n        feature: feature || '',\n        data: values || [],\n\n        //Brush props\n        //Syntax: rangeField is list of *fields* & *range* is list of tuples for each field\n        rangeField: rangeField || [],\n        range: range || [],\n\n        active: false,\n        isConfirmed: true,\n        trigger: trigger\n    };\n}","import React, { Fragment, useState, useRef, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport PropTypes from \"prop-types\";\nimport { useParams } from \"react-router-dom\";\nimport {\n    EditorState,\n    AtomicBlockUtils,\n    RichUtils,\n    convertToRaw,\n    convertFromRaw,\n    Modifier,\n    ContentState,\n} from \"draft-js\";\n\nimport DraftEditor from \"draft-js-plugins-editor\";\n\nimport css from \"./index.module.css\";\n\nimport EditorToolbar, { EditorPlugins } from \"components/EditorToolbar\";\n\nimport SuggestionPanel from \"components/SuggestionPanel\";\nimport PotentialLinkControls from \"components/PotentialLinkControls\";\n\nimport { updateDoc, updateChartsInEditor } from \"ducks/docs\";\nimport { createLinks, createLink, deleteLink, getLinks } from \"ducks/links\";\nimport { getChartsInEditor, getCharts } from \"ducks/charts\";\nimport { setSelectedLink, setManualLinkId, exitManualLinkMode, setTextSelection } from \"ducks/ui\";\n\nimport editorDecorators from \"utils/editorDecorators\";\nimport findSuggestions from \"utils/findSuggestions\";\nimport searchLinks from \"utils/searchLinks\";\nimport insertLinks from \"utils/insertLinks\";\nimport getLastTypedWord from \"utils/getLastTypedWord\";\nimport getTextSelection from \"utils/getTextSelection\";\nimport highlightTextSelection from \"utils/highlightTextSelection\";\nimport deHighlightTextSelection from \"utils/deHighlightTextSelection\";\nimport getBlockText from \"utils/getBlockText\";\nimport filterAlreadyConfirmedLinksInEditor from \"utils/filterAlreadyConfirmedLinksInEditor\";\nimport nlp from \"compromise\";\nimport Snackbar from \"@material-ui/core/Snackbar\";\nimport Alert from \"components/Alert\";\nimport createLinkObject from \"utils/createLink\"\n\nconst AUTOMATIC_SUGGESTION_TIMEOUT = 5000;\n\nexport default function Editor(props) {\n    const dispatch = useDispatch();\n    let { docId } = useParams();\n    const doc = useSelector((state) => state.docs[docId]);\n    const charts = useSelector((state) => getCharts(state, docId));\n    const storedEditorState = useSelector((state) => state.docs[docId].editorRawState);\n    const chartsInEditor = useSelector((state) => getChartsInEditor(state, docId));\n    const selectedLink = useSelector((state) => state.ui.selectedLink);\n    const allLinks = useSelector((state) => getLinks(state,docId));\n    const exitManualLink = useSelector((state) => state.ui.exitManualLink);\n    const manualLinkId = useSelector((state) => state.ui.manualLinkId);\n    const linkActiveNoAutoTrigger = useSelector((state) => state.ui.linkActiveNoAutoTrigger);\n    const textSelectionInStore = useSelector((state) => state.ui.textSelection);\n\n    const [tempTextSelection, setTempTextSelection] = useState(textSelectionInStore);\n    const editorEl = useRef(null); //https://reactjs.org/docs/hooks-reference.html#useref\n    const [suggestions, setSuggestions] = useState([]);\n    const alreadySearchedSentences = useSelector((state) => state.docs[docId].searchedSentences);\n\n    const contentState =\n        storedEditorState === null\n            ? EditorState.createEmpty().getCurrentContent()\n            : convertFromRaw(storedEditorState);\n    const [editorState, setEditorState] = useState(EditorState.createWithContent(contentState));\n    const [currentSelectionState, setCurrentSelectionState] = useState(null);\n    const [currentBlock, setCurrentBlock] = useState(null);\n    const [infoMsg, setInfoMsg] = useState(null);\n    const [autoLinksToInsert, setAutoLinksToInsert] = useState([]);\n\n    let interval = useRef();\n    // const startTimer = () => {\n    //     interval = setInterval(() => {\n    //         // console.log(\"Checking for autosuggestions every:\", AUTOMATIC_SUGGESTION_TIMEOUT);\n    //         if (editorEl?.current?.props?.editorState)\n    //             setCurrentBlock(getBlockText(editorEl.current.props.editorState));\n    //     }, AUTOMATIC_SUGGESTION_TIMEOUT);\n    //     return () => clearInterval(interval.current);\n    // };\n\n    useEffect(() => {\n        dispatch(exitManualLinkMode(false));\n        setCurrentSelectionState(null);\n        dispatch(setTextSelection(null));\n        dispatch(setManualLinkId(null));\n        // startTimer();\n        // return () => clearInterval(interval.current);\n    }, []);\n\n    useEffect(() => {\n        if (exitManualLink) {\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\n            editorEl.current.focus();\n            dispatch(exitManualLinkMode(false));\n            setCurrentSelectionState(null);\n            //Quick and dirty fix! //Clearing Chart Selections\n            window.dispatchEvent(new KeyboardEvent(\"keypress\", { key: \"a\" }));\n        }\n    }, [exitManualLink]);\n\n    useEffect(() => {\n        if (exitManualLink && allLinks[manualLinkId] === undefined) {\n            //clear selection in case no brushing and pressing 'Accept'\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\n            setCurrentSelectionState(null);\n        }\n        if (allLinks[manualLinkId]) {\n            setEditorState(\n                insertLinks([allLinks[manualLinkId]], editorState, currentSelectionState)\n            );\n            dispatch(setManualLinkId(null));\n            setCurrentSelectionState(null);\n            setInfoMsg({msg: 'Link successfully created!', severity: 'success'});\n            //Quick and dirty fix! //Clearing Chart Selections\n            window.dispatchEvent(new KeyboardEvent(\"keypress\", { key: \"a\" }));\n        }\n    }, [manualLinkId, exitManualLink]);\n\n    useEffect(() => {\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\n        dispatch(updateDoc(doc.id, { editorRawState }));\n    }, [editorState]);\n\n    useEffect(()=> {\n        const entityMap = convertToRaw(editorState.getCurrentContent()).entityMap;\n        let linkIdsToKeep = [];\n        Object.keys(entityMap).forEach(function(key) {\n            if(entityMap[key].type === \"LINK\"){\n                if(allLinks[entityMap[key].data.id]){\n                    linkIdsToKeep.push(entityMap[key].data.id);\n                }\n            }     \n        });\n        Object.keys(allLinks).forEach(function(key){\n            if (!linkIdsToKeep.includes(key)){\n                dispatch(deleteLink(key));\n            }\n        });\n\n    },[Object.keys(convertToRaw(editorState.getCurrentContent()).entityMap).length]);\n\n    useEffect(() => {\n        const asyncExec = async () => {\n            if (currentBlock !== null) {\n                const blockText = currentBlock.blockText;\n                if (linkActiveNoAutoTrigger) return;\n                if (selectedLink) return;\n                if (tempTextSelection || tempTextSelection == \"INVALID\") return;\n                const sentences = await nlp(blockText).sentences().json();\n                let allLinksInCurrentBlockText = [];\n                let searchedSentences = [];\n                for (let i = 0; i < sentences.length; i++) {\n                    const { text } = sentences[i];\n                    if (!text.includes(\".\")) continue;\n                    if (alreadySearchedSentences?.includes(text)) continue;\n                    searchedSentences.push(text);\n\n                    const sentenceObject = {\n                        text: text,\n                        startIndex: blockText.indexOf(text),\n                        endIndex: blockText.indexOf(text) + text.length,\n                    };\n                    if (chartsInEditor.length === 0) return;\n                    const links = await searchLinks(sentenceObject.text, sentenceObject.startIndex, chartsInEditor, currentBlock.blockKey);\n                    allLinksInCurrentBlockText = allLinksInCurrentBlockText.concat(links);\n                }\n                dispatch(\n                    updateDoc(doc.id, {\n                        searchedSentences: alreadySearchedSentences?.concat(searchedSentences),\n                    })\n                );\n                if (allLinksInCurrentBlockText.length > 0) {\n                    const rawEditorState = convertToRaw(editorState.getCurrentContent());\n                    allLinksInCurrentBlockText = filterAlreadyConfirmedLinksInEditor(\n                        rawEditorState,\n                        allLinksInCurrentBlockText,\n                        blockText\n                    );\n                    if (allLinksInCurrentBlockText.length > 0) {\n                        // Remove duplicates if any\n                        // TODO: Check why backend send duplicates in the first place\n                        const seen = new Set();\n                        allLinksInCurrentBlockText = allLinksInCurrentBlockText.filter(el => {\n                            const duplicate = seen.has(el.startIndex);\n                            seen.add(el.startIndex);\n                            return !duplicate;\n                          });\n                        setAutoLinksToInsert(allLinksInCurrentBlockText);\n                    }\n                }\n                setCurrentBlock(null);\n            }\n        };\n        asyncExec();\n    }, [currentBlock]);\n\n    function handleEditorChange(editorState) {\n\n        setEditorState(editorState);\n        if(autoLinksToInsert.length>0){\n            const action = createLinks(doc.id, autoLinksToInsert);\n            setEditorState(insertLinks(action.links, editorState));\n            dispatch(action);\n            setInfoMsg({msg:\"Found some suggestions!\", severity:'success'});\n            setAutoLinksToInsert([]);\n        }\n\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\n        const lastTypedWord = getLastTypedWord(editorState);\n\n        const allText = editorState.getCurrentContent().getPlainText(\" \").trim();\n        const updatedSearchedSentences = alreadySearchedSentences?.filter(\n            (alreadySearchedSentence) => allText.includes(alreadySearchedSentence)\n        );\n        dispatch(\n            updateDoc(doc.id, {\n                searchedSentences: updatedSearchedSentences,\n            })\n        );\n        if (lastTypedWord?.text.includes('.')){\n            setCurrentBlock(getBlockText(editorState));\n        }\n\n        //Enable SuggestionMenu on @\n        if (lastTypedWord.text.startsWith(\"@\")) {\n            const suggestions = findSuggestions(\n                chartsInEditor,\n                lastTypedWord.text.slice(1),\n                lastTypedWord.startIndex\n            );\n\n            setSuggestions(suggestions);\n        } else {\n            setSuggestions([]);\n        }\n        // TODO: see if we can catch an event for adding or removing a chart.\n        // Updating charts in store when a chart is added to or removed from document\n        const entityMap = editorRawState.entityMap;\n        const numCharts = Object.keys(entityMap).length;\n        if (numCharts !== chartsInEditor.length) {\n            const ids = Object.values(entityMap).reduce((acc, entity) => {\n                if (entity.type === \"CHART\") {\n                    acc.push(entity.data.id);\n                }\n                return acc;\n            }, []);\n            dispatch(updateChartsInEditor(doc.id, ids));\n        }\n       \n        const currentSelection = editorState.getSelection();\n        const caretPosition = currentSelection.getAnchorOffset();\n        const activeBlockKey = currentSelection.getAnchorKey();\n        //Hide the link accept/delete button when cursor not in link range\n        //TODO: what if selection spans more than one block?\n        if (selectedLink && activeBlockKey) {\n            if (\n                activeBlockKey !== selectedLink.blockKey ||\n                caretPosition < selectedLink.startIndex ||\n                caretPosition > selectedLink.endIndex\n            ) {\n                dispatch(setSelectedLink(null));\n            }\n        }\n        let textSelection = getTextSelection(\n            editorState.getCurrentContent(),\n            currentSelection,\n            \" \" //delimiter\n        );\n  \n        //Hide the floating controls when no text is selected\n        setTempTextSelection(textSelection);\n\n        //search for suggestions on text selection\n        if (textSelection && textSelection != \"INVALID\") {\n            const suggestions = findSuggestions(\n                chartsInEditor,\n                textSelection.text.trim(),\n                textSelection.startIndex\n            );\n            suggestions.length !== 0\n                ? setSuggestions(suggestions)\n                : setSuggestions([{ text: \"NoLinkFound!\" }]);\n        }\n\n        const block = editorState.getCurrentContent().getBlockForKey(activeBlockKey);\n        if (\n            block.getType() === \"unstyled\" &&\n            !exitManualLink &&\n            currentSelectionState &&\n            !tempTextSelection\n        ) {\n            dispatch(exitManualLinkMode(true));\n            dispatch(setTextSelection(null));\n        }\n    }\n\n    function handleKeyCommand(command) {\n        const newEditorState = RichUtils.handleKeyCommand(editorState, command);\n        // handle common key bindings (e.g., bold, italic, etc.)\n        if (newEditorState) {\n            setEditorState(newEditorState);\n            return \"handled\";\n        }\n        return \"not-handled\";\n    }\n    function handleTab(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        setCurrentBlock(getBlockText(editorState));\n\n        setInfoMsg({msg:\"Detecting references! Continue typing...\", severity:'info'});\n        return \"handled\";\n    }\n\n    function handleDragOver(e) {\n        // may need to throttle for performance\n        e.preventDefault();\n        e.stopPropagation();\n        editorEl.current.focus();\n        // e.persist(); //conflict with asynchronous setTimeout in throuttle:\n        //https://stackoverflow.com/questions/38142880/react-js-throttle-mousemove-event-keep-throwing-event-persist-error\n    }\n\n    function handleDrop(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const chartId = e.dataTransfer.getData(\"chartId\");\n        const chart = charts.find((d) => d.id === chartId);\n        const exists = chartsInEditor.find((d) => d.id === chartId);\n        if (chart && !exists) {\n            insertChart(chart);\n            e.dataTransfer.clearData();\n        }\n    }\n\n    function insertChart(chart) {\n        let contentState = editorState.getCurrentContent();\n\n        contentState = contentState.createEntity(\"CHART\", \"IMMUTABLE\", {\n            id: chart.id, // wil get chart info from store\n        });\n        const entityKey = contentState.getLastCreatedEntityKey();\n        const newEditorState = AtomicBlockUtils.insertAtomicBlock(editorState, entityKey, \" \");\n        setEditorState(newEditorState);\n    }\n    function handleBlur() {\n        setSuggestions([]);\n    }\n    function handleSuggestionSelected(suggestion) {\n        const commonProps = {text:suggestion.text, extent:[suggestion.startIndex, suggestion.startIndex + suggestion.text.length], blockKey:editorState.getSelection().getAnchorKey(), chartId: suggestion.chartId};\n        const link = createLinkObject(commonProps,{ feature: suggestion.feature, values: [isNaN(Number(suggestion.text)) ? suggestion.text : Number(suggestion.text)]},{},'@');\n        const action = createLink(doc.id, link); // need ids\n        const newEditorState = insertLinks([action.attrs], editorState);\n        dispatch(action);\n\n        setSuggestions([]);\n        setEditorState(newEditorState);\n    }\n    function handleCreateLinkSelect() {\n        dispatch(exitManualLinkMode(false));\n        setCurrentSelectionState(editorState.getSelection());\n        setEditorState(highlightTextSelection(tempTextSelection, editorState));\n        setInfoMsg({msg:\"Click on any chart avatar to begin linking!\", severity:'info'}\n        );\n    }\n\n    function handleLinkDiscard(link) {\n        //TODO: Some code is similar to insertLinks.js. Consider refactoring!\n        const currentSelection = editorState.getSelection();\n        let newContent = ContentState.createFromText(\"\");\n        const updateLinkExtent = getUpdatedLinkExtent(editorState);\n        const insertTextSelection = currentSelection.merge({\n            anchorOffset: updateLinkExtent.offset,\n            focusOffset: updateLinkExtent.offset + updateLinkExtent.length,\n        });\n        newContent = Modifier.replaceText(\n            editorState.getCurrentContent(),\n            insertTextSelection,\n            link.text,\n            editorState.getCurrentInlineStyle(), //inline styling\n        );\n        let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\n        let newSelection = newEditorState.getSelection().merge({\n            focusOffset: link.endIndex,\n            anchorOffset: link.endIndex,\n        });\n        newEditorState = EditorState.moveSelectionToEnd(newEditorState);\n        newEditorState = EditorState.forceSelection(newEditorState, newSelection);\n        setEditorState(newEditorState);\n\n        dispatch(deleteLink(link.id));\n    }\n    function getUpdatedLinkExtent(editorState){\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\n        const currentSelection = editorState.getSelection();\n        const BlkKey = currentSelection.getAnchorKey();\n        const activeBlock = editorRawState.blocks.find(({key})=>key === BlkKey);\n        const caretPosition = currentSelection.getAnchorOffset();\n        const updateLinkExtent = activeBlock.entityRanges.find(er => (caretPosition >= er.offset && caretPosition <= er.offset + er.length));\n        return updateLinkExtent; \n    }\n    function handleLinkAccept(link) {\n        const updateLinkExtent = getUpdatedLinkExtent(editorState);\n        const confirmedLink = JSON.parse(JSON.stringify(link));\n        confirmedLink.startIndex = updateLinkExtent.offset; \n        confirmedLink.endIndex = updateLinkExtent.offset + updateLinkExtent.length;\n        confirmedLink.isConfirmed = true;\n        setEditorState(insertLinks([confirmedLink], editorState));\n    }\n    function handlePastedText(text){\n        //immediatly search for suggestions in pasted text\n        //TODO: for now it only searches for links in the first pargraph immediately\n        //Just for user study: To maximize link suggestion discovery\n        if (text.length > 260 && text.includes('.')){\n            setCurrentBlock({blockText: text.split(\"\\n\")[0], blockKey:getBlockText(editorState).blockKey});\n        }\n        return \"not-handled\";\n    }\n\n    return (\n        <Fragment>\n            {<EditorToolbar />}\n            <div className={css.editor} onDragOver={handleDragOver} onDrop={handleDrop}>\n                <DraftEditor\n                    editorState={editorState}\n                    plugins={EditorPlugins}\n                    onChange={handleEditorChange}\n                    onBlur={handleBlur}\n                    handleKeyCommand={handleKeyCommand}\n                    handlePastedText={handlePastedText}\n                    stripPastedStyles={true}\n                    decorators={editorDecorators}\n                    ref={editorEl}\n                    onTab={handleTab}\n                    stripPastedStyles={true}\n                />\n            </div>\n            {suggestions.length >= 1 && chartsInEditor.length > 0 && (\n                <SuggestionPanel\n                    suggestions={suggestions.filter((s) => s.text !== \"NoLinkFound!\")}\n                    textSelection={tempTextSelection}\n                    onSelected={handleSuggestionSelected}\n                    onCreateLinkSelect={handleCreateLinkSelect}\n                />\n            )}\n            <PotentialLinkControls\n                textSelection={tempTextSelection}\n                selectedLink={selectedLink}\n                onDiscard={handleLinkDiscard}\n                onAccept={handleLinkAccept}\n            />\n            <Snackbar\n                open={infoMsg !== null}\n                anchorOrigin={{\n                    vertical: \"top\",\n                    horizontal: \"right\",\n                }}\n                autoHideDuration={5000}\n                onClose={() => {\n                    setInfoMsg(null);\n                }}\n            >\n                <Alert severity={infoMsg?.severity}>{infoMsg?.msg}</Alert>\n            </Snackbar>\n        </Fragment>\n    );\n}\n\n//Define the public proptypes of this componenet\nEditor.propTypes = {\n    editor: PropTypes.object,\n    updateEditorState: PropTypes.func,\n    addSelectedChart: PropTypes.func,\n};\n","//https://github.com/facebook/draft-js/issues/442#issuecomment-223816158\n//TODO: Maybe follow the next comment (on the above) and use getContentStateFragment function!\n\nexport default (contentState, selection, blockDelimiter) => {\n    blockDelimiter = blockDelimiter || \"\\n\";\n    var startKey = selection.getStartKey();\n    var endKey = selection.getEndKey();\n    var blocks = contentState.getBlockMap();\n    let blockKey ='';\n\n    var lastWasEnd = false;\n    var selectedBlock = blocks\n        .skipUntil(function (block) {\n            return block.getKey() === startKey;\n        })\n        .takeUntil(function (block) {\n            var result = lastWasEnd;\n\n            if (block.getKey() === endKey) {\n                lastWasEnd = true;\n            }\n\n            return result;\n        });\n    //Don't allow linking across multiple blocks\n    if (selectedBlock.length > 1) return \"INVALID\";\n    const text = selectedBlock\n        .map(function (block) {\n            var key = block.getKey();\n            var text = block.getText();\n\n            let start = 0;\n            let end = text.length;\n\n            if (key === startKey) {\n                start = selection.getStartOffset();\n            }\n            if (key === endKey) {\n                end = selection.getEndOffset();\n            }\n            text = text.slice(start, end);\n            blockKey=key;\n            return text;\n        })\n        .join(blockDelimiter);\n    let sIndex = selection.getStartOffset();\n    let eIndex = selection.getEndOffset();\n    if (selection.isBackward) {\n        eIndex = selection.getEndOffset();\n        sIndex = selection.getStartOffset();\n    }\n    return selection.getStartOffset() !== selection.getEndOffset()\n        ? { text: text, startIndex: sIndex, endIndex: eIndex, blockKey, isBackward:selection.isBackward}\n        : null;\n};\n","import { Modifier, EditorState } from \"draft-js\";\n\nexport default (textSelection, editorState) => {\n    const currentContent = editorState.getCurrentContent();\n    const currentSelection = editorState.getSelection();\n\n    let newContent = currentContent.createEntity(`TEXT_SELECTION`, \"MUTABLE\", {\n        ...textSelection,\n    });\n\n    let start = textSelection.startIndex;\n    let end = textSelection.endIndex;\n\n    if(textSelection.isBackward){\n        start = textSelection.endIndex;\n        end = textSelection.startIndex\n    }\n\n    const entityKey = newContent.getLastCreatedEntityKey();\n\n    const insertTextSelection = currentSelection.merge({\n        anchorOffset:start,\n        focusOffset: end,\n    });\n    newContent = Modifier.replaceText(\n        editorState.getCurrentContent(),\n        insertTextSelection,\n        textSelection.text,\n        editorState.getCurrentInlineStyle(), //inline styling\n        entityKey\n    );\n    let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\n    let newSelection = newEditorState.getSelection().merge({\n        focusOffset: textSelection.endIndex,\n        anchorOffset: textSelection.endIndex,\n    });\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\n    return newEditorState;\n};\n","import React, { useEffect, useState, useRef } from \"react\";\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport uniqueId from \"utils/uniqueId\";\nimport Slider from '@material-ui/core/Slider';\nimport CloseIcon from '@material-ui/icons/Close'\nimport IconButton from '@material-ui/core/IconButton';\nimport TextField from '@material-ui/core/TextField';\nimport Grid from '@material-ui/core/Grid';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport Snackbar from \"@material-ui/core/Snackbar\";\nimport Alert from \"components/Alert\";\nimport Tooltip from '@material-ui/core/Tooltip';\n\nconst useStyles = makeStyles((theme) => ({\n    root: {\n      width: 300,\n      margin: theme.spacing(1),\n    },\n  }));\n\nfunction ValueLabelComponent(props) {\n    const { children, open, value } = props;\n    return (\n        <Tooltip open={open} enterTouchDelay={0} placement=\"top\" title={value}>\n           {children}\n        </Tooltip>\n    );\n}\n\nexport default function Filter(props) {\n    const classes = useStyles();\n    const [axis, setAxis] = useState('')\n    const [value, setValue] = React.useState(null);\n    const [textValue, setTextValue] = React.useState(null);\n    const [marks, setMarks] = useState([{value:1900, label:1900}, {value:2000, label:2000}]);\n    const [showSlider, setShowSlider]=useState(false);\n    const [infoMsg, setInfoMsg] = useState(null);\n    const [pointFeatures, setPointFeatures] = useState([])\n\n    const {chartProperties} = props;\n    let filterOptions = chartProperties.axes.map(axis => axis?.field);\n    const featureFields = [...new Set(chartProperties.features.map((f) => f.field))];\n    filterOptions = filterOptions.concat(featureFields);\n    filterOptions = [...new Set(filterOptions)];\n    \n    function handleFilterChange(event){\n        const filterField = event.target.value;\n        showRightControlsForFilter(filterField);\n    }\n\n    function showRightControlsForFilter(filterField) {\n\n        if (Array.isArray(filterField)) return;\n        setAxis(filterField);\n        const axisObj = getFilterFieldByName(chartProperties.axes, filterField);\n\n        if (axisObj && ![\"ordinal\", \"band\", \"point\"].includes(axisObj?.type)) {\n            const arr = props.viewData.map(vd => vd[filterField]);\n            const [min, max] = getMinMax(arr)\n            //TODO: Handle date/time in a better way!\n            if ([\"date\", \"year\", \"month\", \"time\", \"year_year\"].includes(filterField?.toLowerCase()) || axisObj?.type === 'temporal'\n            ) {\n                const minDate = new Date(min);\n                const maxDate = new Date(max);\n                const newMarks = [{ value: min, label: minDate.toLocaleDateString(), type:'date' }, { value: max, label:  maxDate.toLocaleDateString(), type:'date' }];\n                setMarks(newMarks);\n                setValue([newMarks[0].value, newMarks[1].value]);\n            }\n            else {\n                const newMarks = [{ value: min, label: min.toLocaleString() }, { value: max, label: max.toLocaleString() }];\n                setMarks(newMarks);\n                setValue([newMarks[0].value, newMarks[1].value]);\n            }\n            setTextValue(null);\n            setShowSlider(true);\n        }\n        if (!axisObj || [\"ordinal\", \"band\", \"point\", \"string\"].includes(axisObj?.type)) {\n            let axisFeatures = chartProperties?.features.filter(f => f?.field === filterField);\n            if (!axisFeatures) axisFeatures = chartProperties?.features?.filter(f => f?.properties?.field === filterField);\n            setPointFeatures(axisFeatures);\n            setValue(null);\n            setShowSlider(false);\n        }\n    }\n\n    function handleSliderChange(event, newValue){\n        setValue(newValue);\n    }\n\n    function getFilterFieldByName(axes, name){\n        //TODO: handle if matches to title or field\n        const axisObj = axes.find(a => a?.field === name);\n        return axisObj;\n    }\n\n    function getMinMax(myArray){\n        var lowest = Number.POSITIVE_INFINITY;\n        var highest = Number.NEGATIVE_INFINITY;\n        var tmp;\n        for (var i=myArray.length-1; i>=0; i--) {\n            tmp = +myArray[i];\n            if (tmp < lowest) lowest = tmp;\n            if (tmp > highest) highest = tmp;\n        }\n        return [lowest, highest]\n    }\n\n    function handleTagsChange(event, values){\n        if(values) setTextValue(values)\n    }\n\n    useEffect(()=>{\n        //Send data back to ManualLinkControl component\n        props.onFilterUpdate(props.id, {field: axis, intervalValues:value, features:textValue});\n    }, [value, textValue])\n\n    useEffect(()=>{\n        showRightControlsForFilter(filterOptions[0])\n    },[])\n  \n    return (\n      <React.Fragment>\n        <Grid className= {classes.root} container spacing={1}>\n            <Grid item xs={1}>\n                <IconButton aria-label=\"close\" className={classes.margin} size=\"small\">\n                    <CloseIcon fontSize=\"inherit\" onMouseDown={() => props.onDelete(props.id)}/>\n                </IconButton>\n            </Grid>\n            <Grid item xs={6}>\n                <FormControl className={classes.formControl}>\n                    <InputLabel htmlFor=\"age-native-simple\">Field</InputLabel>\n                    <Select\n                        native\n                        value={axis}\n                        onChange={handleFilterChange}\n                    >\n                        {filterOptions.map(o => <option key={uniqueId(o)} value={o}>{o}</option>)}\n                    </Select>\n                </FormControl>\n            </Grid>\n        </Grid>\n        <Grid container spacing={1}>\n            <Grid item xs={1}></Grid>\n            <Grid item xs={10}>\n            {!showSlider && <Autocomplete\n                    multiple\n                    id=\"combo-box-demo\"\n                    options={pointFeatures}\n                    getOptionLabel={(option) => option?.value}\n                    onChange={handleTagsChange}\n                    // style={{ width: 200 }}\n                    size=\"small\"\n                    renderInput={(params) => <TextField {...params} label=\"Select Values\" variant=\"outlined\" />}\n                />}\n            </Grid>\n        </Grid>\n        <Grid container spacing={1}>\n            <Grid item xs={1}></Grid>\n            <Grid item xs={10}>\n                {showSlider &&\n                    <Slider\n                        value={value}\n                        onChange={handleSliderChange}\n                        valueLabelDisplay=\"auto\"\n                        ValueLabelComponent={ValueLabelComponent}\n                        aria-labelledby=\"range-slider\"\n                        marks={marks}\n                        min={marks[0]?.value}\n                        max={marks[1]?.value}\n                        valueLabelFormat={value => <div>{marks[0]?.type==='date' ? new Date(value).toLocaleDateString() : value.toLocaleString()}</div>}\n                    /> }\n            </Grid>\n      </Grid>\n      <Snackbar\n        open={infoMsg !== null}\n        anchorOrigin={{\n            vertical: \"bottom\",\n            horizontal: \"left\",\n        }}\n        autoHideDuration={5000}\n        onClose={() => {\n            setInfoMsg(null);\n        }}\n        >\n        <Alert severity=\"info\">{infoMsg}</Alert>\n    </Snackbar>\n      </React.Fragment>\n    );\n}","import React,  { useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport Button from \"@material-ui/core/Button\";\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\nimport { useEffect } from \"react\";\nimport { makeStyles } from '@material-ui/core/styles';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport uniqueId from \"utils/uniqueId\";\nimport Grid from '@material-ui/core/Grid';\n\nimport { setTextSelection } from \"ducks/ui\";\nimport { createLinks } from \"ducks/links\";\nimport { setManualLinkId, exitManualLinkMode } from \"ducks/ui\";\nimport createLink from \"utils/createLink\"\nimport Filter from \"components/Filter\"\nimport Snackbar from \"@material-ui/core/Snackbar\";\nimport Alert from \"components/Alert\";\n\n//TODO: needs cleaning & refactoring\n\nconst useStyles = makeStyles((theme) => ({\n    chartAvatars: {\n        display: 'flex',\n        '& > *': {\n          margin: theme.spacing(1),\n        },\n      },\n    root: {\n        // width: 300,\n        margin: theme.spacing(1),\n    },\n  }));\n\nexport default function ManualLinkControls(props) {\n    const dispatch = useDispatch();\n    const classes = useStyles();\n\n    const [axis, setAxis] = useState('');\n    const [showField, setShowField] = useState(false);\n    const [link, setLink]=useState(null);\n    const [selectedPoints, setSelectedPoints] = useState([]);\n    const [filters, setFilters] = useState([])\n    const [infoMsg, setInfoMsg] = useState(null);\n\n    const chartProperties = props.selectedChart.properties;\n    let axisOptions = chartProperties.axes.map(axis => axis?.field);\n    const featureFields = [...new Set(chartProperties.features.map((f) => f.field))];\n    axisOptions = axisOptions.concat(featureFields);\n    axisOptions = [...new Set(axisOptions)];\n\n\n    const handleAxisChange = (event) => {\n        const selectedAxis = event.target.value;\n        setAxis(selectedAxis);\n        link['data'] = selectedPoints.map(sp => sp[selectedAxis]);\n        setLink(link);\n    }\n  \n    function handleResetClick(event) {\n        dispatch(exitManualLinkMode(true));\n        event.preventDefault();\n        event.stopPropagation();\n        dispatch(setTextSelection(null));\n    }\n    function handleAcceptClick(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (link !== null) {\n            link['feature']={field:axis};\n            const action = createLinks(props.currentDoc.id, [link]);\n            dispatch(action);\n            dispatch(setManualLinkId(action.links[0].id));\n        } else dispatch(setManualLinkId(null));\n        dispatch(setTextSelection(null));\n        dispatch(exitManualLinkMode(true));\n\n        setInfoMsg('Link created successfully!')\n    }\n\n    useEffect(()=>{\n        if(props.selectedMarks.length > 0){\n            setShowField(true);\n            const link = makeManualLink(props.textSelection, props.selectedMarks, props.brush, props.viewData);\n            setLink(link);\n        }\n        if(props.brush.length > 0){\n            setShowField(true);\n            const link = makeManualLink(props.textSelection, props.selectedMarks, props.brush, props.viewData);\n            setLink(link);\n        }\n    },[props.selectedMarks, props.brush]);\n\n    function makeManualLink(textSelection, multiPoint, brush, viewData) {\n        let link = null;\n        if (multiPoint.length > 0) {\n            let points = [];\n            for (let i = 0; i < multiPoint.length; i++) {\n                for (let j = 0; j < viewData.length; j++) {\n                    if (multiPoint[i].values[0] === viewData[j]._vgsid_) points.push(viewData[j]);\n                }\n            }\n            let data = [];\n            let field;\n            setSelectedPoints(points);\n            points.forEach(function (p) {\n                field = chartProperties?.axes.filter((axis) =>\n                    [\"ordinal\", \"band\", \"point\"].includes(axis.type)\n                )[0];\n                if (p.hasOwnProperty(\"properties\")) {\n                    field = chartProperties?.features.filter(\n                        (feature) => feature?.value != \"Feature\"\n                    )[0];\n                    //Special case: Maps\n                    //Look for data in TopoJSON Properties or in the datafile!\n                    if (!p[\"properties\"][field?.field]) {\n                        data.push(p[field?.field]);\n                    } else data.push(p[\"properties\"][field?.field]);\n                } else data.push(p[field?.field]);\n            });\n            const feature={ field: field?.field };\n            setAxis(feature.field);\n\n            const commonProps = {text: textSelection.text, extent:[props.textSelection.startIndex, props.textSelection.endIndex], blockKey:props.textSelection.blockKey, chartId: props.selectedChart.id};\n            link = createLink(commonProps, {feature,values:data}, {});\n        }\n        if (brush.length > 0) {\n            let points;\n            let brushField;          \n            let rangeField = [];\n            let range = [];\n\n            //Rectangular Brush\n            if (\n                brush[0].fields.length === 2 &&\n                brush[0].fields[0].type === \"R\" &&\n                brush[0].fields[1].type === \"R\"\n            ) {\n                rangeField.push(brush[0].fields[0].field);\n                rangeField.push(brush[0].fields[1].field);\n                range.push(...brush[0].values[0], ...brush[0].values[1] )\n                points = [];\n                setAxis(brush[0].fields[0].field);\n            } else {\n                //Single Axis Brush\n                if (brush[0]?.fields[0]?.type === \"E\" && brush[0]?.fields[1]?.type === \"R\" ) {\n                    brushField = brush[0].fields[0].field;\n                    points = brush[0].values[0];\n                }\n                if (brush[0]?.fields[0]?.type === \"R\" && brush[0]?.fields[1]?.type === \"E\" ) {\n                    brushField = brush[0].fields[1].field;\n                    points = brush[0].values[1];\n                }\n                if (brush[0].fields.length === 1 && brush[0]?.fields[0]?.type === \"R\") {\n                    brushField = brush[0].fields[0].field;\n                    points = [];\n                    rangeField.push(brushField);\n                    range.push(...brush[0].values[0])\n                }\n                setAxis(brushField);\n            }\n            const commonProps = {text:textSelection.text, extent:[props.textSelection.startIndex, props.textSelection.endIndex], blockKey:props.textSelection.blockKey, chartId:props.selectedChart.id};\n            const dataProps = {feature: { field: brushField }, values:points }\n            const rangeProps = {rangeField,range}\n            link = createLink(commonProps, dataProps, rangeProps);\n        }\n        return link;\n    }\n    \n    function handleAddSelectionBtn(){\n        setFilters([...filters, {id:uniqueId('filter-'), props:{}}]);\n    }\n    function handleFilterDelete(filterId){\n        const updatedFilters = filters.filter(f=> f.id !== filterId);\n        setFilters(updatedFilters)\n    }\n    function handleFilterUpdate(filterId, filterState){\n        const newFilters = [... filters]\n        const filter = newFilters.find(nf => nf.id === filterId);\n        filter.props = filterState\n        setFilters(newFilters)\n    }\n\n    function handleSaveClick(){\n    \n        const commonProps = {text: props.textSelection.text, extent:[props.textSelection.startIndex, props.textSelection.endIndex], blockKey:props.textSelection.blockKey, chartId: props.selectedChart.id};\n        let dataProps={};\n        let rangeField = [];\n        let range = [];\n        filters.forEach(filter => {\n            if (filter.props.features){\n                dataProps = {feature:{field:filter.props.field}, values:filter.props.features.map(f=>f.value)}\n            }\n            if (filter.props.intervalValues){\n                rangeField.push(filter.props.field)\n                range.push(...filter.props.intervalValues)\n            }\n        })\n        let link = createLink(commonProps, dataProps, {rangeField, range});\n        const action = createLinks(props.currentDoc.id, [link]);\n        dispatch(setManualLinkId(action.links[0].id));\n        dispatch(setTextSelection(null));\n        dispatch(exitManualLinkMode(true));\n        dispatch(action);\n\n        setInfoMsg('Link created successfully!')\n    }\n    return (\n        <React.Fragment>\n            {props.mode === 'filter' && <Button variant=\"contained\" size=\"small\" onMouseDown={handleAddSelectionBtn}>+Add Selection</Button>}\n            <Grid container spacing={3}>\n                <Grid item xs={12}>\n                    <div>\n                    {filters.length > 0 && filters.map((filter) => (\n                        <Filter key={filter.id} \n                            chartProperties={chartProperties} \n                            viewData={props.viewData} \n                            id={filter.id} \n                            onDelete={handleFilterDelete} \n                            onFilterUpdate={handleFilterUpdate}/>\n                    ))}\n                    </div>\n                </Grid>\n            </Grid>\n            {filters.length > 0 && <Button variant=\"contained\" size=\"small\" onMouseDown={handleSaveClick}>Save</Button>}\n                {(props.textSelection && showField || props.showSelectedLinkSetting)  && props.mode === 'brush' && <div className={classes.root}>\n                    {props.brush.length === 0 &&  <FormControl className={classes.formControl}>\n                        <InputLabel htmlFor=\"age-native-simple\">Axis</InputLabel>\n                        <Select\n                            native\n                            value={axis}\n                            onChange={handleAxisChange}\n                        >\n                            {axisOptions.map(ao => <option key={uniqueId(ao)} value={ao}>{ao}</option>)}\n                        </Select>\n                        <FormHelperText>Choose which field to link to!</FormHelperText>\n                    </FormControl>}\n                    <div>\n                    <ButtonGroup size=\"small\" variant=\"contained\" aria-label=\"small button group\">\n                        <Button onMouseDown={handleAcceptClick}>Save</Button>\n                        <Button onMouseDown={handleResetClick}>Cancel</Button>\n                    </ButtonGroup>\n                    </div>\n                </div>}\n            <Snackbar\n                open={infoMsg !== null}\n                anchorOrigin={{\n                    vertical: \"top\",\n                    horizontal: \"right\",\n                }}\n                autoHideDuration={5000}\n                onClose={() => {\n                    setInfoMsg(null);\n                }}\n                >\n                <Alert severity=\"success\">{infoMsg}</Alert>\n            </Snackbar>\n        </React.Fragment>\n    );\n}","import React,  { useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport Button from \"@material-ui/core/Button\";\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\nimport Paper from \"@material-ui/core/Paper\";\nimport Typography from \"@material-ui/core/Typography\";\nimport { useEffect } from \"react\";\nimport Slider from '@material-ui/core/Slider';\nimport { makeStyles } from '@material-ui/core/styles';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport FormHelperText from '@material-ui/core/FormHelperText';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport uniqueId from \"utils/uniqueId\";\nimport TextField from '@material-ui/core/TextField';\n\nimport { setTextSelection, showLinkSettingFor } from \"ducks/ui\";\nimport { createLinks, updateLink } from \"ducks/links\";\nimport { setManualLinkId, exitManualLinkMode } from \"ducks/ui\";\nimport createLink from \"utils/createLink\"\n\n\nconst useStyles = makeStyles((theme) => ({\n    root: {\n      width: 300,\n    },\n  }));\n\nexport default function EditLinkSetting(props) {\n    const dispatch = useDispatch();\n    const classes = useStyles();\n    let linkToUpdate = useSelector((state)=> state.ui.showLinkSettingFor);\n\n    const [value, setValue] = useState([20, 37]);\n    const [marks, setMarks] = useState([{value:1900, label:1900}, {value:2000, label:2000}]);\n    const [axis, setAxis] = useState('');\n    const [link, setLink]=useState(null);\n    const [showSlider, setShowSlider]=useState(false);\n    const [stringValues, setStringValues] = useState('Hello');\n    \n\n    const chartProperties = props.selectedChart.properties;\n    let axisOptions = chartProperties.axes.map(axis => axis?.field);\n    const featureFields = [...new Set(chartProperties.features.map((f) => f.field))];\n    axisOptions = axisOptions.concat(featureFields);\n    axisOptions = [...new Set(axisOptions)];\n\n    const handleAxisChange = (event) => {\n    }\n\n    const handleChange = (event, newValue) => {\n        // setValue(newValue);\n        //TODO: send to createLink() for updating link\n        // link['rangeField'] = {field:axis}\n        // link['rangeMin'] = newValue[0];\n        // link['rangeMax'] = newValue[1];\n        // setLink(link);\n      };\n  \n    function handleResetClick(event) {\n    }\n    function handleUpdateClick(event) {\n        console.log('link to update', linkToUpdate, stringValues.toString().split('\\n'));\n        const data = stringValues.toString().split('\\n');\n        const action = updateLink(linkToUpdate.id, {data});\n        dispatch(action);\n\n        dispatch(showLinkSettingFor(null));\n    }\n    function handleTextChange(event){\n        setStringValues(event.target.value);\n        console.log(stringValues);\n    }\n\n    useEffect(()=>{\n        setAxis(props.showLinkSettingFor?.feature?.field);\n\n        if(![\"ordinal\", \"band\", \"point\", \"string\"].includes(props.showLinkSettingFor?.feature?.type)){\n            //Handle interval links\n            setShowSlider(true);\n        }\n        else{\n            console.log('Link props updated.....', props.showLinkSettingFor.data)\n            setStringValues(props.showLinkSettingFor.data);\n        }\n        \n    },[props.showLinkSettingFor])\n        \n\n    return (\n        <React.Fragment>\n            {props.showLinkSettingFor  && <div className={classes.root}>\n                <FormControl className={classes.formControl}>\n                    <InputLabel htmlFor=\"age-native-simple\">Link Field</InputLabel>\n                    <Select\n                        native\n                        value={axis}\n                        onChange={handleAxisChange}\n                    >\n                        {axisOptions.map(ao => <option key={uniqueId(ao)} value={ao}>{ao}</option>)}\n                    </Select>\n                    <FormHelperText>Some important helper text</FormHelperText>\n                </FormControl>\n                <FormControl fullWidth className={classes.margin}>\n                    <TextField\n                        id=\"standard-multiline-flexible\"\n                        label=\"Link Data\"\n                        multiline\n                        rowsMax={4}\n                        value={stringValues}\n                        onChange={handleTextChange}\n                        />\n                    </FormControl>\n                {showSlider && <div><Typography id=\"range-slider\" gutterBottom>\n                    Interval range\n                </Typography>\n                <Slider\n                    value={value}\n                    onChange={handleChange}\n                    valueLabelDisplay=\"auto\"\n                    aria-labelledby=\"range-slider\"\n                    // getAriaValueText={valuetext}\n                    marks={marks}\n                    min={marks[0].value}\n                    max={marks[1].value}\n                /> </div>}\n                <Paper elevation={1}>\n                    <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\n                        <Button onMouseDown={handleUpdateClick}>Update</Button>\n                        <Button onMouseDown={handleResetClick}>Cancel</Button>\n                    </ButtonGroup>\n                </Paper>\n            </div>}\n        </React.Fragment>\n    );\n}","import React, { useEffect, useMemo, useState, useRef } from \"react\";\nimport { useSelector} from \"react-redux\";\nimport addSignalToChartSpec from \"utils/addSignalToChartSpec\";\nimport vegaEmbed from \"vega-embed\";\nimport { parse } from \"vega-parser\";\nimport { View } from \"vega-view\";\nimport ChartConfigPanel from \"components/ChartConfigPanel\";\nimport { useParams } from \"react-router-dom\";\nimport ManualLinkControls from \"components/ManualLinkControls\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport SettingsIcon from \"@material-ui/icons/Settings\";\nimport EditLinkSetting from \"components/EditLinkSetting\"\nimport HelpIcon from '@material-ui/icons/Help';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport { makeStyles } from '@material-ui/core/styles';\n\n\nconst useStyles = makeStyles((theme) => ({\n    hidden: {\n      display:'none'\n    },\n  }));\n\nexport function ChartSetting(props) {\n    const classes = useStyles();\n    const [view, setView] = useState(null);\n    const containerEl = useRef(null);\n    const chartEl = useRef(null);\n    const [ratio, setRatio] = useState(1);\n    let { docId } = useParams();\n    const doc = useSelector((state) => state.docs[docId]);\n    const [selectedMarks, setSelectedMarks] = useState([]);\n    const [viewData, setViewData] = useState([]);\n    const [brush, setBrush] = useState([]);\n    const [toggleSettings, setToggleSettings] = useState(false);\n    const selectedLink = useSelector((state)=> state.ui.selectedLink);\n\n    const {chart} = props;\n    const spec = useMemo(\n        () =>\n            addSignalToChartSpec(\n                chart.highlight,\n                JSON.parse(JSON.stringify(chart.liteSpec)),\n                true\n            ),\n        [chart.spec, chart.highlight]\n    );\n\n    useEffect(() => {\n        const asyncExec = async () => {\n            // compute canvas aspect ratio to maintain it while resizing\n            const runtime = parse(spec);\n            const tempView = await new View(runtime).runAsync();\n\n            const canvas = await tempView.toCanvas();\n            const ratio = canvas.height / canvas.width;\n            setRatio(ratio);\n\n            // add autosize: has limitations: https://vega.github.io/vega-lite/docs/size.html#limitations\n            //TODO: brush interfere with autosize\n\n            // spec.autosize = {\n            //     type: \"fit\",\n            //     contains: \"padding\",\n            //     resize: true,\n            // };\n            const result = await vegaEmbed(chartEl?.current, spec, { actions: false });\n            const view = result.view;\n\n            // const viewData = view.data(\"source_0\");\n            const viewData = !chart.liteSpec.data.hasOwnProperty(\"url\")\n                ? view.data(\"data_0\")\n                : view.data(\"source_0\");\n            setViewData(viewData);\n            try {\n                view.addDataListener(\"paintbrush_store\", function (name, value) {\n                    setSelectedMarks(selectedMarks.concat(value));\n                });\n\n                view.addDataListener(\"brush_store\", function (name, value) {\n                    setBrush(brush.concat(value));\n                });\n            } catch (error) {\n                //No brush_store if no brush added\n            }\n            setView(view);\n        };\n        asyncExec();\n    }, [spec]);\n\n    // useEffect(\n    //     throttle(async () => {\n    //         resize(view, ratio);\n    //     }, 500)\n    // );\n\n    function resize(view, ratio) {\n        if (view) {\n            const { width } = containerEl.current.getBoundingClientRect();\n            const height = ratio * width;\n            // view.resize().height(height).width(width).runAsync();\n        }\n    }\n\n    function handleSettingClick() {\n        setToggleSettings(!toggleSettings);\n    }\n\n    const showConfig = true;\n    const highlightStyle = {\n        position: \"relative\",\n        width: \"fit-content\",\n    };\n    return (\n        <React.Fragment>\n            <div ref={containerEl} style={highlightStyle}>\n                <div>\n                    {showConfig && props.mode !=='filter' && <div style={{display:'flex'}}> \n                        <IconButton\n                            onMouseDown={handleSettingClick}\n                            aria-label=\"settings\"\n                            // color=\"primary\"\n                        >\n                            <SettingsIcon />\n                        </IconButton>\n                        <Tooltip placement='right-start' title=\"Use brushing to select visual marks on the chart! Hold down the SHIFT key to select multiple marks!\">\n                            <IconButton style={{marginTop:'0px'}} aria-label=\"help\">\n                                <HelpIcon />\n                            </IconButton>\n                        </Tooltip>\n                    </div>\n                    }\n                </div>\n                <div className={props.mode==='filter' ? classes.hidden : ''} ref={chartEl} />\n                {showConfig && toggleSettings && <ChartConfigPanel chart={chart} />}\n                {showConfig && props.textSelection && (\n                    <ManualLinkControls\n                        currentDoc={doc}\n                        selectedChart={chart}\n                        textSelection={props.textSelection}\n                        selectedMarks={selectedMarks}\n                        brush={brush}\n                        viewData={viewData}\n                        mode={props.mode}\n                    />\n                )}\n                {props.showLinkSettingFor && (\n                    <EditLinkSetting\n                        currentDoc={doc}\n                        selectedChart={chart}\n                        selectedMarks={selectedMarks}\n                        brush={brush}\n                        viewData={viewData}\n                        showLinkSettingFor={props.showLinkSettingFor}\n                        selectedLink={selectedLink}\n                    />\n                )}\n            </div>\n        </React.Fragment>\n    );\n};\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { useParams } from \"react-router-dom\";\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Avatar from '@material-ui/core/Avatar';\nimport Typography from \"@material-ui/core/Typography\";\nimport { getChartsInEditor } from \"ducks/charts\";\nimport { ChartSetting } from \"components/ChartSetting\";\nimport HelpIcon from '@material-ui/icons/Help';\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport ToggleButton from '@material-ui/lab/ToggleButton';\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup';\nimport TuneIcon from '@material-ui/icons/Tune';\nimport BrushIcon from '@material-ui/icons/Brush';\nimport { Fragment } from \"react\";\nimport LinkIcon from '@material-ui/icons/Link';\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen';\n\n\nconst useStyles = makeStyles((theme) => ({\n    chartAvatars: {\n        display: 'flex',\n        '& > *': {\n          margin: theme.spacing(1),\n        },\n      },\n    root: {\n      width: 300,\n    },\n    toggleBtn:{\n      margin: theme.spacing(1)\n    },\n    largeAvatar: {\n        width: theme.spacing(7),\n        height: theme.spacing(7),\n      },\n      largeAvatarActive: {\n        width: theme.spacing(7),\n        height: theme.spacing(7),\n        border: '1px solid #5e5d5d'\n      },\n  }));\n\nexport default function LinkSetting() {\n    const classes = useStyles();\n    const { docId } = useParams();\n    const chartsInEditor = useSelector((state) => getChartsInEditor(state, docId));\n    const textSelection = useSelector((state) => state.ui.textSelection);\n    const showLinkSettingFor = useSelector((state) => state.ui.showLinkSettingFor);\n    const [selectedChart, setSelectedChart] = useState(null);\n    const [creationMode, setCreationMode] = useState('brush');\n    const [createNewLink, setCreateNewLink] = useState(false)\n\n    useEffect(()=>{\n      if(!textSelection) {\n        setCreateNewLink(false);\n        setSelectedChart(null);\n      }\n      else {\n        setCreateNewLink(true);\n        setCreationMode('brush');\n      }\n    },[textSelection])\n\n    function handleChartAvatarClick(chart){\n        if(selectedChart != chart)\n          setSelectedChart(chart);\n        else setSelectedChart(null);\n    }\n\n    useEffect(()=>{\n      setSelectedChart(chartsInEditor.filter(c => c.id === showLinkSettingFor?.chartId).pop());\n    },[showLinkSettingFor])\n\n    function handleModeChange(event, mode){\n      if (mode !== null)\n        setCreationMode(mode);\n    }\n  \n    return (\n      <React.Fragment>\n        {createNewLink && <div className={classes.root}>\n        <div style={{display:'flex'}}>\n          <Typography variant=\"overline\" display=\"block\" gutterBottom>\n              Link Setting\n          </Typography>\n          <Tooltip placement='right-start' title=\"Click on any chart to begin creating references!\">\n              <IconButton style={{marginTop:'-8px'}} size=\"small\" aria-label=\"help\">\n                  <HelpIcon />\n              </IconButton>\n          </Tooltip>\n        </div>\n          <div className={classes.chartAvatars}>\n              {chartsInEditor.map((chart) => (\n                  <Avatar key={chart.id} src={chart.thumbnail} variant='rounded' className={chart.id === selectedChart?.id ? classes.largeAvatarActive: classes.largeAvatar} onClick={() => handleChartAvatarClick(chart)} />\n              ))}\n          </div>\n          {selectedChart && <ToggleButtonGroup className={classes.toggleBtn}\n                value={creationMode}\n                exclusive\n                onChange={handleModeChange}\n                aria-label=\"text alignment\"\n                size='small'\n                >\n                <ToggleButton value=\"brush\" aria-label=\"left aligned\">\n                    <BrushIcon />\n                </ToggleButton>\n                <ToggleButton value=\"filter\" aria-label=\"centered\">\n                    <TuneIcon />\n                </ToggleButton>\n            </ToggleButtonGroup>}\n          {selectedChart && <ChartSetting mode={creationMode} textSelection={textSelection} chart={selectedChart} />}\n      </div>}\n      {showLinkSettingFor && <div className={classes.root}>\n          <Typography variant=\"overline\" display=\"block\" gutterBottom>\n              Link Setting\n          </Typography>\n          <div className={classes.chartAvatars}>\n              {chartsInEditor.map((chart) => (\n                  <Avatar key={chart.id} src={chart.thumbnail} variant='rounded' className={chart.id === showLinkSettingFor?.chartId ? classes.largeAvatarActive: classes.largeAvatar} />\n              ))}\n          </div>\n          {selectedChart && <ChartSetting textSelection={textSelection} chart={selectedChart} showLinkSettingFor={showLinkSettingFor} />}\n      </div>}\n      {!createNewLink && <Fragment>\n          <Typography variant=\"button\" display=\"block\" gutterBottom>\n              Useful Shortcuts\n          </Typography>\n          <Typography variant=\"caption\" display=\"block\" gutterBottom>\n           Press <strong>Tab key</strong> while at the end of a sentence or paragraph to get automatic suggestions!\n      </Typography>\n      <Typography variant=\"caption\" display=\"block\" gutterBottom>\n       Type <strong>@</strong> or <strong> select portion of text</strong> to triggers suggestions!\n      </Typography>\n          \n{/*           \n          <Tooltip placement='right-start' title=\"Press Tab key while at the end of a sentence or paragraph to get automatic suggestions!\">\n              <IconButton style={{marginTop:'-8px'}}  aria-label=\"help\">\n                  <LinkIcon />\n              </IconButton>\n          </Tooltip>\n          <Tooltip placement='right-start' title=\"Press @ key or select portion of text to triggers suggestions!\">\n              <IconButton style={{marginTop:'-8px'}}  aria-label=\"help\">\n                  <MenuOpenIcon />\n              </IconButton>\n          </Tooltip> */}\n          </Fragment>}\n      </React.Fragment>\n    );\n}","import React from \"react\";\nimport { useDispatch } from \"react-redux\";\n// import TextField from '@material-ui/core/TextField';\nimport ChartGallery from \"components/ChartGallery\";\nimport Editor from \"components/Editor\";\n\nimport Grid from \"@material-ui/core/Grid\";\nimport Typography from \"@material-ui/core/Typography\";\nimport { setViewMode } from \"ducks/ui\";\nimport { useEffect } from \"react\";\nimport LinkSetting from \"components/LinkSetting\";\nimport HelpIcon from '@material-ui/icons/Help';\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\n\nexport default function Edit(props) {\n    const dispatch = useDispatch();\n    useEffect(() => {\n        dispatch(setViewMode(false));\n    }, []);\n\n    return (\n        <Grid container spacing={2}>\n            <Grid item xs={2}>\n                <div style={{display:'flex'}}>\n                <Typography variant=\"overline\" display=\"block\" gutterBottom>\n                    Chart Gallery\n                </Typography>\n                <Tooltip placement='right-start' title=\"Drop VegaLite specifications to add charts!\">\n                    <IconButton style={{marginTop:'-8px'}} size=\"small\" aria-label=\"help\">\n                        <HelpIcon />\n                    </IconButton>\n                </Tooltip>\n                </div>\n                <ChartGallery />\n            </Grid>\n            <Grid item xs={7}>\n                <Editor />\n            </Grid>\n            <Grid item xs={3}>\n                <LinkSetting />\n            </Grid>\n        </Grid>\n    );\n}\n","import React from \"react\";\nimport Navbar from \"components/Navbar\";\nimport Home from 'components/Home';\nimport Docs from 'components/Docs';\nimport View from 'components/View';\nimport Edit from 'components/Edit';\nimport { HashRouter as Router, Switch, Route } from \"react-router-dom\";\nimport Container from '@material-ui/core/Container';\n\nfunction App() {\n  return (\n    <Router>\n      <Navbar />\n      <Container maxWidth=\"lg\" mt={2}>\n        <Switch>\n          <Route path=\"/docs/:docId/view\">\n            <View />\n          </Route>\n          <Route path=\"/docs/:docId\">\n            <Edit />\n          </Route>\n          <Route path=\"/docs\">\n            <Docs />\n          </Route>\n          <Route path=\"/\">\n            <Home />\n          </Route>\n          \n        </Switch>\n      </Container>\n    </Router>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { combineReducers } from \"redux\";\n// import editor from \"./editor\";\nimport charts from \"./charts\";\nimport docs from \"./docs\";\nimport links from \"./links\";\nimport ui from \"./ui\";\n\nexport default combineReducers({\n  docs,\n  charts,\n  links,\n  ui\n});\n\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport { createLogger } from \"redux-logger\";\nimport reduxFreeze from \"redux-freeze\";\nimport { Provider } from \"react-redux\";\nimport { applyMiddleware, createStore } from \"redux\";\nimport rootReducer from \"./ducks\";\nimport localforage from \"localforage\";\nimport throttle from \"./utils/throttle\";\n\nimport { createMuiTheme, ThemeProvider } from \"@material-ui/core/styles\";\nconst theme = createMuiTheme({\n    //https://material-ui.com/customization/palette/\n    palette: {\n        primary: {\n            main: \"#2196f3\",\n        },\n        secondary: {\n            main: \"#e91e63\",\n        },\n        info: {\n            main: \"#1976d2\",\n        },\n        error: {\n            main: \"#f44336\",\n        },\n        warning: {\n            main: \"#ff9800\",\n        },\n        success: {\n            main: \"#4caf50\",\n        },\n    },\n    secondary: {\n        main: \"#e91e63\",\n    },\n    info: {\n        main: \"#1976d2\",\n    },\n    error: {\n        main: \"#f44336\",\n    },\n    warning: {\n        main: \"#ff9800\",\n    },\n    success: {\n        main: \"#4caf50\",\n    },\n    textSecondary: {\n        main: \"#bdbdbd\",\n    },\n});\n// console.log(logger);\n\nlet loadData = new Promise((resolve, reject) => {\n    localforage\n        .getItem(\"state\")\n        .then((data) => {\n            resolve(data);\n        })\n        .catch((err) => {\n            reject(err);\n        });\n});\n\nloadData\n    .then((data) => {\n        let middleware = [reduxFreeze, createLogger()];\n        let store = createStore(\n            rootReducer,\n            // {},\n            data ? data : {},\n            // applyMiddleware(...middleware)\n        );\n        // initialize if ne\n        if (!data) {\n        }\n        store.subscribe(\n            throttle(() => {\n                let state = { ...store.getState() };\n                delete state[\"ui\"]; // don't persist ui sate\n                localforage.setItem(\"state\", state);\n            }, 1000)\n        );\n        // localforage.clear(function(err) {\n        //   // Run this code once the database has been entirely deleted.\n        //   console.log(\"Database is now empty.\");\n        // });\n        ReactDOM.render(\n            <Provider store={store}>\n                <ThemeProvider theme={theme}>\n                    <App />\n                </ThemeProvider>\n            </Provider>,\n            document.getElementById(\"root\")\n        );\n    })\n    .catch((err) => {\n        console.log(err);\n        ReactDOM.render(<div>Failed to initialize data!</div>, document.getElementById(\"root\"));\n    });\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}