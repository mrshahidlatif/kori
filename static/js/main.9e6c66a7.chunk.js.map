{"version":3,"sources":["components/ChartConfigPanel/index.module.css","components/Link/index.module.css","components/ChartGallery/index.module.css","components/Viewer/index.module.css","components/HighlightTextSelection/index.module.css","components/Chart/index.module.css","components/Editor/index.module.css","components/SuggestionPanel/index.module.css","components/PotentialLinkControls/index.module.css","utils/uniqueId.js","ducks/charts.js","ducks/docs.js","components/Navbar/index.jsx","components/Home/index.jsx","ducks/ui.js","components/Doc/index.jsx","components/Docs/index.jsx","utils/addSignalToChartSpec.js","utils/addBrushToVegaLiteSpec.js","utils/throttle.js","components/ChartConfigPanel/index.jsx","components/ChartBlock/index.jsx","components/EditorToolbar/index.jsx","utils/createChartBlockPlugin.js","ducks/links.js","utils/editorDecorators.js","components/HighlightTextSelection/index.jsx","components/Link/index.jsx","components/Viewer/index.jsx","utils/removePotentialLinks.js","components/View/index.jsx","components/Alert/index.jsx","components/Chart/index.jsx","utils/extractChartFeatures.js","utils/createThumbnail.js","components/ChartGallery/index.jsx","components/SuggestionPanel/index.jsx","components/PotentialLinkControls/index.jsx","utils/findSuggestions.js","utils/searchLinks.js","utils/getBlockText.js","utils/getLastTypedWord.js","utils/insertLinks.js","utils/deHighlightTextSelection.js","utils/filterAlreadyConfirmedLinksInEditor.js","utils/createLink.js","components/Editor/index.jsx","utils/getTextSelection.js","utils/highlightTextSelection.js","components/Filter/index.jsx","components/ManualLinkControls/index.jsx","components/EditLinkSetting/index.jsx","components/ChartSetting/index.jsx","components/LinkSetting/index.jsx","components/Edit/index.jsx","App.js","serviceWorker.js","ducks/index.js","index.js"],"names":["module","exports","nanoid","customAlphabet","prefix","createChart","docId","spec","liteSpec","attrs","chartId","uniqueId","type","timestamp","Date","now","highlight","channel","active","inactive","id","updateChart","getCharts","createSelector","state","docs","charts","_","map","cid","getChartsInEditor","chartsInEditor","initialState","testchart","thumbnail","properties","axes","name","field","data","title","features","value","barChartSpec","barChartLiteSpec","updateDoc","testdoc","searchedSentences","editorRawState","blocks","key","text","depth","inlineStyleRanges","offset","length","style","entityRanges","entityMap","useStyles","makeStyles","theme","root","flexGrow","marginBottom","spacing","classes","dispatch","useDispatch","useSelector","ui","currentDocId","doc","AppBar","className","position","color","Toolbar","variant","Link","underline","component","RouterLink","to","TextField","onChange","e","target","size","fullWidth","margin","marginLeft","marginRight","label","Button","Home","Grid","container","justify","item","xs","Typography","gutterBottom","Box","Fab","aria-label","display","setSelectedLink","link","setTextSelection","textSelection","setManualLinkId","linkId","exitManualLinkMode","exit","setViewMode","val","setLinkActiveNoAutoTrigger","showLinkSettingFor","button","width","padding","paper","justifyContent","alignItems","palette","secondary","height","Doc","props","onClick","Paper","elevation","Docs","Object","values","action","createDoc","addBrush","selections","includes","mark","paintbrush","toggle","clear","brush","encoding","condition","selection","addBrushToVegaLiteSpec","compile","forEach","d","url","startsWith","process","signals","start","end","enabled","marks","addSignalToMark","isMap","activePredicate","inactivePredicate","oldProp","encode","update","highlightProp","test","concat","isArray","func","last","deferTimer","wait","throttled","args","clearTimeout","setTimeout","ChartConfigPanel","channelOptions","opacity","fill","colors","chart","useState","setActive","setInactive","handleActiveChangeCommitted","event","newValue","handleInactiveChangeCommitted","zIndex","css","panel","top","left","onMouseDown","stopPropagation","p","direction","Select","option","keys","MenuItem","Slider","aria-labelledby","valueLabelDisplay","min","max","step","onChangeCommitted","picker","bgcolor","border","onMouseUp","memo","block","blockProps","customStyleMap","customStyleFn","decorator","forceSelection","offsetKey","tree","contentState","blockStyleFn","preventScroll","elementProps","view","setView","containerEl","useRef","chartEl","ratio","setRatio","toggleSettings","setToggleSettings","viewMode","links","filter","shallowEqual","useMemo","addSignalToChartSpec","JSON","parse","stringify","resize","current","getBoundingClientRect","useEffect","a","runtime","View","runAsync","tempView","toCanvas","canvas","vegaEmbed","actions","result","asyncExec","throttle","some","signal","feature","rangeField","range","showConfig","getAnchorKey","getKey","Fragment","ref","IconButton","toolbarPlugin","createToolbarPlugin","focusPlugin","createFocusPlugin","alignmentPlugin","createAlignmentPlugin","resizeablePlugin","createResizeablePlugin","AlignmentTool","EditorPlugins","config","ChartBlock","blockRendererFn","getEditorState","getType","getCurrentContent","getEntityAt","entity","getEntity","getData","editable","createChartBlockPlugin","composeDecorators","EditorToolbar","externalProps","createLinks","deleteLink","deactivateLink","getLinks","fromEntries","entries","strategy","contentBlock","callback","findEntityRanges","character","entityKey","data-offset-key","children","potentialLink","isConfirmed","onMouseOver","onMouseLeave","updatedLink","startIndex","endIndex","Viewer","useParams","rawEditorState","editorEl","EditorState","createEmpty","convertFromRaw","removePotentialLinks","createWithContent","editorState","setEditorState","viewer","plugins","handleKeyCommand","command","newEditorState","RichUtils","decorators","editorDecorators","readOnly","console","log","Alert","errorMsg","setErrorMsg","hover","setHover","onKeyDown","tabIndex","draggable","onDragStart","dataTransfer","setData","onMouseEnter","Avatar","src","Snackbar","open","anchorOrigin","vertical","horizontal","autoHideDuration","onClose","severity","featureMap","getState","truthy","falsy","recurse","datum","isString","axesMap","extractChartAxes","scales","scale","row","domain","isDate","toString","fields","searchFieldName","scaleName","enter","hasOwnProperty","relatedAxis","axis","undefined","toImageURL","img","resized","orgImg","Promise","resolve","reject","Image","onload","document","createElement","ctx","getContext","drawImage","this","toDataURL","ChartGallery","dragging","setDragging","onDragEnter","onDragLeave","onDragOver","preventDefault","onDrop","file","files","match","reader","FileReader","createThumbnail","extractChartFeatures","readAsText","draggingArea","SuggestionPanel","window","getSelection","pos","rangeCount","getRangeAt","handleClick","suggestion","onSelected","x","y","suggestionPanel","List","ListItem","onCreateLinkSelect","ListItemIcon","suggestions","slice","i","dense","bind","ListItemAvatar","alt","ListItemText","primary","PotentialLinkControls","selectedLink","potentialLinkControls","ButtonGroup","onAccept","onDiscard","partialText","toLowerCase","request","require","sentence","sentenceOffset","blockKey","options","uri","method","headers","Accept","json","body","requestPromise","util","promisify","response","currentContent","blockText","getBlockForKey","getText","currentSelection","currentBlock","caretOffset","getAnchorOffset","blockTextBeforeCaret","substr","lastWord","split","pop","currentBlockText","getBlockText","insertLink","activeBlockKey","find","allInstancesOfLink","indexOf","push","newContent","createEntity","getLastCreatedEntityKey","insertLinkSelection","merge","anchorKey","focusKey","anchorOffset","focusOffset","insertSuggestionSelection","getLastTypedWord","Modifier","replaceText","trigger","getCurrentInlineStyle","caretPosition","newSelection","currentSelectionState","currentContentState","newContentState","applyEntity","newCaretPosition","Math","getFocusOffset","moveSelectionToEnd","allLinksInCurrentBlockText","linkInCurrentBlockText","shouldKeep","extent","Editor","storedEditorState","allLinks","exitManualLink","manualLinkId","linkActiveNoAutoTrigger","textSelectionInStore","tempTextSelection","setTempTextSelection","setSuggestions","alreadySearchedSentences","setCurrentSelectionState","setCurrentBlock","infoMsg","setInfoMsg","autoLinksToInsert","setAutoLinksToInsert","getUpdatedLinkExtent","convertToRaw","BlkKey","activeBlock","er","deHighlightTextSelection","focus","dispatchEvent","KeyboardEvent","insertLinks","msg","linkIdsToKeep","nlp","sentences","sentenceObject","searchLinks","filterAlreadyConfirmedLinksInEditor","seen","Set","el","duplicate","has","add","editor","exists","AtomicBlockUtils","insertAtomicBlock","insertChart","clearData","lastTypedWord","allText","getPlainText","trim","updatedSearchedSentences","alreadySearchedSentence","findSuggestions","ids","reduce","acc","updateChartsInEditor","blockDelimiter","startKey","getStartKey","endKey","getEndKey","getBlockMap","lastWasEnd","selectedBlock","skipUntil","takeUntil","getStartOffset","getEndOffset","join","sIndex","eIndex","isBackward","getTextSelection","onBlur","handlePastedText","stripPastedStyles","onTab","s","commonProps","createLinkObject","isNaN","Number","createLink","insertTextSelection","highlightTextSelection","ContentState","createFromText","updateLinkExtent","confirmedLink","ValueLabelComponent","Tooltip","enterTouchDelay","placement","Filter","setAxis","React","setValue","textValue","setTextValue","setMarks","showSlider","setShowSlider","pointFeatures","setPointFeatures","chartProperties","filterOptions","featureFields","f","showRightControlsForFilter","filterField","axisObj","myArray","tmp","lowest","POSITIVE_INFINITY","highest","NEGATIVE_INFINITY","getMinMax","viewData","vd","minDate","maxDate","newMarks","toLocaleDateString","toLocaleString","axisFeatures","onFilterUpdate","intervalValues","fontSize","onDelete","FormControl","formControl","InputLabel","htmlFor","native","o","Autocomplete","multiple","getOptionLabel","renderInput","params","valueLabelFormat","chartAvatars","ManualLinkControls","showField","setShowField","setLink","selectedPoints","setSelectedPoints","filters","setFilters","selectedChart","axisOptions","makeManualLink","multiPoint","points","j","_vgsid_","brushField","handleFilterDelete","filterId","updatedFilters","handleFilterUpdate","filterState","newFilters","nf","selectedMarks","mode","dataProps","currentDoc","showSelectedLinkSetting","selectedAxis","sp","ao","FormHelperText","EditLinkSetting","linkToUpdate","stringValues","setStringValues","multiline","rowsMax","hidden","ChartSetting","setSelectedMarks","setViewData","setBrush","addDataListener","error","marginTop","toggleBtn","largeAvatar","largeAvatarActive","LinkSetting","setSelectedChart","creationMode","setCreationMode","createNewLink","setCreateNewLink","c","handleChartAvatarClick","ToggleButtonGroup","exclusive","ToggleButton","Edit","App","Navbar","Container","maxWidth","mt","path","Boolean","location","hostname","combineReducers","newState","createMuiTheme","main","info","warning","success","textSecondary","localforage","getItem","then","catch","err","reduxFreeze","createLogger","store","createStore","rootReducer","subscribe","setItem","ReactDOM","render","ThemeProvider","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.9e6c66a7.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"panel\":\"ChartConfigPanel_panel__1OEWt\",\"picker\":\"ChartConfigPanel_picker__2cC4T\",\"color\":\"ChartConfigPanel_color__2Pmzu\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"link\":\"Link_link__jXHvo\",\"potentialLink\":\"Link_potentialLink__3JiCy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ChartGallery_container__pQIvT\",\"draggingArea\":\"ChartGallery_draggingArea__Wft5P\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"viewer\":\"Viewer_viewer__2m97m\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"textSelection\":\"HighlightTextSelection_textSelection__2uV3y\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Chart_container__-PcK5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"editor\":\"Editor_editor__2c4G6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"suggestionPanel\":\"SuggestionPanel_suggestionPanel__2eTnI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"potentialLinkControls\":\"PotentialLinkControls_potentialLinkControls__7i3RY\"};","import { customAlphabet } from 'nanoid'\r\nconst nanoid = customAlphabet('1234567890abcdefghijklmnopqrstuvwxyz', 10)\r\nexport default (prefix) => { \r\n\treturn (prefix ? prefix + nanoid() : nanoid());\r\n};","import uniqueId from \"utils/uniqueId\";\r\nimport barChartSpec from \"./specs/barchart.json\";\r\nimport barChartLiteSpec from \"./specs/barChartLite.json\";\r\nimport { createSelector } from \"reselect\";\r\n\r\n// action types\r\nexport const CREATE_CHART = \"CREATE_CHART\";\r\nexport const UPDATE_CHART = \"UPDATE_CHART\";\r\nexport const DELETE_CHART = \"DELETE_CHART\";\r\n\r\n// actions\r\nexport const createChart = (docId, spec, liteSpec, attrs = {}) => {\r\n    let chartId = uniqueId(\"chart-\");\r\n    attrs = {\r\n        docId,\r\n        spec,\r\n        liteSpec,\r\n        timestamp: Date.now(),\r\n        highlight: { channel: \"opacity\", active: 1.0, inactive: 0.1 },\r\n        ...attrs,\r\n        id: chartId,\r\n    };\r\n    return { type: CREATE_CHART, chartId, attrs };\r\n};\r\n\r\nexport const updateChart = (chartId, attrs) => {\r\n    return { type: UPDATE_CHART, chartId, attrs };\r\n};\r\n\r\nexport const deleteChart = (chartId, attrs) => {\r\n    return {\r\n        type: DELETE_CHART,\r\n        chartId,\r\n        attrs,\r\n    };\r\n};\r\n// selectors\r\nexport const getCharts = createSelector(\r\n    (state) => state.docs,\r\n    (state) => state.charts,\r\n    (_, docId) => docId,\r\n    (docs, charts, docId) => docs[docId].charts.map((cid) => charts[cid])\r\n);\r\n\r\nexport const getChartsInEditor = createSelector(\r\n    (state) => state.docs,\r\n    (state) => state.charts,\r\n    (_, docId) => docId,\r\n    (docs, charts, docId) => docs[docId].chartsInEditor.map((cid) => charts[cid])\r\n);\r\n// reducers\r\nconst initialState = {\r\n    testchart: {\r\n        id: \"testchart\",\r\n        docId: \"testdoc\",\r\n        timestamp: Date.now(),\r\n        thumbnail:\r\n            \"data:image/png;base64,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\",\r\n        highlight: { channel: \"opacity\", active: 1.0, inactive: 0.1 },\r\n        properties: {\r\n            axes: [\r\n                {\r\n                    name: \"x\",\r\n                    field: \"category\",\r\n                    data: \"data_0\",\r\n                    type: \"ordinal\",\r\n                    title: \"category\",\r\n                },\r\n                { name: \"y\", field: \"amount\", data: \"data_0\", type: \"linear\", title: \"amount\" },\r\n            ],\r\n            features: [\r\n                { value: \"Apple\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Amazon\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Facebook\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Netflix\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Microsoft\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Samsung\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Twitter\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n                { value: \"Linkedin\", type: \"string\", field: \"category\", data: \"data_0\" },\r\n            ],\r\n        },\r\n        spec: barChartSpec,\r\n        liteSpec: barChartLiteSpec,\r\n    },\r\n};\r\n\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case CREATE_CHART:\r\n        case UPDATE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.chartId]: {\r\n                    ...(state[action.chartId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case DELETE_CHART: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.chartId];\r\n            return newState;\r\n        }\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import uniqueId from \"utils/uniqueId\";\r\nimport { CREATE_CHART, DELETE_CHART } from \"ducks/charts\";\r\n// action types\r\nexport const CREATE_DOC = \"CREATE_DOC\";\r\nexport const UPDATE_DOC = \"UPDATE_DOC\";\r\nexport const DELETE_DOC = \"DELETE_DOC\";\r\n\r\nexport const UPDATE_EDITOR_STATE = \"UPDATE_EDITOR_STATE\";\r\nexport const UPDATE_CHARTS_IN_EDITOR = \"UPDATE_CHARTS_IN_EDITOR\";\r\n\r\n// actions\r\nexport const createDoc = (attrs = {}) => {\r\n    let docId = uniqueId();\r\n    attrs = {\r\n        title: \"Untitled\",\r\n        editorRawState: null,\r\n        timestamp: Date.now(),\r\n        searchedSentences: [],\r\n        charts: [],\r\n        chartsInEditor: [],\r\n        ...attrs,\r\n        id: docId,\r\n    };\r\n    return { type: CREATE_DOC, docId, attrs };\r\n};\r\n\r\nexport const updateDoc = (docId, attrs) => {\r\n    return { type: UPDATE_DOC, docId, attrs };\r\n};\r\n\r\nexport const deleteDoc = (docId) => {\r\n    return {\r\n        type: DELETE_DOC,\r\n        docId,\r\n    };\r\n};\r\n\r\nexport const updateChartsInEditor = (docId, charts) => {\r\n    return { type: UPDATE_CHARTS_IN_EDITOR, docId, charts };\r\n};\r\n\r\n// selectors\r\n\r\n// reducers\r\n\r\nconst initialState = {\r\n    testdoc: {\r\n        id: \"testdoc\",\r\n        title: \"Testing...\",\r\n        timestamp: Date.now(),\r\n        charts: [\"testchart\"],\r\n        chartsInEditor: [],\r\n        searchedSentences: [],\r\n        editorRawState: {\r\n            blocks: [\r\n                {\r\n                    key: \"8i090\",\r\n                    text: \"Welcome to Vis-Text Editor\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 26,\r\n                            style: \"BOLD\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n                {\r\n                    key: \"42ncd\",\r\n                    text: \"Here you can compose interactive articles\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 42,\r\n                            style: \"UNDERLINE\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n                {\r\n                    key: \"327r6\",\r\n                    text:\r\n                        \"Start dragging the chart from Chart Gallery to the editor and start creating! ;)\",\r\n                    type: \"unstyled\",\r\n                    depth: 0,\r\n                    inlineStyleRanges: [\r\n                        {\r\n                            offset: 0,\r\n                            length: 81,\r\n                            style: \"ITALIC\",\r\n                        },\r\n                    ],\r\n                    entityRanges: [],\r\n                    data: {},\r\n                },\r\n            ],\r\n            entityMap: {},\r\n        },\r\n    },\r\n};\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case CREATE_DOC:\r\n        case UPDATE_DOC:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...(state[action.docId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case DELETE_DOC: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.docId];\r\n            return newState;\r\n        }\r\n        case CREATE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.attrs.docId]: {\r\n                    ...state[action.attrs.docId],\r\n                    charts: state[action.attrs.docId].charts.concat(action.chartId),\r\n                },\r\n            };\r\n        case DELETE_CHART:\r\n            return {\r\n                ...state,\r\n                [action.attrs.docId]: {\r\n                    ...state[action.attrs.docId],\r\n                    charts: state[action.attrs.docId].charts.filter(\r\n                        (cid) => cid !== action.chartId\r\n                    ),\r\n                },\r\n            };\r\n\r\n        case UPDATE_CHARTS_IN_EDITOR:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...state[action.docId],\r\n                    chartsInEditor: action.charts,\r\n                },\r\n            };\r\n        case UPDATE_EDITOR_STATE:\r\n            return {\r\n                ...state,\r\n                [action.docId]: {\r\n                    ...state[action.docId],\r\n                    editorRawState: action.editorRawState,\r\n                },\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React, { Fragment } from \"react\";\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport AppBar from \"@material-ui/core/AppBar\";\r\nimport Toolbar from \"@material-ui/core/Toolbar\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport Link from \"@material-ui/core/Link\";\r\nimport TextField from \"@material-ui/core/TextField\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { updateDoc } from \"ducks/docs\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    root: {\r\n        flexGrow: 1,\r\n        marginBottom: theme.spacing(3),\r\n    },\r\n    // menuButton: {\r\n    //   marginRight: theme.spacing(2),\r\n    // },\r\n    title: {\r\n        flexGrow: 1,\r\n    },\r\n}));\r\n\r\nexport default function () {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n    const docId = useSelector((state) => state.ui.currentDocId);\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n\r\n    function handleChange(e) {\r\n        dispatch(updateDoc(docId, { title: e.target.value }));\r\n    }\r\n    return (\r\n        <AppBar className={classes.root} position=\"static\" color=\"inherit\">\r\n            <Toolbar variant=\"dense\">\r\n                {/* <Button  color=\"inherit\" component={RouterLink} to=\"/docs\">\r\n        <Typography variant=\"h6\" className={classes.title}>\r\n        GORI\r\n          </Typography>\r\n        </Button> */}\r\n                <Link\r\n                    variant=\"h6\"\r\n                    className={classes.title}\r\n                    underline=\"none\"\r\n                    color=\"inherit\"\r\n                    component={RouterLink}\r\n                    to=\"/\"\r\n                >\r\n                    KORI\r\n                </Link>\r\n                {/* <Typography variant=\"h6\" className={classes.title} >\r\n\r\n          \r\n          </Typography> */}\r\n                {docId && (\r\n                    <TextField\r\n                        value={doc.title}\r\n                        onChange={handleChange}\r\n                        size=\"small\"\r\n                        fullWidth\r\n                        margin=\"dense\"\r\n                        variant=\"filled\"\r\n                        style={{ marginLeft: \"100px\", marginRight: \"20px\" }}\r\n                        label=\"Document Title\"\r\n                    />\r\n                )}\r\n                <Button color=\"inherit\" component={RouterLink} to=\"/docs\">\r\n                    Docs\r\n                </Button>\r\n\r\n                {docId && (\r\n                    <Fragment>\r\n                        <span style={{ marginLeft: \"10px\", marginRight: \"10px\" }}> | </span>\r\n                        <Button color=\"inherit\" component={RouterLink} to={`/docs/${docId}`}>\r\n                            Edit\r\n                        </Button>\r\n                        <Button color=\"inherit\" component={RouterLink} to={`/docs/${docId}/view`}>\r\n                            View\r\n                        </Button>\r\n                    </Fragment>\r\n                )}\r\n            </Toolbar>\r\n        </AppBar>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport Fab from \"@material-ui/core/Fab\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport NavigationIcon from \"@material-ui/icons/Navigation\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport { Link } from \"react-router-dom\";\r\nfunction Home() {\r\n    return (\r\n        <Grid container spacing={3} justify=\"center\">\r\n            <Grid item xs={6}>\r\n                <Typography variant=\"h2\" gutterBottom>\r\n                    KORI\r\n                </Typography>\r\n                <Box marginBottom={2}>\r\n                    <Typography variant=\"body1\" gutterBottom>\r\n                        Abstract\r\n                    </Typography>\r\n                </Box>\r\n                <Fab\r\n                    variant=\"extended\"\r\n                    color=\"primary\"\r\n                    aria-label=\"add\"\r\n                    component={Link}\r\n                    to=\"/docs\"\r\n                >\r\n                    <NavigationIcon />\r\n                    Get Started\r\n                </Fab>\r\n            </Grid>\r\n            <Grid item xs={6}>\r\n                <Typography variant=\"overline\" display=\"block\" gutterBottom>\r\n                    Teaser Image/Video\r\n                </Typography>\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n\r\nexport default Home;\r\n","export const SET_SELECTED_LINK = \"SET_SELECTED_LINK\";\r\nexport const SET_TEXT_SELECTION = \"SET_TEXT_SELECTION\";\r\nexport const SET_MANUAL_LINK_ID = \"SET_MANUAL_LINK_ID\";\r\nexport const EXIT_MANUAL_LINK_MODE = \"EXIT_MANUAL_LINK_MODE\";\r\nexport const SET_CURRENT_DOC_ID = \"SET_CURRENT_DOC_ID\";\r\nexport const SET_VIEW_MODE = \"SET_VIEW_MODE\";\r\nexport const LINK_ACTIVE_NO_AUTO_TRIGGER = \"LINK_ACTIVE_NO_AUTO_TRIGGER\";\r\nexport const SHOW_LINK_SETTING_FOR = \"SHOW_LINK_SETTING_FOR\"\r\n\r\nexport const setSelectedLink = (link) => {\r\n    return { type: SET_SELECTED_LINK, link };\r\n};\r\nexport const setTextSelection = (textSelection) => {\r\n    return { type: SET_TEXT_SELECTION, textSelection };\r\n};\r\nexport const setManualLinkId = (linkId) => {\r\n    return { type: SET_MANUAL_LINK_ID, linkId };\r\n};\r\nexport const exitManualLinkMode = (exit) => {\r\n    return { type: EXIT_MANUAL_LINK_MODE, exit };\r\n};\r\n\r\nexport const SetCurrentDocId = (docId) => {\r\n    return { type: SET_CURRENT_DOC_ID, docId };\r\n};\r\nexport const setViewMode = (val) => {\r\n    return { type: SET_VIEW_MODE, val };\r\n};\r\nexport const setLinkActiveNoAutoTrigger = (val) => {\r\n    return { type: LINK_ACTIVE_NO_AUTO_TRIGGER, val };\r\n};\r\nexport const showLinkSettingFor = (val) => {\r\n    return { type: SHOW_LINK_SETTING_FOR, val };\r\n};\r\n//reducers\r\nconst initialState = {};\r\n\r\nexport default (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case SET_SELECTED_LINK:\r\n            return {\r\n                ...state,\r\n                selectedLink: action.link,\r\n            };\r\n        case SET_TEXT_SELECTION:\r\n            return {\r\n                ...state,\r\n                textSelection: action.textSelection,\r\n            };\r\n        case SET_MANUAL_LINK_ID:\r\n            return {\r\n                ...state,\r\n                manualLinkId: action.linkId,\r\n            };\r\n        case EXIT_MANUAL_LINK_MODE:\r\n            return {\r\n                ...state,\r\n                exitManualLink: action.exit,\r\n            };\r\n        case SET_CURRENT_DOC_ID:\r\n            return {\r\n                ...state,\r\n                currentDocId: action.docId,\r\n            };\r\n        case SET_VIEW_MODE:\r\n            return { ...state, viewMode: action.val };\r\n        case LINK_ACTIVE_NO_AUTO_TRIGGER:\r\n            return { ...state, linkActiveNoAutoTrigger: action.val };\r\n        case SHOW_LINK_SETTING_FOR:\r\n            return { ...state, showLinkSettingFor: action.val};\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React from \"react\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\n\r\nimport { createDoc } from \"ducks/docs\";\r\nimport { SetCurrentDocId } from \"ducks/ui\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    button: {\r\n        width: \"100%\",\r\n        padding: theme.spacing(1),\r\n        margin: theme.spacing(1),\r\n    },\r\n    paper: {\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        color: theme.palette.text.secondary,\r\n        height: theme.spacing(16),\r\n        width: \"100%\",\r\n    },\r\n}));\r\n\r\nfunction Doc(props) {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n\r\n    function handleClick() {\r\n        dispatch(SetCurrentDocId(props.docId));\r\n    }\r\n\r\n    return (\r\n        <Button\r\n            className={classes.button}\r\n            component={RouterLink}\r\n            to={`/docs/${props.docId}`}\r\n            onClick={handleClick}\r\n        >\r\n            <Paper className={classes.paper} elevation={2}>\r\n                {props.doc.title}\r\n                <div></div>\r\n            </Paper>\r\n        </Button>\r\n    );\r\n}\r\n\r\nexport default Doc;\r\n","import React from \"react\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport AddIcon from \"@material-ui/icons/Add\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport Doc from \"components/Doc\";\r\n\r\nimport { createDoc } from \"ducks/docs\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    button: {\r\n        width: \"100%\",\r\n        padding: theme.spacing(1),\r\n        margin: theme.spacing(1),\r\n    },\r\n    paper: {\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        color: theme.palette.text.secondary,\r\n        height: theme.spacing(16),\r\n        width: \"100%\",\r\n    },\r\n}));\r\n\r\nfunction Docs() {\r\n    const classes = useStyles();\r\n    const dispatch = useDispatch();\r\n    const docs = useSelector((state) => Object.values(state.docs));\r\n\r\n    function handleClick() {\r\n        const action = createDoc();\r\n        dispatch(action);\r\n    }\r\n\r\n    return (\r\n        <Grid container spacing={1}>\r\n            <Grid item xs={2}>\r\n                <Button className={classes.button} onClick={handleClick}>\r\n                    <Paper className={classes.paper} variant=\"outlined\">\r\n                        <AddIcon />\r\n                    </Paper>\r\n                </Button>\r\n            </Grid>\r\n            {docs.map((doc) => (\r\n                <Grid key={doc.id} item xs={2}>\r\n                    <Doc doc={doc} docId={doc.id} />\r\n                </Grid>\r\n            ))}\r\n        </Grid>\r\n    );\r\n}\r\n\r\nexport default Docs;\r\n","// TODO: support different encodings?\r\nimport { isArray, isObject } from \"vega-util\";\r\nimport addBrushToVegaLiteSpec from \"utils/addBrushToVegaLiteSpec\";\r\nimport { compile } from \"vega-lite/build/vega-lite\";\r\n\r\nexport default (highlight, liteSpec, addBrush) => {\r\n    try {\r\n        if(addBrush) addBrushToVegaLiteSpec(liteSpec);\r\n        \r\n    } catch (e) {}\r\n\r\n    const spec = compile(liteSpec).spec; // vega spec\r\n    // support vega-lite sample datasets\r\n\r\n    spec.data.forEach((d) => {\r\n        if (d.url && d.url.startsWith(\"data\")) {\r\n            d.url = process.env.PUBLIC_URL + \"/\" + d.url;\r\n        }\r\n    });\r\n\r\n    // highlight\r\n    spec.signals = [\r\n        ...(spec.signals || []),\r\n        {\r\n            name: \"highlight\", // should we add a prefix to avoid conflict with existing signals\r\n            value: { data: [], start: 0, end: 100, enabled: false },\r\n        },\r\n    ];\r\n\r\n    spec.marks.forEach((mark) => {\r\n        addSignalToMark(mark, highlight);\r\n    });\r\n    return spec;\r\n};\r\n\r\nexport function addSignalToMark(mark, highlight) {\r\n    if (mark.type === \"group\") {\r\n        // recursive\r\n        if (mark.marks) {\r\n            mark.marks.forEach((mark) => addSignalToMark(mark, highlight)); // will this generalize to all charts?\r\n        }\r\n        return;\r\n    }\r\n    const isMap = mark.type === \"shape\" && mark.style.includes(\"geoshape\");\r\n    //Warning: Not scalable solution, only handles combination of a categorical with upto 3 numerical axis\r\n    //TODO: see if we can combine two categorical variables using the same logic\r\n    const activePredicate = `highlight.enabled===true && (\r\n        (length(highlight.rangeField) === 0 && ${\r\n            isMap ? \"indexof(highlight.data, datum.properties[highlight.field]) != -1 || indexof(highlight.data, datum[highlight.field]) != -1\"  : \"indexof(highlight.data, datum[highlight.field]) != -1\"\r\n        }) || \r\n\r\n        length(highlight.rangeField) === 0 && length(highlight.field) === 2 && indexof(highlight.data, datum[highlight.field[0]]) != -1 && \r\n        indexof(highlight.data, datum[highlight.field[1]]) || \r\n\r\n        (length(highlight.rangeField) === 1 && ${\r\n            isMap ? \"indexof(highlight.data, datum.properties[highlight.field]) != -1 || indexof(highlight.data, datum[highlight.field]) != -1\" : \"indexof(highlight.data, datum[highlight.field]) != -1\"\r\n        }) && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) || \r\n\r\n        length(highlight.rangeField) === 1 && length(highlight.data) === 0 && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) ||\r\n\r\n        length(highlight.rangeField) === 2 && length(highlight.data) === 0 && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) && \r\n        inrange(datum[highlight.rangeField[1]], [highlight.range[2], highlight.range[3]]) ||\r\n\r\n        (length(highlight.rangeField) === 2 && ${\r\n            isMap ? \"indexof(highlight.data, datum.properties[highlight.field]) != -1 || indexof(highlight.data, datum[highlight.field]) != -1\" : \"indexof(highlight.data, datum[highlight.field]) != -1\"\r\n        }) && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) && inrange(datum[highlight.rangeField[1]], [highlight.range[2], highlight.range[3]]) ||\r\n\r\n        length(highlight.rangeField) === 3 && length(highlight.data) === 0 && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) && \r\n        inrange(datum[highlight.rangeField[1]], [highlight.range[2], highlight.range[3]]) && inrange(datum[highlight.rangeField[2]], [highlight.range[4], highlight.range[5]]) ||\r\n\r\n        (length(highlight.rangeField) === 3 && ${\r\n            isMap ? \"indexof(highlight.data, datum.properties[highlight.field]) != -1 || indexof(highlight.data, datum[highlight.field]) != -1\" : \"indexof(highlight.data, datum[highlight.field]) != -1\"\r\n        }) && inrange(datum[highlight.rangeField[0]], [highlight.range[0], highlight.range[1]]) && inrange(datum[highlight.rangeField[1]], [highlight.range[2], highlight.range[3]]) &&\r\n        inrange(datum[highlight.rangeField[2]], [highlight.range[4], highlight.range[5]])\r\n\r\n\r\n    )`;\r\n    //TODO: reduce redundant checking, Also check if we need this at all\r\n    const inactivePredicate =`highlight.enabled===true && !(\r\n        (length(highlight.rangeField) === 0 && ${\r\n            isMap ? \"indexof(highlight.data, datum.properties[highlight.field]) != -1\" : \"indexof(highlight.data, datum[highlight.field]) != -1\"\r\n        })\r\n    )`;\r\n    const oldProp = mark.encode.update[highlight.channel];\r\n    const highlightProp = [\r\n        {\r\n            test: activePredicate,\r\n            value: highlight.active,\r\n        },\r\n        {\r\n            test: inactivePredicate,\r\n            value: highlight.inactive,\r\n        },\r\n        // put existing property if exists either in array or object form\r\n        //TODO: see if we need the Object Check?\r\n        // ...(isObject(oldProp) ? [oldProp] : isArray(oldProp) ? oldProp : []),\r\n    ];\r\n    mark.encode.update = {\r\n        ...mark.encode.update,\r\n        [highlight.channel]: highlightProp.concat(isArray(oldProp) ? oldProp : []),\r\n    };\r\n}\r\n","export default (liteSpec) => {\r\n    // No rectangular brush for maps\r\n    const noBrush = [\"geoshape\"].includes(liteSpec.mark) || liteSpec.mark.type === \"arc\";\r\n    const selections = noBrush\r\n        ? {\r\n              paintbrush: { type: \"multi\", toggle: true, clear: \"window:keypress\", },\r\n              \r\n          }\r\n        : {\r\n              brush: {\r\n                  type: \"interval\",\r\n                  clear: \"window:keypress\",\r\n              },\r\n              paintbrush: {\r\n                  type: \"multi\",\r\n                  toggle: true,\r\n                  clear: \"window:keypress\",\r\n              },\r\n          };\r\n\r\n    liteSpec[\"selection\"] = selections;\r\n    //TODO: Check what's wrong with multiple conditions https://github.com/vega/vega-lite/issues/3040\r\n    liteSpec.encoding[\"opacity\"] = {\r\n        condition: [\r\n            // {\r\n            //     selection: \"brush\",\r\n            //     value: 1,\r\n            // },\r\n            {\r\n                selection: \"paintbrush\",\r\n                value: 1,\r\n            },\r\n        ],\r\n        value: 0.1,\r\n    };\r\n    return liteSpec;\r\n};\r\n","export default (func, wait = 50) => {\r\n  let last;\r\n  let deferTimer;\r\n\r\n  const throttled = (...args) => {\r\n    const now = Date.now();\r\n\r\n    if (last && now < last + wait) {\r\n      clearTimeout(deferTimer);\r\n\r\n      deferTimer = setTimeout(() => {\r\n        last = now;\r\n        func(...args);\r\n      }, wait);\r\n    } else {\r\n      last = now;\r\n      func(...args);\r\n    }\r\n  };\r\n\r\n  return throttled;\r\n};\r\n","import React, { useState } from \"react\";\r\nimport css from \"./index.module.css\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport MenuItem from \"@material-ui/core/MenuItem\";\r\nimport Slider from \"@material-ui/core/Slider\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Select from \"@material-ui/core/Select\";\r\nimport PropTypes from \"prop-types\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { updateChart } from \"ducks/charts\";\r\n\r\nexport default function ChartConfigPanel(props) {\r\n    const dispatch = useDispatch();\r\n    const channelOptions = {\r\n        opacity: { active: 1.0, inactive: 0.1 },\r\n        fill: { active: \"#1f77b4\", inactive: \"#c7c7c7\" },\r\n    };\r\n    const colors = [\r\n        \"#1f77b4\",\r\n        \"#aec7e8\",\r\n        \"#ff7f0e\",\r\n        \"#ffbb78\",\r\n        \"#2ca02c\",\r\n        \"#98df8a\",\r\n        \"#d62728\",\r\n        \"#ff9896\",\r\n        \"#9467bd\",\r\n        \"#c5b0d5\",\r\n        \"#8c564b\",\r\n        \"#c49c94\",\r\n        \"#e377c2\",\r\n        \"#f7b6d2\",\r\n        \"#7f7f7f\",\r\n        \"#c7c7c7\",\r\n        \"#bcbd22\",\r\n        \"#dbdb8d\",\r\n        \"#17becf\",\r\n        \"#9edae5\",\r\n    ];\r\n    const highlight = props.chart.highlight;\r\n    const [active, setActive] = useState(highlight.active); // necessary for handling intermediate changes\r\n    const [inactive, setInactive] = useState(highlight.inactive); // to prevent constant flickering chart updates\r\n    function handleChannelChange(event) {\r\n        // setChannel(event.target.value);\r\n        const channel = event.target.value;\r\n\r\n        if (channel !== highlight.channel) {\r\n            const option = channelOptions[channel];\r\n            setActive(option.active);\r\n            setInactive(option.inactive);\r\n            dispatch(\r\n                updateChart(props.chart.id, { highlight: { channel, ...channelOptions[channel] } })\r\n            );\r\n        }\r\n    }\r\n    function handleActiveChange(event, newValue) {\r\n        setActive(newValue);\r\n    }\r\n    function handleInactiveChange(event, newValue) {\r\n        setInactive(newValue);\r\n    }\r\n    function handleActiveChangeCommitted(event, newValue) {\r\n        setActive(newValue);\r\n        dispatch(updateChart(props.chart.id, { highlight: { ...highlight, active: newValue } }));\r\n    }\r\n    function handleInactiveChangeCommitted(event, newValue) {\r\n        setInactive(newValue);\r\n        dispatch(updateChart(props.chart.id, { highlight: { ...highlight, inactive: newValue } }));\r\n    }\r\n    return (\r\n        <div>\r\n            <Box\r\n                zIndex=\"modal\"\r\n                className={css.panel}\r\n                top={40}\r\n                left={\"45%\"}\r\n                onMouseDown={(e) => e.stopPropagation()}\r\n            >\r\n                <Box component={Paper} p={2}>\r\n                    <Grid container direction=\"column\" spacing={2}>\r\n                        <Grid item>\r\n                            <Typography gutterBottom>Highlight Option</Typography>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <Typography variant=\"caption\">Channel</Typography>\r\n                            <Box>\r\n                                <Select value={highlight.channel} onChange={handleChannelChange}>\r\n                                    {Object.keys(channelOptions).map((option) => (\r\n                                        <MenuItem key={option} value={option}>\r\n                                            {option}\r\n                                        </MenuItem>\r\n                                    ))}\r\n                                </Select>\r\n                            </Box>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <Typography variant=\"caption\">Active</Typography>\r\n                            {highlight.channel === \"opacity\" ? (\r\n                                <Slider\r\n                                    value={active}\r\n                                    aria-labelledby=\"discrete-slider\"\r\n                                    valueLabelDisplay=\"auto\"\r\n                                    min={0.0}\r\n                                    max={1.0}\r\n                                    step={0.05}\r\n                                    onChange={handleActiveChange}\r\n                                    onChangeCommitted={handleActiveChangeCommitted}\r\n                                />\r\n                            ) : (\r\n                                <Box className={css.picker}>\r\n                                    {colors.map((color) => (\r\n                                        <Box\r\n                                            className={css.color}\r\n                                            bgcolor={color}\r\n                                            border={color === active ? 1 : 0}\r\n                                            onMouseUp={(e) => handleActiveChangeCommitted(e, color)}\r\n                                        />\r\n                                    ))}\r\n                                </Box>\r\n                            )}\r\n                            <Typography variant=\"caption\">Inactive</Typography>\r\n                            {highlight.channel === \"opacity\" ? (\r\n                                <Slider\r\n                                    value={inactive}\r\n                                    aria-labelledby=\"discrete-slider\"\r\n                                    valueLabelDisplay=\"auto\"\r\n                                    min={0.0}\r\n                                    max={1.0}\r\n                                    step={0.05}\r\n                                    onChange={handleInactiveChange}\r\n                                    onChangeCommitted={handleInactiveChangeCommitted}\r\n                                />\r\n                            ) : (\r\n                                <Box className={css.picker}>\r\n                                    {colors.map((color) => (\r\n                                        <Box\r\n                                            className={css.color}\r\n                                            bgcolor={color}\r\n                                            border={color === inactive ? 1 : 0}\r\n                                            onMouseUp={(e) =>\r\n                                                handleInactiveChangeCommitted(e, color)\r\n                                            }\r\n                                        />\r\n                                    ))}\r\n                                </Box>\r\n                            )}\r\n                        </Grid>\r\n                    </Grid>\r\n                </Box>\r\n            </Box>\r\n        </div>\r\n    );\r\n}\r\n\r\nChartConfigPanel.propTypes = {\r\n    chart: PropTypes.object,\r\n    onUpdated: PropTypes.func,\r\n};\r\n","import React, { useEffect, useMemo, memo, useState, useRef } from \"react\";\r\nimport { useSelector, shallowEqual } from \"react-redux\";\r\nimport addSignalToChartSpec from \"utils/addSignalToChartSpec\";\r\nimport vegaEmbed from \"vega-embed\";\r\nimport throttle from \"utils/throttle\";\r\nimport { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\nimport ChartConfigPanel from \"components/ChartConfigPanel\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport SettingsIcon from \"@material-ui/icons/Settings\";\r\n\r\nexport default memo(function ChartBlock({\r\n    block,\r\n    blockProps,\r\n    customStyleMap,\r\n    customStyleFn,\r\n    decorator,\r\n    forceSelection,\r\n    offsetKey,\r\n    selection,\r\n    tree,\r\n    contentState,\r\n    blockStyleFn, //weird props passed from editor\r\n    preventScroll, //weird props passed from editor\r\n    style,\r\n    ...elementProps\r\n}) {\r\n    const [view, setView] = useState(null);\r\n    const containerEl = useRef(null);\r\n    const chartEl = useRef(null);\r\n    const [ratio, setRatio] = useState(1);\r\n    const chart = useSelector((state) => state.charts[blockProps.id]);\r\n    const [toggleSettings, setToggleSettings] = useState(false);\r\n    const viewMode = useSelector((state) => state.ui.viewMode);\r\n\r\n    // TODO: use a memoized selector for performance\r\n    const links = useSelector(\r\n        (state) => Object.values(state.links).filter((link) => link.chartId === blockProps.id),\r\n        shallowEqual\r\n    );\r\n    const spec = useMemo(\r\n        () =>\r\n            addSignalToChartSpec(\r\n                chart.highlight,\r\n                JSON.parse(JSON.stringify(chart.liteSpec)),\r\n                false\r\n            ),\r\n        [chart.spec, chart.highlight]\r\n    );\r\n\r\n    useEffect(() => {\r\n        const asyncExec = async () => {\r\n            // compute canvas aspect ratio to maintain it while resizing\r\n\r\n            const runtime = parse(spec);\r\n            const tempView = await new View(runtime).runAsync();\r\n\r\n            const canvas = await tempView.toCanvas();\r\n            const ratio = canvas.height / canvas.width;\r\n            setRatio(ratio);\r\n\r\n            // add autosize: has limitations: https://vega.github.io/vega-lite/docs/size.html#limitations\r\n\r\n            // spec.autosize = {\r\n            //     type: \"fit\",\r\n            //     contains: \"padding\",\r\n            //     resize: true,\r\n            // };\r\n            const result = await vegaEmbed(chartEl.current, spec, { actions: false });\r\n            const view = result.view;\r\n            setView(view);\r\n        };\r\n        asyncExec();\r\n    }, [spec]);\r\n\r\n    useEffect(\r\n        throttle(async () => {\r\n            resize(view, ratio);\r\n        }, 500)\r\n    );\r\n\r\n    function resize(view, ratio) {\r\n        if (view) {\r\n            const { width } = containerEl.current.getBoundingClientRect();\r\n            const height = ratio * width;\r\n            // view.resize().height(height).width(width).runAsync();\r\n        }\r\n    }\r\n    useEffect(() => {\r\n        if (!view) {\r\n            return;\r\n        }\r\n        if (links.some((link) => link.active)) {\r\n            // Should we send all signals at once? would it improve performance?\r\n            links\r\n                .filter((link) => link.active)\r\n                .forEach((link) => {\r\n                    view.signal(\"highlight\", {\r\n                        type: link.type,\r\n                        data: link.data || [],\r\n                        field: link.feature?.field || '',\r\n                        enabled: true,\r\n                        rangeField: link.rangeField || [],\r\n                        range: link.range || [],\r\n                    }).runAsync();\r\n                });\r\n        } else {\r\n            view.signal(\"highlight\", { enabled: false }).runAsync();\r\n        }\r\n    }, [links]);\r\n\r\n    function handleSettingClick() {\r\n        setToggleSettings(!toggleSettings);\r\n    }\r\n\r\n    const showConfig = viewMode ? false : selection.getAnchorKey() === block.getKey(); // show only clicking this block\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <div ref={containerEl} {...elementProps} style={{...style, position: \"relative\", width: \"fit-content\"}}>\r\n                <div>\r\n                    {showConfig && (\r\n                        <IconButton\r\n                            onMouseDown={handleSettingClick}\r\n                            aria-label=\"settings\"\r\n                            // color=\"primary\"\r\n                        >\r\n                            <SettingsIcon />\r\n                        </IconButton>\r\n                    )}\r\n                </div>\r\n                <div ref={chartEl} />\r\n                {showConfig && toggleSettings && <ChartConfigPanel chart={chart} />}\r\n            </div>\r\n        </React.Fragment>\r\n    );\r\n});\r\n","\r\nimport React, { Fragment } from 'react';\r\nimport createToolbarPlugin, { Separator } from \"draft-js-static-toolbar-plugin\";\r\nimport createAlignmentPlugin from \"draft-js-alignment-plugin\";\r\nimport createFocusPlugin from \"draft-js-focus-plugin\";\r\nimport createResizeablePlugin from 'draft-js-resizeable-plugin';\r\n\r\nimport \"draft-js-static-toolbar-plugin/lib/plugin.css\";\r\nimport \"draft-js-alignment-plugin/lib/plugin.css\";\r\nimport \"draft-js-focus-plugin/lib/plugin.css\";\r\n// import \"draft-js-resizeable-plugin/lib/plugin.css\";\r\n\r\nimport createChartBlockPlugin from 'utils/createChartBlockPlugin';\r\n\r\nimport {\r\n  ItalicButton,\r\n  BoldButton,\r\n  UnderlineButton,\r\n  CodeButton,\r\n  HeadlineOneButton,\r\n  HeadlineTwoButton,\r\n  HeadlineThreeButton,\r\n  UnorderedListButton,\r\n  OrderedListButton,\r\n  BlockquoteButton,\r\n  CodeBlockButton\r\n} from \"draft-js-buttons\";\r\nimport { composeDecorators } from \"draft-js-plugins-editor\";\r\n\r\n\r\nconst toolbarPlugin = createToolbarPlugin();\r\nconst focusPlugin = createFocusPlugin();\r\nconst alignmentPlugin = createAlignmentPlugin();\r\nconst resizeablePlugin = createResizeablePlugin();\r\n\r\nconst { AlignmentTool } = alignmentPlugin;\r\nconst { Toolbar } = toolbarPlugin;\r\nconst decorator = composeDecorators(\r\n  focusPlugin.decorator,\r\n  resizeablePlugin.decorator,\r\n  alignmentPlugin.decorator\r\n);\r\n\r\nconst chartBlockPlugin = createChartBlockPlugin({ decorator });\r\nexport const EditorPlugins = [focusPlugin, resizeablePlugin, alignmentPlugin, toolbarPlugin, chartBlockPlugin];\r\n\r\nexport default function EditorToolbar() {\r\n  return (\r\n    <Fragment>\r\n      <Toolbar>\r\n        {// may be use React.Fragment instead of div to improve perfomance after React 16\r\n          externalProps => (\r\n            <div>\r\n              <BoldButton {...externalProps} />\r\n              <ItalicButton {...externalProps} />\r\n              <UnderlineButton {...externalProps} />\r\n              <CodeButton {...externalProps} />\r\n              <Separator {...externalProps} />\r\n              <HeadlineOneButton {...externalProps} />\r\n              <HeadlineTwoButton {...externalProps} />\r\n              <HeadlineThreeButton {...externalProps} />\r\n              <UnorderedListButton {...externalProps} />\r\n              <OrderedListButton {...externalProps} />\r\n              <BlockquoteButton {...externalProps} />\r\n              <CodeBlockButton {...externalProps} />\r\n            </div>\r\n          )}\r\n      </Toolbar>\r\n      <AlignmentTool />\r\n    </Fragment>\r\n\r\n  )\r\n}","\r\nimport ChartBlock from 'components/ChartBlock';\r\n\r\nexport default (config = {}) => {\r\n    const component = config.decorator\r\n        ? config.decorator(ChartBlock)\r\n        : ChartBlock;\r\n\r\n    return {\r\n        blockRendererFn: (block, { getEditorState }) => {\r\n            if (block.getType() === \"atomic\") {\r\n                const contentState = getEditorState().getCurrentContent();\r\n                if (!block.getEntityAt(0)) return;\r\n                const entity = contentState.getEntity(block.getEntityAt(0));\r\n                const data = entity.getData();\r\n                const type = entity.getType();\r\n                if (type === \"CHART\") {\r\n                    return {\r\n                        component,\r\n                        editable: false,\r\n                        props:{\r\n                            ...data\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n            return null;\r\n        },\r\n        ChartBlock\r\n    };\r\n};","import uniqueId from \"utils/uniqueId\";\r\nimport { createSelector } from \"reselect\";\r\n\r\n// action types\r\nexport const CREATE_LINK = \"CREATE_LINK\";\r\nexport const UPDATE_LINK = \"UPDATE_LINK\";\r\nexport const DELETE_LINK = \"DELETE_LINK\";\r\nexport const ACTIVATE_LINK = \"ACTIVATE_LINK\";\r\nexport const DEACTIVATE_LINK = \"DEACTIVATE_LINK\";\r\nexport const CREATE_LINKS = \"CREATE_LINKS\";\r\nexport const CONFIRM_LINK = \"CONFIRM_LINK\";\r\n\r\nexport const createLink = (docId, link, attrs = {}) => {\r\n    let linkId = uniqueId(\"link-\");\r\n    attrs = {\r\n        docId,\r\n        timestamp: Date.now(),\r\n        ...link, // chartId, text, etc\r\n        ...attrs, // will override the above properties if any attr is set in attrs\r\n        id: linkId,\r\n    };\r\n    return { type: CREATE_LINK, linkId, attrs };\r\n};\r\n\r\nexport const createLinks = (docId, links) => {\r\n    return {\r\n        type: CREATE_LINKS,\r\n        links: links.map((link) => ({\r\n            ...link,\r\n            timestamp: Date.now(),\r\n            docId,\r\n            id: uniqueId(\"link-\"),\r\n        })),\r\n    };\r\n};\r\n\r\nexport const updateLink = (linkId, attrs) => {\r\n    return { type: UPDATE_LINK, linkId, attrs };\r\n};\r\n\r\nexport const deleteLink = (linkId) => {\r\n    return {\r\n        type: DELETE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const activateLink = (linkId) => {\r\n    return {\r\n        type: ACTIVATE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const deactivateLink = (linkId) => {\r\n    return {\r\n        type: DEACTIVATE_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\nexport const confirmLink = (linkId) => {\r\n    return {\r\n        type: CONFIRM_LINK,\r\n        linkId,\r\n    };\r\n};\r\n\r\n// selectors\r\nexport const getLinks = createSelector(\r\n    (state) => state.links,\r\n    (_, docId) => docId,\r\n    (links, docId) => Object.fromEntries(Object.entries(links).filter(([k,v]) => v.docId === docId))\r\n);\r\n\r\n// reducers\r\nexport default (state = {}, action) => {\r\n    switch (action.type) {\r\n        case CREATE_LINK:\r\n        case UPDATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...(state[action.linkId] || {}),\r\n                    ...action.attrs,\r\n                },\r\n            };\r\n        case CREATE_LINKS:\r\n            return action.links.reduce((state, link) => {\r\n                return {\r\n                    ...state,\r\n                    [link.id]: link,\r\n                };\r\n            }, state);\r\n        case DELETE_LINK: {\r\n            let newState = {\r\n                ...state,\r\n            };\r\n            delete newState[action.linkId];\r\n            return newState;\r\n        }\r\n        case ACTIVATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    active: true,\r\n                },\r\n            };\r\n        case DEACTIVATE_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    active: false,\r\n                },\r\n            };\r\n        case CONFIRM_LINK:\r\n            return {\r\n                ...state,\r\n                [action.linkId]: {\r\n                    ...state[action.linkId],\r\n                    isConfirmed: true,\r\n                },\r\n            };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","/**\r\n * Super simple decorators for handles and hashtags, for demonstration\r\n * purposes only. Don't reuse these regexes.\r\n */\r\n//TODO: REGEX needs to be improved and crafted to our use case!\r\n// import LinkText from 'components/LinkText';\r\n// import AutoLink from 'components/AutoLink';\r\nimport Link from \"components/Link\";\r\nimport HighlightTextSelection from \"components/HighlightTextSelection\";\r\n// const HANDLE_REGEX = /\\@[\\w]+/g;\r\n\r\n// export function handleStrategy(contentBlock, callback, contentState) {\r\n//   findWithRegex(HANDLE_REGEX, contentBlock, callback);\r\n// }\r\n\r\n// export function findWithRegex(regex, contentBlock, callback) {\r\n//   const text = contentBlock.getText();\r\n//   let matchArr, start;\r\n//   while ((matchArr = regex.exec(text)) !== null) {\r\n//     start = matchArr.index;\r\n//     callback(start, start + matchArr[0].length);\r\n//   }\r\n// }\r\n\r\nexport function findLinkEntities(contentBlock, callback, contentState) {\r\n    contentBlock.findEntityRanges((character) => {\r\n        const entityKey = character.getEntity();\r\n        return entityKey !== null && contentState.getEntity(entityKey).getType() === \"LINK\";\r\n    }, callback);\r\n}\r\nexport function findTextSelectionEntity(contentBlock, callback, contentState) {\r\n    contentBlock.findEntityRanges((character) => {\r\n        const entityKey = character.getEntity();\r\n        return (\r\n            entityKey !== null && contentState.getEntity(entityKey).getType() === \"TEXT_SELECTION\"\r\n        );\r\n    }, callback);\r\n}\r\n\r\nexport default [\r\n    {\r\n        strategy: findTextSelectionEntity,\r\n        component: HighlightTextSelection, // decorateComponentWithProps(LinkText, EditorState)\r\n    },\r\n    {\r\n        strategy: findLinkEntities,\r\n        component: Link,\r\n    },\r\n    // {\r\n    //     strategy: findAutoLinkEntities,\r\n    //     component: AutoLink\r\n    // }\r\n];\r\n","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\n\r\nexport default function Link(props) {\r\n    return (\r\n        <span className={css.textSelection} data-offset-key={props.offsetKey}>\r\n            {props.children}\r\n        </span>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport css from \"./index.module.css\";\r\nimport { activateLink, deactivateLink, updateLink } from \"ducks/links\";\r\nimport { setSelectedLink, setLinkActiveNoAutoTrigger } from \"ducks/ui\";\r\n\r\nexport default function Link(props) {\r\n    const dispatch = useDispatch();\r\n    const links = useSelector((state) => state.links);\r\n\r\n    let style = css.potentialLink;\r\n    const link = props.contentState.getEntity(props.entityKey).getData();\r\n    if (links[link.id]) {\r\n        if (links[link.id].isConfirmed) style = css.link;\r\n    }\r\n\r\n    function handleMouseOver() {\r\n        // if (links[link.id].isConfirmed)\r\n        dispatch(activateLink(link.id));\r\n        dispatch(setLinkActiveNoAutoTrigger(true));\r\n    }\r\n    function handleMouseLeave() {\r\n        deactivateLink(link.id);\r\n        dispatch(deactivateLink(link.id));\r\n        dispatch(setLinkActiveNoAutoTrigger(false));\r\n    }\r\n    function handleClick() {\r\n        //Quick and dirty fix! //TODO: Check later\r\n        //TODO: only store ID of link in editor.\r\n        const updatedLink = JSON.parse(JSON.stringify(link));\r\n        updatedLink.startIndex = props.start;\r\n        updatedLink.endIndex = props.end;\r\n        dispatch(setSelectedLink(updatedLink));\r\n    }\r\n\r\n    return (\r\n        <span\r\n            className={style}\r\n            onMouseOver={handleMouseOver}\r\n            onMouseLeave={handleMouseLeave}\r\n            onClick={handleClick}\r\n            data-offset-key={props.offsetKey}\r\n        >\r\n            {props.children}\r\n        </span>\r\n    );\r\n}\r\n","import React, { Fragment, useState, useRef, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport { EditorState, RichUtils, convertFromRaw } from \"draft-js\";\r\n\r\nimport DraftEditor from \"draft-js-plugins-editor\";\r\n\r\nimport css from \"./index.module.css\";\r\n\r\nimport { EditorPlugins } from \"components/EditorToolbar\";\r\nimport editorDecorators from \"utils/editorDecorators\";\r\nimport removePotentialLinks from \"utils/removePotentialLinks\";\r\n\r\nexport default function Viewer(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n\r\n    const rawEditorState = useSelector((state) => state.docs[docId].editorRawState);\r\n    const editorEl = useRef(null); //https://reactjs.org/docs/hooks-reference.html#useref\r\n\r\n    const contentState =\r\n        rawEditorState === null\r\n            ? EditorState.createEmpty().getCurrentContent()\r\n            : convertFromRaw(removePotentialLinks(rawEditorState));\r\n    const [editorState, setEditorState] = useState(EditorState.createWithContent(contentState));\r\n\r\n    //Disabling edit functions in view mode!\r\n    const viewMode = props.viewMode;\r\n\r\n    function handleEditorChange(editorState) {\r\n        setEditorState(editorState);\r\n    }\r\n\r\n    function handleKeyCommand(command) {\r\n        // handle common key bindings (e.g., bold, italic, etc.)\r\n        const newEditorState = RichUtils.handleKeyCommand(editorState, command);\r\n        if (newEditorState) {\r\n            setEditorState(newEditorState);\r\n            return \"handled\";\r\n        }\r\n        return \"not-handled\";\r\n    }\r\n\r\n    return (\r\n        <Fragment>\r\n            <div className={css.viewer}>\r\n                <DraftEditor\r\n                    editorState={editorState}\r\n                    plugins={EditorPlugins}\r\n                    onChange={handleEditorChange}\r\n                    handleKeyCommand={handleKeyCommand}\r\n                    decorators={editorDecorators}\r\n                    ref={editorEl}\r\n                    readOnly={viewMode}\r\n                />\r\n            </div>\r\n        </Fragment>\r\n    );\r\n}\r\n","export default (rawEditorState) => {\r\n    let entityMap = { ...rawEditorState.entityMap };\r\n    Object.keys(entityMap).forEach(function (key) {\r\n        if (entityMap[key].type === \"LINK\") {\r\n            if (!entityMap[key].data.isConfirmed) delete entityMap[key];\r\n        }\r\n    });\r\n    const newRawEditorState = { blocks: rawEditorState.blocks, entityMap: entityMap };\r\n    return newRawEditorState;\r\n};\r\n","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport Viewer from \"components/Viewer\";\r\n\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport { setViewMode } from \"ducks/ui\";\r\nimport { useEffect } from \"react\";\r\n\r\nexport default function View(props) {\r\n    console.log(\"Viewer Mode Active!!!\");\r\n\r\n    const dispatch = useDispatch();\r\n    useEffect(() => {\r\n        dispatch(setViewMode(true));\r\n    }, []);\r\n\r\n    return (\r\n        <Grid container spacing={2}>\r\n            <Grid item xs={8}>\r\n                <Viewer viewMode={true} />\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n","import MuiAlert from \"@material-ui/lab/Alert\";\r\nimport React from \"react\";\r\n\r\nexport default function Alert(props) {\r\n    return <MuiAlert elevation={6} variant=\"filled\" {...props} />;\r\n}\r\n","import React, { memo, useState} from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport PropTypes from \"prop-types\";\r\nimport css from \"./index.module.css\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport { deleteChart } from \"ducks/charts\";\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport Alert from \"components/Alert\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\n\r\n// See ChartBlock for a chart in the editor\r\nexport function Chart(props) {\r\n    const dispatch = useDispatch();\r\n    const chartsInEditor = useSelector((state) => state.docs[props.docId].chartsInEditor);\r\n    const [errorMsg, setErrorMsg] = useState(null);\r\n\r\n    function handleDragStart(e) {\r\n        e.dataTransfer.setData(\"chartId\", props.id);\r\n    }\r\n\r\n    const [hover, setHover] = useState(false);\r\n    function handleEnter() {\r\n        setHover(true);\r\n    }\r\n    function handleLeave() {\r\n        setHover(false);\r\n    }\r\n    function handleKeyPress(event) {\r\n        if (event.key === \"Delete\") {\r\n            if (!chartsInEditor.includes(props.id))\r\n                dispatch(deleteChart(props.id, { docId: props.docId }));\r\n            else setErrorMsg(\"Chart can not be deleted. It is active in the editor!\");\r\n        }\r\n    }\r\n    return (\r\n        <Paper\r\n            className={css.container}\r\n            onKeyDown={handleKeyPress}\r\n            tabIndex=\"0\"\r\n            elevation={hover ? 2 : 0}\r\n        >\r\n            <div\r\n                draggable={true}\r\n                onDragStart={handleDragStart}\r\n                onMouseEnter={handleEnter}\r\n                onMouseLeave={handleLeave}\r\n            >\r\n                <Avatar src={props.thumbnail} variant='rounded' style={{ height: '150px', width: '150px' }}/>\r\n            </div>\r\n            <Snackbar\r\n                open={errorMsg !== null}\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                autoHideDuration={5000}\r\n                onClose={() => {\r\n                    setErrorMsg(null);\r\n                }}\r\n            >\r\n                <Alert severity=\"error\">{errorMsg}</Alert>\r\n            </Snackbar>\r\n        </Paper>\r\n    );\r\n}\r\n\r\nChart.propTypes = {\r\n    id: PropTypes.any,\r\n    width: PropTypes.number,\r\n    height: PropTypes.number,\r\n};\r\n\r\nexport default memo(Chart);\r\n","//Parsing ChartInEditor for extracting chart features from vegalite spec\r\n\r\nimport { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\nimport { truthy, falsy } from \"vega-util\";\r\nimport { toString, isDate, isString, isArray } from \"vega-util\";\r\n\r\n// potential features?\r\n// data categories (discrete)\r\n// data values (continuous)\r\n// axis titles\r\n// legends\r\n// scales etc\r\nexport default async function (spec) {\r\n    if (!spec.data) {\r\n        return [];\r\n    }\r\n    const featureMap = {};\r\n    const runtime = parse(spec);\r\n    const view = await new View(runtime).runAsync();\r\n    const state = view.getState({\r\n        data: truthy,\r\n        signals: falsy,\r\n        recurse: true,\r\n    });\r\n\r\n    // sometimes, individual data points are not explicitely encoded using scales\r\n    for (const mark of spec.marks) {\r\n        // mu\r\n        const data = state.data[mark.name].map((d) => d.datum);\r\n\r\n        for (const datum of data) {\r\n            const isMap = mark.type === \"shape\" && mark.style.includes(\"geoshape\");\r\n            let entries = Object.entries(datum); //Object.entries(isMap ? datum : datum);\r\n            if (isMap) {\r\n                // combine with map properties\r\n                entries = entries.concat(Object.entries(datum.properties));\r\n            }\r\n            for (const [field, value] of entries) {\r\n                if (!isString(value)) {\r\n                    // only categorical data\r\n                    continue;\r\n                }\r\n                featureMap[value] = {\r\n                    value,\r\n                    type: \"string\",\r\n                    field,\r\n                    data: datum.name,\r\n                };\r\n            }\r\n        }\r\n    }\r\n    // Note: The following logic addressses two missing cases\r\n    // 1. Nested marks\r\n    // 2. Categorical scale with numeric data domain\r\n    // TODO: Can we combine the two logics elegantly?\r\n    spec.data.forEach((datum) => {\r\n        // for each data table\r\n        const viewdata = view.data(datum.name);\r\n        // console.log(\"viewdata\", viewdata);\r\n    });\r\n    //Extracting Axes of the charts\r\n    const axesMap = extractChartAxes(spec);\r\n    spec.scales\r\n        .filter((scale) => [\"ordinal\", \"band\", \"point\"].includes(scale.type))\r\n        .forEach((scale) => {\r\n            // each discrete scale\r\n            spec.data.forEach((datum) => {\r\n                // for each data table\r\n                const viewdata = view.data(datum.name);\r\n                viewdata.forEach((row) => {\r\n                    // for each row in the table\r\n                    // a single field\r\n                    if (scale.domain.field) {\r\n                        const field = scale.domain.field;\r\n                        const value = isDate(row[field]) ? row[field] : toString(row[field]);\r\n                        const type = isDate(value) ? \"date\" : \"string\";\r\n                        featureMap[value] = {\r\n                            value,\r\n                            type,\r\n                            field,\r\n                            data: datum.name,\r\n                        };\r\n                    } else if (scale.domain.fields) {\r\n                        //multiple fields from the same data\r\n                        scale.domain.fields.forEach((d) => {\r\n                            const field = isString(d) ? d : d.field;\r\n                            const value = isDate(row[field]) ? row[field] : toString(row[field]);\r\n                            const type = isDate(value) ? \"date\" : \"string\";\r\n                            featureMap[value] = {\r\n                                value,\r\n                                type,\r\n                                field,\r\n                                data: datum.name,\r\n                            };\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n            if (isArray(scale.domain)) {\r\n                // literal array\r\n                scale.domain.forEach((value) => {\r\n                    value = isDate(value) ? value : toString(value);\r\n                    const type = isDate(value) ? \"date\" : \"string\";\r\n                    const field = searchFieldName(spec, scale.name);\r\n                    featureMap[value] = {\r\n                        value,\r\n                        type,\r\n                        field,\r\n                        data: null,\r\n                    };\r\n                });\r\n            }\r\n        });\r\n    const properties = { axes: Object.values(axesMap), features: Object.values(featureMap) };\r\n    return properties;\r\n}\r\n\r\nexport const searchFieldName = (spec, scaleName) => {\r\n    for (const mark of spec.marks) {\r\n        if (mark.encode.enter) {\r\n            for (const [, props] of Object.entries(mark.encode.enter)) {\r\n                if (props.scale === scaleName && props.field) {\r\n                    return props.field;\r\n                }\r\n            }\r\n        }\r\n        if (mark.encode.update) {\r\n            for (const [, props] of Object.entries(mark.encode.update)) {\r\n                if (props.scale === scaleName && props.field) {\r\n                    return props.field;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return null;\r\n};\r\n\r\nexport const extractChartAxes = (spec) => {\r\n    let axesMap = {};\r\n    spec.scales.forEach((scale) => {\r\n        //TODO: handle cases where data is aggregated e.g., stack bar chart, stack area chart, pie chart,\r\n        const name = scale.name;\r\n        const field =\r\n            //field is array of objects\r\n            isArray(scale.domain.fields) && scale.domain.fields[0].hasOwnProperty(\"field\")\r\n                ? scale.domain.fields[0].field\r\n                : //field is simple array\r\n                isArray(scale.domain.fields)\r\n                ? scale.domain.fields\r\n                : scale.domain.field;\r\n        const data = scale.domain.data;\r\n        const type = scale.type;\r\n\r\n        const relatedAxis = spec.axes\r\n            ? spec.axes.filter((axis) => {\r\n                  return (axis.scale === name && axis.title !== undefined) || null;\r\n              })\r\n            : undefined;\r\n        const title =\r\n            isArray(relatedAxis) && relatedAxis.length > 0 && relatedAxis[0].hasOwnProperty(\"title\")\r\n                ? relatedAxis[0].title\r\n                : field //if title is not found, saving field as title (needed for maps!)\r\n                ? field\r\n                : undefined;\r\n\r\n        const axis = { name: name, field: field, data: data, type: type, title: title };\r\n        axesMap[name] = axis;\r\n    });\r\n    return axesMap;\r\n};\r\n","import { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\n\r\nconst THUMBNAIL_HEIGHT = 250;\r\nexport default async (spec) => {\r\n    // parse the spec and get the view\r\n    const runtime = parse(spec);\r\n    const view = await new View(runtime).runAsync();\r\n    // conver the view to an image\r\n    const img = await view.toImageURL(\"png\"); // base64\r\n    // resize the image to a thumbnail size\r\n    const resized = await resize(img);\r\n    return resized;\r\n};\r\n\r\nfunction resize(orgImg) {\r\n    return new Promise((resolve, reject) => {\r\n        const img = new Image();\r\n        img.src = orgImg;\r\n        img.onload = function () {\r\n            // draw the image into a thumbnail scale\r\n            const height = THUMBNAIL_HEIGHT;\r\n            const width = (height / img.height) * img.width;\r\n            const canvas = document.createElement(\"canvas\"),\r\n                ctx = canvas.getContext(\"2d\");\r\n\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n\r\n            ctx.drawImage(this, 0, 0, width, height);\r\n\r\n            // return rescaled base64 image url\r\n            resolve(canvas.toDataURL());\r\n        };\r\n    });\r\n}\r\n","import React, { useState } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport css from \"./index.module.css\";\r\nimport Chart from \"components/Chart\";\r\nimport { createChart, getCharts } from \"ducks/charts\";\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport { compile } from \"vega-lite/build/vega-lite\";\r\nimport extractChartFeatures from \"utils/extractChartFeatures\";\r\nimport createThumbnail from \"utils/createThumbnail\";\r\nimport Alert from \"components/Alert\";\r\n\r\nexport default function ChartGallery(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const [dragging, setDragging] = useState(false);\r\n    const [errorMsg, setErrorMsg] = useState(null);\r\n\r\n    const charts = useSelector((state) => getCharts(state, docId));\r\n\r\n    function handleDragEnter() {\r\n        setDragging(true);\r\n    }\r\n    function handleDragLeave() {\r\n        setDragging(false);\r\n    }\r\n    function handleDragOver(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    }\r\n\r\n    function handleDrop(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        // console.log('VegaLite', VegaLite);\r\n        let file = e.dataTransfer.files[0];\r\n        if (!file) {\r\n            return;\r\n        }\r\n        // if (file.size > 1000000) {\r\n        //     // larger than 1 MB\r\n        //     setErrorMsg(\"Size too big (>1MB)!\");\r\n        //     return;\r\n        // }\r\n        if (file.type.match(\"application/json\")) {\r\n            const reader = new FileReader();\r\n\r\n            // Closure to capture the file information.\r\n            reader.onload = async (e) => {\r\n                try {\r\n                    const liteSpec = JSON.parse(e.target.result);\r\n                    const spec = compile(liteSpec).spec; // vega spec\r\n                    // support vega-lite sample datasets\r\n\r\n                    spec.data.forEach((d) => {\r\n                        if (d.url && d.url.startsWith(\"data\")) {\r\n                            d.url = process.env.PUBLIC_URL + \"/\" + d.url;\r\n                        }\r\n                    });\r\n                    const thumbnail = await createThumbnail(spec);\r\n\r\n                    const properties = await extractChartFeatures(spec);\r\n                    dispatch(createChart(docId, spec, liteSpec, { properties, thumbnail }));\r\n                } catch (e) {\r\n                    setErrorMsg(\"Syntex error in specification file!\");\r\n                }\r\n            };\r\n\r\n            reader.readAsText(file);\r\n        } else {\r\n            setErrorMsg(\"Wrong format!\");\r\n        }\r\n        setDragging(false);\r\n    }\r\n\r\n    return (\r\n        <div\r\n            className={css.container}\r\n            onDragEnter={handleDragEnter}\r\n            onDragLeave={handleDragLeave}\r\n            onDragOver={handleDragOver}\r\n            onDrop={handleDrop}\r\n        >\r\n            <Snackbar\r\n                open={errorMsg !== null}\r\n                anchorOrigin={{\r\n                    vertical: \"bottom\",\r\n                    horizontal: \"left\",\r\n                }}\r\n                autoHideDuration={5000}\r\n                onClose={() => {\r\n                    setErrorMsg(null);\r\n                }}\r\n            >\r\n                <Alert severity=\"error\">{errorMsg}</Alert>\r\n            </Snackbar>\r\n\r\n            <div className={css.draggingArea} style={{ opacity: dragging ? 0.5 : 0.0 }}>\r\n                Drop Vega-lite Spec\r\n            </div>\r\n            {charts.map((chart) => (\r\n                <Chart key={chart.id} docId={docId} id={chart.id} spec={chart.spec} thumbnail={chart.thumbnail} />\r\n            ))}\r\n        </div>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport css from \"./index.module.css\";\r\n// import { addTextLink, deactivateSuggestions } from \"../ducks/ui\";\r\n// import insertSuggestion from \"utils/insertSuggestion\";\r\n// import createTextLink from \"utils/createTextLink\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport ListItemText from \"@material-ui/core/ListItemText\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport ListItemAvatar from \"@material-ui/core/ListItemAvatar\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport ListItemIcon from \"@material-ui/core/ListItemIcon\";\r\nimport LinkIcon from '@material-ui/icons/Link';\r\nimport PropTypes from \"prop-types\";\r\n\r\nimport { setTextSelection } from \"ducks/ui\";\r\n\r\nconst SUGGESTION_LIMIT = 5;\r\nexport default function SuggestionPanel(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n\r\n    const padding = 20;\r\n\r\n    function handleClick(suggestion, event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        props.onSelected(suggestion);\r\n    }\r\n\r\n    function handleCreateLink() {\r\n        props.onCreateLinkSelect();\r\n        dispatch(setTextSelection(props.textSelection));\r\n    }\r\n    return pos ? (\r\n        <Box\r\n            zIndex=\"modal\"\r\n            left={pos.x + padding}\r\n            top={pos.y + padding}\r\n            className={css.suggestionPanel}\r\n        >\r\n            <Paper>\r\n\r\n                <List>\r\n                    <ListItem button onMouseDown={handleCreateLink}>\r\n                        {/* <ListItemAvatar>\r\n                            <Avatar>\r\n                            <LinkIcon />\r\n                            </Avatar>\r\n                        </ListItemAvatar> */}\r\n                        <ListItemIcon>\r\n                            <LinkIcon />\r\n                        </ListItemIcon>\r\n                        Create Link\r\n                    </ListItem>\r\n                    {\r\n                        // should we rank suggestions\r\n\r\n                        props.suggestions.slice(0, SUGGESTION_LIMIT).map((suggestion, i) => (\r\n                            <ListItem\r\n                                key={i}\r\n                                button\r\n                                dense\r\n                                onMouseDown={handleClick.bind(null, suggestion)}\r\n                            >\r\n                                <ListItemAvatar>\r\n                                    <Avatar alt=\"chart\" src={suggestion.thumbnail} />\r\n                                </ListItemAvatar>\r\n                                <ListItemText\r\n                                    primary={suggestion.text}\r\n                                    secondary={\r\n                                        <Typography component=\"span\" variant=\"caption\" color='textSecondary'>\r\n                                            {suggestion.chartId}\r\n                                        </Typography>\r\n                                    }\r\n                                />\r\n                            </ListItem>\r\n                        ))\r\n                    }\r\n                </List>\r\n            </Paper>\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n\r\nSuggestionPanel.propTypes = {\r\n    suggestions: PropTypes.array,\r\n    onSelected: PropTypes.func,\r\n};\r\n","import React from \"react\";\r\nimport css from \"./index.module.css\";\r\n\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\r\nimport PropTypes from \"prop-types\";\r\nimport { setSelectedLink, showLinkSettingFor, showSelectedLinkSetting } from \"ducks/ui\";\r\nimport { confirmLink, deleteLink } from \"ducks/links\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\n\r\nexport default function PotentialLinkControls(props) {\r\n    const dispatch = useDispatch();\r\n    const selection = window.getSelection();\r\n    const pos = selection.rangeCount > 0 ? selection.getRangeAt(0).getBoundingClientRect() : null;\r\n    const padding = 10;\r\n\r\n    function handleDiscardClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        props.onDiscard(props.selectedLink);\r\n        dispatch(setSelectedLink(null));\r\n    }\r\n    function handleAcceptClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        dispatch(confirmLink(props.selectedLink.id));\r\n        props.onAccept(props.selectedLink);\r\n        dispatch(setSelectedLink(null));\r\n    }\r\n    function handleSettingClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        dispatch(showLinkSettingFor(props.selectedLink));\r\n        dispatch(setSelectedLink(null));\r\n        \r\n    }\r\n    return pos && props.selectedLink && !props.selectedLink.isConfirmed && !props.textSelection ? (\r\n        <Box\r\n            zIndex=\"modal\"\r\n            left={pos.x + padding}\r\n            top={pos.y + padding}\r\n            className={css.potentialLinkControls}\r\n        >\r\n            <Paper elevation={1}>\r\n                <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\r\n                    <Button onMouseDown={handleAcceptClick}>Accept</Button>\r\n                    <Button onMouseDown={handleDiscardClick}>Discard</Button>\r\n                    {/* <Button onMouseDown={handleSettingClick}>Setting</Button> */}\r\n                </ButtonGroup>\r\n            </Paper>\r\n        </Box>\r\n    ) : (\r\n        \"\"\r\n    );\r\n}\r\n","export default (charts, partialText, startIndex) => {\r\n    return partialText.length === 0\r\n        ? []\r\n        : [].concat(\r\n              ...charts.map((chart) =>\r\n                  chart.properties.features\r\n                      .filter((d) => {\r\n                          if (d.type === \"string\" && d.value) {\r\n                              return d.value.toLowerCase().startsWith(partialText.toLowerCase());\r\n                          } else if (d.type === \"date\") {\r\n                              //temporary\r\n                              return d.value\r\n                                  .toString()\r\n                                  .toLowerCase()\r\n                                  .includes(partialText.toLowerCase());\r\n                          }\r\n                          return false;\r\n                      })\r\n                      .map((d) => ({\r\n                          chartId: chart.id,\r\n                          thumbnail: chart.thumbnail,\r\n                          feature: d,\r\n                          text: d.value.toString(),\r\n                          startIndex,\r\n                      }))\r\n              )\r\n          );\r\n};\r\n","import util from \"util\";\r\nconst request = require(\"request\");\r\n\r\nexport default async (sentence, sentenceOffset, charts, blockKey) => {\r\n    const payload = { text: sentence, sentenceOffset, charts: charts, blockKey};\r\n    const options = {\r\n        uri: \"https://koriserver.namwkim.org/discover-links\",\r\n        method: \"POST\",\r\n        headers: {\r\n            Accept: \"application/json\",\r\n            \"Accept-Charset\": \"utf-8\",\r\n        },\r\n        json: true,\r\n        body: payload,\r\n    };\r\n\r\n    const requestPromise = util.promisify(request);\r\n    try{\r\n        const response = await requestPromise(options);\r\n        return response?.body?.data;\r\n    }\r\n    catch(e){\r\n        return []\r\n    }\r\n}","export default (editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n    const blockKey = currentSelection.getAnchorKey();\r\n    const currentBlock = currentContent.getBlockForKey(blockKey);\r\n    const blockText = currentBlock.getText();\r\n\r\n    return {blockText, blockKey};\r\n};\r\n","export default (editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n    const blockKey = currentSelection.getAnchorKey();\r\n    const currentBlock = currentContent.getBlockForKey(blockKey);\r\n    const caretOffset = currentSelection.getAnchorOffset();\r\n    const blockTextBeforeCaret = currentBlock.getText().substr(0, caretOffset);\r\n    const end = currentSelection.getAnchorOffset();\r\n\r\n    const lastWord = blockTextBeforeCaret.split(\" \").slice(-1).pop();\r\n    const start = end - lastWord.length;\r\n    return {\r\n        text: lastWord,\r\n        startIndex: start,\r\n        endIndex: end,\r\n    };\r\n};\r\n","import { Modifier, EditorState } from \"draft-js\";\r\nimport getBlockText from \"./getBlockText\";\r\nimport getLastTypedWord from \"./getLastTypedWord\";\r\nexport default (links, editorState) => {\r\n    const currentBlockText = getBlockText(editorState)?.blockText;\r\n    links.forEach((link) => {\r\n        editorState = insertLink(link, editorState, currentBlockText);\r\n    });\r\n    return editorState;\r\n};\r\nexport const insertLink = (link, editorState, currentBlockText) => {\r\n\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n    const activeBlockKey = currentSelection.getAnchorKey();\r\n\r\n    let start = link.startIndex;\r\n    let end = link.endIndex;\r\n    if (start < 0) start = 0;\r\n\r\n    // Handle situation when paragraph changes before inserting links\r\n    const find = link.text\r\n    let allInstancesOfLink = [];\r\n    let i = 0, j=0;\r\n    while (~(i = currentBlockText.indexOf (find,i + find.length))) allInstancesOfLink.push(i);\r\n    \r\n    if (allInstancesOfLink.length > 0 && !allInstancesOfLink.includes(link.startIndex)){\r\n       return editorState;\r\n    }\r\n\r\n    let newContent = currentContent.createEntity(`LINK`, \"MUTABLE\", {\r\n        ...link,\r\n    });\r\n    const entityKey = newContent.getLastCreatedEntityKey();\r\n\r\n    const insertLinkSelection = currentSelection.merge({\r\n        anchorKey: link.blockKey,\r\n        focusKey: link.blockKey,\r\n        anchorOffset: start,\r\n        focusOffset: end,\r\n    });\r\n    \r\n    const insertSuggestionSelection =  editorState.getSelection().merge({\r\n        anchorOffset: getLastTypedWord(editorState).startIndex\r\n    });\r\n\r\n    newContent = Modifier.replaceText(\r\n        editorState.getCurrentContent(),\r\n        link?.trigger === \"@\" ? insertSuggestionSelection : insertLinkSelection,\r\n        link.text,\r\n        editorState.getCurrentInlineStyle(), //inline styling\r\n        entityKey\r\n    );\r\n\r\n    //Stop cursor from jumping to beginning of a line\r\n    const caretPosition = currentSelection.getAnchorOffset();\r\n    let newEditorState = EditorState.push(editorState, newContent, \"insert-characters\");\r\n    let newSelection = newEditorState.getSelection().merge({\r\n        anchorKey: activeBlockKey,\r\n        focusKey: activeBlockKey,\r\n        focusOffset: caretPosition,\r\n        anchorOffset: caretPosition,\r\n    });\r\n    // newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n    return newEditorState;\r\n};\r\n","import { Modifier, EditorState } from \"draft-js\";\r\n\r\nexport default (currentSelectionState, editorState) => {\r\n    if (!currentSelectionState) return;\r\n    const currentContentState = editorState.getCurrentContent();\r\n\r\n    const newContentState = Modifier.applyEntity(currentContentState, currentSelectionState, null);\r\n    let newEditorState = EditorState.push(editorState, newContentState, \"apply-entity\");\r\n\r\n    const newCaretPosition = Math.max(\r\n        currentSelectionState.getAnchorOffset(),\r\n        currentSelectionState.getFocusOffset()\r\n    );\r\n\r\n    const newSelection = newEditorState.getSelection().merge({\r\n        focusOffset: newCaretPosition,\r\n        anchorOffset: newCaretPosition,\r\n    });\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n\r\n    return newEditorState;\r\n};\r\n","export default (rawEditorState, allLinksInCurrentBlockText, blockText) => {\r\n    const entityMap = { ...rawEditorState.entityMap };\r\n    allLinksInCurrentBlockText = allLinksInCurrentBlockText.filter((linkInCurrentBlockText) => {\r\n        let shouldKeep = true;\r\n        Object.keys(entityMap).forEach(function (key) {\r\n            if (entityMap[key].type === \"LINK\") {\r\n                if (\r\n                    entityMap[key].data.isConfirmed &&\r\n                    entityMap[key].data.text === linkInCurrentBlockText?.text &&\r\n                    blockText.includes(entityMap[key].data.text)\r\n                ) {\r\n                    shouldKeep = false;\r\n                }\r\n            }\r\n        });\r\n        return shouldKeep;\r\n    });\r\n    return allLinksInCurrentBlockText;\r\n};\r\n","//Arguments//\r\n        //commonProps={text, extent, chartId}, \r\n        //dataProps={feature, values}, \r\n        //rangeProps={fieldX, rangeX, fieldY, rangeY}, \r\n        //suggestionProps={trigger}\r\n\r\nexport default ({text, extent, blockKey, chartId}, {feature, values}, {rangeField, range}, trigger) => {\r\n    return { \r\n        // common props\r\n        text: text,\r\n        startIndex: extent[0],\r\n        endIndex: extent[1],\r\n        blockKey:blockKey,\r\n        chartId: chartId,\r\n        \r\n        //data props\r\n        feature: feature || '',\r\n        data: values || [],\r\n\r\n        //Brush props\r\n        //Syntax: rangeField is list of *fields* & *range* is list of tuples for each field\r\n        rangeField: rangeField || [],\r\n        range: range || [],\r\n\r\n        active: false,\r\n        isConfirmed: true,\r\n        trigger: trigger\r\n    };\r\n}","import React, { Fragment, useState, useRef, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport PropTypes from \"prop-types\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport {\r\n    EditorState,\r\n    AtomicBlockUtils,\r\n    RichUtils,\r\n    convertToRaw,\r\n    convertFromRaw,\r\n    Modifier,\r\n    ContentState,\r\n} from \"draft-js\";\r\n\r\nimport DraftEditor from \"draft-js-plugins-editor\";\r\n\r\nimport css from \"./index.module.css\";\r\n\r\nimport EditorToolbar, { EditorPlugins } from \"components/EditorToolbar\";\r\n\r\nimport SuggestionPanel from \"components/SuggestionPanel\";\r\nimport PotentialLinkControls from \"components/PotentialLinkControls\";\r\n\r\nimport { updateDoc, updateChartsInEditor } from \"ducks/docs\";\r\nimport { createLinks, createLink, deleteLink, getLinks } from \"ducks/links\";\r\nimport { getChartsInEditor, getCharts } from \"ducks/charts\";\r\nimport { setSelectedLink, setManualLinkId, exitManualLinkMode, setTextSelection } from \"ducks/ui\";\r\n\r\nimport editorDecorators from \"utils/editorDecorators\";\r\nimport findSuggestions from \"utils/findSuggestions\";\r\nimport searchLinks from \"utils/searchLinks\";\r\nimport insertLinks from \"utils/insertLinks\";\r\nimport getLastTypedWord from \"utils/getLastTypedWord\";\r\nimport getTextSelection from \"utils/getTextSelection\";\r\nimport highlightTextSelection from \"utils/highlightTextSelection\";\r\nimport deHighlightTextSelection from \"utils/deHighlightTextSelection\";\r\nimport getBlockText from \"utils/getBlockText\";\r\nimport filterAlreadyConfirmedLinksInEditor from \"utils/filterAlreadyConfirmedLinksInEditor\";\r\nimport nlp from \"compromise\";\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport Alert from \"components/Alert\";\r\nimport createLinkObject from \"utils/createLink\"\r\n\r\nconst AUTOMATIC_SUGGESTION_TIMEOUT = 5000;\r\n\r\nexport default function Editor(props) {\r\n    const dispatch = useDispatch();\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n    const charts = useSelector((state) => getCharts(state, docId));\r\n    const storedEditorState = useSelector((state) => state.docs[docId].editorRawState);\r\n    const chartsInEditor = useSelector((state) => getChartsInEditor(state, docId));\r\n    const selectedLink = useSelector((state) => state.ui.selectedLink);\r\n    const allLinks = useSelector((state) => getLinks(state,docId));\r\n    const exitManualLink = useSelector((state) => state.ui.exitManualLink);\r\n    const manualLinkId = useSelector((state) => state.ui.manualLinkId);\r\n    const linkActiveNoAutoTrigger = useSelector((state) => state.ui.linkActiveNoAutoTrigger);\r\n    const textSelectionInStore = useSelector((state) => state.ui.textSelection);\r\n\r\n    const [tempTextSelection, setTempTextSelection] = useState(textSelectionInStore);\r\n    const editorEl = useRef(null); //https://reactjs.org/docs/hooks-reference.html#useref\r\n    const [suggestions, setSuggestions] = useState([]);\r\n    const alreadySearchedSentences = useSelector((state) => state.docs[docId].searchedSentences);\r\n\r\n    const contentState =\r\n        storedEditorState === null\r\n            ? EditorState.createEmpty().getCurrentContent()\r\n            : convertFromRaw(storedEditorState);\r\n    const [editorState, setEditorState] = useState(EditorState.createWithContent(contentState));\r\n    const [currentSelectionState, setCurrentSelectionState] = useState(null);\r\n    const [currentBlock, setCurrentBlock] = useState(null);\r\n    const [infoMsg, setInfoMsg] = useState(null);\r\n    const [autoLinksToInsert, setAutoLinksToInsert] = useState([]);\r\n\r\n    let interval = useRef();\r\n    // const startTimer = () => {\r\n    //     interval = setInterval(() => {\r\n    //         // console.log(\"Checking for autosuggestions every:\", AUTOMATIC_SUGGESTION_TIMEOUT);\r\n    //         if (editorEl?.current?.props?.editorState)\r\n    //             setCurrentBlock(getBlockText(editorEl.current.props.editorState));\r\n    //     }, AUTOMATIC_SUGGESTION_TIMEOUT);\r\n    //     return () => clearInterval(interval.current);\r\n    // };\r\n\r\n    useEffect(() => {\r\n        dispatch(exitManualLinkMode(false));\r\n        setCurrentSelectionState(null);\r\n        dispatch(setTextSelection(null));\r\n        dispatch(setManualLinkId(null));\r\n        // startTimer();\r\n        // return () => clearInterval(interval.current);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (exitManualLink) {\r\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\r\n            editorEl.current.focus();\r\n            dispatch(exitManualLinkMode(false));\r\n            setCurrentSelectionState(null);\r\n            //Quick and dirty fix! //Clearing Chart Selections\r\n            window.dispatchEvent(new KeyboardEvent(\"keypress\", { key: \"a\" }));\r\n        }\r\n    }, [exitManualLink]);\r\n\r\n    useEffect(() => {\r\n        if (exitManualLink && allLinks[manualLinkId] === undefined) {\r\n            //clear selection in case no brushing and pressing 'Accept'\r\n            setEditorState(deHighlightTextSelection(currentSelectionState, editorState));\r\n            setCurrentSelectionState(null);\r\n        }\r\n        if (allLinks[manualLinkId]) {\r\n            setEditorState(\r\n                insertLinks([allLinks[manualLinkId]], editorState, currentSelectionState)\r\n            );\r\n            dispatch(setManualLinkId(null));\r\n            setCurrentSelectionState(null);\r\n            setInfoMsg({msg: 'Link successfully created!', severity: 'success'});\r\n            //Quick and dirty fix! //Clearing Chart Selections\r\n            window.dispatchEvent(new KeyboardEvent(\"keypress\", { key: \"a\" }));\r\n        }\r\n    }, [manualLinkId, exitManualLink]);\r\n\r\n    useEffect(() => {\r\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\r\n        dispatch(updateDoc(doc.id, { editorRawState }));\r\n    }, [editorState]);\r\n\r\n    useEffect(()=> {\r\n        const entityMap = convertToRaw(editorState.getCurrentContent()).entityMap;\r\n        let linkIdsToKeep = [];\r\n        Object.keys(entityMap).forEach(function(key) {\r\n            if(entityMap[key].type === \"LINK\"){\r\n                if(allLinks[entityMap[key].data.id]){\r\n                    linkIdsToKeep.push(entityMap[key].data.id);\r\n                }\r\n            }     \r\n        });\r\n        Object.keys(allLinks).forEach(function(key){\r\n            if (!linkIdsToKeep.includes(key)){\r\n                dispatch(deleteLink(key));\r\n            }\r\n        });\r\n\r\n    },[Object.keys(convertToRaw(editorState.getCurrentContent()).entityMap).length]);\r\n\r\n    useEffect(() => {\r\n        const asyncExec = async () => {\r\n            if (currentBlock !== null) {\r\n                const blockText = currentBlock.blockText;\r\n                if (linkActiveNoAutoTrigger) return;\r\n                if (selectedLink) return;\r\n                if (tempTextSelection || tempTextSelection == \"INVALID\") return;\r\n                const sentences = await nlp(blockText).sentences().json();\r\n                let allLinksInCurrentBlockText = [];\r\n                let searchedSentences = [];\r\n                for (let i = 0; i < sentences.length; i++) {\r\n                    const { text } = sentences[i];\r\n                    if (!text.includes(\".\")) continue;\r\n                    if (alreadySearchedSentences?.includes(text)) continue;\r\n                    searchedSentences.push(text);\r\n\r\n                    const sentenceObject = {\r\n                        text: text,\r\n                        startIndex: blockText.indexOf(text),\r\n                        endIndex: blockText.indexOf(text) + text.length,\r\n                    };\r\n                    if (chartsInEditor.length === 0) return;\r\n                    const links = await searchLinks(sentenceObject.text, sentenceObject.startIndex, chartsInEditor, currentBlock.blockKey);\r\n                    allLinksInCurrentBlockText = allLinksInCurrentBlockText.concat(links);\r\n                }\r\n                dispatch(\r\n                    updateDoc(doc.id, {\r\n                        searchedSentences: alreadySearchedSentences?.concat(searchedSentences),\r\n                    })\r\n                );\r\n                if (allLinksInCurrentBlockText.length > 0) {\r\n                    const rawEditorState = convertToRaw(editorState.getCurrentContent());\r\n                    allLinksInCurrentBlockText = filterAlreadyConfirmedLinksInEditor(\r\n                        rawEditorState,\r\n                        allLinksInCurrentBlockText,\r\n                        blockText\r\n                    );\r\n                    if (allLinksInCurrentBlockText.length > 0) {\r\n                        // Remove duplicates if any\r\n                        // TODO: Check why backend send duplicates in the first place\r\n                        const seen = new Set();\r\n                        allLinksInCurrentBlockText = allLinksInCurrentBlockText.filter(el => {\r\n                            const duplicate = seen.has(el.startIndex);\r\n                            seen.add(el.startIndex);\r\n                            return !duplicate;\r\n                          });\r\n                        setAutoLinksToInsert(allLinksInCurrentBlockText);\r\n                    }\r\n                }\r\n                setCurrentBlock(null);\r\n            }\r\n        };\r\n        asyncExec();\r\n    }, [currentBlock]);\r\n\r\n    function handleEditorChange(editorState) {\r\n        setEditorState(editorState);\r\n        if(autoLinksToInsert.length>0){\r\n            const action = createLinks(doc.id, autoLinksToInsert);\r\n            setEditorState(insertLinks(action.links, editorState));\r\n            dispatch(action);\r\n            setAutoLinksToInsert([]);\r\n        }\r\n\r\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\r\n        const lastTypedWord = getLastTypedWord(editorState);\r\n\r\n        const allText = editorState.getCurrentContent().getPlainText(\" \").trim();\r\n        const updatedSearchedSentences = alreadySearchedSentences?.filter(\r\n            (alreadySearchedSentence) => allText.includes(alreadySearchedSentence)\r\n        );\r\n        dispatch(\r\n            updateDoc(doc.id, {\r\n                searchedSentences: updatedSearchedSentences,\r\n            })\r\n        );\r\n\r\n        //Enable SuggestionMenu on @\r\n        if (lastTypedWord.text.startsWith(\"@\")) {\r\n            const suggestions = findSuggestions(\r\n                chartsInEditor,\r\n                lastTypedWord.text.slice(1),\r\n                lastTypedWord.startIndex\r\n            );\r\n\r\n            setSuggestions(suggestions);\r\n        } else {\r\n            setSuggestions([]);\r\n        }\r\n        // TODO: see if we can catch an event for adding or removing a chart.\r\n        // Updating charts in store when a chart is added to or removed from document\r\n        const entityMap = editorRawState.entityMap;\r\n        const numCharts = Object.keys(entityMap).length;\r\n        if (numCharts !== chartsInEditor.length) {\r\n            const ids = Object.values(entityMap).reduce((acc, entity) => {\r\n                if (entity.type === \"CHART\") {\r\n                    acc.push(entity.data.id);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            dispatch(updateChartsInEditor(doc.id, ids));\r\n        }\r\n       \r\n        const currentSelection = editorState.getSelection();\r\n        const caretPosition = currentSelection.getAnchorOffset();\r\n        const activeBlockKey = currentSelection.getAnchorKey();\r\n        //Hide the link accept/delete button when cursor not in link range\r\n        //TODO: what if selection spans more than one block?\r\n        if (selectedLink && activeBlockKey) {\r\n            if (\r\n                activeBlockKey !== selectedLink.blockKey ||\r\n                caretPosition < selectedLink.startIndex ||\r\n                caretPosition > selectedLink.endIndex\r\n            ) {\r\n                dispatch(setSelectedLink(null));\r\n            }\r\n        }\r\n        let textSelection = getTextSelection(\r\n            editorState.getCurrentContent(),\r\n            currentSelection,\r\n            \" \" //delimiter\r\n        );\r\n  \r\n        //Hide the floating controls when no text is selected\r\n        setTempTextSelection(textSelection);\r\n\r\n        //search for suggestions on text selection\r\n        if (textSelection && textSelection != \"INVALID\") {\r\n            const suggestions = findSuggestions(\r\n                chartsInEditor,\r\n                textSelection.text.trim(),\r\n                textSelection.startIndex\r\n            );\r\n            suggestions.length !== 0\r\n                ? setSuggestions(suggestions)\r\n                : setSuggestions([{ text: \"NoLinkFound!\" }]);\r\n        }\r\n\r\n        const block = editorState.getCurrentContent().getBlockForKey(activeBlockKey);\r\n        if (\r\n            block.getType() === \"unstyled\" &&\r\n            !exitManualLink &&\r\n            currentSelectionState &&\r\n            !tempTextSelection\r\n        ) {\r\n            dispatch(exitManualLinkMode(true));\r\n            dispatch(setTextSelection(null));\r\n        }\r\n    }\r\n\r\n    function handleKeyCommand(command) {\r\n        // handle common key bindings (e.g., bold, italic, etc.)\r\n        const newEditorState = RichUtils.handleKeyCommand(editorState, command);\r\n        if (newEditorState) {\r\n            setEditorState(newEditorState);\r\n            return \"handled\";\r\n        }\r\n        return \"not-handled\";\r\n    }\r\n    function handleTab(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setCurrentBlock(getBlockText(editorState));\r\n        return \"handled\";\r\n    }\r\n\r\n    function handleDragOver(e) {\r\n        // may need to throttle for performance\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        editorEl.current.focus();\r\n        // e.persist(); //conflict with asynchronous setTimeout in throuttle:\r\n        //https://stackoverflow.com/questions/38142880/react-js-throttle-mousemove-event-keep-throwing-event-persist-error\r\n    }\r\n\r\n    function handleDrop(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const chartId = e.dataTransfer.getData(\"chartId\");\r\n        const chart = charts.find((d) => d.id === chartId);\r\n        const exists = chartsInEditor.find((d) => d.id === chartId);\r\n        if (chart && !exists) {\r\n            insertChart(chart);\r\n            e.dataTransfer.clearData();\r\n        }\r\n    }\r\n\r\n    function insertChart(chart) {\r\n        let contentState = editorState.getCurrentContent();\r\n\r\n        contentState = contentState.createEntity(\"CHART\", \"IMMUTABLE\", {\r\n            id: chart.id, // wil get chart info from store\r\n        });\r\n        const entityKey = contentState.getLastCreatedEntityKey();\r\n        const newEditorState = AtomicBlockUtils.insertAtomicBlock(editorState, entityKey, \" \");\r\n        setEditorState(newEditorState);\r\n    }\r\n    function handleBlur() {\r\n        setSuggestions([]);\r\n    }\r\n    function handleSuggestionSelected(suggestion) {\r\n        const commonProps = {text:suggestion.text, extent:[suggestion.startIndex, suggestion.startIndex + suggestion.text.length], blockKey:editorState.getSelection().getAnchorKey(), chartId: suggestion.chartId};\r\n        const link = createLinkObject(commonProps,{ feature: suggestion.feature, values: [isNaN(Number(suggestion.text)) ? suggestion.text : Number(suggestion.text)]},{},'@');\r\n        const action = createLink(doc.id, link); // need ids\r\n        const newEditorState = insertLinks([action.attrs], editorState);\r\n        dispatch(action);\r\n\r\n        setSuggestions([]);\r\n        setEditorState(newEditorState);\r\n    }\r\n    function handleCreateLinkSelect() {\r\n        dispatch(exitManualLinkMode(false));\r\n        setCurrentSelectionState(editorState.getSelection());\r\n        setEditorState(highlightTextSelection(tempTextSelection, editorState));\r\n        setInfoMsg({msg:\"Click on any chart avatar to begin linking!\", severity:'info'}\r\n        );\r\n    }\r\n\r\n    function handleLinkDiscard(link) {\r\n        //TODO: Some code is similar to insertLinks.js. Consider refactoring!\r\n        const currentSelection = editorState.getSelection();\r\n        let newContent = ContentState.createFromText(\"\");\r\n        const updateLinkExtent = getUpdatedLinkExtent(editorState);\r\n        const insertTextSelection = currentSelection.merge({\r\n            anchorOffset: updateLinkExtent.offset,\r\n            focusOffset: updateLinkExtent.offset + updateLinkExtent.length,\r\n        });\r\n        newContent = Modifier.replaceText(\r\n            editorState.getCurrentContent(),\r\n            insertTextSelection,\r\n            link.text,\r\n            editorState.getCurrentInlineStyle(), //inline styling\r\n        );\r\n        let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n        let newSelection = newEditorState.getSelection().merge({\r\n            focusOffset: link.endIndex,\r\n            anchorOffset: link.endIndex,\r\n        });\r\n        newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n        newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n        setEditorState(newEditorState);\r\n\r\n        dispatch(deleteLink(link.id));\r\n    }\r\n    function getUpdatedLinkExtent(editorState){\r\n        const editorRawState = convertToRaw(editorState.getCurrentContent());\r\n        const currentSelection = editorState.getSelection();\r\n        const BlkKey = currentSelection.getAnchorKey();\r\n        const activeBlock = editorRawState.blocks.find(({key})=>key === BlkKey);\r\n        const caretPosition = currentSelection.getAnchorOffset();\r\n        const updateLinkExtent = activeBlock.entityRanges.find(er => (caretPosition >= er.offset && caretPosition <= er.offset + er.length));\r\n        return updateLinkExtent; \r\n    }\r\n    function handleLinkAccept(link) {\r\n        const updateLinkExtent = getUpdatedLinkExtent(editorState);\r\n        const confirmedLink = JSON.parse(JSON.stringify(link));\r\n        confirmedLink.startIndex = updateLinkExtent.offset; \r\n        confirmedLink.endIndex = updateLinkExtent.offset + updateLinkExtent.length;\r\n        confirmedLink.isConfirmed = true;\r\n        setEditorState(insertLinks([confirmedLink], editorState));\r\n    }\r\n    function handlePastedText(text){\r\n        //immediatly search for suggestions in pasted text\r\n        //TODO: for now it only searches for links in the first pargraph immediately\r\n        setCurrentBlock({blockText: text.split(\"\\n\")[0], blockKey:getBlockText(editorState).blockKey});\r\n        return \"not-handled\";\r\n    }\r\n\r\n    return (\r\n        <Fragment>\r\n            {<EditorToolbar />}\r\n            <div className={css.editor} onDragOver={handleDragOver} onDrop={handleDrop}>\r\n                <DraftEditor\r\n                    editorState={editorState}\r\n                    plugins={EditorPlugins}\r\n                    onChange={handleEditorChange}\r\n                    onBlur={handleBlur}\r\n                    handleKeyCommand={handleKeyCommand}\r\n                    handlePastedText={handlePastedText}\r\n                    stripPastedStyles={true}\r\n                    decorators={editorDecorators}\r\n                    ref={editorEl}\r\n                    onTab={handleTab}\r\n                    stripPastedStyles={true}\r\n                />\r\n            </div>\r\n            {suggestions.length >= 1 && chartsInEditor.length > 0 && (\r\n                <SuggestionPanel\r\n                    suggestions={suggestions.filter((s) => s.text !== \"NoLinkFound!\")}\r\n                    textSelection={tempTextSelection}\r\n                    onSelected={handleSuggestionSelected}\r\n                    onCreateLinkSelect={handleCreateLinkSelect}\r\n                />\r\n            )}\r\n            <PotentialLinkControls\r\n                textSelection={tempTextSelection}\r\n                selectedLink={selectedLink}\r\n                onDiscard={handleLinkDiscard}\r\n                onAccept={handleLinkAccept}\r\n            />\r\n            <Snackbar\r\n                open={infoMsg !== null}\r\n                anchorOrigin={{\r\n                    vertical: \"top\",\r\n                    horizontal: \"right\",\r\n                }}\r\n                autoHideDuration={5000}\r\n                onClose={() => {\r\n                    setInfoMsg(null);\r\n                }}\r\n            >\r\n                <Alert severity={infoMsg?.severity}>{infoMsg?.msg}</Alert>\r\n            </Snackbar>\r\n        </Fragment>\r\n    );\r\n}\r\n\r\n//Define the public proptypes of this componenet\r\nEditor.propTypes = {\r\n    editor: PropTypes.object,\r\n    updateEditorState: PropTypes.func,\r\n    addSelectedChart: PropTypes.func,\r\n};\r\n","//https://github.com/facebook/draft-js/issues/442#issuecomment-223816158\r\n//TODO: Maybe follow the next comment (on the above) and use getContentStateFragment function!\r\n\r\nexport default (contentState, selection, blockDelimiter) => {\r\n    blockDelimiter = blockDelimiter || \"\\n\";\r\n    var startKey = selection.getStartKey();\r\n    var endKey = selection.getEndKey();\r\n    var blocks = contentState.getBlockMap();\r\n    let blockKey ='';\r\n\r\n    var lastWasEnd = false;\r\n    var selectedBlock = blocks\r\n        .skipUntil(function (block) {\r\n            return block.getKey() === startKey;\r\n        })\r\n        .takeUntil(function (block) {\r\n            var result = lastWasEnd;\r\n\r\n            if (block.getKey() === endKey) {\r\n                lastWasEnd = true;\r\n            }\r\n\r\n            return result;\r\n        });\r\n    //Don't allow linking across multiple blocks\r\n    if (selectedBlock.length > 1) return \"INVALID\";\r\n    const text = selectedBlock\r\n        .map(function (block) {\r\n            var key = block.getKey();\r\n            var text = block.getText();\r\n\r\n            let start = 0;\r\n            let end = text.length;\r\n\r\n            if (key === startKey) {\r\n                start = selection.getStartOffset();\r\n            }\r\n            if (key === endKey) {\r\n                end = selection.getEndOffset();\r\n            }\r\n            text = text.slice(start, end);\r\n            blockKey=key;\r\n            return text;\r\n        })\r\n        .join(blockDelimiter);\r\n    let sIndex = selection.getStartOffset();\r\n    let eIndex = selection.getEndOffset();\r\n    if (selection.isBackward) {\r\n        eIndex = selection.getEndOffset();\r\n        sIndex = selection.getStartOffset();\r\n    }\r\n    return selection.getStartOffset() !== selection.getEndOffset()\r\n        ? { text: text, startIndex: sIndex, endIndex: eIndex, blockKey, isBackward:selection.isBackward}\r\n        : null;\r\n};\r\n","import { Modifier, EditorState } from \"draft-js\";\r\n\r\nexport default (textSelection, editorState) => {\r\n    const currentContent = editorState.getCurrentContent();\r\n    const currentSelection = editorState.getSelection();\r\n\r\n    let newContent = currentContent.createEntity(`TEXT_SELECTION`, \"MUTABLE\", {\r\n        ...textSelection,\r\n    });\r\n\r\n    let start = textSelection.startIndex;\r\n    let end = textSelection.endIndex;\r\n\r\n    if(textSelection.isBackward){\r\n        start = textSelection.endIndex;\r\n        end = textSelection.startIndex\r\n    }\r\n\r\n    const entityKey = newContent.getLastCreatedEntityKey();\r\n\r\n    const insertTextSelection = currentSelection.merge({\r\n        anchorOffset:start,\r\n        focusOffset: end,\r\n    });\r\n    newContent = Modifier.replaceText(\r\n        editorState.getCurrentContent(),\r\n        insertTextSelection,\r\n        textSelection.text,\r\n        editorState.getCurrentInlineStyle(), //inline styling\r\n        entityKey\r\n    );\r\n    let newEditorState = EditorState.push(editorState, newContent, \"apply-entity\");\r\n    let newSelection = newEditorState.getSelection().merge({\r\n        focusOffset: textSelection.endIndex,\r\n        anchorOffset: textSelection.endIndex,\r\n    });\r\n    newEditorState = EditorState.moveSelectionToEnd(newEditorState);\r\n    newEditorState = EditorState.forceSelection(newEditorState, newSelection);\r\n    return newEditorState;\r\n};\r\n","import React, { useEffect, useState, useRef } from \"react\";\r\n\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport uniqueId from \"utils/uniqueId\";\r\nimport Slider from '@material-ui/core/Slider';\r\nimport CloseIcon from '@material-ui/icons/Close'\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Autocomplete from '@material-ui/lab/Autocomplete';\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport Alert from \"components/Alert\";\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    root: {\r\n      width: 300,\r\n      margin: theme.spacing(1),\r\n    },\r\n  }));\r\n\r\nfunction ValueLabelComponent(props) {\r\n    const { children, open, value } = props;\r\n    return (\r\n        <Tooltip open={open} enterTouchDelay={0} placement=\"top\" title={value}>\r\n           {children}\r\n        </Tooltip>\r\n    );\r\n}\r\n\r\nexport default function Filter(props) {\r\n    const classes = useStyles();\r\n    const [axis, setAxis] = useState('')\r\n    const [value, setValue] = React.useState(null);\r\n    const [textValue, setTextValue] = React.useState(null);\r\n    const [marks, setMarks] = useState([{value:1900, label:1900}, {value:2000, label:2000}]);\r\n    const [showSlider, setShowSlider]=useState(false);\r\n    const [infoMsg, setInfoMsg] = useState(null);\r\n    const [pointFeatures, setPointFeatures] = useState([])\r\n\r\n    const {chartProperties} = props;\r\n    let filterOptions = chartProperties.axes.map(axis => axis?.field);\r\n    const featureFields = [...new Set(chartProperties.features.map((f) => f.field))];\r\n    filterOptions = filterOptions.concat(featureFields);\r\n    filterOptions = [...new Set(filterOptions)];\r\n    \r\n    function handleFilterChange(event){\r\n        const filterField = event.target.value;\r\n        showRightControlsForFilter(filterField);\r\n    }\r\n\r\n    function showRightControlsForFilter(filterField) {\r\n        setAxis(filterField);\r\n        const axisObj = getFilterFieldByName(chartProperties.axes, filterField);\r\n\r\n        if (axisObj && ![\"ordinal\", \"band\", \"point\"].includes(axisObj?.type)) {\r\n            const arr = props.viewData.map(vd => vd[filterField]);\r\n            const [min, max] = getMinMax(arr)\r\n            //TODO: Handle date/time in a better way!\r\n            if ([\"date\", \"year\", \"month\", \"time\", \"year_year\"].includes(filterField.toLowerCase()) || axisObj?.type === 'temporal'\r\n            ) {\r\n                const minDate = new Date(min);\r\n                const maxDate = new Date(max);\r\n                const newMarks = [{ value: min, label: minDate.toLocaleDateString(), type:'date' }, { value: max, label:  maxDate.toLocaleDateString(), type:'date' }];\r\n                setMarks(newMarks);\r\n                setValue([newMarks[0].value, newMarks[1].value]);\r\n            }\r\n            else {\r\n                const newMarks = [{ value: min, label: min.toLocaleString() }, { value: max, label: max.toLocaleString() }];\r\n                setMarks(newMarks);\r\n                setValue([newMarks[0].value, newMarks[1].value]);\r\n            }\r\n            setTextValue(null);\r\n            setShowSlider(true);\r\n        }\r\n        if (!axisObj || [\"ordinal\", \"band\", \"point\", \"string\"].includes(axisObj?.type)) {\r\n            let axisFeatures = chartProperties?.features.filter(f => f?.field === filterField);\r\n            if (!axisFeatures) axisFeatures = chartProperties?.features?.filter(f => f?.properties?.field === filterField);\r\n            setPointFeatures(axisFeatures);\r\n            setValue(null);\r\n            setShowSlider(false);\r\n        }\r\n    }\r\n\r\n    function handleSliderChange(event, newValue){\r\n        setValue(newValue);\r\n    }\r\n\r\n    function getFilterFieldByName(axes, name){\r\n        //TODO: handle if matches to title or field\r\n        const axisObj = axes.find(a => a?.field === name);\r\n        return axisObj;\r\n    }\r\n\r\n    function getMinMax(myArray){\r\n        var lowest = Number.POSITIVE_INFINITY;\r\n        var highest = Number.NEGATIVE_INFINITY;\r\n        var tmp;\r\n        for (var i=myArray.length-1; i>=0; i--) {\r\n            tmp = +myArray[i];\r\n            if (tmp < lowest) lowest = tmp;\r\n            if (tmp > highest) highest = tmp;\r\n        }\r\n        return [lowest, highest]\r\n    }\r\n\r\n    function handleTagsChange(event, values){\r\n        if(values) setTextValue(values)\r\n    }\r\n\r\n    useEffect(()=>{\r\n        //Send data back to ManualLinkControl component\r\n        props.onFilterUpdate(props.id, {field: axis, intervalValues:value, features:textValue});\r\n    }, [value, textValue])\r\n\r\n    useEffect(()=>{\r\n        showRightControlsForFilter(filterOptions[0])\r\n    },[])\r\n  \r\n    return (\r\n      <React.Fragment>\r\n        <Grid className= {classes.root} container spacing={1}>\r\n            <Grid item xs={1}>\r\n                <IconButton aria-label=\"close\" className={classes.margin} size=\"small\">\r\n                    <CloseIcon fontSize=\"inherit\" onMouseDown={() => props.onDelete(props.id)}/>\r\n                </IconButton>\r\n            </Grid>\r\n            <Grid item xs={6}>\r\n                <FormControl className={classes.formControl}>\r\n                    <InputLabel htmlFor=\"age-native-simple\">Field</InputLabel>\r\n                    <Select\r\n                        native\r\n                        value={axis}\r\n                        onChange={handleFilterChange}\r\n                    >\r\n                        {filterOptions.map(o => <option key={uniqueId(o)} value={o}>{o}</option>)}\r\n                    </Select>\r\n                </FormControl>\r\n            </Grid>\r\n        </Grid>\r\n        <Grid container spacing={1}>\r\n            <Grid item xs={1}></Grid>\r\n            <Grid item xs={10}>\r\n            {!showSlider && <Autocomplete\r\n                    multiple\r\n                    id=\"combo-box-demo\"\r\n                    options={pointFeatures}\r\n                    getOptionLabel={(option) => option?.value}\r\n                    onChange={handleTagsChange}\r\n                    // style={{ width: 200 }}\r\n                    size=\"small\"\r\n                    renderInput={(params) => <TextField {...params} label=\"Select Values\" variant=\"outlined\" />}\r\n                />}\r\n            </Grid>\r\n        </Grid>\r\n        <Grid container spacing={1}>\r\n            <Grid item xs={1}></Grid>\r\n            <Grid item xs={10}>\r\n                {showSlider &&\r\n                    <Slider\r\n                        value={value}\r\n                        onChange={handleSliderChange}\r\n                        valueLabelDisplay=\"auto\"\r\n                        ValueLabelComponent={ValueLabelComponent}\r\n                        aria-labelledby=\"range-slider\"\r\n                        marks={marks}\r\n                        min={marks[0]?.value}\r\n                        max={marks[1]?.value}\r\n                        valueLabelFormat={value => <div>{marks[0]?.type==='date' ? new Date(value).toLocaleDateString() : value.toLocaleString()}</div>}\r\n                    /> }\r\n            </Grid>\r\n      </Grid>\r\n      <Snackbar\r\n        open={infoMsg !== null}\r\n        anchorOrigin={{\r\n            vertical: \"bottom\",\r\n            horizontal: \"left\",\r\n        }}\r\n        autoHideDuration={5000}\r\n        onClose={() => {\r\n            setInfoMsg(null);\r\n        }}\r\n        >\r\n        <Alert severity=\"info\">{infoMsg}</Alert>\r\n    </Snackbar>\r\n      </React.Fragment>\r\n    );\r\n}","import React,  { useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\r\nimport { useEffect } from \"react\";\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport FormHelperText from '@material-ui/core/FormHelperText';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport uniqueId from \"utils/uniqueId\";\r\nimport Grid from '@material-ui/core/Grid';\r\n\r\nimport { setTextSelection } from \"ducks/ui\";\r\nimport { createLinks } from \"ducks/links\";\r\nimport { setManualLinkId, exitManualLinkMode } from \"ducks/ui\";\r\nimport createLink from \"utils/createLink\"\r\nimport Filter from \"components/Filter\"\r\nimport Snackbar from \"@material-ui/core/Snackbar\";\r\nimport Alert from \"components/Alert\";\r\n\r\n//TODO: needs cleaning & refactoring\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    chartAvatars: {\r\n        display: 'flex',\r\n        '& > *': {\r\n          margin: theme.spacing(1),\r\n        },\r\n      },\r\n    root: {\r\n        // width: 300,\r\n        margin: theme.spacing(1),\r\n    },\r\n  }));\r\n\r\nexport default function ManualLinkControls(props) {\r\n    const dispatch = useDispatch();\r\n    const classes = useStyles();\r\n\r\n    const [axis, setAxis] = useState('');\r\n    const [showField, setShowField] = useState(false);\r\n    const [link, setLink]=useState(null);\r\n    const [selectedPoints, setSelectedPoints] = useState([]);\r\n    const [filters, setFilters] = useState([])\r\n    const [infoMsg, setInfoMsg] = useState(null);\r\n\r\n    const chartProperties = props.selectedChart.properties;\r\n    let axisOptions = chartProperties.axes.map(axis => axis?.field);\r\n    const featureFields = [...new Set(chartProperties.features.map((f) => f.field))];\r\n    axisOptions = axisOptions.concat(featureFields);\r\n    axisOptions = [...new Set(axisOptions)];\r\n\r\n\r\n    const handleAxisChange = (event) => {\r\n        const selectedAxis = event.target.value;\r\n        setAxis(selectedAxis);\r\n        link['data'] = selectedPoints.map(sp => sp[selectedAxis]);\r\n        setLink(link);\r\n    }\r\n  \r\n    function handleResetClick(event) {\r\n        dispatch(exitManualLinkMode(true));\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        dispatch(setTextSelection(null));\r\n    }\r\n    function handleAcceptClick(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        if (link !== null) {\r\n            link['feature']={field:axis};\r\n            const action = createLinks(props.currentDoc.id, [link]);\r\n            dispatch(action);\r\n            dispatch(setManualLinkId(action.links[0].id));\r\n        } else dispatch(setManualLinkId(null));\r\n        dispatch(setTextSelection(null));\r\n        dispatch(exitManualLinkMode(true));\r\n\r\n        setInfoMsg('Link created successfully!')\r\n    }\r\n\r\n    useEffect(()=>{\r\n        if(props.selectedMarks.length > 0){\r\n            setShowField(true);\r\n            const link = makeManualLink(props.textSelection, props.selectedMarks, props.brush, props.viewData);\r\n            setLink(link);\r\n        }\r\n        if(props.brush.length > 0){\r\n            setShowField(true);\r\n            const link = makeManualLink(props.textSelection, props.selectedMarks, props.brush, props.viewData);\r\n            setLink(link);\r\n        }\r\n    },[props.selectedMarks, props.brush]);\r\n\r\n    function makeManualLink(textSelection, multiPoint, brush, viewData) {\r\n        let link = null;\r\n        if (multiPoint.length > 0) {\r\n            let points = [];\r\n            for (let i = 0; i < multiPoint.length; i++) {\r\n                for (let j = 0; j < viewData.length; j++) {\r\n                    if (multiPoint[i].values[0] === viewData[j]._vgsid_) points.push(viewData[j]);\r\n                }\r\n            }\r\n            let data = [];\r\n            let field;\r\n            setSelectedPoints(points);\r\n            points.forEach(function (p) {\r\n                field = chartProperties?.axes.filter((axis) =>\r\n                    [\"ordinal\", \"band\", \"point\"].includes(axis.type)\r\n                )[0];\r\n                if (p.hasOwnProperty(\"properties\")) {\r\n                    field = chartProperties?.features.filter(\r\n                        (feature) => feature?.value != \"Feature\"\r\n                    )[0];\r\n                    //Special case: Maps\r\n                    //Look for data in TopoJSON Properties or in the datafile!\r\n                    if (!p[\"properties\"][field?.field]) {\r\n                        data.push(p[field?.field]);\r\n                    } else data.push(p[\"properties\"][field?.field]);\r\n                } else data.push(p[field?.field]);\r\n            });\r\n            const feature={ field: field?.field };\r\n            setAxis(feature.field);\r\n\r\n            const commonProps = {text: textSelection.text, extent:[props.textSelection.startIndex, props.textSelection.endIndex], blockKey:props.textSelection.blockKey, chartId: props.selectedChart.id};\r\n            link = createLink(commonProps, {feature,values:data}, {});\r\n        }\r\n        if (brush.length > 0) {\r\n            let points;\r\n            let brushField;          \r\n            let rangeField = [];\r\n            let range = [];\r\n\r\n            //Rectangular Brush\r\n            if (\r\n                brush[0].fields.length === 2 &&\r\n                brush[0].fields[0].type === \"R\" &&\r\n                brush[0].fields[1].type === \"R\"\r\n            ) {\r\n                rangeField.push(brush[0].fields[0].field);\r\n                rangeField.push(brush[0].fields[1].field);\r\n                range.push(...brush[0].values[0], ...brush[0].values[1] )\r\n                points = [];\r\n                setAxis(brush[0].fields[0].field);\r\n            } else {\r\n                //Single Axis Brush\r\n                if (brush[0]?.fields[0]?.type === \"E\" && brush[0]?.fields[1]?.type === \"R\" ) {\r\n                    brushField = brush[0].fields[0].field;\r\n                    points = brush[0].values[0];\r\n                }\r\n                if (brush[0]?.fields[0]?.type === \"R\" && brush[0]?.fields[1]?.type === \"E\" ) {\r\n                    brushField = brush[0].fields[1].field;\r\n                    points = brush[0].values[1];\r\n                }\r\n                if (brush[0].fields.length === 1 && brush[0]?.fields[0]?.type === \"R\") {\r\n                    brushField = brush[0].fields[0].field;\r\n                    points = [];\r\n                    rangeField.push(brushField);\r\n                    range.push(...brush[0].values[0])\r\n                }\r\n                setAxis(brushField);\r\n            }\r\n            const commonProps = {text:textSelection.text, extent:[props.textSelection.startIndex, props.textSelection.endIndex], blockKey:props.textSelection.blockKey, chartId:props.selectedChart.id};\r\n            const dataProps = {feature: { field: brushField }, values:points }\r\n            const rangeProps = {rangeField,range}\r\n            link = createLink(commonProps, dataProps, rangeProps);\r\n        }\r\n        return link;\r\n    }\r\n    \r\n    function handleAddSelectionBtn(){\r\n        setFilters([...filters, {id:uniqueId('filter-'), props:{}}]);\r\n    }\r\n    function handleFilterDelete(filterId){\r\n        const updatedFilters = filters.filter(f=> f.id !== filterId);\r\n        setFilters(updatedFilters)\r\n    }\r\n    function handleFilterUpdate(filterId, filterState){\r\n        const newFilters = [... filters]\r\n        const filter = newFilters.find(nf => nf.id === filterId);\r\n        filter.props = filterState\r\n        setFilters(newFilters)\r\n    }\r\n\r\n    function handleSaveClick(){\r\n    \r\n        const commonProps = {text: props.textSelection.text, extent:[props.textSelection.startIndex, props.textSelection.endIndex], blockKey:props.textSelection.blockKey, chartId: props.selectedChart.id};\r\n        let dataProps={};\r\n        let rangeField = [];\r\n        let range = [];\r\n        filters.forEach(filter => {\r\n            if (filter.props.features){\r\n                dataProps = {feature:{field:filter.props.field}, values:filter.props.features.map(f=>f.value)}\r\n            }\r\n            if (filter.props.intervalValues){\r\n                rangeField.push(filter.props.field)\r\n                range.push(...filter.props.intervalValues)\r\n            }\r\n        })\r\n        let link = createLink(commonProps, dataProps, {rangeField, range});\r\n        const action = createLinks(props.currentDoc.id, [link]);\r\n        dispatch(setManualLinkId(action.links[0].id));\r\n        dispatch(setTextSelection(null));\r\n        dispatch(exitManualLinkMode(true));\r\n        dispatch(action);\r\n\r\n        setInfoMsg('Link created successfully!')\r\n    }\r\n    return (\r\n        <React.Fragment>\r\n            {props.mode === 'filter' && <Button variant=\"contained\" size=\"small\" onMouseDown={handleAddSelectionBtn}>+Add Selection</Button>}\r\n            <Grid container spacing={3}>\r\n                <Grid item xs={12}>\r\n                    <div>\r\n                    {filters.length > 0 && filters.map((filter) => (\r\n                        <Filter key={filter.id} \r\n                            chartProperties={chartProperties} \r\n                            viewData={props.viewData} \r\n                            id={filter.id} \r\n                            onDelete={handleFilterDelete} \r\n                            onFilterUpdate={handleFilterUpdate}/>\r\n                    ))}\r\n                    </div>\r\n                </Grid>\r\n            </Grid>\r\n            {filters.length > 0 && <Button variant=\"contained\" size=\"small\" onMouseDown={handleSaveClick}>Save</Button>}\r\n                {(props.textSelection && showField || props.showSelectedLinkSetting)  && props.mode === 'brush' && <div className={classes.root}>\r\n                    {props.brush.length === 0 &&  <FormControl className={classes.formControl}>\r\n                        <InputLabel htmlFor=\"age-native-simple\">Axis</InputLabel>\r\n                        <Select\r\n                            native\r\n                            value={axis}\r\n                            onChange={handleAxisChange}\r\n                        >\r\n                            {axisOptions.map(ao => <option key={uniqueId(ao)} value={ao}>{ao}</option>)}\r\n                        </Select>\r\n                        <FormHelperText>Choose which field to link to!</FormHelperText>\r\n                    </FormControl>}\r\n                    <div>\r\n                    <ButtonGroup size=\"small\" variant=\"contained\" aria-label=\"small button group\">\r\n                        <Button onMouseDown={handleAcceptClick}>Save</Button>\r\n                        <Button onMouseDown={handleResetClick}>Cancel</Button>\r\n                    </ButtonGroup>\r\n                    </div>\r\n                </div>}\r\n            <Snackbar\r\n                open={infoMsg !== null}\r\n                anchorOrigin={{\r\n                    vertical: \"top\",\r\n                    horizontal: \"right\",\r\n                }}\r\n                autoHideDuration={5000}\r\n                onClose={() => {\r\n                    setInfoMsg(null);\r\n                }}\r\n                >\r\n                <Alert severity=\"success\">{infoMsg}</Alert>\r\n            </Snackbar>\r\n        </React.Fragment>\r\n    );\r\n}","import React,  { useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\r\nimport Paper from \"@material-ui/core/Paper\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport { useEffect } from \"react\";\r\nimport Slider from '@material-ui/core/Slider';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport FormHelperText from '@material-ui/core/FormHelperText';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport uniqueId from \"utils/uniqueId\";\r\nimport TextField from '@material-ui/core/TextField';\r\n\r\nimport { setTextSelection, showLinkSettingFor } from \"ducks/ui\";\r\nimport { createLinks, updateLink } from \"ducks/links\";\r\nimport { setManualLinkId, exitManualLinkMode } from \"ducks/ui\";\r\nimport createLink from \"utils/createLink\"\r\n\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    root: {\r\n      width: 300,\r\n    },\r\n  }));\r\n\r\nexport default function EditLinkSetting(props) {\r\n    const dispatch = useDispatch();\r\n    const classes = useStyles();\r\n    let linkToUpdate = useSelector((state)=> state.ui.showLinkSettingFor);\r\n\r\n    const [value, setValue] = useState([20, 37]);\r\n    const [marks, setMarks] = useState([{value:1900, label:1900}, {value:2000, label:2000}]);\r\n    const [axis, setAxis] = useState('');\r\n    const [link, setLink]=useState(null);\r\n    const [showSlider, setShowSlider]=useState(false);\r\n    const [stringValues, setStringValues] = useState('Hello');\r\n    \r\n\r\n    const chartProperties = props.selectedChart.properties;\r\n    let axisOptions = chartProperties.axes.map(axis => axis?.field);\r\n    const featureFields = [...new Set(chartProperties.features.map((f) => f.field))];\r\n    axisOptions = axisOptions.concat(featureFields);\r\n    axisOptions = [...new Set(axisOptions)];\r\n\r\n    const handleAxisChange = (event) => {\r\n    }\r\n\r\n    const handleChange = (event, newValue) => {\r\n        // setValue(newValue);\r\n        //TODO: send to createLink() for updating link\r\n        // link['rangeField'] = {field:axis}\r\n        // link['rangeMin'] = newValue[0];\r\n        // link['rangeMax'] = newValue[1];\r\n        // setLink(link);\r\n      };\r\n  \r\n    function handleResetClick(event) {\r\n    }\r\n    function handleUpdateClick(event) {\r\n        console.log('link to update', linkToUpdate, stringValues.toString().split('\\n'));\r\n        const data = stringValues.toString().split('\\n');\r\n        const action = updateLink(linkToUpdate.id, {data});\r\n        dispatch(action);\r\n\r\n        dispatch(showLinkSettingFor(null));\r\n    }\r\n    function handleTextChange(event){\r\n        setStringValues(event.target.value);\r\n        console.log(stringValues);\r\n    }\r\n\r\n    useEffect(()=>{\r\n        setAxis(props.showLinkSettingFor?.feature?.field);\r\n\r\n        if(![\"ordinal\", \"band\", \"point\", \"string\"].includes(props.showLinkSettingFor?.feature?.type)){\r\n            //Handle interval links\r\n            setShowSlider(true);\r\n        }\r\n        else{\r\n            console.log('Link props updated.....', props.showLinkSettingFor.data)\r\n            setStringValues(props.showLinkSettingFor.data);\r\n        }\r\n        \r\n    },[props.showLinkSettingFor])\r\n        \r\n\r\n    return (\r\n        <React.Fragment>\r\n            {props.showLinkSettingFor  && <div className={classes.root}>\r\n                <FormControl className={classes.formControl}>\r\n                    <InputLabel htmlFor=\"age-native-simple\">Link Field</InputLabel>\r\n                    <Select\r\n                        native\r\n                        value={axis}\r\n                        onChange={handleAxisChange}\r\n                    >\r\n                        {axisOptions.map(ao => <option key={uniqueId(ao)} value={ao}>{ao}</option>)}\r\n                    </Select>\r\n                    <FormHelperText>Some important helper text</FormHelperText>\r\n                </FormControl>\r\n                <FormControl fullWidth className={classes.margin}>\r\n                    <TextField\r\n                        id=\"standard-multiline-flexible\"\r\n                        label=\"Link Data\"\r\n                        multiline\r\n                        rowsMax={4}\r\n                        value={stringValues}\r\n                        onChange={handleTextChange}\r\n                        />\r\n                    </FormControl>\r\n                {showSlider && <div><Typography id=\"range-slider\" gutterBottom>\r\n                    Interval range\r\n                </Typography>\r\n                <Slider\r\n                    value={value}\r\n                    onChange={handleChange}\r\n                    valueLabelDisplay=\"auto\"\r\n                    aria-labelledby=\"range-slider\"\r\n                    // getAriaValueText={valuetext}\r\n                    marks={marks}\r\n                    min={marks[0].value}\r\n                    max={marks[1].value}\r\n                /> </div>}\r\n                <Paper elevation={1}>\r\n                    <ButtonGroup size=\"small\" variant=\"text\" fullWidth aria-label=\"small button group\">\r\n                        <Button onMouseDown={handleUpdateClick}>Update</Button>\r\n                        <Button onMouseDown={handleResetClick}>Cancel</Button>\r\n                    </ButtonGroup>\r\n                </Paper>\r\n            </div>}\r\n        </React.Fragment>\r\n    );\r\n}","import React, { useEffect, useMemo, useState, useRef } from \"react\";\r\nimport { useSelector} from \"react-redux\";\r\nimport addSignalToChartSpec from \"utils/addSignalToChartSpec\";\r\nimport vegaEmbed from \"vega-embed\";\r\nimport { parse } from \"vega-parser\";\r\nimport { View } from \"vega-view\";\r\nimport ChartConfigPanel from \"components/ChartConfigPanel\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport ManualLinkControls from \"components/ManualLinkControls\";\r\nimport IconButton from \"@material-ui/core/IconButton\";\r\nimport SettingsIcon from \"@material-ui/icons/Settings\";\r\nimport EditLinkSetting from \"components/EditLinkSetting\"\r\nimport HelpIcon from '@material-ui/icons/Help';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\n\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    hidden: {\r\n      display:'none'\r\n    },\r\n  }));\r\n\r\nexport function ChartSetting(props) {\r\n    const classes = useStyles();\r\n    const [view, setView] = useState(null);\r\n    const containerEl = useRef(null);\r\n    const chartEl = useRef(null);\r\n    const [ratio, setRatio] = useState(1);\r\n    let { docId } = useParams();\r\n    const doc = useSelector((state) => state.docs[docId]);\r\n    const [selectedMarks, setSelectedMarks] = useState([]);\r\n    const [viewData, setViewData] = useState([]);\r\n    const [brush, setBrush] = useState([]);\r\n    const [toggleSettings, setToggleSettings] = useState(false);\r\n    const selectedLink = useSelector((state)=> state.ui.selectedLink);\r\n\r\n    const {chart} = props;\r\n    const spec = useMemo(\r\n        () =>\r\n            addSignalToChartSpec(\r\n                chart.highlight,\r\n                JSON.parse(JSON.stringify(chart.liteSpec)),\r\n                true\r\n            ),\r\n        [chart.spec, chart.highlight]\r\n    );\r\n\r\n    useEffect(() => {\r\n        const asyncExec = async () => {\r\n            // compute canvas aspect ratio to maintain it while resizing\r\n            const runtime = parse(spec);\r\n            const tempView = await new View(runtime).runAsync();\r\n\r\n            const canvas = await tempView.toCanvas();\r\n            const ratio = canvas.height / canvas.width;\r\n            setRatio(ratio);\r\n\r\n            // add autosize: has limitations: https://vega.github.io/vega-lite/docs/size.html#limitations\r\n            //TODO: brush interfere with autosize\r\n\r\n            // spec.autosize = {\r\n            //     type: \"fit\",\r\n            //     contains: \"padding\",\r\n            //     resize: true,\r\n            // };\r\n            const result = await vegaEmbed(chartEl?.current, spec, { actions: false });\r\n            const view = result.view;\r\n\r\n            // const viewData = view.data(\"source_0\");\r\n            const viewData = !chart.liteSpec.data.hasOwnProperty(\"url\")\r\n                ? view.data(\"data_0\")\r\n                : view.data(\"source_0\");\r\n            setViewData(viewData);\r\n            try {\r\n                view.addDataListener(\"paintbrush_store\", function (name, value) {\r\n                    setSelectedMarks(selectedMarks.concat(value));\r\n                });\r\n\r\n                view.addDataListener(\"brush_store\", function (name, value) {\r\n                    setBrush(brush.concat(value));\r\n                });\r\n            } catch (error) {\r\n                //No brush_store if no brush added\r\n            }\r\n            setView(view);\r\n        };\r\n        asyncExec();\r\n    }, [spec]);\r\n\r\n    // useEffect(\r\n    //     throttle(async () => {\r\n    //         resize(view, ratio);\r\n    //     }, 500)\r\n    // );\r\n\r\n    function resize(view, ratio) {\r\n        if (view) {\r\n            const { width } = containerEl.current.getBoundingClientRect();\r\n            const height = ratio * width;\r\n            // view.resize().height(height).width(width).runAsync();\r\n        }\r\n    }\r\n\r\n    function handleSettingClick() {\r\n        setToggleSettings(!toggleSettings);\r\n    }\r\n\r\n    const showConfig = true;\r\n    const highlightStyle = {\r\n        position: \"relative\",\r\n        width: \"fit-content\",\r\n    };\r\n    return (\r\n        <React.Fragment>\r\n            <div ref={containerEl} style={highlightStyle}>\r\n                <div>\r\n                    {showConfig && props.mode !=='filter' && <div style={{display:'flex'}}> \r\n                        <IconButton\r\n                            onMouseDown={handleSettingClick}\r\n                            aria-label=\"settings\"\r\n                            // color=\"primary\"\r\n                        >\r\n                            <SettingsIcon />\r\n                        </IconButton>\r\n                        <Tooltip placement='right-start' title=\"Use brushing to select visual marks on the chart! Hold down the SHIFT key to select multiple marks!\">\r\n                            <IconButton style={{marginTop:'0px'}} aria-label=\"help\">\r\n                                <HelpIcon />\r\n                            </IconButton>\r\n                        </Tooltip>\r\n                    </div>\r\n                    }\r\n                </div>\r\n                <div className={props.mode==='filter' ? classes.hidden : ''} ref={chartEl} />\r\n                {showConfig && toggleSettings && <ChartConfigPanel chart={chart} />}\r\n                {showConfig && props.textSelection && (\r\n                    <ManualLinkControls\r\n                        currentDoc={doc}\r\n                        selectedChart={chart}\r\n                        textSelection={props.textSelection}\r\n                        selectedMarks={selectedMarks}\r\n                        brush={brush}\r\n                        viewData={viewData}\r\n                        mode={props.mode}\r\n                    />\r\n                )}\r\n                {props.showLinkSettingFor && (\r\n                    <EditLinkSetting\r\n                        currentDoc={doc}\r\n                        selectedChart={chart}\r\n                        selectedMarks={selectedMarks}\r\n                        brush={brush}\r\n                        viewData={viewData}\r\n                        showLinkSettingFor={props.showLinkSettingFor}\r\n                        selectedLink={selectedLink}\r\n                    />\r\n                )}\r\n            </div>\r\n        </React.Fragment>\r\n    );\r\n};\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useParams } from \"react-router-dom\";\r\n\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Avatar from '@material-ui/core/Avatar';\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport { getChartsInEditor } from \"ducks/charts\";\r\nimport { ChartSetting } from \"components/ChartSetting\";\r\nimport HelpIcon from '@material-ui/icons/Help';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport ToggleButton from '@material-ui/lab/ToggleButton';\r\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup';\r\nimport TuneIcon from '@material-ui/icons/Tune';\r\nimport BrushIcon from '@material-ui/icons/Brush';\r\n\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    chartAvatars: {\r\n        display: 'flex',\r\n        '& > *': {\r\n          margin: theme.spacing(1),\r\n        },\r\n      },\r\n    root: {\r\n      width: 300,\r\n    },\r\n    toggleBtn:{\r\n      margin: theme.spacing(1)\r\n    },\r\n    largeAvatar: {\r\n        width: theme.spacing(7),\r\n        height: theme.spacing(7),\r\n      },\r\n      largeAvatarActive: {\r\n        width: theme.spacing(7),\r\n        height: theme.spacing(7),\r\n        border: '1px solid #5e5d5d'\r\n      },\r\n  }));\r\n\r\nexport default function LinkSetting() {\r\n    const classes = useStyles();\r\n    const { docId } = useParams();\r\n    const chartsInEditor = useSelector((state) => getChartsInEditor(state, docId));\r\n    const textSelection = useSelector((state) => state.ui.textSelection);\r\n    const showLinkSettingFor = useSelector((state) => state.ui.showLinkSettingFor);\r\n    const [selectedChart, setSelectedChart] = useState(null);\r\n    const [creationMode, setCreationMode] = useState('brush');\r\n    const [createNewLink, setCreateNewLink] = useState(false)\r\n\r\n    useEffect(()=>{\r\n      if(!textSelection) {\r\n        setCreateNewLink(false);\r\n        setSelectedChart(null);\r\n      }\r\n      else {\r\n        setCreateNewLink(true);\r\n        setCreationMode('brush');\r\n      }\r\n    },[textSelection])\r\n\r\n    function handleChartAvatarClick(chart){\r\n        if(selectedChart != chart)\r\n          setSelectedChart(chart);\r\n        else setSelectedChart(null);\r\n    }\r\n\r\n    useEffect(()=>{\r\n      setSelectedChart(chartsInEditor.filter(c => c.id === showLinkSettingFor?.chartId).pop());\r\n    },[showLinkSettingFor])\r\n\r\n    function handleModeChange(event, mode){\r\n      if (mode !== null)\r\n        setCreationMode(mode);\r\n    }\r\n  \r\n    return (\r\n      <React.Fragment>\r\n        {createNewLink && <div className={classes.root}>\r\n        <div style={{display:'flex'}}>\r\n          <Typography variant=\"overline\" display=\"block\" gutterBottom>\r\n              Link Setting\r\n          </Typography>\r\n          <Tooltip placement='right-start' title=\"Click on any chart to begin creating references!\">\r\n              <IconButton style={{marginTop:'-8px'}} size=\"small\" aria-label=\"help\">\r\n                  <HelpIcon />\r\n              </IconButton>\r\n          </Tooltip>\r\n        </div>\r\n          <div className={classes.chartAvatars}>\r\n              {chartsInEditor.map((chart) => (\r\n                  <Avatar key={chart.id} src={chart.thumbnail} variant='rounded' className={chart.id === selectedChart?.id ? classes.largeAvatarActive: classes.largeAvatar} onClick={() => handleChartAvatarClick(chart)} />\r\n              ))}\r\n          </div>\r\n          {selectedChart && <ToggleButtonGroup className={classes.toggleBtn}\r\n                value={creationMode}\r\n                exclusive\r\n                onChange={handleModeChange}\r\n                aria-label=\"text alignment\"\r\n                size='small'\r\n                >\r\n                <ToggleButton value=\"brush\" aria-label=\"left aligned\">\r\n                    <BrushIcon />\r\n                </ToggleButton>\r\n                <ToggleButton value=\"filter\" aria-label=\"centered\">\r\n                    <TuneIcon />\r\n                </ToggleButton>\r\n            </ToggleButtonGroup>}\r\n          {selectedChart && <ChartSetting mode={creationMode} textSelection={textSelection} chart={selectedChart} />}\r\n      </div>}\r\n      {showLinkSettingFor && <div className={classes.root}>\r\n          <Typography variant=\"overline\" display=\"block\" gutterBottom>\r\n              Link Setting\r\n          </Typography>\r\n          <div className={classes.chartAvatars}>\r\n              {chartsInEditor.map((chart) => (\r\n                  <Avatar key={chart.id} src={chart.thumbnail} variant='rounded' className={chart.id === showLinkSettingFor?.chartId ? classes.largeAvatarActive: classes.largeAvatar} />\r\n              ))}\r\n          </div>\r\n          {selectedChart && <ChartSetting textSelection={textSelection} chart={selectedChart} showLinkSettingFor={showLinkSettingFor} />}\r\n      </div>}\r\n      </React.Fragment>\r\n    );\r\n}","import React from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\n// import TextField from '@material-ui/core/TextField';\r\nimport ChartGallery from \"components/ChartGallery\";\r\nimport Editor from \"components/Editor\";\r\n\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Typography from \"@material-ui/core/Typography\";\r\nimport { setViewMode } from \"ducks/ui\";\r\nimport { useEffect } from \"react\";\r\nimport LinkSetting from \"components/LinkSetting\";\r\nimport HelpIcon from '@material-ui/icons/Help';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\nexport default function Edit(props) {\r\n    const dispatch = useDispatch();\r\n    useEffect(() => {\r\n        dispatch(setViewMode(false));\r\n    }, []);\r\n\r\n    return (\r\n        <Grid container spacing={2}>\r\n            <Grid item xs={2}>\r\n                <div style={{display:'flex'}}>\r\n                <Typography variant=\"overline\" display=\"block\" gutterBottom>\r\n                    Chart Gallery\r\n                </Typography>\r\n                <Tooltip placement='right-start' title=\"Drop VegaLite specifications to add charts!\">\r\n                    <IconButton style={{marginTop:'-8px'}} size=\"small\" aria-label=\"help\">\r\n                        <HelpIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n                </div>\r\n                <ChartGallery />\r\n            </Grid>\r\n            <Grid item xs={8}>\r\n                <Editor />\r\n            </Grid>\r\n            <Grid item xs={2}>\r\n                <LinkSetting />\r\n            </Grid>\r\n        </Grid>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport Navbar from \"components/Navbar\";\r\nimport Home from 'components/Home';\r\nimport Docs from 'components/Docs';\r\nimport View from 'components/View';\r\nimport Edit from 'components/Edit';\r\nimport { BrowserRouter as Router, Switch, Route } from \"react-router-dom\";\r\nimport Container from '@material-ui/core/Container';\r\n\r\nfunction App() {\r\n  return (\r\n    <Router>\r\n      <Navbar />\r\n      <Container maxWidth=\"lg\" mt={2}>\r\n        <Switch>\r\n          <Route path=\"/docs/:docId/view\">\r\n            <View />\r\n          </Route>\r\n          <Route path=\"/docs/:docId\">\r\n            <Edit />\r\n          </Route>\r\n          <Route path=\"/docs\">\r\n            <Docs />\r\n          </Route>\r\n          <Route path=\"/\">\r\n            <Home />\r\n          </Route>\r\n          \r\n        </Switch>\r\n      </Container>\r\n    </Router>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import { combineReducers } from \"redux\";\r\n// import editor from \"./editor\";\r\nimport charts from \"./charts\";\r\nimport docs from \"./docs\";\r\nimport links from \"./links\";\r\nimport ui from \"./ui\";\r\n\r\nexport default combineReducers({\r\n  docs,\r\n  charts,\r\n  links,\r\n  ui\r\n});\r\n\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\nimport { createLogger } from \"redux-logger\";\r\nimport reduxFreeze from \"redux-freeze\";\r\nimport { Provider } from \"react-redux\";\r\nimport { applyMiddleware, createStore } from \"redux\";\r\nimport rootReducer from \"./ducks\";\r\nimport localforage from \"localforage\";\r\nimport throttle from \"./utils/throttle\";\r\n\r\nimport { createMuiTheme, ThemeProvider } from \"@material-ui/core/styles\";\r\nconst theme = createMuiTheme({\r\n    //https://material-ui.com/customization/palette/\r\n    palette: {\r\n        primary: {\r\n            main: \"#2196f3\",\r\n        },\r\n        secondary: {\r\n            main: \"#e91e63\",\r\n        },\r\n        info: {\r\n            main: \"#1976d2\",\r\n        },\r\n        error: {\r\n            main: \"#f44336\",\r\n        },\r\n        warning: {\r\n            main: \"#ff9800\",\r\n        },\r\n        success: {\r\n            main: \"#4caf50\",\r\n        },\r\n    },\r\n    secondary: {\r\n        main: \"#e91e63\",\r\n    },\r\n    info: {\r\n        main: \"#1976d2\",\r\n    },\r\n    error: {\r\n        main: \"#f44336\",\r\n    },\r\n    warning: {\r\n        main: \"#ff9800\",\r\n    },\r\n    success: {\r\n        main: \"#4caf50\",\r\n    },\r\n    textSecondary: {\r\n        main: \"#bdbdbd\",\r\n    },\r\n});\r\n// console.log(logger);\r\n\r\nlet loadData = new Promise((resolve, reject) => {\r\n    localforage\r\n        .getItem(\"state\")\r\n        .then((data) => {\r\n            resolve(data);\r\n        })\r\n        .catch((err) => {\r\n            reject(err);\r\n        });\r\n});\r\n\r\nloadData\r\n    .then((data) => {\r\n        let middleware = [reduxFreeze, createLogger()];\r\n        let store = createStore(\r\n            rootReducer,\r\n            // {},\r\n            data ? data : {},\r\n            // applyMiddleware(...middleware)\r\n        );\r\n        // initialize if ne\r\n        if (!data) {\r\n        }\r\n        store.subscribe(\r\n            throttle(() => {\r\n                let state = { ...store.getState() };\r\n                delete state[\"ui\"]; // don't persist ui sate\r\n                localforage.setItem(\"state\", state);\r\n            }, 1000)\r\n        );\r\n        // localforage.clear(function(err) {\r\n        //   // Run this code once the database has been entirely deleted.\r\n        //   console.log(\"Database is now empty.\");\r\n        // });\r\n        ReactDOM.render(\r\n            <Provider store={store}>\r\n                <ThemeProvider theme={theme}>\r\n                    <App />\r\n                </ThemeProvider>\r\n            </Provider>,\r\n            document.getElementById(\"root\")\r\n        );\r\n    })\r\n    .catch((err) => {\r\n        console.log(err);\r\n        ReactDOM.render(<div>Failed to initialize data!</div>, document.getElementById(\"root\"));\r\n    });\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}